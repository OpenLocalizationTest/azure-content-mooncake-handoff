{
  "nodes": [
    {
      "content": "高级存储：适用于 Azure 虚拟机工作负荷的高性能存储 | Azure",
      "pos": [
        27,
        63
      ]
    },
    {
      "content": "高级存储为 Azure 虚拟机上运行的 I/O 密集型工作负载提供高性能、低延迟的磁盘支持。Azure DS 系列和 GS 系列 VM 支持高级存储。",
      "pos": [
        82,
        157
      ]
    },
    {
      "content": "高级存储：适用于 Azure 虚拟机工作负荷的高性能存储",
      "pos": [
        360,
        388
      ]
    },
    {
      "content": "概述",
      "pos": [
        393,
        395
      ]
    },
    {
      "content": "Azure 高级存储为运行 I/O 密集型工作负荷的虚拟机提供高性能、低延迟的磁盘支持。在固态硬盘 (SSD) 上使用高级存储存储数据的虚拟机 (VM) 磁盘。可以将应用程序的 VM 磁盘迁移到 Azure 高级存储，以充分利用这些磁盘的速度和性能。",
      "pos": [
        397,
        522
      ]
    },
    {
      "content": "Azure VM 支持附加多个高级存储磁盘，使你的应用程序可以具有每个 VM 多达 64 TB 的存储空间。借助高级存储，应用程序对于每个 VM 可以实现 80,000 IOPS（每秒输入/输出操作数）和每秒 2000 MB 的磁盘吞吐量，并且读取操作的延迟非常低。",
      "pos": [
        524,
        657
      ]
    },
    {
      "content": "使用高级存储，Azure 提供的功能可真正将要求苛刻的企业应用程序（如 Dynamics AX、Dynamics CRM、Exchange Server、SharePoint 场和 SAP Business Suite）转移到云。你可以运行各种需要高级存储的一致高性能和低延迟的性能密集型数据库工作负荷，如 SQL Server、Oracle、MongoDB、MySQL、Redis。",
      "pos": [
        659,
        851
      ]
    },
    {
      "pos": [
        854,
        991
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> 建议将任何需要高 IOPS 的虚拟机磁盘迁移到 Azure 高级存储，以便你的应用程序实现最佳性能。如果你的磁盘不需要高 IOPS，你可以通过在标准存储（将虚拟机磁盘数据存储在硬盘驱动器 (HDD) 上而不是 SSD 上）中对其进行维护来限制成本。"
    },
    {
      "pos": [
        993,
        1148
      ],
      "content": "若要开始使用 Azure 高级存储，请访问<bpt id=\"p1\">[</bpt>开始免费试用<ept id=\"p1\">](/pricing/1rmb-trial/)</ept>页。有关将现有的虚拟机迁移到高级存储的信息，请参阅<bpt id=\"p2\">[</bpt>迁移到 Azure 高级存储<ept id=\"p2\">](/documentation/articles/storage-migration-to-premium-storage)</ept>。"
    },
    {
      "content": "有关高级存储的重要事项",
      "pos": [
        1153,
        1164
      ]
    },
    {
      "content": "以下是使用高级存储之前或使用高级存储时需考虑的重要事项列表：",
      "pos": [
        1166,
        1196
      ]
    },
    {
      "pos": [
        1200,
        1332
      ],
      "content": "若要使用高级存储，你必须有一个高级存储帐户。若要了解如何创建高级存储帐户，请参阅<bpt id=\"p1\">[</bpt>为磁盘创建和使用高级存储帐户<ept id=\"p1\">](#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk)</ept>。"
    },
    {
      "pos": [
        1336,
        1773
      ],
      "content": "高级存储已在<bpt id=\"p1\">[</bpt>管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>中提供并可通过以下 SDK 库来访问：<bpt id=\"p2\">[</bpt>存储 REST API<ept id=\"p2\">](http://msdn.microsoft.com/zh-cn/library/azure/dd179355.aspx)</ept> 版本 2014-02-14 或更高版本；<bpt id=\"p3\">[</bpt>服务管理 REST API<ept id=\"p3\">](http://msdn.microsoft.com/zh-cn/library/azure/ee460799.aspx)</ept> 版本 2014-10-01 或更高版本（经典部署）；<bpt id=\"p4\">[</bpt>存储资源提供程序 API<ept id=\"p4\">](http://msdn.microsoft.com/zh-cn/library/azure/mt163683.aspx)</ept>（ARM 部署）；以及 <bpt id=\"p5\">[</bpt>Azure PowerShell<ept id=\"p5\">](/documentation/articles/powershell-install-configure)</ept> 版本 0.8.10 或更高版本。"
    },
    {
      "pos": [
        1779,
        2003
      ],
      "content": "高级存储仅支持 Azure 页 Blob，用于保存适用于 Azure 虚拟机 (VM) 的持久性磁盘。有关 Azure 页 Blob 的信息，请参阅<bpt id=\"p1\">[</bpt>了解块 Blob、追加 Blob 和页 Blob<ept id=\"p1\">](http://msdn.microsoft.com/zh-cn/library/azure/ee691964.aspx)</ept>。高级存储不支持 Azure 块 Blob、Azure 追加 Blob、Azure 文件、Azure 表或 Azure 队列。"
    },
    {
      "pos": [
        2007,
        2145
      ],
      "content": "高级存储帐户是本地冗余 (LRS) 帐户，在单一区域内会保留三份数据。有关使用高级存储时的异地复制注意事项，请参阅本文中的<bpt id=\"p1\">[</bpt>使用高级存储时的快照与复制 Blob<ept id=\"p1\">](#snapshots-and-copy-blob-when-using-premium-storage)</ept> 部分。"
    },
    {
      "pos": [
        2149,
        2340
      ],
      "content": "如果你希望 VM 磁盘使用高级存储帐户，你必须使用 DS 或 GS 系列的 VM。DS 或 GS 系列的 VM 可同时使用标准和高级存储磁盘。非 DS 或非 GS 系列的 VM 无法使用高级存储磁盘。有关可用 Azure VM 磁盘类型和大小的详细信息，请参阅<bpt id=\"p1\">[</bpt>虚拟机大小<ept id=\"p1\">](/documentation/articles/virtual-machines-size-specs)</ept>。"
    },
    {
      "pos": [
        2344,
        2526
      ],
      "content": "为 VM 设置高级存储磁盘的过程，与设置标准存储磁盘的过程类似。你需要为 Azure 磁盘和 VM 选择最适合的高级存储选项。根据高级产品的性能特征，VM 大小应适合工作负载。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>使用高级存储时的缩放性和性能目标<ept id=\"p1\">](#scalability-and-performance-targets-when-using-premium-storage)</ept>。"
    },
    {
      "content": "高级存储帐户无法映射到自定义域名。",
      "pos": [
        2530,
        2547
      ]
    },
    {
      "pos": [
        2551,
        2939
      ],
      "content": "存储分析目前不支持高级存储。若要使用高级存储帐户上的磁盘分析 VM 的性能度量值，请使用基于操作系统的工具，如 <bpt id=\"p1\">[</bpt>Windows 性能监视器<ept id=\"p1\">](https://technet.microsoft.com/zh-cn/library/cc749249.aspx)</ept>（对于 Windows VM）和 <bpt id=\"p2\">[</bpt>IOSTAT<ept id=\"p2\">](http://linux.die.net/man/1/iostat)</ept>（对于 Linux VM）。你还可以在 Azure 门户上启用 Azure VM 诊断。有关详细信息，请参阅<bpt id=\"p3\">[</bpt>使用 Azure Diagnostics 扩展监视 Azure 虚拟机<ept id=\"p3\">](https://azure.microsoft.com/blog/2014/09/02/windows-azure-virtual-machine-monitoring-with-wad-extension/)</ept>。"
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"using-premium-storage-for-disks\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> 使用高级存储磁盘",
      "pos": [
        2943,
        2996
      ]
    },
    {
      "content": "可通过两种方式使用高级存储磁盘：",
      "pos": [
        2997,
        3013
      ]
    },
    {
      "content": "首先创建新的高级存储帐户，然后在创建 VM 时使用它。",
      "pos": [
        3017,
        3044
      ]
    },
    {
      "content": "创建新的 DS 或 GS 系列 VM。创建 VM 时，你可以选择以前创建的高级存储帐户、创建新的高级存储帐户，或者让 Azure 门户创建默认的高级帐户。",
      "pos": [
        3047,
        3124
      ]
    },
    {
      "content": "Azure 使用存储帐户作为操作系统和数据磁盘的容器。换句话说，如果你创建 Azure DS 系列或 GS 系列的 VM 并选择 Azure 高级存储帐户，操作系统和数据磁盘会存储在该存储帐户中。",
      "pos": [
        3126,
        3224
      ]
    },
    {
      "pos": [
        3226,
        3328
      ],
      "content": "有关将现有的虚拟机迁移到高级存储的信息，请参阅<bpt id=\"p1\">[</bpt>迁移到 Azure 高级存储<ept id=\"p1\">](/documentation/articles/storage-migration-to-premium-storage)</ept>。"
    },
    {
      "pos": [
        3330,
        3780
      ],
      "content": "为充分利用高级存储的优点，请先使用帐户类型 <bpt id=\"p1\">*</bpt>Premium_LRS<ept id=\"p1\">*</ept> 创建一个高级存储帐户。若要执行此操作，可以使用 <bpt id=\"p2\">[</bpt>Azure 门户<ept id=\"p2\">](https://manage.windowsazure.cn)</ept>、<bpt id=\"p3\">[</bpt>Azure PowerShell<ept id=\"p3\">](/documentation/articles/powershell-install-configure)</ept>、<bpt id=\"p4\">[</bpt>服务管理 REST API<ept id=\"p4\">](http://msdn.microsoft.com/zh-cn/library/azure/ee460799.aspx)</ept>（经典部署）或<bpt id=\"p5\">[</bpt>存储资源提供程序 REST API<ept id=\"p5\">](http://msdn.microsoft.com/zh-cn/library/azure/mt163683.aspx)</ept>（ARM 部署）。有关分步说明，请参阅<bpt id=\"p6\">[</bpt>为磁盘创建和使用高级存储帐户<ept id=\"p6\">](#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk)</ept>。"
    },
    {
      "content": "重要说明：",
      "pos": [
        3786,
        3791
      ]
    },
    {
      "pos": [
        3795,
        4063
      ],
      "content": "有关高级存储帐户的容量和带宽限制的详细信息，请参阅<bpt id=\"p1\">[</bpt>使用高级存储时的缩放性和性能目标<ept id=\"p1\">](#scalability-and-performance-targets-when-using-premium-storage)</ept>部分。如果你的应用程序的需求超过了单个存储帐户的可伸缩性目标，则在生成应用程序时请让它使用多个存储帐户，并将数据分布在这些存储帐户中。例如，如果要将 51 TB 的磁盘附加到多个 VM，请将它们分布在两个存储帐户中，因为 35 TB 是单个高级存储帐户的限制。请确保单个高级存储帐户永远不会超过 35 TB 的设置磁盘。"
    },
    {
      "content": "默认情况下，所有高级数据磁盘的磁盘缓存策略都是“只读的”，所有附加到 VM 的高级操作系统都是“读写的”。为使应用程序的 I/O 达到最佳性能，建议使用此配置设置。对于频繁写入或只写的磁盘（例如 SQL Server 日志文件），禁用磁盘缓存可获得更佳的应用程序性能。",
      "pos": [
        4066,
        4200
      ]
    },
    {
      "content": "确保 VM 上有足够的带宽来驱动磁盘通信。例如，STANDARD_DS1 VM 为高级存储磁盘通信提供每秒 32 MB 的专用带宽。这意味着，附加到此 VM 的 P10 高级存储磁盘最高只能达到每秒 32 MB，而不能像 P10 磁盘那样最高达到每秒 100 MB。同样，STANDARD_DS13 VM 可跨所有磁盘最高达到每秒 256 MB。目前，DS 系列上的最大 VM 是 STANDARD_DS14，它可以跨所有磁盘最高提供每秒 512 MB。GS 系列上的最大 VM 是 STANDARD_GS5，它可以跨所有磁盘最高提供每秒 2000 MB。",
      "pos": [
        4203,
        4481
      ]
    },
    {
      "content": "请注意，这些限制只适用于磁盘流量，而不包括缓存命中和网络流量。VM 网络通信可以使用单独的带宽，这不同于高级存储磁盘的专用带宽。",
      "pos": [
        4487,
        4551
      ]
    },
    {
      "pos": [
        4557,
        4786
      ],
      "content": "有关 DS 系列和 GS 系列 VM 的最大 IOPS 与吞吐量（带宽）的最新信息，请参阅<bpt id=\"p1\">[</bpt>虚拟机的大小<ept id=\"p1\">](/documentation/articles/virtual-machines-size-specs)</ept>。若要了解高级存储磁盘及其 IOPS 和吞吐量限制，请参阅本文的<bpt id=\"p2\">[</bpt>使用高级存储时的可伸缩性和性能目标<ept id=\"p2\">](#scalability-and-performance-targets-when-using-premium-storage)</ept>部分中的表格。"
    },
    {
      "pos": [
        4790,
        5020
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> 缓存命中数不受到磁盘配置 IOPS/吞吐量的限制。也就是说，当你在 DS 系列或 GS 系列 VM 上使用具有 ReadOnly 缓存设置的数据磁盘时，缓存提供的读取数不受高级存储磁盘限制的约束。因此，如果工作负荷以读取为主，可以从磁盘获得极高的吞吐量。请注意，缓存根据 VM 大小受到 VM 级别不同的 IOPS / 吞吐量的限制。DS 系列 VM 大约有 4000 IOPS，缓存与本地 SSD IO 是每个核心 33 MB/秒。"
    },
    {
      "content": "可以在同一个 DS 系列或 GS 系列 VM 中同时使用高级和标准存储磁盘。",
      "pos": [
        5024,
        5062
      ]
    },
    {
      "pos": [
        5065,
        5757
      ],
      "content": "使用高级存储时，可以设置 DS 系列 VM 并将多个持久性数据磁盘附加到 VM。如有需要，可以跨磁盘条带化，以增加卷的容量与性能。如果你使用<bpt id=\"p1\">[</bpt>存储空间<ept id=\"p1\">](http://technet.microsoft.com/zh-cn/library/hh831739.aspx)</ept>来条带化高级存储数据磁盘，应该以使用的每个磁盘一个列的方式来配置它。否则，条带化卷的整体性能可能会低于预期，因为磁盘之间的通信分配不平均。默认情况下，服务器管理器用户界面 (UI) 可让你设置最多包含 8 个磁盘的列。但如果磁盘超过 8 个，则你必须使用 PowerShell 来创建卷，并手动指定列数。否则，即使你有更多磁盘，服务器管理器 UI 仍会继续使用 8 个列。例如，如果在一个条带集中有 32 个磁盘，则你应该指定 32 列。可以使用 <bpt id=\"p2\">[</bpt>New-VirtualDisk<ept id=\"p2\">](http://technet.microsoft.com/zh-cn/library/hh848643.aspx)</ept> PowerShell cmdlet 的 <bpt id=\"p3\">*</bpt>NumberOfColumns<ept id=\"p3\">*</ept> 参数来指定虚拟磁盘使用的列数。有关详细信息，请参阅<bpt id=\"p4\">[</bpt>存储空间概述<ept id=\"p4\">](http://technet.microsoft.com/zh-cn/library/hh831739.aspx)</ept>和<bpt id=\"p5\">[</bpt>存储空间常见问题<ept id=\"p5\">](http://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx)</ept>。"
    },
    {
      "pos": [
        5760,
        5998
      ],
      "content": "避免将 DS 系列虚拟机添加到包含非 DS 系列 VM 的现有云服务。可能的解决方法是将现有 VHD 迁移到只运行 DS 系列 VM 的新云服务。如果想要保留托管 DS 系列 VM 的新云服务的相同虚拟 IP 地址 (VIP)，请使用<bpt id=\"p1\">[</bpt>保留 IP 地址<ept id=\"p1\">](/documentation/articles/virtual-networks-configure-vnet-to-vnet-connection)</ept>功能。GS 系列 VM 只能添加到运行 G 系列 VM 的现有云服务。"
    },
    {
      "content": "可以将 DS 系列 Azure 虚拟机配置为使用标准存储帐户或高级存储帐户上托管的操作系统 (OS) 磁盘。如果 OS 磁盘只是用于引导，则你可以考虑使用基于标准存储的 OS 磁盘。这样既可以提高性价比，又可以在引导后提供类似于高级存储的性能。如果在除引导以外的 OS 磁盘上执行任何其他任务，请使用高级存储，因为它提供更好的性能。例如，如果你的应用程序要与 OS 磁盘相互读/写数据，则使用基于高级存储的 OS 磁盘可为 VM 提供更好的性能。",
      "pos": [
        6001,
        6224
      ]
    },
    {
      "pos": [
        6227,
        6342
      ],
      "content": "可以对高级存储使用 <bpt id=\"p1\">[</bpt>Azure 命令行界面 (Azure CLI)<ept id=\"p1\">](/documentation/articles/xplat-cli-install)</ept>。若要使用 Azure CLI 更改某个磁盘上的缓存策略，请运行以下命令："
    },
    {
      "content": "请注意，缓存策略选项可以是 ReadOnly、None 或 ReadWrite。有关更多选项，请通过运行以下命令查看帮助：",
      "pos": [
        6412,
        6473
      ]
    },
    {
      "pos": [
        6513,
        6605
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"scalability-and-performance-targets-when-using-premium-storage\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> 使用高级存储时的缩放性和性能目标"
    },
    {
      "content": "当你为某个高级存储帐户设置磁盘时，其每秒的输入/输出操作次数 (IOPS) 和吞吐量（带宽）取决于磁盘大小。目前有三种类型的高级存储磁盘：P10、P20 和 P30。每种类型各有特定的 IOPS 和吞吐量限制，如下表所示：",
      "pos": [
        6607,
        6718
      ]
    },
    {
      "content": "高级存储磁盘类型",
      "pos": [
        6835,
        6843
      ]
    },
    {
      "content": "P10",
      "pos": [
        6874,
        6877
      ]
    },
    {
      "content": "P20",
      "pos": [
        6908,
        6911
      ]
    },
    {
      "content": "P30",
      "pos": [
        6942,
        6945
      ]
    },
    {
      "content": "磁盘大小",
      "pos": [
        6987,
        6991
      ]
    },
    {
      "content": "128 GiB",
      "pos": [
        7014,
        7021
      ]
    },
    {
      "content": "512 GiB",
      "pos": [
        7035,
        7042
      ]
    },
    {
      "content": "1024 GiB (1 TB)",
      "pos": [
        7056,
        7071
      ]
    },
    {
      "content": "每个磁盘的 IOPS",
      "pos": [
        7104,
        7114
      ]
    },
    {
      "content": "500",
      "pos": [
        7137,
        7140
      ]
    },
    {
      "content": "2300",
      "pos": [
        7154,
        7158
      ]
    },
    {
      "content": "5000",
      "pos": [
        7172,
        7176
      ]
    },
    {
      "content": "每个磁盘的吞吐量",
      "pos": [
        7209,
        7217
      ]
    },
    {
      "content": "每秒 100 MB *",
      "pos": [
        7240,
        7251
      ]
    },
    {
      "content": "每秒 150 MB *",
      "pos": [
        7265,
        7276
      ]
    },
    {
      "content": "每秒 200 MB *",
      "pos": [
        7290,
        7301
      ]
    },
    {
      "pos": [
        7334,
        7474
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> 请确保 VM 上有足够的带宽可用来驱动磁盘通信，如本文前面的<bpt id=\"p1\">[</bpt>使用高级存储磁盘<ept id=\"p1\">](#using-premium-storage-for-disks)</ept>部分中所述。否则，将会根据 VM 限制而不是上表中提到的磁盘限制，将磁盘吞吐量和 IOPS 约束为较小值。"
    },
    {
      "content": "Azure 会将磁盘大小映射（向上舍入）至表中指定的最接近高级存储磁盘选项。例如，大小为 100 GiB 的磁盘会分类为 P10 选项，每秒最多可执行 500 个 IO 单位，每秒吞吐量可达 100 MB。同样地，大小为 400 GiB 的磁盘会分类为 P20 选项，每秒最多可执行 2300 个 IO 单位，每秒吞吐量可达 150 MB。",
      "pos": [
        7476,
        7646
      ]
    },
    {
      "content": "输入/输出 (I/O) 单位大小为 256 KB。如果要传送的数据少于 256 KB，会视为单个 I/O 单位。较大的 I/O 大小则会视为大小是 256 KB 的多个 I/O。例如，1100 KB 的 I/O 会视为五个 I/O 单位。",
      "pos": [
        7648,
        7767
      ]
    },
    {
      "content": "吞吐量限制包括磁盘写入，以及不是从缓存进行的磁盘读取。例如，P10 磁盘的非缓存读取和写入总和应小于或等于每秒 100 MB。同样地，单个 P10 磁盘可有每秒 100 MB 的非缓存读取或每秒 100 MB 的写入吞吐量，或是每秒 60 MB 的读取和每秒 40 MB 的写入吞吐量。",
      "pos": [
        7769,
        7912
      ]
    },
    {
      "content": "当你在 Azure 创建磁盘后，请根据应用程序的容量、性能、缩放性和高峰负载需求来选择最适合的高级存储磁盘产品。",
      "pos": [
        7914,
        7970
      ]
    },
    {
      "pos": [
        7974,
        8180
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> 你可以轻松增加现有磁盘的大小。例如，如果你想要将 30 GB 大小的磁盘增加到 128 GB 或 1 TB。或者，如果想要将 P20 磁盘转换为 P30 磁盘，因为需要更多容量或更多的 IOPS 和吞吐量。可以使用“Update-AzureDisk”PowerShell 命令配合“-ResizedSizeInGB”属性来扩展磁盘。若要执行此操作，需要先从 VM 分离磁盘或停止 VM。"
    },
    {
      "content": "下表描述高级存储帐户的缩放性目标：",
      "pos": [
        8182,
        8199
      ]
    },
    {
      "content": "总帐户容量",
      "pos": [
        8316,
        8321
      ]
    },
    {
      "content": "本地冗余存储帐户的总带宽",
      "pos": [
        8352,
        8364
      ]
    },
    {
      "content": "磁盘容量：35 TB",
      "pos": [
        8430,
        8440
      ]
    },
    {
      "content": "快照容量：10 TB",
      "pos": [
        8468,
        8478
      ]
    },
    {
      "content": "入站 + 出站最高每秒 50 Gbps",
      "pos": [
        8512,
        8531
      ]
    },
    {
      "content": "入站是指发送到存储帐户的所有数据（请求）。",
      "pos": [
        8564,
        8585
      ]
    },
    {
      "content": "出站是指从存储帐户接收的所有数据（响应）。",
      "pos": [
        8588,
        8609
      ]
    },
    {
      "pos": [
        8611,
        8696
      ],
      "content": "有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure 存储空间缩放性和性能目标<ept id=\"p1\">](/documentation/articles/storage-scalability-targets)</ept>。"
    },
    {
      "content": "使用高级存储时的限制",
      "pos": [
        8701,
        8711
      ]
    },
    {
      "content": "如果应用程序的 IOPS 或吞吐量超出了分配的高级存储磁盘限制，或者 VM 上所有磁盘的总磁盘通信超出了 VM 可用的磁盘带宽限制，则可能会有限制情况。若要避免限制，建议根据设置的磁盘缩放性和性能目标，以及 VM 可用的磁盘带宽，来限制磁盘的挂起 I/O 请求数。",
      "pos": [
        8712,
        8844
      ]
    },
    {
      "content": "当应用程序设计为避免限制情况时，可以达到最低延迟。另一方面，如果磁盘的挂起 I/O 请求数过小，应用程序便无法利用磁盘可用的最大 IOPS 和吞吐量级别。",
      "pos": [
        8846,
        8923
      ]
    },
    {
      "content": "以下示例演示了如何计算限制级别：",
      "pos": [
        8925,
        8941
      ]
    },
    {
      "content": "示例 1：",
      "pos": [
        8947,
        8952
      ]
    },
    {
      "content": "在 P10 磁盘上，应用程序一秒内有 495 个 16 KB 磁盘大小的 I/O（相当于 495 个 I/O 单位）。如果你在该秒内尝试 2 MB 的 I/O，I/O 单位的总数会等于 495 + 8。这是因为当 I/O 单位大小是 256 KB 时，2 MB 的 I/O 会产生 2048 KB / 256 KB = 8 个 I/O 单位。因为 495 + 8 的总和超出磁盘 500 的 IOPS 限制，因此会发生限制情况。",
      "pos": [
        8953,
        9167
      ]
    },
    {
      "content": "注意：",
      "pos": [
        9173,
        9176
      ]
    },
    {
      "content": "所有计算都是基于 256 KB 的 I/O 单位大小。",
      "pos": [
        9177,
        9204
      ]
    },
    {
      "content": "示例 2：",
      "pos": [
        9210,
        9215
      ]
    },
    {
      "content": "在 P10 磁盘上，应用程序有 400 个 256 KB 磁盘大小的 I/O。使用的总带宽为 (400 * 256) / 1024 = 100 MB/秒。请注意，每秒 100 MB 是 P10 磁盘的吞吐量限制。如果应用程序尝试在该秒内执行更多 I/O 便会发生限制情况，因为会超出分配的限制。",
      "pos": [
        9216,
        9363
      ]
    },
    {
      "content": "示例 3：",
      "pos": [
        9369,
        9374
      ]
    },
    {
      "content": "某个 DS4 VM 附加了两个 P30 磁盘。每个 P30 磁盘的吞吐量可达到每秒 200 MB。但是，DS4 VM 的总磁盘带宽容量为每秒 256 MB。因此，你无法在此 DS4 VM 上同时以最大吞吐量驱动附加的磁盘。若要解决此问题，你可以在一个磁盘上保持每秒 200 MB 的通信，在另一个磁盘上保持每秒 56 MB。如果磁盘通信的总和超出每秒 256 MB，磁盘通信将受到限制。",
      "pos": [
        9375,
        9568
      ]
    },
    {
      "content": "注意：",
      "pos": [
        9574,
        9577
      ]
    },
    {
      "content": "如果磁盘通信大多包含小型 I/O，应用程序在达到吞吐量限制前很可能会先达到 IOPS 限制。另一方面，如果磁盘通信主要包含大型 I/O，应用程序可能会达到吞吐量限制，而非 IOPS 限制。可以使用最佳的 I/O 大小和限制磁盘的挂起 I/O 请求数，来最大化应用程序的 IOPS 和吞吐量容量。",
      "pos": [
        9578,
        9725
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"snapshots-and-copy-blob-when-using-premium-storage\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> 使用高级存储时的快照与复制 Blob",
      "pos": [
        9729,
        9811
      ]
    },
    {
      "content": "可以像使用标准存储时创建快照的方式来为高级存储创建快照。由于高级存储是本地冗余存储，因此建议你创建快照，并将那些快照复制到地域冗余的标准存储帐户。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure 存储冗余选项<ept id=\"p1\">](/documentation/articles/storage-redundancy)</ept>。",
      "pos": [
        9812,
        9955
      ]
    },
    {
      "pos": [
        9957,
        10325
      ],
      "content": "如果磁盘已附加到 VM，在备份磁盘的页 Blob 上不允许某些 API 操作。例如，只要磁盘附加到 VM，你就无法在该 Blob 上执行<bpt id=\"p1\">[</bpt>复制 Blob<ept id=\"p1\">](http://msdn.microsoft.com/zh-cn/library/azure/dd894037.aspx)</ept> 操作。此时，你必须先使用<bpt id=\"p2\">[</bpt>快照 Blob<ept id=\"p2\">](http://msdn.microsoft.com/zh-cn/library/azure/ee691971.aspx)</ept> REST API 方法创建该 Blob 的快照，然后对该快照执行<bpt id=\"p3\">[</bpt>复制 Blob<ept id=\"p3\">](http://msdn.microsoft.com/zh-cn/library/azure/dd894037.aspx)</ept> 以复制附加的磁盘。或者，可以中断附加磁盘，然后在基础 Blob 上执行任何必要的操作。"
    },
    {
      "content": "重要说明：",
      "pos": [
        10331,
        10336
      ]
    },
    {
      "content": "单个 Blob 的快照数限制为 100。每 10 分钟最多可获取一个快照。",
      "pos": [
        10340,
        10377
      ]
    },
    {
      "content": "每个高级存储帐户的最大快照容量为 10 TB。请注意，快照容量仅指快照中的数据总量，而不包括基本 Blob 中的数据。",
      "pos": [
        10380,
        10439
      ]
    },
    {
      "pos": [
        10442,
        10657
      ],
      "content": "若要维护快照的异地冗余副本，你可以使用 AzCopy 或“复制 Blob”将高级存储帐户中的快照复制到异地冗余的标准存储帐户。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>如何对 Azure 存储空间使用 AzCopy<ept id=\"p1\">](/documentation/articles/storage-use-azcopy)</ept> 和<bpt id=\"p2\">[</bpt>复制 Blob<ept id=\"p2\">](http://msdn.microsoft.com/zh-cn/library/azure/dd894037.aspx)</ept>。"
    },
    {
      "pos": [
        10660,
        10789
      ],
      "content": "有关对高级存储帐户中的页 Blob 执行 REST 操作的详细信息，请参阅 MSDN 库中的<bpt id=\"p1\">[</bpt>对 Azure 高级存储使用 Blob 服务操作<ept id=\"p1\">](https://msdn.microsoft.com/zh-cn/library/dn889922.aspx)</ept>。"
    },
    {
      "content": "在高级存储中使用 Linux VM",
      "pos": [
        10794,
        10811
      ]
    },
    {
      "content": "请参考以下重要说明，以了解如何在高级存储上配置 Linux VM：",
      "pos": [
        10812,
        10845
      ]
    },
    {
      "content": "对于缓存设置为“ReadOnly”或“None”的所有高级存储磁盘，必须在装入文件系统时禁用“屏障”，以实现高级存储的伸放性目标。对于这种情况你不需要屏障，因为写入高级存储支持的磁盘对于这些缓存设置是持久的。在成功完成写入请求时，数据已写入到持久存储。请根据你的文件系统，使用以下方法来禁用“屏障”：",
      "pos": [
        10849,
        10999
      ]
    },
    {
      "pos": [
        11006,
        11078
      ],
      "content": "如果你使用的是 <bpt id=\"p1\">**</bpt>reiserFS<ept id=\"p1\">**</ept>，请使用装入选项“barrier=none”禁用屏障（要启用屏障，请使用“barrier=flush”）"
    },
    {
      "pos": [
        11085,
        11151
      ],
      "content": "如果你使用的是 <bpt id=\"p1\">**</bpt>ext3/ext4<ept id=\"p1\">**</ept>，请使用装入选项“barrier=0”禁用屏障（要启用屏障，请使用“barrier=1”）"
    },
    {
      "pos": [
        11158,
        11216
      ],
      "content": "如果你使用的是 <bpt id=\"p1\">**</bpt>XFS<ept id=\"p1\">**</ept>，请使用装入选项“nobarrier”禁用屏障（要启用屏障，请使用“barrier”）"
    },
    {
      "content": "对于缓存设置为“ReadWrite”的高级存储磁盘，应该启用屏障以实现写入持久性。",
      "pos": [
        11220,
        11261
      ]
    },
    {
      "pos": [
        11264,
        11406
      ],
      "content": "若要在重新启动 VM 后保留卷标，你必须使用对磁盘的 UUID 引用来更新 /etc/fstab。另请参阅<bpt id=\"p1\">[</bpt>如何将数据磁盘附加到 Linux 虚拟机<ept id=\"p1\">](/documentation/articles/virtual-machines-linux-how-to-attach-disk)</ept>"
    },
    {
      "content": "以下是我们使用高级存储验证过的 Linux 分发版。我们建议将 VM 升级到其中至少一个版本（或更新版本），以改进高级存储的性能和稳定性。此外，某些版本需要最新的 LIS（适用于 Azure 的 Linux Integration Services v4.0）。请使用下面提供的链接进行下载和安装。在我们完成其他验证后，将陆续在列表中添加更多映像。请注意，我们的验证表明，性能根据映像而有所不同，并且还取决于工作负荷特征和映像上的设置。不同的映像已针对不同种类的工作负荷进行优化。",
      "pos": [
        11408,
        11648
      ]
    },
    {
      "content": "分发",
      "pos": [
        11764,
        11766
      ]
    },
    {
      "content": "版本",
      "pos": [
        11797,
        11799
      ]
    },
    {
      "content": "支持的内核",
      "pos": [
        11830,
        11835
      ]
    },
    {
      "content": "支持的映像",
      "pos": [
        11866,
        11871
      ]
    },
    {
      "content": "Ubuntu",
      "pos": [
        11925,
        11931
      ]
    },
    {
      "content": "12.04",
      "pos": [
        11954,
        11959
      ]
    },
    {
      "content": "3.2.0-75.110",
      "pos": [
        11973,
        11985
      ]
    },
    {
      "content": "Ubuntu-12_04_5-LTS-amd64-server-20150119-en-us-30GB",
      "pos": [
        11999,
        12050
      ]
    },
    {
      "content": "14.04",
      "pos": [
        12075,
        12080
      ]
    },
    {
      "content": "3.13.0-44.73",
      "pos": [
        12094,
        12106
      ]
    },
    {
      "content": "Ubuntu-14_04_1-LTS-amd64-server-20150123-en-us-30GB",
      "pos": [
        12120,
        12171
      ]
    },
    {
      "content": "14.10",
      "pos": [
        12196,
        12201
      ]
    },
    {
      "content": "3.16.0-29.39",
      "pos": [
        12215,
        12227
      ]
    },
    {
      "content": "Ubuntu-14_10-amd64-server-20150202-en-us-30GB",
      "pos": [
        12241,
        12286
      ]
    },
    {
      "content": "15.04",
      "pos": [
        12311,
        12316
      ]
    },
    {
      "content": "3.19.0-15",
      "pos": [
        12330,
        12339
      ]
    },
    {
      "content": "Ubuntu-15_04-amd64-server-20150422-en-us-30GB",
      "pos": [
        12353,
        12398
      ]
    },
    {
      "content": "SUSE",
      "pos": [
        12431,
        12435
      ]
    },
    {
      "content": "SLES 12",
      "pos": [
        12458,
        12465
      ]
    },
    {
      "content": "3.12.36-38.1",
      "pos": [
        12479,
        12491
      ]
    },
    {
      "content": "suse-sles-12-priority-v20150213",
      "pos": [
        12505,
        12536
      ]
    },
    {
      "content": "suse-sles-12-v20150213",
      "pos": [
        12540,
        12562
      ]
    },
    {
      "content": "CoreOS",
      "pos": [
        12595,
        12601
      ]
    },
    {
      "content": "584.0.0",
      "pos": [
        12624,
        12631
      ]
    },
    {
      "content": "3.18.4",
      "pos": [
        12645,
        12651
      ]
    },
    {
      "content": "CoreOS 584.0.0",
      "pos": [
        12665,
        12679
      ]
    },
    {
      "content": "CentOS",
      "pos": [
        12724,
        12730
      ]
    },
    {
      "content": "6.5, 6.6, 6.7, 7.0",
      "pos": [
        12753,
        12771
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n        &lt;a href=\"http://go.microsoft.com/fwlink/?LinkID=403033&amp;clcid=0x409\"&gt;</ph> 需要 LIS 4.0 <ph id=\"ph2\">&lt;/a&gt;</ph><ph id=\"ph3\"> </ph>",
      "pos": [
        12799,
        12893
      ]
    },
    {
      "content": "7.1",
      "pos": [
        12945,
        12948
      ]
    },
    {
      "content": "3.10.0-229.1.2.el7",
      "pos": [
        12962,
        12980
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n        &lt;a href=\"http://go.microsoft.com/fwlink/?LinkID=403033&amp;clcid=0x409\"&gt;</ph> 建议使用 LIS 4.0 <ph id=\"ph2\">&lt;/a&gt;</ph><ph id=\"ph3\"> </ph>",
      "pos": [
        12994,
        13090
      ]
    },
    {
      "content": "Oracle",
      "pos": [
        13163,
        13169
      ]
    },
    {
      "content": "6.4",
      "pos": [
        13192,
        13195
      ]
    },
    {
      "content": "需要 LIS 4.0",
      "pos": [
        13292,
        13302
      ]
    },
    {
      "content": "7.0",
      "pos": [
        13332,
        13335
      ]
    },
    {
      "content": "联系支持人员以获取详细信息",
      "pos": [
        13363,
        13376
      ]
    },
    {
      "content": "Openlogic CentOS 的 LIS 驱动程序",
      "pos": [
        13412,
        13439
      ]
    },
    {
      "content": "运行 OpenLogic CentOS VM 的客户应该运行以下命令来安装最新的驱动程序：",
      "pos": [
        13441,
        13486
      ]
    },
    {
      "content": "需要重新启动才能激活新的驱动程序。",
      "pos": [
        13606,
        13623
      ]
    },
    {
      "content": "使用高级存储时的定价和计费方式",
      "pos": [
        13630,
        13645
      ]
    },
    {
      "content": "使用高级存储时，请注意以下计费方式：",
      "pos": [
        13646,
        13664
      ]
    },
    {
      "pos": [
        13668,
        13923
      ],
      "content": "高级存储磁盘的计费根据是磁盘的设置大小。Azure 会将磁盘大小（向上舍入）映射到<bpt id=\"p1\">[</bpt>使用高级存储时的缩放性和性能目标<ept id=\"p1\">](#scalability-and-performance-targets-when-using-premium-storage)</ept>部分的表中指定的最接近高级存储磁盘。任何已设置的磁盘都是按每月的高级存储优惠价格以每小时的方式计费。例如，如果你在设置完 P10 磁盘的 20 小时后删除它，则会以 20 小时计算 P10 解决方案的费用。这与写入磁盘的实际数据量或使用的 IOPS/吞吐量无关。"
    },
    {
      "pos": [
        13926,
        14038
      ],
      "content": "高级存储上的快照会因为使用的额外容量而产生费用。有关快照的详细信息，请参阅<bpt id=\"p1\">[</bpt>创建 Blob 的快照<ept id=\"p1\">](http://msdn.microsoft.com/zh-cn/library/azure/hh488361.aspx)</ept>。"
    },
    {
      "pos": [
        14041,
        14109
      ],
      "content": "<bpt id=\"p1\">[</bpt>出站数据传输<ept id=\"p1\">](/pricing/details/data-transfers/)</ept>（Azure 数据中心送出的数据）会产生带宽使用费。"
    },
    {
      "content": "有关高级存储与 DS 和 GS 系列 VM 定价的详细信息，请参阅：",
      "pos": [
        14111,
        14145
      ]
    },
    {
      "content": "Azure 存储定价",
      "pos": [
        14150,
        14160
      ]
    },
    {
      "content": "虚拟机定价",
      "pos": [
        14195,
        14200
      ]
    },
    {
      "pos": [
        14244,
        14350
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> 为虚拟机器数据磁盘创建和使用高级存储帐户"
    },
    {
      "content": "本部分演示如何使用 Azure PowerShell 和 Azure 命令行界面 (Azure CLI) 创建高级存储帐户。另外，还演示了高级存储帐户的示例用例：在使用高级存储帐户时创建虚拟机，并将数据磁盘附加到虚拟机。",
      "pos": [
        14352,
        14462
      ]
    },
    {
      "content": "通过 Azure PowerShell 使用高级存储创建 Azure 虚拟机",
      "pos": [
        14469,
        14507
      ]
    },
    {
      "content": "本 PowerShell 示例演示如何创建新的高级存储帐户并将使用该帐户的数据磁盘附加到新的 Azure 虚拟机。",
      "pos": [
        14508,
        14565
      ]
    },
    {
      "pos": [
        14570,
        14676
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>如何安装和配置 Azure PowerShell<ept id=\"p1\">](/documentation/articles/powershell-install-configure)</ept> 中提供的步骤设置 PowerShell 环境。"
    },
    {
      "pos": [
        14680,
        14802
      ],
      "content": "启动 PowerShell 控制台，连接到订阅，并在控制台窗口中运行以下 PowerShell cmdlet。如此 PowerShell 语句中所示，当你创建高级存储帐户时，必须将 <bpt id=\"p1\">**</bpt>Type<ept id=\"p1\">**</ept> 参数指定为 <bpt id=\"p2\">**</bpt>Premium_LRS<ept id=\"p2\">**</ept>。"
    },
    {
      "content": "接下来，请创建新的 DS 系列 VM，并在控制台窗口中运行以下 PowerShell cmdlet 以指定要使用高级存储。可以使用相同的步骤创建 GS 系列 VM。在命令中指定适当的 VM 大小。例如，Standard_GS2：",
      "pos": [
        14924,
        15038
      ]
    },
    {
      "content": "如果希望 VM 有更多的磁盘空间，请在创建虚拟机后于控制台窗口中运行以下 PowerShell cmdlet 以将新的数据磁盘附加到现有 DS 系列或 GS 系列 VM。",
      "pos": [
        15766,
        15851
      ]
    },
    {
      "content": "通过 Azure 命令行界面使用高级存储创建 Azure 虚拟机",
      "pos": [
        16318,
        16350
      ]
    },
    {
      "pos": [
        16352,
        16518
      ],
      "content": "<bpt id=\"p1\">[</bpt>Azure 命令行界面<ept id=\"p1\">](/documentation/articles/xplat-cli-install)</ept> (Azure CLI) 提供一组可在 Azure 平台上运行的开放源代码跨平台命令。以下示例演示如何使用 Azure CLI（0.8.14 和更高版本）创建高级存储帐户、新的虚拟机，以及从高级存储帐户附加新的数据磁盘。"
    },
    {
      "content": "创建高级存储帐户",
      "pos": [
        16525,
        16533
      ]
    },
    {
      "content": "创建 DS 系列虚拟机",
      "pos": [
        16629,
        16640
      ]
    },
    {
      "content": "显示有关虚拟机的信息",
      "pos": [
        16848,
        16858
      ]
    },
    {
      "content": "附加新的数据磁盘",
      "pos": [
        16900,
        16908
      ]
    },
    {
      "content": "显示有关新数据磁盘的信息",
      "pos": [
        17041,
        17053
      ]
    },
    {
      "content": "后续步骤",
      "pos": [
        17135,
        17139
      ]
    },
    {
      "content": "对 Azure 高级存储使用 Blob 服务操作",
      "pos": [
        17144,
        17168
      ]
    },
    {
      "content": "迁移到 Azure 高级存储",
      "pos": [
        17229,
        17243
      ]
    },
    {
      "content": "在 Azure 门户中创建 Windows 虚拟机",
      "pos": [
        17310,
        17335
      ]
    },
    {
      "content": "虚拟机的大小",
      "pos": [
        17414,
        17420
      ]
    },
    {
      "content": "存储文档",
      "pos": [
        17478,
        17482
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"高级存储：适用于 Azure 虚拟机工作负荷的高性能存储 | Azure\"\n    description=\"高级存储为 Azure 虚拟机上运行的 I/O 密集型工作负载提供高性能、低延迟的磁盘支持。Azure DS 系列和 GS 系列 VM 支持高级存储。\"\n    services=\"storage\"\n    documentationCenter=\"\"\n    authors=\"ms-prkhad\"\n    manager=\"\"\n    editor=\"tysonn\"/>\n\n<tags\n    ms.service=\"storage\"\n    ms.date=\"02/03/2016\"\n    wacn.date=\"03/17/2016\"/>\n\n\n# 高级存储：适用于 Azure 虚拟机工作负荷的高性能存储\n\n## 概述\n\nAzure 高级存储为运行 I/O 密集型工作负荷的虚拟机提供高性能、低延迟的磁盘支持。在固态硬盘 (SSD) 上使用高级存储存储数据的虚拟机 (VM) 磁盘。可以将应用程序的 VM 磁盘迁移到 Azure 高级存储，以充分利用这些磁盘的速度和性能。\n\nAzure VM 支持附加多个高级存储磁盘，使你的应用程序可以具有每个 VM 多达 64 TB 的存储空间。借助高级存储，应用程序对于每个 VM 可以实现 80,000 IOPS（每秒输入/输出操作数）和每秒 2000 MB 的磁盘吞吐量，并且读取操作的延迟非常低。\n\n使用高级存储，Azure 提供的功能可真正将要求苛刻的企业应用程序（如 Dynamics AX、Dynamics CRM、Exchange Server、SharePoint 场和 SAP Business Suite）转移到云。你可以运行各种需要高级存储的一致高性能和低延迟的性能密集型数据库工作负荷，如 SQL Server、Oracle、MongoDB、MySQL、Redis。\n\n>[AZURE.NOTE] 建议将任何需要高 IOPS 的虚拟机磁盘迁移到 Azure 高级存储，以便你的应用程序实现最佳性能。如果你的磁盘不需要高 IOPS，你可以通过在标准存储（将虚拟机磁盘数据存储在硬盘驱动器 (HDD) 上而不是 SSD 上）中对其进行维护来限制成本。\n\n若要开始使用 Azure 高级存储，请访问[开始免费试用](/pricing/1rmb-trial/)页。有关将现有的虚拟机迁移到高级存储的信息，请参阅[迁移到 Azure 高级存储](/documentation/articles/storage-migration-to-premium-storage)。\n\n## 有关高级存储的重要事项\n\n以下是使用高级存储之前或使用高级存储时需考虑的重要事项列表：\n\n- 若要使用高级存储，你必须有一个高级存储帐户。若要了解如何创建高级存储帐户，请参阅[为磁盘创建和使用高级存储帐户](#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk)。\n\n- 高级存储已在[管理门户](https://manage.windowsazure.cn)中提供并可通过以下 SDK 库来访问：[存储 REST API](http://msdn.microsoft.com/zh-cn/library/azure/dd179355.aspx) 版本 2014-02-14 或更高版本；[服务管理 REST API](http://msdn.microsoft.com/zh-cn/library/azure/ee460799.aspx) 版本 2014-10-01 或更高版本（经典部署）；[存储资源提供程序 API](http://msdn.microsoft.com/zh-cn/library/azure/mt163683.aspx)（ARM 部署）；以及 [Azure PowerShell](/documentation/articles/powershell-install-configure) 版本 0.8.10 或更高版本。\n\n\n\n- 高级存储仅支持 Azure 页 Blob，用于保存适用于 Azure 虚拟机 (VM) 的持久性磁盘。有关 Azure 页 Blob 的信息，请参阅[了解块 Blob、追加 Blob 和页 Blob](http://msdn.microsoft.com/zh-cn/library/azure/ee691964.aspx)。高级存储不支持 Azure 块 Blob、Azure 追加 Blob、Azure 文件、Azure 表或 Azure 队列。\n\n- 高级存储帐户是本地冗余 (LRS) 帐户，在单一区域内会保留三份数据。有关使用高级存储时的异地复制注意事项，请参阅本文中的[使用高级存储时的快照与复制 Blob](#snapshots-and-copy-blob-when-using-premium-storage) 部分。\n\n- 如果你希望 VM 磁盘使用高级存储帐户，你必须使用 DS 或 GS 系列的 VM。DS 或 GS 系列的 VM 可同时使用标准和高级存储磁盘。非 DS 或非 GS 系列的 VM 无法使用高级存储磁盘。有关可用 Azure VM 磁盘类型和大小的详细信息，请参阅[虚拟机大小](/documentation/articles/virtual-machines-size-specs)。\n\n- 为 VM 设置高级存储磁盘的过程，与设置标准存储磁盘的过程类似。你需要为 Azure 磁盘和 VM 选择最适合的高级存储选项。根据高级产品的性能特征，VM 大小应适合工作负载。有关详细信息，请参阅[使用高级存储时的缩放性和性能目标](#scalability-and-performance-targets-when-using-premium-storage)。\n\n- 高级存储帐户无法映射到自定义域名。\n\n- 存储分析目前不支持高级存储。若要使用高级存储帐户上的磁盘分析 VM 的性能度量值，请使用基于操作系统的工具，如 [Windows 性能监视器](https://technet.microsoft.com/zh-cn/library/cc749249.aspx)（对于 Windows VM）和 [IOSTAT](http://linux.die.net/man/1/iostat)（对于 Linux VM）。你还可以在 Azure 门户上启用 Azure VM 诊断。有关详细信息，请参阅[使用 Azure Diagnostics 扩展监视 Azure 虚拟机](https://azure.microsoft.com/blog/2014/09/02/windows-azure-virtual-machine-monitoring-with-wad-extension/)。\n\n##<a id=\"using-premium-storage-for-disks\"></a> 使用高级存储磁盘\n可通过两种方式使用高级存储磁盘：\n\n- 首先创建新的高级存储帐户，然后在创建 VM 时使用它。\n- 创建新的 DS 或 GS 系列 VM。创建 VM 时，你可以选择以前创建的高级存储帐户、创建新的高级存储帐户，或者让 Azure 门户创建默认的高级帐户。\n\nAzure 使用存储帐户作为操作系统和数据磁盘的容器。换句话说，如果你创建 Azure DS 系列或 GS 系列的 VM 并选择 Azure 高级存储帐户，操作系统和数据磁盘会存储在该存储帐户中。\n\n有关将现有的虚拟机迁移到高级存储的信息，请参阅[迁移到 Azure 高级存储](/documentation/articles/storage-migration-to-premium-storage)。\n\n为充分利用高级存储的优点，请先使用帐户类型 *Premium_LRS* 创建一个高级存储帐户。若要执行此操作，可以使用 [Azure 门户](https://manage.windowsazure.cn)、[Azure PowerShell](/documentation/articles/powershell-install-configure)、[服务管理 REST API](http://msdn.microsoft.com/zh-cn/library/azure/ee460799.aspx)（经典部署）或[存储资源提供程序 REST API](http://msdn.microsoft.com/zh-cn/library/azure/mt163683.aspx)（ARM 部署）。有关分步说明，请参阅[为磁盘创建和使用高级存储帐户](#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk)。\n\n### 重要说明：\n\n- 有关高级存储帐户的容量和带宽限制的详细信息，请参阅[使用高级存储时的缩放性和性能目标](#scalability-and-performance-targets-when-using-premium-storage)部分。如果你的应用程序的需求超过了单个存储帐户的可伸缩性目标，则在生成应用程序时请让它使用多个存储帐户，并将数据分布在这些存储帐户中。例如，如果要将 51 TB 的磁盘附加到多个 VM，请将它们分布在两个存储帐户中，因为 35 TB 是单个高级存储帐户的限制。请确保单个高级存储帐户永远不会超过 35 TB 的设置磁盘。\n- 默认情况下，所有高级数据磁盘的磁盘缓存策略都是“只读的”，所有附加到 VM 的高级操作系统都是“读写的”。为使应用程序的 I/O 达到最佳性能，建议使用此配置设置。对于频繁写入或只写的磁盘（例如 SQL Server 日志文件），禁用磁盘缓存可获得更佳的应用程序性能。\n- 确保 VM 上有足够的带宽来驱动磁盘通信。例如，STANDARD_DS1 VM 为高级存储磁盘通信提供每秒 32 MB 的专用带宽。这意味着，附加到此 VM 的 P10 高级存储磁盘最高只能达到每秒 32 MB，而不能像 P10 磁盘那样最高达到每秒 100 MB。同样，STANDARD_DS13 VM 可跨所有磁盘最高达到每秒 256 MB。目前，DS 系列上的最大 VM 是 STANDARD_DS14，它可以跨所有磁盘最高提供每秒 512 MB。GS 系列上的最大 VM 是 STANDARD_GS5，它可以跨所有磁盘最高提供每秒 2000 MB。\n\n    请注意，这些限制只适用于磁盘流量，而不包括缓存命中和网络流量。VM 网络通信可以使用单独的带宽，这不同于高级存储磁盘的专用带宽。\n\n    有关 DS 系列和 GS 系列 VM 的最大 IOPS 与吞吐量（带宽）的最新信息，请参阅[虚拟机的大小](/documentation/articles/virtual-machines-size-specs)。若要了解高级存储磁盘及其 IOPS 和吞吐量限制，请参阅本文的[使用高级存储时的可伸缩性和性能目标](#scalability-and-performance-targets-when-using-premium-storage)部分中的表格。\n\n> [AZURE.NOTE] 缓存命中数不受到磁盘配置 IOPS/吞吐量的限制。也就是说，当你在 DS 系列或 GS 系列 VM 上使用具有 ReadOnly 缓存设置的数据磁盘时，缓存提供的读取数不受高级存储磁盘限制的约束。因此，如果工作负荷以读取为主，可以从磁盘获得极高的吞吐量。请注意，缓存根据 VM 大小受到 VM 级别不同的 IOPS / 吞吐量的限制。DS 系列 VM 大约有 4000 IOPS，缓存与本地 SSD IO 是每个核心 33 MB/秒。\n\n- 可以在同一个 DS 系列或 GS 系列 VM 中同时使用高级和标准存储磁盘。\n- 使用高级存储时，可以设置 DS 系列 VM 并将多个持久性数据磁盘附加到 VM。如有需要，可以跨磁盘条带化，以增加卷的容量与性能。如果你使用[存储空间](http://technet.microsoft.com/zh-cn/library/hh831739.aspx)来条带化高级存储数据磁盘，应该以使用的每个磁盘一个列的方式来配置它。否则，条带化卷的整体性能可能会低于预期，因为磁盘之间的通信分配不平均。默认情况下，服务器管理器用户界面 (UI) 可让你设置最多包含 8 个磁盘的列。但如果磁盘超过 8 个，则你必须使用 PowerShell 来创建卷，并手动指定列数。否则，即使你有更多磁盘，服务器管理器 UI 仍会继续使用 8 个列。例如，如果在一个条带集中有 32 个磁盘，则你应该指定 32 列。可以使用 [New-VirtualDisk](http://technet.microsoft.com/zh-cn/library/hh848643.aspx) PowerShell cmdlet 的 *NumberOfColumns* 参数来指定虚拟磁盘使用的列数。有关详细信息，请参阅[存储空间概述](http://technet.microsoft.com/zh-cn/library/hh831739.aspx)和[存储空间常见问题](http://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx)。\n- 避免将 DS 系列虚拟机添加到包含非 DS 系列 VM 的现有云服务。可能的解决方法是将现有 VHD 迁移到只运行 DS 系列 VM 的新云服务。如果想要保留托管 DS 系列 VM 的新云服务的相同虚拟 IP 地址 (VIP)，请使用[保留 IP 地址](/documentation/articles/virtual-networks-configure-vnet-to-vnet-connection)功能。GS 系列 VM 只能添加到运行 G 系列 VM 的现有云服务。\n- 可以将 DS 系列 Azure 虚拟机配置为使用标准存储帐户或高级存储帐户上托管的操作系统 (OS) 磁盘。如果 OS 磁盘只是用于引导，则你可以考虑使用基于标准存储的 OS 磁盘。这样既可以提高性价比，又可以在引导后提供类似于高级存储的性能。如果在除引导以外的 OS 磁盘上执行任何其他任务，请使用高级存储，因为它提供更好的性能。例如，如果你的应用程序要与 OS 磁盘相互读/写数据，则使用基于高级存储的 OS 磁盘可为 VM 提供更好的性能。\n- 可以对高级存储使用 [Azure 命令行界面 (Azure CLI)](/documentation/articles/xplat-cli-install)。若要使用 Azure CLI 更改某个磁盘上的缓存策略，请运行以下命令：\n\n    `$ azure vm disk attach -h ReadOnly <VM-Name> <Disk-Name>`\n\n    请注意，缓存策略选项可以是 ReadOnly、None 或 ReadWrite。有关更多选项，请通过运行以下命令查看帮助：\n\n    `azure vm disk attach --help`\n\n\n##<a id=\"scalability-and-performance-targets-when-using-premium-storage\"></a> 使用高级存储时的缩放性和性能目标\n\n当你为某个高级存储帐户设置磁盘时，其每秒的输入/输出操作次数 (IOPS) 和吞吐量（带宽）取决于磁盘大小。目前有三种类型的高级存储磁盘：P10、P20 和 P30。每种类型各有特定的 IOPS 和吞吐量限制，如下表所示：\n\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\" style=\"border: 1px solid #000000;\">\n<tbody>\n<tr>\n    <td><strong>高级存储磁盘类型</strong></td>\n    <td><strong>P10</strong></td>\n    <td><strong>P20</strong></td>\n    <td><strong>P30</strong></td>\n</tr>\n<tr>\n    <td><strong>磁盘大小</strong></td>\n    <td>128 GiB</td>\n    <td>512 GiB</td>\n    <td>1024 GiB (1 TB)</td>\n</tr>\n<tr>\n    <td><strong>每个磁盘的 IOPS</strong></td>\n    <td>500</td>\n    <td>2300</td>\n    <td>5000</td>\n</tr>\n<tr>\n    <td><strong>每个磁盘的吞吐量</strong></td>\n    <td>每秒 100 MB *</td>\n    <td>每秒 150 MB *</td>\n    <td>每秒 200 MB *</td>\n</tr>\n</tbody>\n</table>\n\n> [AZURE.NOTE] 请确保 VM 上有足够的带宽可用来驱动磁盘通信，如本文前面的[使用高级存储磁盘](#using-premium-storage-for-disks)部分中所述。否则，将会根据 VM 限制而不是上表中提到的磁盘限制，将磁盘吞吐量和 IOPS 约束为较小值。\n\nAzure 会将磁盘大小映射（向上舍入）至表中指定的最接近高级存储磁盘选项。例如，大小为 100 GiB 的磁盘会分类为 P10 选项，每秒最多可执行 500 个 IO 单位，每秒吞吐量可达 100 MB。同样地，大小为 400 GiB 的磁盘会分类为 P20 选项，每秒最多可执行 2300 个 IO 单位，每秒吞吐量可达 150 MB。\n\n输入/输出 (I/O) 单位大小为 256 KB。如果要传送的数据少于 256 KB，会视为单个 I/O 单位。较大的 I/O 大小则会视为大小是 256 KB 的多个 I/O。例如，1100 KB 的 I/O 会视为五个 I/O 单位。\n\n吞吐量限制包括磁盘写入，以及不是从缓存进行的磁盘读取。例如，P10 磁盘的非缓存读取和写入总和应小于或等于每秒 100 MB。同样地，单个 P10 磁盘可有每秒 100 MB 的非缓存读取或每秒 100 MB 的写入吞吐量，或是每秒 60 MB 的读取和每秒 40 MB 的写入吞吐量。\n\n当你在 Azure 创建磁盘后，请根据应用程序的容量、性能、缩放性和高峰负载需求来选择最适合的高级存储磁盘产品。\n\n> [AZURE.NOTE] 你可以轻松增加现有磁盘的大小。例如，如果你想要将 30 GB 大小的磁盘增加到 128 GB 或 1 TB。或者，如果想要将 P20 磁盘转换为 P30 磁盘，因为需要更多容量或更多的 IOPS 和吞吐量。可以使用“Update-AzureDisk”PowerShell 命令配合“-ResizedSizeInGB”属性来扩展磁盘。若要执行此操作，需要先从 VM 分离磁盘或停止 VM。\n\n下表描述高级存储帐户的缩放性目标：\n\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\" style=\"border: 1px solid #000000;\">\n<tbody>\n<tr>\n    <td><strong>总帐户容量</strong></td>\n    <td><strong>本地冗余存储帐户的总带宽</strong></td>\n</tr>\n<tr>\n    <td>\n    <ul>\n       <li type=round>磁盘容量：35 TB</li>\n       <li type=round>快照容量：10 TB</li>\n    </ul>\n    </td>\n    <td>入站 + 出站最高每秒 50 Gbps</td>\n</tr>\n</tbody>\n</table>\n\n- 入站是指发送到存储帐户的所有数据（请求）。\n- 出站是指从存储帐户接收的所有数据（响应）。\n\n有关详细信息，请参阅 [Azure 存储空间缩放性和性能目标](/documentation/articles/storage-scalability-targets)。\n\n## 使用高级存储时的限制\n如果应用程序的 IOPS 或吞吐量超出了分配的高级存储磁盘限制，或者 VM 上所有磁盘的总磁盘通信超出了 VM 可用的磁盘带宽限制，则可能会有限制情况。若要避免限制，建议根据设置的磁盘缩放性和性能目标，以及 VM 可用的磁盘带宽，来限制磁盘的挂起 I/O 请求数。\n\n当应用程序设计为避免限制情况时，可以达到最低延迟。另一方面，如果磁盘的挂起 I/O 请求数过小，应用程序便无法利用磁盘可用的最大 IOPS 和吞吐量级别。\n\n以下示例演示了如何计算限制级别：\n\n### 示例 1：\n在 P10 磁盘上，应用程序一秒内有 495 个 16 KB 磁盘大小的 I/O（相当于 495 个 I/O 单位）。如果你在该秒内尝试 2 MB 的 I/O，I/O 单位的总数会等于 495 + 8。这是因为当 I/O 单位大小是 256 KB 时，2 MB 的 I/O 会产生 2048 KB / 256 KB = 8 个 I/O 单位。因为 495 + 8 的总和超出磁盘 500 的 IOPS 限制，因此会发生限制情况。\n\n### 注意：\n所有计算都是基于 256 KB 的 I/O 单位大小。\n\n### 示例 2：\n在 P10 磁盘上，应用程序有 400 个 256 KB 磁盘大小的 I/O。使用的总带宽为 (400 * 256) / 1024 = 100 MB/秒。请注意，每秒 100 MB 是 P10 磁盘的吞吐量限制。如果应用程序尝试在该秒内执行更多 I/O 便会发生限制情况，因为会超出分配的限制。\n\n### 示例 3：\n某个 DS4 VM 附加了两个 P30 磁盘。每个 P30 磁盘的吞吐量可达到每秒 200 MB。但是，DS4 VM 的总磁盘带宽容量为每秒 256 MB。因此，你无法在此 DS4 VM 上同时以最大吞吐量驱动附加的磁盘。若要解决此问题，你可以在一个磁盘上保持每秒 200 MB 的通信，在另一个磁盘上保持每秒 56 MB。如果磁盘通信的总和超出每秒 256 MB，磁盘通信将受到限制。\n\n### 注意：\n如果磁盘通信大多包含小型 I/O，应用程序在达到吞吐量限制前很可能会先达到 IOPS 限制。另一方面，如果磁盘通信主要包含大型 I/O，应用程序可能会达到吞吐量限制，而非 IOPS 限制。可以使用最佳的 I/O 大小和限制磁盘的挂起 I/O 请求数，来最大化应用程序的 IOPS 和吞吐量容量。\n\n##<a id=\"snapshots-and-copy-blob-when-using-premium-storage\"></a> 使用高级存储时的快照与复制 Blob\n可以像使用标准存储时创建快照的方式来为高级存储创建快照。由于高级存储是本地冗余存储，因此建议你创建快照，并将那些快照复制到地域冗余的标准存储帐户。有关详细信息，请参阅 [Azure 存储冗余选项](/documentation/articles/storage-redundancy)。\n\n如果磁盘已附加到 VM，在备份磁盘的页 Blob 上不允许某些 API 操作。例如，只要磁盘附加到 VM，你就无法在该 Blob 上执行[复制 Blob](http://msdn.microsoft.com/zh-cn/library/azure/dd894037.aspx) 操作。此时，你必须先使用[快照 Blob](http://msdn.microsoft.com/zh-cn/library/azure/ee691971.aspx) REST API 方法创建该 Blob 的快照，然后对该快照执行[复制 Blob](http://msdn.microsoft.com/zh-cn/library/azure/dd894037.aspx) 以复制附加的磁盘。或者，可以中断附加磁盘，然后在基础 Blob 上执行任何必要的操作。\n\n### 重要说明：\n\n- 单个 Blob 的快照数限制为 100。每 10 分钟最多可获取一个快照。\n- 每个高级存储帐户的最大快照容量为 10 TB。请注意，快照容量仅指快照中的数据总量，而不包括基本 Blob 中的数据。\n- 若要维护快照的异地冗余副本，你可以使用 AzCopy 或“复制 Blob”将高级存储帐户中的快照复制到异地冗余的标准存储帐户。有关详细信息，请参阅[如何对 Azure 存储空间使用 AzCopy](/documentation/articles/storage-use-azcopy) 和[复制 Blob](http://msdn.microsoft.com/zh-cn/library/azure/dd894037.aspx)。\n- 有关对高级存储帐户中的页 Blob 执行 REST 操作的详细信息，请参阅 MSDN 库中的[对 Azure 高级存储使用 Blob 服务操作](https://msdn.microsoft.com/zh-cn/library/dn889922.aspx)。\n\n## 在高级存储中使用 Linux VM\n请参考以下重要说明，以了解如何在高级存储上配置 Linux VM：\n\n- 对于缓存设置为“ReadOnly”或“None”的所有高级存储磁盘，必须在装入文件系统时禁用“屏障”，以实现高级存储的伸放性目标。对于这种情况你不需要屏障，因为写入高级存储支持的磁盘对于这些缓存设置是持久的。在成功完成写入请求时，数据已写入到持久存储。请根据你的文件系统，使用以下方法来禁用“屏障”：\n    - 如果你使用的是 **reiserFS**，请使用装入选项“barrier=none”禁用屏障（要启用屏障，请使用“barrier=flush”）\n    - 如果你使用的是 **ext3/ext4**，请使用装入选项“barrier=0”禁用屏障（要启用屏障，请使用“barrier=1”）\n    - 如果你使用的是 **XFS**，请使用装入选项“nobarrier”禁用屏障（要启用屏障，请使用“barrier”）\n\n- 对于缓存设置为“ReadWrite”的高级存储磁盘，应该启用屏障以实现写入持久性。\n- 若要在重新启动 VM 后保留卷标，你必须使用对磁盘的 UUID 引用来更新 /etc/fstab。另请参阅[如何将数据磁盘附加到 Linux 虚拟机](/documentation/articles/virtual-machines-linux-how-to-attach-disk)\n\n以下是我们使用高级存储验证过的 Linux 分发版。我们建议将 VM 升级到其中至少一个版本（或更新版本），以改进高级存储的性能和稳定性。此外，某些版本需要最新的 LIS（适用于 Azure 的 Linux Integration Services v4.0）。请使用下面提供的链接进行下载和安装。在我们完成其他验证后，将陆续在列表中添加更多映像。请注意，我们的验证表明，性能根据映像而有所不同，并且还取决于工作负荷特征和映像上的设置。不同的映像已针对不同种类的工作负荷进行优化。\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\" style=\"border: 1px solid #000000;\">\n<tbody>\n<tr>\n    <td><strong>分发</strong></td>\n    <td><strong>版本</strong></td>\n    <td><strong>支持的内核</strong></td>\n    <td><strong>支持的映像</strong></td>\n</tr>\n<tr>\n    <td rowspan=\"4\"><strong>Ubuntu</strong></td>\n    <td>12.04</td>\n    <td>3.2.0-75.110</td>\n    <td>Ubuntu-12_04_5-LTS-amd64-server-20150119-en-us-30GB</td>\n</tr>\n<tr>\n    <td>14.04</td>\n    <td>3.13.0-44.73</td>\n    <td>Ubuntu-14_04_1-LTS-amd64-server-20150123-en-us-30GB</td>\n</tr>\n<tr>\n    <td>14.10</td>\n    <td>3.16.0-29.39</td>\n    <td>Ubuntu-14_10-amd64-server-20150202-en-us-30GB</td>\n</tr>\n<tr>\n    <td>15.04</td>\n    <td>3.19.0-15</td>\n    <td>Ubuntu-15_04-amd64-server-20150422-en-us-30GB</td>\n</tr>\n<tr>\n    <td><strong>SUSE</strong></td>\n    <td>SLES 12</td>\n    <td>3.12.36-38.1</td>\n    <td>suse-sles-12-priority-v20150213<br>suse-sles-12-v20150213</td>\n</tr>\n<tr>\n    <td><strong>CoreOS</strong></td>\n    <td>584.0.0</td>\n    <td>3.18.4</td>\n    <td>CoreOS 584.0.0</td>\n</tr>\n<tr>\n    <td rowspan=\"2\"><strong>CentOS</strong></td>\n    <td>6.5, 6.6, 6.7, 7.0</td>\n    <td></td>\n    <td>\n        <a href=\"http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409\"> 需要 LIS 4.0 </a> </br>\n        *请参阅以下注释\n    </td>\n</tr>\n<tr>\n    <td>7.1</td>\n    <td>3.10.0-229.1.2.el7</td>\n    <td>\n        <a href=\"http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409\"> 建议使用 LIS 4.0 </a> <br/>\n        *请参阅以下注释\n    </td>\n</tr>\n\n<tr>\n    <td rowspan=\"2\"><strong>Oracle</strong></td>\n    <td>6.4</td>\n    <td></td>\n    <td><a href=\"http://go.microsoft.com/fwlink/?LinkID=403033&clcid=0x409\"> 需要 LIS 4.0 </a></td>\n</tr>\n<tr>\n    <td>7.0</td>\n    <td></td>\n    <td>联系支持人员以获取详细信息</td>\n</tr>\n</tbody>\n</table>\n\n\n### Openlogic CentOS 的 LIS 驱动程序\n\n运行 OpenLogic CentOS VM 的客户应该运行以下命令来安装最新的驱动程序：\n\n    sudo rpm -e hypervkvpd  ## (may return error if not installed, that's OK)\n    sudo yum install microsoft-hyper-v\n\n需要重新启动才能激活新的驱动程序。\n\n\n\n## 使用高级存储时的定价和计费方式\n使用高级存储时，请注意以下计费方式：\n\n- 高级存储磁盘的计费根据是磁盘的设置大小。Azure 会将磁盘大小（向上舍入）映射到[使用高级存储时的缩放性和性能目标](#scalability-and-performance-targets-when-using-premium-storage)部分的表中指定的最接近高级存储磁盘。任何已设置的磁盘都是按每月的高级存储优惠价格以每小时的方式计费。例如，如果你在设置完 P10 磁盘的 20 小时后删除它，则会以 20 小时计算 P10 解决方案的费用。这与写入磁盘的实际数据量或使用的 IOPS/吞吐量无关。\n- 高级存储上的快照会因为使用的额外容量而产生费用。有关快照的详细信息，请参阅[创建 Blob 的快照](http://msdn.microsoft.com/zh-cn/library/azure/hh488361.aspx)。\n- [出站数据传输](/pricing/details/data-transfers/)（Azure 数据中心送出的数据）会产生带宽使用费。\n\n有关高级存储与 DS 和 GS 系列 VM 定价的详细信息，请参阅：\n\n- [Azure 存储定价](/home/features/storage#price)\n- [虚拟机定价](/home/features/virtual-machines#price)\n\n##<a id=\"create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk\"></a> 为虚拟机器数据磁盘创建和使用高级存储帐户\n\n本部分演示如何使用 Azure PowerShell 和 Azure 命令行界面 (Azure CLI) 创建高级存储帐户。另外，还演示了高级存储帐户的示例用例：在使用高级存储帐户时创建虚拟机，并将数据磁盘附加到虚拟机。\n\n\n### 通过 Azure PowerShell 使用高级存储创建 Azure 虚拟机\n本 PowerShell 示例演示如何创建新的高级存储帐户并将使用该帐户的数据磁盘附加到新的 Azure 虚拟机。\n\n1. 根据[如何安装和配置 Azure PowerShell](/documentation/articles/powershell-install-configure) 中提供的步骤设置 PowerShell 环境。\n2. 启动 PowerShell 控制台，连接到订阅，并在控制台窗口中运行以下 PowerShell cmdlet。如此 PowerShell 语句中所示，当你创建高级存储帐户时，必须将 **Type** 参数指定为 **Premium_LRS**。\n\n        New-AzureStorageAccount -StorageAccountName \"yourpremiumaccount\" -Location \"East China\" -Type \"Premium_LRS\"\n\n3. 接下来，请创建新的 DS 系列 VM，并在控制台窗口中运行以下 PowerShell cmdlet 以指定要使用高级存储。可以使用相同的步骤创建 GS 系列 VM。在命令中指定适当的 VM 大小。例如，Standard_GS2：\n\n        $storageAccount = \"yourpremiumaccount\"\n        $adminName = \"youradmin\"\n        $adminPassword = \"yourpassword\"\n        $vmName =\"yourVM\"\n        $location = \"East China\"\n        $imageName = \"55bc2b193643443bb879a78bda516fc8__Windows-Server-2012-R2-20150726-en.us-127GB.vhd\"\n        $vmSize =\"Standard_DS2\"\n        $OSDiskPath = \"https://\" + $storageAccount + \".blob.core.chinacloudapi.cn/vhds/\" + $vmName + \"_OS_PIO.vhd\"\n        $vm = New-AzureVMConfig -Name $vmName -ImageName $imageName -InstanceSize $vmSize -MediaLocation $OSDiskPath\n        Add-AzureProvisioningConfig -Windows -VM $vm -AdminUsername $adminName -Password $adminPassword\n        New-AzureVM -ServiceName $vmName -VMs $VM -Location $location\n\n4. 如果希望 VM 有更多的磁盘空间，请在创建虚拟机后于控制台窗口中运行以下 PowerShell cmdlet 以将新的数据磁盘附加到现有 DS 系列或 GS 系列 VM。\n\n        $storageAccount = \"yourpremiumaccount\"\n        $vmName =\"yourVM\"\n        $vm = Get-AzureVM -ServiceName $vmName -Name $vmName\n        $LunNo = 1\n        $path = \"http://\" + $storageAccount + \".blob.core.chinacloudapi.cn/vhds/\" + \"myDataDisk_\" + $LunNo + \"_PIO.vhd\"\n        $label = \"Disk \" + $LunNo\n        Add-AzureDataDisk -CreateNew -MediaLocation $path -DiskSizeInGB 128 -DiskLabel $label -LUN $LunNo -HostCaching ReadOnly -VM $vm | Update-AzureVm\n\n### 通过 Azure 命令行界面使用高级存储创建 Azure 虚拟机\n\n[Azure 命令行界面](/documentation/articles/xplat-cli-install) (Azure CLI) 提供一组可在 Azure 平台上运行的开放源代码跨平台命令。以下示例演示如何使用 Azure CLI（0.8.14 和更高版本）创建高级存储帐户、新的虚拟机，以及从高级存储帐户附加新的数据磁盘。\n\n#### 创建高级存储帐户\n\n````\nazure storage account create \"premiumtestaccount\" -l \"East China\" --type PLRS\n````\n\n#### 创建 DS 系列虚拟机\n\n    azure vm create -z \"Standard_DS2\" -l \"East China\" -e 22 \"premium-test-vm\"\n        \"b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-14_10-amd64-server-20150202-en-us-30GB\" -u \"myusername\" -p \"passwd@123\"\n\n#### 显示有关虚拟机的信息\n\n    azure vm show premium-test-vm\n\n#### 附加新的数据磁盘\n\n    azure vm disk attach-new premium-test-vm 20 https://premiumstorageaccount.blob.core.chinacloudapi.cn/vhd-store/data1.vhd\n\n#### 显示有关新数据磁盘的信息\n\n    azure vm disk show premium-test-vm-premium-test-vm-0-201502210429470316\n\n## 后续步骤\n\n- [对 Azure 高级存储使用 Blob 服务操作](https://msdn.microsoft.com/zh-cn/library/dn889922.aspx)\n- [迁移到 Azure 高级存储](/documentation/articles/storage-migration-to-premium-storage)\n- [在 Azure 门户中创建 Windows 虚拟机](/documentation/articles/virtual-machines-windows-tutorial-classic-portal)\n- [虚拟机的大小](/documentation/articles/virtual-machines-size-specs)\n- [存储文档](documentation/services/storage)\n\n[Image1]: ./media/storage-premium-storage/Azure_pricing_tier.png\n\n<!---HONumber=Mooncake_0307_2016-->"
}