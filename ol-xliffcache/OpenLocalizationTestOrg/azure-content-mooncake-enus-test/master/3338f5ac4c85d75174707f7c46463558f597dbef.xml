{
  "nodes": [
    {
      "content": "在 HDInsight 中提交 Hadoop 作业 | Azure",
      "pos": [
        27,
        60
      ]
    },
    {
      "content": "了解如何将 Hadoop 作业提交到 Azure HDInsight Hadoop。",
      "pos": [
        79,
        121
      ]
    },
    {
      "content": "在 HDInsight 中提交 Hadoop 作业",
      "pos": [
        358,
        383
      ]
    },
    {
      "content": "学习如何使用 Azure PowerShell 提交 MapReduce 和 Hive 作业，以及如何使用 HDInsight .NET SDK 提交 MapReduce、Hadoop 流式处理和 Hive 作业。",
      "pos": [
        385,
        492
      ]
    },
    {
      "content": "先决条件",
      "pos": [
        497,
        501
      ]
    },
    {
      "content": "在开始阅读本文前，你必须具有：",
      "pos": [
        503,
        518
      ]
    },
    {
      "pos": [
        522,
        644
      ],
      "content": "<bpt id=\"p1\">**</bpt>一个 Azure HDInsight 群集<ept id=\"p1\">**</ept>。有关说明，请参阅 <bpt id=\"p2\">[</bpt>HDInsight 入门<ept id=\"p2\">][hdinsight-get-started]</ept>或<bpt id=\"p3\">[</bpt>在 HDInsight 中创建 Hadoop 群集<ept id=\"p3\">][hdinsight-provision]</ept>。"
    },
    {
      "pos": [
        647,
        758
      ],
      "content": "<bpt id=\"p1\">**</bpt>配备 Azure PowerShell 的工作站<ept id=\"p1\">**</ept>。请参阅<bpt id=\"p2\">[</bpt>安装和使用 Azure PowerShell<ept id=\"p2\">](/documentation/articles/powershell-install-configure)</ept>。"
    },
    {
      "content": "使用 PowerShell 提交 MapReduce 作业",
      "pos": [
        762,
        791
      ]
    },
    {
      "pos": [
        793,
        893
      ],
      "content": "请参阅<bpt id=\"p1\">[</bpt>在基于 Windows 的 HDInsight 中运行 Hadoop MapReduce 示例<ept id=\"p1\">](/documentation/articles/hdinsight-run-samples)</ept>。"
    },
    {
      "content": "使用 PowerShell 提交 Hive 作业",
      "pos": [
        897,
        921
      ]
    },
    {
      "pos": [
        923,
        1014
      ],
      "content": "请参阅<bpt id=\"p1\">[</bpt>使用 PowerShell 运行 Hive 查询<ept id=\"p1\">](/documentation/articles/hdinsight-hadoop-use-hive-powershell)</ept>"
    },
    {
      "content": "使用 Visual Studio 提交 Hive 作业",
      "pos": [
        1019,
        1046
      ]
    },
    {
      "pos": [
        1048,
        1126
      ],
      "content": "请参阅<bpt id=\"p1\">[</bpt>适用于 Visual Studio 的 HDInsight Hadoop 工具入门<ept id=\"p1\">][hdinsight-visual-studio-tools]</ept>。"
    },
    {
      "content": "使用 PowerShell 提交 Sqoop 作业",
      "pos": [
        1130,
        1155
      ]
    },
    {
      "pos": [
        1157,
        1208
      ],
      "content": "请参阅<bpt id=\"p1\">[</bpt>将 Sqoop 与 HDInsight 配合使用<ept id=\"p1\">][hdinsight-use-sqoop]</ept>。"
    },
    {
      "content": "使用 HDInsight .NET SDK 提交 Hive/Pig/Sqoop 作业",
      "pos": [
        1212,
        1254
      ]
    },
    {
      "content": "HDInsight .NET SDK 提供 .NET 客户端库，可简化从 .NET 中使用 HDInsight 群集的操作。",
      "pos": [
        1255,
        1317
      ]
    },
    {
      "content": "提交作业",
      "pos": [
        1321,
        1325
      ]
    },
    {
      "content": "在 Visual Studio 中创建 C# 控制台应用程序。",
      "pos": [
        1332,
        1363
      ]
    },
    {
      "content": "通过 Nuget 包管理器控制台运行以下命令。",
      "pos": [
        1367,
        1390
      ]
    },
    {
      "content": "使用以下代码：",
      "pos": [
        1598,
        1605
      ]
    },
    {
      "pos": [
        10517,
        10533
      ],
      "content": "按 <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> 运行应用程序。"
    },
    {
      "content": "使用适用于 Visual Studio 的 HDInsight 工具提交作业",
      "pos": [
        10537,
        10575
      ]
    },
    {
      "pos": [
        10577,
        10755
      ],
      "content": "你可以使用适用于 Visual Studio 的 HDInsight 工具来运行 Hive 查询和 Pig 脚本。请参阅<bpt id=\"p1\">[</bpt>适用于 HDInsight 的 Visual Studio Hadoop 工具入门<ept id=\"p1\">](/documentation/articles/hdinsight-hadoop-visual-studio-tools-get-started)</ept>。"
    },
    {
      "content": "后续步骤",
      "pos": [
        10759,
        10763
      ]
    },
    {
      "content": "在本文中，你已经学习了几种创建 HDInsight 群集的方法。若要了解更多信息，请参阅下列文章：",
      "pos": [
        10764,
        10813
      ]
    },
    {
      "content": "Azure HDInsight 入门",
      "pos": [
        10818,
        10836
      ]
    },
    {
      "content": "在 HDInsight 中创建 Hadoop 群集",
      "pos": [
        10864,
        10889
      ]
    },
    {
      "content": "使用 PowerShell 管理 HDInsight",
      "pos": [
        10915,
        10941
      ]
    },
    {
      "content": "HDInsight Cmdlet 参考文档",
      "pos": [
        10974,
        10995
      ]
    },
    {
      "content": "将 Hive 与 HDInsight 配合使用",
      "pos": [
        11032,
        11055
      ]
    },
    {
      "content": "将 Pig 与 HDInsight 配合使用",
      "pos": [
        11080,
        11102
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"在 HDInsight 中提交 Hadoop 作业 | Azure\"\n    description=\"了解如何将 Hadoop 作业提交到 Azure HDInsight Hadoop。\"\n    editor=\"cgronlun\"\n    manager=\"paulettm\"\n    services=\"hdinsight\"\n    documentationCenter=\"\"\n    tags=\"azure-portal\"\n    authors=\"mumian\"/>\n\n<tags\n    ms.service=\"hdinsight\"\n    ms.date=\"10/30/2015\"\n    wacn.date=\"02/17/2016\"/>\n\n# 在 HDInsight 中提交 Hadoop 作业\n\n学习如何使用 Azure PowerShell 提交 MapReduce 和 Hive 作业，以及如何使用 HDInsight .NET SDK 提交 MapReduce、Hadoop 流式处理和 Hive 作业。\n\n###先决条件\n\n在开始阅读本文前，你必须具有：\n\n* **一个 Azure HDInsight 群集**。有关说明，请参阅 [HDInsight 入门][hdinsight-get-started]或[在 HDInsight 中创建 Hadoop 群集][hdinsight-provision]。\n- **配备 Azure PowerShell 的工作站**。请参阅[安装和使用 Azure PowerShell](/documentation/articles/powershell-install-configure)。\n\n##使用 PowerShell 提交 MapReduce 作业\n\n请参阅[在基于 Windows 的 HDInsight 中运行 Hadoop MapReduce 示例](/documentation/articles/hdinsight-run-samples)。\n\n##使用 PowerShell 提交 Hive 作业\n\n请参阅[使用 PowerShell 运行 Hive 查询](/documentation/articles/hdinsight-hadoop-use-hive-powershell)\n\n## 使用 Visual Studio 提交 Hive 作业\n\n请参阅[适用于 Visual Studio 的 HDInsight Hadoop 工具入门][hdinsight-visual-studio-tools]。\n\n##使用 PowerShell 提交 Sqoop 作业\n\n请参阅[将 Sqoop 与 HDInsight 配合使用][hdinsight-use-sqoop]。\n\n##使用 HDInsight .NET SDK 提交 Hive/Pig/Sqoop 作业\nHDInsight .NET SDK 提供 .NET 客户端库，可简化从 .NET 中使用 HDInsight 群集的操作。\n\n**提交作业**\n\n1. 在 Visual Studio 中创建 C# 控制台应用程序。\n2. 通过 Nuget 包管理器控制台运行以下命令。\n\n        Install-Package Microsoft.Azure.Common.Authentication -pre\n        Install-Package Microsoft.Azure.Management.HDInsight -Pre\n        Install-Package Microsoft.Azure.Management.HDInsight.Job -Pre\n2. 使用以下代码：\n\n        using System;\n        using System.Collections.Generic;\n        using System.Linq;\n        using System.Security;\n        \n        using Microsoft.Azure;\n        using Microsoft.Azure.Common.Authentication;\n        using Microsoft.Azure.Common.Authentication.Factories;\n        using Microsoft.Azure.Common.Authentication.Models;\n        using Microsoft.Azure.Management.HDInsight;\n        using Microsoft.Azure.Management.HDInsight.Job;\n        using Microsoft.Azure.Management.HDInsight.Job.Models;\n        using Hyak.Common;\n        \n        namespace SubmitHDInsightJobDotNet\n        {\n            class Program\n            {\n                private static HDInsightManagementClient _hdiManagementClient;\n                private static HDInsightJobManagementClient _hdiJobManagementClient;\n        \n                private static Guid SubscriptionId = new Guid(\"<Your Subscription ID>\");\n                private const string ResourceGroupName = \"<Your Resource Group Name>\";\n        \n                private const string ExistingClusterName = \"<Your HDInsight Cluster Name>\";\n                private const string ExistingClusterUri = ExistingClusterName + \".azurehdinsight.cn\";\n                private const string ExistingClusterUsername = \"admin\";\n                private const string ExistingClusterPassword = \"**********\";\n        \n                static void Main(string[] args)\n                {\n                    System.Console.WriteLine(\"Running\");\n        \n                    var tokenCreds = GetTokenCloudCredentials();\n                    var subCloudCredentials = GetSubscriptionCloudCredentials(tokenCreds, SubscriptionId);\n        \n                    _hdiManagementClient = new HDInsightManagementClient(subCloudCredentials);\n        \n                    var clusterCredentials = new BasicAuthenticationCloudCredentials { Username = ExistingClusterUsername, Password = ExistingClusterPassword };\n                    _hdiJobManagementClient = new HDInsightJobManagementClient(ExistingClusterUri, clusterCredentials);\n        \n                    SubmitHiveJob();\n                    SubmitPigJob();\n                    SubmitSqoopJob();\n                }\n        \n                public static TokenCloudCredentials GetTokenCloudCredentials(string username = null, SecureString password = null)\n                {\n                    var authFactory = new AuthenticationFactory();\n        \n                    var account = new AzureAccount { Type = AzureAccount.AccountType.User };\n        \n                    if (username != null && password != null)\n                        account.Id = username;\n        \n                    var env = AzureEnvironment.PublicEnvironments[EnvironmentName.AzureCloud];\n        \n                    var accessToken =\n                        authFactory.Authenticate(account, env, AuthenticationFactory.CommonAdTenant, password, ShowDialog.Auto)\n                            .AccessToken;\n        \n                    return new TokenCloudCredentials(accessToken);\n                }\n        \n                public static SubscriptionCloudCredentials GetSubscriptionCloudCredentials(TokenCloudCredentials creds, Guid subId)\n                {\n                    return new TokenCloudCredentials(subId.ToString(), creds.Token);\n                }\n        \n                private static void SubmitPigJob()\n                {\n                    var parameters = new PigJobSubmissionParameters\n                    {\n                        UserName = ExistingClusterUsername,\n                        Query = @\"LOGS = LOAD 'wasb:///example/data/sample.log';\n                            LEVELS = foreach LOGS generate REGEX_EXTRACT($0, '(TRACE|DEBUG|INFO|WARN|ERROR|FATAL)', 1)  as LOGLEVEL;\n                            FILTEREDLEVELS = FILTER LEVELS by LOGLEVEL is not null;\n                            GROUPEDLEVELS = GROUP FILTEREDLEVELS by LOGLEVEL;\n                            FREQUENCIES = foreach GROUPEDLEVELS generate group as LOGLEVEL, COUNT(FILTEREDLEVELS.LOGLEVEL) as COUNT;\n                            RESULT = order FREQUENCIES by COUNT desc;\n                            DUMP RESULT;\"\n                    };\n        \n                    System.Console.WriteLine(\"Submitting the Pig job to the cluster...\");\n                    var response = _hdiJobManagementClient.JobManagement.SubmitPigJob(parameters);\n                    System.Console.WriteLine(\"Validating that the response is as expected...\");\n                    System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\n                    System.Console.WriteLine(\"Validating the response object...\");\n                    System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\n                }\n        \n                private static void SubmitHiveJob()\n                {\n                    Dictionary<string, string> defines = new Dictionary<string, string> { { \"hive.execution.engine\", \"ravi\" }, { \"hive.exec.reducers.max\", \"1\" } };\n                    List<string> args = new List<string> { { \"argA\" }, { \"argB\" } };\n                    var parameters = new HiveJobSubmissionParameters\n                    {\n                        UserName = ExistingClusterUsername,\n                        Query = \"SHOW TABLES\",\n                        Defines = ConvertDefinesToString(defines),\n                        Arguments = ConvertArgsToString(args)\n                    };\n        \n                    System.Console.WriteLine(\"Submitting the Hive job to the cluster...\");\n                    var response = _hdiJobManagementClient.JobManagement.SubmitHiveJob(parameters);\n                    System.Console.WriteLine(\"Validating that the response is as expected...\");\n                    System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\n                    System.Console.WriteLine(\"Validating the response object...\");\n                    System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\n                }\n        \n                private static void SubmitSqoopJob()\n                {\n                    var sqlDatabaseServerName = \"<SQLDatabaseServerName>\";\n                    var sqlDatabaseLogin = \"<SQLDatabaseLogin>\";\n                    var sqlDatabaseLoginPassword = \"<SQLDatabaseLoginPassword>\";\n                    var sqlDatabaseDatabaseName = \"hdisqoop\";\n        \n                    var tableName = \"log4jlogs\";\n                    var exportDir = \"/tutorials/usesqoop/data\";\n        \n                    // Connection string for using Azure SQL Database.\n                    // Comment if using SQL Server\n                    var connectionString = \"jdbc:sqlserver://\" + sqlDatabaseServerName + \".database.chinacloudapi.cn;user=\" + sqlDatabaseLogin + \"@\" + sqlDatabaseServerName + \";password=\" + sqlDatabaseLoginPassword + \";database=\" + sqlDatabaseDatabaseName;\n                    // Connection string for using SQL Server.\n                    // Uncomment if using SQL Server\n                    //var connectionString = \"jdbc:sqlserver://\" + sqlDatabaseServerName + \";user=\" + sqlDatabaseLogin + \";password=\" + sqlDatabaseLoginPassword + \";database=\" + sqlDatabaseDatabaseName;\n        \n                    var parameters = new SqoopJobSubmissionParameters\n                    {\n                        UserName = ExistingClusterUsername,\n                        Command = \"export --connect \" + connectionString + \" --table \" + tableName + \"_mobile --export-dir \" + exportDir + \"_mobile --fields-terminated-by \\\\t -m 1\"\n                    };\n        \n                    System.Console.WriteLine(\"Submitting the Sqoop job to the cluster...\");\n                    var response = _hdiJobManagementClient.JobManagement.SubmitSqoopJob(parameters);\n                    System.Console.WriteLine(\"Validating that the response is as expected...\");\n                    System.Console.WriteLine(\"Response status code is \" + response.StatusCode);\n                    System.Console.WriteLine(\"Validating the response object...\");\n                    System.Console.WriteLine(\"JobId is \" + response.JobSubmissionJsonResponse.Id);\n                }\n        \n                private static string ConvertDefinesToString(Dictionary<string, string> defines)\n                {\n                    if (defines.Count == 0)\n                    {\n                        return null;\n                    }\n        \n                    return string.Join(\"&define=\", defines.Select(x => x.Key + \"%3D\" + x.Value).ToArray());\n                }\n                private static string ConvertArgsToString(List<string> args)\n                {\n                    if (args.Count == 0)\n                    {\n                        return null;\n                    }\n        \n                    return string.Join(\"&arg=\", args.ToArray());\n                }\n            }\n        }\n\n5. 按 **F5** 运行应用程序。\n\n##使用适用于 Visual Studio 的 HDInsight 工具提交作业\n\n你可以使用适用于 Visual Studio 的 HDInsight 工具来运行 Hive 查询和 Pig 脚本。请参阅[适用于 HDInsight 的 Visual Studio Hadoop 工具入门](/documentation/articles/hdinsight-hadoop-visual-studio-tools-get-started)。\n\n##后续步骤\n在本文中，你已经学习了几种创建 HDInsight 群集的方法。若要了解更多信息，请参阅下列文章：\n\n* [Azure HDInsight 入门][hdinsight-get-started]\n* [在 HDInsight 中创建 Hadoop 群集][hdinsight-provision]\n* [使用 PowerShell 管理 HDInsight][hdinsight-admin-powershell]\n* [HDInsight Cmdlet 参考文档][hdinsight-powershell-reference]\n* [将 Hive 与 HDInsight 配合使用][hdinsight-use-hive]\n* [将 Pig 与 HDInsight 配合使用][hdinsight-use-pig]\n\n\n[azure-certificate]: /documentation/articles/cloud-services-certs-create/\n[azure-management-portal]: https://manage.windowsazure.cn/\n\n[hdinsight-visual-studio-tools]: /documentation/articles/hdinsight-hadoop-visual-studio-tools-get-started\n[hdinsight-use-sqoop]: /documentation/articles/hdinsight-use-sqoop\n[hdinsight-provision]: /documentation/articles/hdinsight-provision-clusters-v1\n[hdinsight-use-mapreduce]: /documentation/articles/hdinsight-use-mapreduce\n[hdinsight-use-hive]: /documentation/articles/hdinsight-use-hive\n[hdinsight-use-pig]: /documentation/articles/hdinsight-use-pig\n[hdinsight-get-started]: /documentation/articles/hdinsight-hadoop-tutorial-get-started-windows-v1\n[hdinsight-storage]: /documentation/articles/hdinsight-hadoop-use-blob-storage\n[hdinsight-admin-powershell]: /documentation/articles/hdinsight-administer-use-powershell\n[hdinsight-develop-streaming-jobs]: /documentation/articles/hdinsight-hadoop-develop-deploy-streaming-jobs\n\n[hdinsight-powershell-reference]: https://msdn.microsoft.com/zh-cn/library/dn858087.aspx\n\n[powershell-install-configure]: /documentation/articles/powershell-install-configure\n\n[image-hdi-gettingstarted-runmrjob]: ./media/hdinsight-submit-hadoop-jobs-programmatically/HDI.GettingStarted.RunMRJob.png\n[image-hdi-gettingstarted-mrjoboutput]: ./media/hdinsight-submit-hadoop-jobs-programmatically/HDI.GettingStarted.MRJobOutput.png\n\n[apache-hive]: http://hive.apache.org/\n\n<!---HONumber=Mooncake_1207_2015-->"
}