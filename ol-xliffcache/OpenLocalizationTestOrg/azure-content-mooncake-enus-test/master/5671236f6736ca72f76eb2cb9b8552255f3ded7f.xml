{
  "nodes": [
    {
      "content": "服务总线 和 PHP 与 AMQP 1.0 | Azure",
      "pos": [
        27,
        56
      ]
    },
    {
      "content": "使用 AMQP 通过 PHP 使用服务总线。",
      "pos": [
        74,
        96
      ]
    },
    {
      "content": "使用 AMQP 1.0 通过 PHP 使用服务总线",
      "pos": [
        310,
        335
      ]
    },
    {
      "content": "Proton-PHP 是绑定到 Proton-C 的 PHP 语言；也就是说，Proton-PHP 是作为 C 中实现的引擎周围的包装器实现的。",
      "pos": [
        424,
        496
      ]
    },
    {
      "content": "下载 Proton 客户端库",
      "pos": [
        501,
        515
      ]
    },
    {
      "pos": [
        517,
        664
      ],
      "content": "你可以从 <bpt id=\"p1\">[</bpt>http://qpid.apache.org/download.html<ept id=\"p1\">](http://qpid.apache.org/download.html)</ept> 下载 Proton-C 及其关联的绑定（包括 PHP）。此下载采用源代码格式。若要生成代码，请按照已下载的程序包中包含的说明操作。"
    },
    {
      "pos": [
        668,
        840
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph>在撰写本文时，Proton-C 中的 SSL 支持仅适用于 Linux 操作系统。由于 Azure 服务总线需要使用 SSL，目前，Proton-C（及语言绑定）只能用于从 Linux 访问服务总线。对 Windows 上的 SSL 启用 Proton-C 的开发工作正在进行中，因此请经常返回查看是否有更新。"
    },
    {
      "content": "通过 PHP 使用服务总线队列、主题和订阅",
      "pos": [
        845,
        866
      ]
    },
    {
      "content": "以下代码演示如何从服务总线消息实体发送和接收消息。",
      "pos": [
        868,
        893
      ]
    },
    {
      "content": "使用 Proton-PHP 发送消息",
      "pos": [
        899,
        917
      ]
    },
    {
      "content": "以下代码演示如何向服务总线消息实体发送消息。",
      "pos": [
        919,
        941
      ]
    },
    {
      "content": "使用 Proton-PHP 接收消息",
      "pos": [
        1204,
        1222
      ]
    },
    {
      "content": "以下代码演示如何从服务总线消息实体接收消息。",
      "pos": [
        1224,
        1246
      ]
    },
    {
      "content": "在 .NET 和 Proton-PHP 之间进行消息传递",
      "pos": [
        1577,
        1605
      ]
    },
    {
      "content": "应用程序属性",
      "pos": [
        1611,
        1617
      ]
    },
    {
      "content": "ProtonPHP 到服务总线 .NET API",
      "pos": [
        1624,
        1648
      ]
    },
    {
      "pos": [
        1650,
        1768
      ],
      "content": "Proton-PHP 消息支持以下类型的应用程序属性：<bpt id=\"p1\">**</bpt>integer<ept id=\"p1\">**</ept>、<bpt id=\"p2\">**</bpt>double<ept id=\"p2\">**</ept>、<bpt id=\"p3\">**</bpt>Boolean<ept id=\"p3\">**</ept>、<bpt id=\"p4\">**</bpt>string<ept id=\"p4\">**</ept> 和 <bpt id=\"p5\">**</bpt>object<ept id=\"p5\">**</ept>。以下 PHP 代码显示如何使用上述每种属性类型在消息上设置属性。"
    },
    {
      "pos": [
        2039,
        2141
      ],
      "content": "在服务总线 .NET API 中，在 <bpt id=\"p1\">[</bpt>BrokeredMessage<ept id=\"p1\">][]</ept> 的 <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> 集合中携带消息应用程序属性。以下代码演示如何读取从 PHP 客户端收到的消息的应用程序属性。"
    },
    {
      "content": "下表将 PHP 属性类型映射到 .NET 属性类型。",
      "pos": [
        2631,
        2657
      ]
    },
    {
      "content": "PHP 属性类型",
      "pos": [
        2661,
        2669
      ]
    },
    {
      "content": ".NET 属性类型",
      "pos": [
        2672,
        2681
      ]
    },
    {
      "content": "integer",
      "pos": [
        2729,
        2736
      ]
    },
    {
      "content": "int",
      "pos": [
        2739,
        2742
      ]
    },
    {
      "content": "double",
      "pos": [
        2747,
        2753
      ]
    },
    {
      "content": "double",
      "pos": [
        2756,
        2762
      ]
    },
    {
      "content": "布尔值",
      "pos": [
        2767,
        2770
      ]
    },
    {
      "content": "bool",
      "pos": [
        2773,
        2777
      ]
    },
    {
      "content": "字符串",
      "pos": [
        2782,
        2785
      ]
    },
    {
      "content": "字符串",
      "pos": [
        2788,
        2791
      ]
    },
    {
      "content": "object",
      "pos": [
        2796,
        2802
      ]
    },
    {
      "content": "对象",
      "pos": [
        2805,
        2807
      ]
    },
    {
      "content": "服务总线 .NET API 到 PHP",
      "pos": [
        2816,
        2835
      ]
    },
    {
      "pos": [
        2837,
        3129
      ],
      "content": "<bpt id=\"p1\">[</bpt>BrokeredMessage<ept id=\"p1\">][]</ept> 类型支持以下类型的应用程序属性：<bpt id=\"p2\">**</bpt>byte<ept id=\"p2\">**</ept>、<bpt id=\"p3\">**</bpt>sbyte<ept id=\"p3\">**</ept>、<bpt id=\"p4\">**</bpt>char<ept id=\"p4\">**</ept>、<bpt id=\"p5\">**</bpt>short<ept id=\"p5\">**</ept>、<bpt id=\"p6\">**</bpt>ushort<ept id=\"p6\">**</ept>、<bpt id=\"p7\">**</bpt>int<ept id=\"p7\">**</ept>、<bpt id=\"p8\">**</bpt>uint<ept id=\"p8\">**</ept>、<bpt id=\"p9\">**</bpt>long<ept id=\"p9\">**</ept>、<bpt id=\"p10\">**</bpt>ulong<ept id=\"p10\">**</ept>、<bpt id=\"p11\">**</bpt>float<ept id=\"p11\">**</ept>、<bpt id=\"p12\">**</bpt>double<ept id=\"p12\">**</ept>、<bpt id=\"p13\">**</bpt>decimal<ept id=\"p13\">**</ept>、<bpt id=\"p14\">**</bpt>bool<ept id=\"p14\">**</ept>、<bpt id=\"p15\">**</bpt>Guid<ept id=\"p15\">**</ept>、<bpt id=\"p16\">**</bpt>string<ept id=\"p16\">**</ept>、<bpt id=\"p17\">**</bpt>Uri<ept id=\"p17\">**</ept>、<bpt id=\"p18\">**</bpt>DateTime<ept id=\"p18\">**</ept>、<bpt id=\"p19\">**</bpt>DateTimeOffset<ept id=\"p19\">**</ept> 和 <bpt id=\"p20\">**</bpt>TimeSpan<ept id=\"p20\">**</ept>。以下 .NET 代码显示如何使用上述每种属性类型在 <bpt id=\"p21\">[</bpt>BrokeredMessage<ept id=\"p21\">][]</ept> 对象上设置属性。"
    },
    {
      "content": "以下 PHP 代码演示如何读取从服务总线 .NET 客户端收到的消息的应用程序属性。",
      "pos": [
        4094,
        4136
      ]
    },
    {
      "content": "下表将 .NET 属性类型映射到 PHP 属性类型。",
      "pos": [
        4340,
        4366
      ]
    },
    {
      "content": ".NET 属性类型",
      "pos": [
        4370,
        4379
      ]
    },
    {
      "content": "PHP 属性类型",
      "pos": [
        4382,
        4390
      ]
    },
    {
      "content": "说明",
      "pos": [
        4393,
        4395
      ]
    },
    {
      "content": "byte",
      "pos": [
        4609,
        4613
      ]
    },
    {
      "content": "integer",
      "pos": [
        4616,
        4623
      ]
    },
    {
      "content": "-",
      "pos": [
        4626,
        4627
      ]
    },
    {
      "content": "sbyte",
      "pos": [
        4631,
        4636
      ]
    },
    {
      "content": "integer",
      "pos": [
        4639,
        4646
      ]
    },
    {
      "content": "-",
      "pos": [
        4649,
        4650
      ]
    },
    {
      "content": "char",
      "pos": [
        4654,
        4658
      ]
    },
    {
      "content": "Char",
      "pos": [
        4661,
        4665
      ]
    },
    {
      "content": "Proton-PHP 类",
      "pos": [
        4668,
        4680
      ]
    },
    {
      "content": "short",
      "pos": [
        4686,
        4691
      ]
    },
    {
      "content": "integer",
      "pos": [
        4694,
        4701
      ]
    },
    {
      "content": "-",
      "pos": [
        4704,
        4705
      ]
    },
    {
      "content": "ushort",
      "pos": [
        4709,
        4715
      ]
    },
    {
      "content": "integer",
      "pos": [
        4718,
        4725
      ]
    },
    {
      "content": "-",
      "pos": [
        4728,
        4729
      ]
    },
    {
      "content": "int",
      "pos": [
        4733,
        4736
      ]
    },
    {
      "content": "integer",
      "pos": [
        4739,
        4746
      ]
    },
    {
      "content": "-",
      "pos": [
        4749,
        4750
      ]
    },
    {
      "content": "uint",
      "pos": [
        4754,
        4758
      ]
    },
    {
      "content": "Integer",
      "pos": [
        4761,
        4768
      ]
    },
    {
      "content": "-",
      "pos": [
        4771,
        4772
      ]
    },
    {
      "content": "long",
      "pos": [
        4776,
        4780
      ]
    },
    {
      "content": "integer",
      "pos": [
        4783,
        4790
      ]
    },
    {
      "content": "-",
      "pos": [
        4793,
        4794
      ]
    },
    {
      "content": "ulong",
      "pos": [
        4798,
        4803
      ]
    },
    {
      "content": "integer",
      "pos": [
        4806,
        4813
      ]
    },
    {
      "content": "-",
      "pos": [
        4816,
        4817
      ]
    },
    {
      "content": "float",
      "pos": [
        4821,
        4826
      ]
    },
    {
      "content": "double",
      "pos": [
        4829,
        4835
      ]
    },
    {
      "content": "-",
      "pos": [
        4838,
        4839
      ]
    },
    {
      "content": "double",
      "pos": [
        4843,
        4849
      ]
    },
    {
      "content": "double",
      "pos": [
        4852,
        4858
      ]
    },
    {
      "content": "-",
      "pos": [
        4861,
        4862
      ]
    },
    {
      "content": "decimal",
      "pos": [
        4866,
        4873
      ]
    },
    {
      "content": "string",
      "pos": [
        4876,
        4882
      ]
    },
    {
      "content": "目前 Proton 不支持 Decimal。",
      "pos": [
        4885,
        4907
      ]
    },
    {
      "content": "bool",
      "pos": [
        4912,
        4916
      ]
    },
    {
      "content": "boolean",
      "pos": [
        4919,
        4926
      ]
    },
    {
      "content": "-",
      "pos": [
        4929,
        4930
      ]
    },
    {
      "content": "Guid",
      "pos": [
        4934,
        4938
      ]
    },
    {
      "content": "UUID",
      "pos": [
        4941,
        4945
      ]
    },
    {
      "content": "Proton-PHP 类",
      "pos": [
        4948,
        4960
      ]
    },
    {
      "content": "string",
      "pos": [
        4966,
        4972
      ]
    },
    {
      "content": "string",
      "pos": [
        4975,
        4981
      ]
    },
    {
      "content": "-",
      "pos": [
        4984,
        4985
      ]
    },
    {
      "content": "DateTime",
      "pos": [
        4989,
        4997
      ]
    },
    {
      "content": "integer",
      "pos": [
        5000,
        5007
      ]
    },
    {
      "content": "-",
      "pos": [
        5010,
        5011
      ]
    },
    {
      "content": "DateTimeOffset",
      "pos": [
        5015,
        5029
      ]
    },
    {
      "content": "DescribedType",
      "pos": [
        5032,
        5045
      ]
    },
    {
      "content": "映射到 AMQP 类型的 DateTimeOffset.UtcTicks：",
      "pos": [
        5048,
        5085
      ]
    },
    {
      "content": "TimeSpan",
      "pos": [
        5208,
        5216
      ]
    },
    {
      "content": "DescribedType",
      "pos": [
        5219,
        5232
      ]
    },
    {
      "content": "映射到 AMQP 类型的 Timespan.Ticks：",
      "pos": [
        5235,
        5263
      ]
    },
    {
      "content": "Uri",
      "pos": [
        5372,
        5375
      ]
    },
    {
      "content": "DescribedType",
      "pos": [
        5378,
        5391
      ]
    },
    {
      "content": "映射到 AMQP 类型的 Uri.AbsoluteUri：",
      "pos": [
        5394,
        5423
      ]
    },
    {
      "content": "标准属性",
      "pos": [
        5528,
        5532
      ]
    },
    {
      "pos": [
        5534,
        5591
      ],
      "content": "下表显示了 Proton-PHP 标准消息属性与 <bpt id=\"p1\">[</bpt>BrokeredMessage<ept id=\"p1\">][]</ept> 标准消息属性之间的映射。"
    },
    {
      "content": "Proton-PHP",
      "pos": [
        5595,
        5605
      ]
    },
    {
      "content": "服务总线 .NET",
      "pos": [
        5608,
        5617
      ]
    },
    {
      "content": "说明",
      "pos": [
        5620,
        5622
      ]
    },
    {
      "content": "Durable",
      "pos": [
        5738,
        5745
      ]
    },
    {
      "content": "不适用",
      "pos": [
        5748,
        5751
      ]
    },
    {
      "content": "服务总线仅支持持久消息。",
      "pos": [
        5754,
        5766
      ]
    },
    {
      "content": "Priority",
      "pos": [
        5771,
        5779
      ]
    },
    {
      "content": "不适用",
      "pos": [
        5782,
        5785
      ]
    },
    {
      "content": "服务总线仅支持单一消息优先级。",
      "pos": [
        5788,
        5803
      ]
    },
    {
      "content": "Ttl",
      "pos": [
        5808,
        5811
      ]
    },
    {
      "content": "Message.TimeToLive",
      "pos": [
        5814,
        5832
      ]
    },
    {
      "content": "转换，Proton-PHP TTL 以毫秒为单位定义。",
      "pos": [
        5835,
        5862
      ]
    },
    {
      "content": "first_acquirer",
      "pos": [
        5867,
        5881
      ]
    },
    {
      "content": "-",
      "pos": [
        5884,
        5885
      ]
    },
    {
      "content": "-",
      "pos": [
        5888,
        5889
      ]
    },
    {
      "content": "delivery_count",
      "pos": [
        5895,
        5909
      ]
    },
    {
      "content": "-",
      "pos": [
        5912,
        5913
      ]
    },
    {
      "content": "-",
      "pos": [
        5916,
        5917
      ]
    },
    {
      "content": "Id",
      "pos": [
        5923,
        5925
      ]
    },
    {
      "content": "Message.Id",
      "pos": [
        5928,
        5938
      ]
    },
    {
      "content": "-",
      "pos": [
        5941,
        5942
      ]
    },
    {
      "content": "user_id",
      "pos": [
        5948,
        5955
      ]
    },
    {
      "content": "-",
      "pos": [
        5958,
        5959
      ]
    },
    {
      "content": "-",
      "pos": [
        5962,
        5963
      ]
    },
    {
      "content": "Address",
      "pos": [
        5969,
        5976
      ]
    },
    {
      "content": "Message.To",
      "pos": [
        5979,
        5989
      ]
    },
    {
      "content": "-",
      "pos": [
        5992,
        5993
      ]
    },
    {
      "content": "Subject",
      "pos": [
        5999,
        6006
      ]
    },
    {
      "content": "Message.Label",
      "pos": [
        6009,
        6022
      ]
    },
    {
      "content": "-",
      "pos": [
        6025,
        6026
      ]
    },
    {
      "content": "reply_to",
      "pos": [
        6032,
        6040
      ]
    },
    {
      "content": "Message.ReplyTo",
      "pos": [
        6043,
        6058
      ]
    },
    {
      "content": "-",
      "pos": [
        6061,
        6062
      ]
    },
    {
      "content": "correlation_id",
      "pos": [
        6068,
        6082
      ]
    },
    {
      "content": "Message.CorrelationId",
      "pos": [
        6085,
        6106
      ]
    },
    {
      "content": "-",
      "pos": [
        6109,
        6110
      ]
    },
    {
      "content": "content_type",
      "pos": [
        6116,
        6128
      ]
    },
    {
      "content": "Message.ContentType",
      "pos": [
        6131,
        6150
      ]
    },
    {
      "content": "-",
      "pos": [
        6153,
        6154
      ]
    },
    {
      "content": "content_encoding",
      "pos": [
        6159,
        6175
      ]
    },
    {
      "content": "不适用",
      "pos": [
        6178,
        6181
      ]
    },
    {
      "content": "-",
      "pos": [
        6184,
        6185
      ]
    },
    {
      "content": "expiry_time",
      "pos": [
        6190,
        6201
      ]
    },
    {
      "content": "Message.ExpiresAtUTC",
      "pos": [
        6204,
        6224
      ]
    },
    {
      "content": "-",
      "pos": [
        6227,
        6228
      ]
    },
    {
      "content": "creation_time",
      "pos": [
        6234,
        6247
      ]
    },
    {
      "content": "不适用",
      "pos": [
        6250,
        6253
      ]
    },
    {
      "content": "-",
      "pos": [
        6256,
        6257
      ]
    },
    {
      "content": "group_id",
      "pos": [
        6262,
        6270
      ]
    },
    {
      "content": "Message.SessionId",
      "pos": [
        6273,
        6290
      ]
    },
    {
      "content": "-",
      "pos": [
        6293,
        6294
      ]
    },
    {
      "content": "group_sequence",
      "pos": [
        6300,
        6314
      ]
    },
    {
      "content": "-",
      "pos": [
        6317,
        6318
      ]
    },
    {
      "content": "reply_to_group_id",
      "pos": [
        6324,
        6341
      ]
    },
    {
      "content": "Message.ReplyToSessionId",
      "pos": [
        6344,
        6368
      ]
    },
    {
      "content": "-",
      "pos": [
        6371,
        6372
      ]
    },
    {
      "content": "Format",
      "pos": [
        6377,
        6383
      ]
    },
    {
      "content": "不适用",
      "pos": [
        6386,
        6389
      ]
    },
    {
      "content": "-",
      "pos": [
        6392,
        6393
      ]
    },
    {
      "content": "服务总线 .NET API 到 Proton-PHP",
      "pos": [
        6402,
        6428
      ]
    },
    {
      "content": "服务总线 .NET",
      "pos": [
        6432,
        6441
      ]
    },
    {
      "content": "Proton-PHP",
      "pos": [
        6444,
        6454
      ]
    },
    {
      "content": "说明",
      "pos": [
        6457,
        6459
      ]
    },
    {
      "content": "ContentType",
      "pos": [
        6606,
        6617
      ]
    },
    {
      "content": "Message-&gt;content_type",
      "pos": [
        6620,
        6641
      ]
    },
    {
      "content": "-",
      "pos": [
        6644,
        6645
      ]
    },
    {
      "content": "CorrelationId",
      "pos": [
        6651,
        6664
      ]
    },
    {
      "content": "Message-&gt;correlation_id",
      "pos": [
        6667,
        6690
      ]
    },
    {
      "content": "-",
      "pos": [
        6693,
        6694
      ]
    },
    {
      "content": "EnqueuedTimeUtc",
      "pos": [
        6700,
        6715
      ]
    },
    {
      "content": "Message-&gt;annotations[x-opt-enqueued-time]",
      "pos": [
        6718,
        6759
      ]
    },
    {
      "content": "-",
      "pos": [
        6762,
        6763
      ]
    },
    {
      "content": "Label",
      "pos": [
        6769,
        6774
      ]
    },
    {
      "content": "Message-&gt;subject",
      "pos": [
        6777,
        6793
      ]
    },
    {
      "content": "-",
      "pos": [
        6796,
        6797
      ]
    },
    {
      "content": "MessageId",
      "pos": [
        6803,
        6812
      ]
    },
    {
      "content": "Message-&gt;id",
      "pos": [
        6815,
        6826
      ]
    },
    {
      "content": "-",
      "pos": [
        6829,
        6830
      ]
    },
    {
      "content": "ReplyTo",
      "pos": [
        6836,
        6843
      ]
    },
    {
      "content": "Message-&gt;reply_to",
      "pos": [
        6846,
        6863
      ]
    },
    {
      "content": "-",
      "pos": [
        6866,
        6867
      ]
    },
    {
      "content": "ReplyToSessionId",
      "pos": [
        6873,
        6889
      ]
    },
    {
      "content": "Message-&gt;reply_to_group_id",
      "pos": [
        6892,
        6918
      ]
    },
    {
      "content": "-",
      "pos": [
        6921,
        6922
      ]
    },
    {
      "content": "ScheduledEnqueueTimeUtc",
      "pos": [
        6928,
        6951
      ]
    },
    {
      "content": "Message-&gt;annotations [“x-opt-scheduled-enqueue-time”]",
      "pos": [
        6954,
        7007
      ]
    },
    {
      "content": "-",
      "pos": [
        7010,
        7011
      ]
    },
    {
      "content": "SessionId",
      "pos": [
        7017,
        7026
      ]
    },
    {
      "content": "Message-&gt;group_id",
      "pos": [
        7029,
        7046
      ]
    },
    {
      "content": "-",
      "pos": [
        7049,
        7050
      ]
    },
    {
      "content": "TimeToLive",
      "pos": [
        7056,
        7066
      ]
    },
    {
      "content": "Message-&gt;ttl",
      "pos": [
        7069,
        7081
      ]
    },
    {
      "content": "转换，Proton-PHP TTL 以毫秒为单位定义。",
      "pos": [
        7084,
        7111
      ]
    },
    {
      "content": "To",
      "pos": [
        7116,
        7118
      ]
    },
    {
      "content": "Message-&gt;address",
      "pos": [
        7121,
        7137
      ]
    },
    {
      "content": "-",
      "pos": [
        7140,
        7141
      ]
    },
    {
      "content": "后续步骤",
      "pos": [
        7148,
        7152
      ]
    },
    {
      "content": "准备好了解详细信息？ 请访问以下链接：",
      "pos": [
        7154,
        7173
      ]
    },
    {
      "content": "服务总线 AMQP 概述",
      "pos": [
        7178,
        7190
      ]
    },
    {
      "content": "适用于 Windows Server 的服务总线中的 AMQP",
      "pos": [
        7195,
        7226
      ]
    }
  ],
  "content": "<properties \n   pageTitle=\"服务总线 和 PHP 与 AMQP 1.0 | Azure\"\n   description=\"使用 AMQP 通过 PHP 使用服务总线。\"\n   services=\"service-bus\"\n   documentationCenter=\"na\"\n   authors=\"sethmanheim\"\n   manager=\"timlt\"\n   editor=\"tysonn\" /> \n<tags \n   ms.service=\"service-bus\"\n   ms.date=\"10/07/2015\"\n   wacn.date=\"11/27/2015\" />\n\n# 使用 AMQP 1.0 通过 PHP 使用服务总线\n\n[AZURE.INCLUDE [service-bus-selector-amqp](../includes/service-bus-selector-amqp.md)]\n\nProton-PHP 是绑定到 Proton-C 的 PHP 语言；也就是说，Proton-PHP 是作为 C 中实现的引擎周围的包装器实现的。\n\n## 下载 Proton 客户端库\n\n你可以从 [http://qpid.apache.org/download.html](http://qpid.apache.org/download.html) 下载 Proton-C 及其关联的绑定（包括 PHP）。此下载采用源代码格式。若要生成代码，请按照已下载的程序包中包含的说明操作。\n\n> [AZURE.IMPORTANT]在撰写本文时，Proton-C 中的 SSL 支持仅适用于 Linux 操作系统。由于 Azure 服务总线需要使用 SSL，目前，Proton-C（及语言绑定）只能用于从 Linux 访问服务总线。对 Windows 上的 SSL 启用 Proton-C 的开发工作正在进行中，因此请经常返回查看是否有更新。\n\n## 通过 PHP 使用服务总线队列、主题和订阅\n\n以下代码演示如何从服务总线消息实体发送和接收消息。\n\n### 使用 Proton-PHP 发送消息\n\n以下代码演示如何向服务总线消息实体发送消息。\n\n```\n$messenger = new Messenger();\n$message = new Message();\n$message->address = \"amqps://[username]:[password]@[namespace].servicebus.chinacloudapi.cn/[entity]\";\n\n$message->body = \"This is a text string\";\n$messenger->put($message);\n$messenger->send();\n```\n\n### 使用 Proton-PHP 接收消息\n\n以下代码演示如何从服务总线消息实体接收消息。\n\n```\n$messenger = new Messenger();\n$address = \"amqps://[username]:[password]@[namespace].servicebus.chinacloudapi.cn/[entity]\";\n$messenger->subscribe($address);\n\n$messenger->start();\n$messenger->recv(1);\n\nif($messenger->incoming())\n{\n   $message = new Message();\n   $messenger->get($message);      \n}\n\n$messenger->stop();\n```\n\n## 在 .NET 和 Proton-PHP 之间进行消息传递\n\n### 应用程序属性\n\n#### ProtonPHP 到服务总线 .NET API\n\nProton-PHP 消息支持以下类型的应用程序属性：**integer**、**double**、**Boolean**、**string** 和 **object**。以下 PHP 代码显示如何使用上述每种属性类型在消息上设置属性。\n\n```\n$message->properties[\"TestInt\"] = 1;    \n$message->properties[\"TestDouble\"] = 1.5;      \n$message->properties[\"TestBoolean\"] = False;\n$message->properties[\"TestString\"] = \"Service Bus\";    \n$message->properties[\"TestObject\"] = new UUID(\"1234123412341234\");   \n```\n\n在服务总线 .NET API 中，在 [BrokeredMessage][] 的 **Properties** 集合中携带消息应用程序属性。以下代码演示如何读取从 PHP 客户端收到的消息的应用程序属性。\n\n```\nif (message.Properties.Keys.Count > 0)\n{\n  foreach (string name in message.Properties.Keys)\n  {\n    Object value = message.Properties[name];\n    Console.WriteLine(name + \": \" + value + \" (\" + value.GetType() + \")\" );\n  }\n  Console.WriteLine();\n}if (message.Properties.Keys.Count > 0)\n{\nforeach (string name in message.Properties.Keys)\n{\n  Object value = message.Properties[name];\n  Console.WriteLine(name + \": \" + value + \" (\" + value.GetType() + \")\" );\n}\nConsole.WriteLine();\n}\n```\n\n下表将 PHP 属性类型映射到 .NET 属性类型。\n\n| PHP 属性类型 | .NET 属性类型 |\n|-------------------|--------------------|\n| integer | int |\n| double | double |\n| 布尔值 | bool |\n| 字符串 | 字符串 |\n| object | 对象 |\n\n#### 服务总线 .NET API 到 PHP\n\n[BrokeredMessage][] 类型支持以下类型的应用程序属性：**byte**、**sbyte**、**char**、**short**、**ushort**、**int**、**uint**、**long**、**ulong**、**float**、**double**、**decimal**、**bool**、**Guid**、**string**、**Uri**、**DateTime**、**DateTimeOffset** 和 **TimeSpan**。以下 .NET 代码显示如何使用上述每种属性类型在 [BrokeredMessage][] 对象上设置属性。\n\n```\nmessage.Properties[\"TestByte\"] = (byte)128;\nmessage.Properties[\"TestSbyte\"] = (sbyte)-22;\nmessage.Properties[\"TestChar\"] = (char) 'X';\nmessage.Properties[\"TestShort\"] = (short)-12345;\nmessage.Properties[\"TestUshort\"] = (ushort)12345;\nmessage.Properties[\"TestInt\"] = (int)-100;\nmessage.Properties[\"TestUint\"] = (uint)100;\nmessage.Properties[\"TestLong\"] = (long)-12345;\nmessage.Properties[\"TestUlong\"] = (ulong)12345;\nmessage.Properties[\"TestFloat\"] = (float)3.14159;\nmessage.Properties[\"TestDouble\"] = (double)3.14159;\nmessage.Properties[\"TestDecimal\"] = (decimal)3.14159;\nmessage.Properties[\"TestBoolean\"] = true;\nmessage.Properties[\"TestGuid\"] = Guid.NewGuid();\nmessage.Properties[\"TestString\"] = \"Service Bus\";\nmessage.Properties[\"TestUri\"] = new Uri(\"http://www.bing.com\");\nmessage.Properties[\"TestDateTime\"] = DateTime.Now;\nmessage.Properties[\"TestDateTimeOffSet\"] = DateTimeOffset.Now;\nmessage.Properties[\"TestTimeSpan\"] = TimeSpan.FromMinutes(60);\n```\n\n以下 PHP 代码演示如何读取从服务总线 .NET 客户端收到的消息的应用程序属性。\n\n```\nif ($message->properties != null)\n{\n  foreach($message->properties as $key => $value)\n  {\n    printf(\"-- %s : %s (%s) \\n\", $key, $value, gettype($value));                       \n  }         \n}\n```\n\n下表将 .NET 属性类型映射到 PHP 属性类型。\n\n| .NET 属性类型 | PHP 属性类型 | 说明 |\n|--------------------|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| byte | integer | - \n| sbyte | integer | - \n| char | Char | Proton-PHP 类 | \n| short | integer | - \n| ushort | integer | - \n| int | integer | - \n| uint | Integer | - \n| long | integer | - \n| ulong | integer | - \n| float | double | - \n| double | double | - \n| decimal | string | 目前 Proton 不支持 Decimal。| \n| bool | boolean | - \n| Guid | UUID | Proton-PHP 类 | \n| string | string | - \n| DateTime | integer | - \n| DateTimeOffset | DescribedType | 映射到 AMQP 类型的 DateTimeOffset.UtcTicks：<type name=”datetime-offset” class=restricted source=”long”> <descriptor name=”com.microsoft:datetime-offset” /></type> \n| TimeSpan | DescribedType | 映射到 AMQP 类型的 Timespan.Ticks：<type name=”timespan” class=restricted source=”long”> <descriptor name=”com.microsoft:timespan” /></type> \n| Uri | DescribedType | 映射到 AMQP 类型的 Uri.AbsoluteUri：<type name=”uri” class=restricted source=”string”> <descriptor name=”com.microsoft:uri” /></type> |\n\n### 标准属性\n\n下表显示了 Proton-PHP 标准消息属性与 [BrokeredMessage][] 标准消息属性之间的映射。\n\n| Proton-PHP | 服务总线 .NET | 说明 |\n|----------------------|--------------------------|----------------------------------------------------------|\n| Durable | 不适用 | 服务总线仅支持持久消息。 |\n| Priority | 不适用 | 服务总线仅支持单一消息优先级。 |\n| Ttl | Message.TimeToLive | 转换，Proton-PHP TTL 以毫秒为单位定义。 |\n| first_acquirer | - | - | \n| delivery_count | - | - | \n| Id | Message.Id | - | \n| user_id | - | - | \n| Address | Message.To | - | \n| Subject | Message.Label | - | \n| reply_to | Message.ReplyTo | - | \n| correlation_id | Message.CorrelationId | - | \n| content_type | Message.ContentType | - |\n| content_encoding | 不适用 | - |\n| expiry_time | Message.ExpiresAtUTC | - | \n| creation_time | 不适用 | - |\n| group_id | Message.SessionId | - | \n| group_sequence | - | \n| reply_to_group_id | Message.ReplyToSessionId | - |\n| Format | 不适用 | - |\n\n#### 服务总线 .NET API 到 Proton-PHP\n\n| 服务总线 .NET | Proton-PHP | 说明 |\n|-------------------------|--------------------------------------------------------|--------------------------------------------------------|\n| ContentType | Message->content_type | - | \n| CorrelationId | Message->correlation_id | - | \n| EnqueuedTimeUtc | Message->annotations[x-opt-enqueued-time] | - | \n| Label | Message->subject | - | \n| MessageId | Message->id | - | \n| ReplyTo | Message->reply_to | - | \n| ReplyToSessionId | Message->reply_to_group_id | - | \n| ScheduledEnqueueTimeUtc | Message->annotations [“x-opt-scheduled-enqueue-time”] | - | \n| SessionId | Message->group_id | - | \n| TimeToLive | Message->ttl | 转换，Proton-PHP TTL 以毫秒为单位定义。| \n| To | Message->address | - |\n\n## 后续步骤\n\n准备好了解详细信息？ 请访问以下链接：\n\n- [服务总线 AMQP 概述]\n- [适用于 Windows Server 的服务总线中的 AMQP]\n\n\n[BrokeredMessage]: https://msdn.microsoft.com/zh-cn/library/azure/microsoft.servicebus.messaging.brokeredmessage.aspx\n\n[适用于 Windows Server 的服务总线中的 AMQP]: https://msdn.microsoft.com/zh-cn/library/dn574799.aspx\n\n[服务总线 AMQP 概述]: /documentation/articles/service-bus-amqp-overview\n\n<!---HONumber=82-->"
}