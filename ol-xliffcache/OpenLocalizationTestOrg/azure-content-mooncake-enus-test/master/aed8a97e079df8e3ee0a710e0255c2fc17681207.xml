{
  "nodes": [
    {
      "content": "创建包含成员资格、OAuth 和 SQL 数据库的安全 ASP.NET Web 窗体应用并部署到 Azure Web 应用",
      "pos": [
        28,
        89
      ]
    },
    {
      "content": "本教程说明如何生成整合了 SQL 数据库的安全 ASP.NET 4.5 Web 窗体 Web 应用并将其部署到 Azure。",
      "pos": [
        109,
        171
      ]
    },
    {
      "content": "创建包含成员资格、OAuth 和 SQL 数据库的安全 ASP.NET Web 窗体应用并部署到 Azure Web 应用",
      "pos": [
        400,
        461
      ]
    },
    {
      "content": "概述",
      "pos": [
        465,
        467
      ]
    },
    {
      "content": "本教程说明如何生成整合了 SQL 数据库的安全 ASP.NET 4.5 Web 窗体 Web 应用并将其部署到 Azure。",
      "pos": [
        468,
        530
      ]
    },
    {
      "pos": [
        533,
        711
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>有关本教程中的 MVC 版本，请参阅<bpt id=\"p1\">[</bpt>创建包含身份验证和 SQLDB 的 ASP.NET MVC 应用并将其部署到 Azure Web 应用<ept id=\"p1\">](/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database)</ept>。"
    },
    {
      "content": "你可以免费注册一个 Azure 帐户，而且，如果你还没有 Visual Studio 2013，则此 SDK 会自动安装 Visual Studio 2013 for Web Express。你可以免费开始针对 Azure 进行开发。",
      "pos": [
        713,
        830
      ]
    },
    {
      "content": "本教程假定你之前未使用过 Azure。完成本教程之后，你将能够在云中启动并运行使用云数据库的 Web 应用。",
      "pos": [
        832,
        886
      ]
    },
    {
      "content": "学习内容：",
      "pos": [
        888,
        893
      ]
    },
    {
      "content": "如何创建 ASP.NET 4.5 Web 窗体项目并将其发布到 Azure Web 应用。",
      "pos": [
        897,
        942
      ]
    },
    {
      "content": "如何使用 OAuth 和 ASP.NET 成员资格保护你的应用程序。",
      "pos": [
        945,
        979
      ]
    },
    {
      "content": "如何为成员资格和应用程序数据使用单个数据库。",
      "pos": [
        982,
        1004
      ]
    },
    {
      "content": "如何使用 Web 窗体基架创建网页以便修改数据。",
      "pos": [
        1007,
        1031
      ]
    },
    {
      "content": "如何使用新成员资格 API 添加用户和角色。",
      "pos": [
        1034,
        1056
      ]
    },
    {
      "content": "如何使用 SQL 数据库在 Azure 中存储数据。",
      "pos": [
        1059,
        1085
      ]
    },
    {
      "content": "你将生成一个简单的联系人列表 Web 应用，该应用程序基于 ASP.NET 4.5 Web 窗体构建并使用实体框架进行数据库访问。下图显示了用于对数据库进行读取和写入访问的 Web 窗体页：",
      "pos": [
        1087,
        1182
      ]
    },
    {
      "content": "联系人 - 编辑页",
      "pos": [
        1186,
        1195
      ]
    },
    {
      "pos": [
        1303,
        1408
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>若要完成本教程，您需要一个 Azure 帐户。如果您没有帐户，则可以<ph id=\"ph2\">&lt;a href=\"/pricing/1rmb-trial/\" target=\"_blank\"&gt;</ph>注册获取试用版<ph id=\"ph3\">&lt;/a&gt;</ph>。"
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"set-up-the-development-environment\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>设置开发环境",
      "pos": [
        1412,
        1467
      ]
    },
    {
      "content": "若要开始，请通过安装 Visual Studio 2013 和 Azure SDK for .NET 来设置开发环境。",
      "pos": [
        1469,
        1528
      ]
    },
    {
      "pos": [
        1533,
        1611
      ],
      "content": "安装 <bpt id=\"p1\">[</bpt>Visual Studio 2013<ept id=\"p1\">](https://www.visualstudio.com/zh-cn/downloads)</ept>（如果尚未安装）。"
    },
    {
      "pos": [
        1617,
        1833
      ],
      "content": "安装 <bpt id=\"p1\">[</bpt>Azure SDK for Visual Studio 2013<ept id=\"p1\">](http://go.microsoft.com/fwlink/?linkid=324322&amp;clcid=0x409)</ept>。本教程需要先安装 Visual Studio 2013，然后再安装 Azure SDK for Visual Studio 2013。根据计算机上已有 SDK 依赖项数量的不同，安装 SDK 可能耗时较长，从几分钟到半小时或更长时间不等。"
    },
    {
      "content": "如果系统提示你是要运行还是保存可执行安装文件，请单击“运行”。",
      "pos": [
        1840,
        1871
      ]
    },
    {
      "content": "在“Web 平台安装程序”窗口中，单击“安装”，然后进行安装。",
      "pos": [
        1875,
        1906
      ]
    },
    {
      "content": "Web 平台安装程序",
      "pos": [
        1908,
        1918
      ]
    },
    {
      "content": "如果你已安装 SDK，则会安装 0 个项。要安装的项数将显示在“Web 平台安装程序”窗口的左下角。",
      "pos": [
        2040,
        2090
      ]
    },
    {
      "pos": [
        2095,
        2247
      ],
      "content": "如果您还没有 <bpt id=\"p1\">**</bpt>Visual Studio Update 2<ept id=\"p1\">**</ept>，请下载并安装 <bpt id=\"p2\">**</bpt><ph id=\"ph1\">&lt;!--[--&gt;</ph>Visual Studio 2013 Update 2<ph id=\"ph2\">&lt;!--](http://www.microsoft.com/download/details.aspx?id=42666)--&gt;</ph><ept id=\"p2\">**</ept> 或更高版本。"
    },
    {
      "pos": [
        2254,
        2380
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>只有安装了 Visual Studio 2013 Update 2 或更高版本才能使用 Goggle OAuth 2.0 以及在本地使用 SSL，而不会显示任何警告。此外，你需要通过 Update 2 来使用 Web 窗体基架。"
    },
    {
      "content": "安装完成后，你便做好了开发准备工作。",
      "pos": [
        2382,
        2400
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Set-up-the-Azure-environment\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>设置 Azure 环境",
      "pos": [
        2404,
        2458
      ]
    },
    {
      "content": "在本部分中，你将通过在 Azure 中创建 Azure 和 SQL 数据库来设置 Azure 环境。",
      "pos": [
        2459,
        2509
      ]
    },
    {
      "content": "在 Azure 中创建 Web 应用和 SQL 数据库",
      "pos": [
        2514,
        2541
      ]
    },
    {
      "content": "在本教程中，你的 Web 应用将在共享宿主环境中运行，这意味着它将在与 Azure 中与其他 Web 应用共享的虚拟机 (VM) 上运行。共享宿主环境是一种在云中开始工作的低成本方式。稍后，如果你的 Web 流量增加，则应用程序可进行扩展，通过在专用 VM 上运行来满足需要。如果你需要一个更复杂的体系结构，则可迁移到 Azure 云服务。云服务在你可根据自己的需求进行配置的专用 VM 上运行。",
      "pos": [
        2543,
        2741
      ]
    },
    {
      "content": "Azure SQL 数据库是根据 SQL Server 技术构建的基于云的关系数据库服务。可以与 SQL Server 一起使用的工具和应用程序也可用于 SQL 数据库。",
      "pos": [
        2743,
        2828
      ]
    },
    {
      "pos": [
        2833,
        3035
      ],
      "content": "在 <bpt id=\"p1\">[</bpt> Azure 管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>中，单击左侧选项卡中的“Web Apps”，然后单击“新建”。<ph id=\"ph1\">![</ph>Web 平台安装程序<ph id=\"ph2\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-02.png)</ph>"
    },
    {
      "content": "单击“Web App”，然后单击“自定义创建”。",
      "pos": [
        3039,
        3063
      ]
    },
    {
      "content": "自定义创建",
      "pos": [
        3065,
        3070
      ]
    },
    {
      "content": "“新建 Web App - 自定义创建”向导将打开。",
      "pos": [
        3183,
        3209
      ]
    },
    {
      "pos": [
        3216,
        3479
      ],
      "content": "在该向导的“创建 Web App”步骤中，在“URL”框中输入将用作你的应用程序的唯一 URL 的字符串。完整的 URL 将包含你在此处输入的内容和你在文本框旁边看到的后缀。图中显示了一个 URL，但可能已有人使用了该 URL，因此<bpt id=\"p1\">**</bpt>必须另外选择一个 URL<ept id=\"p1\">**</ept>。<ph id=\"ph1\">![</ph>联系人 - 创建新 Web 应用<ph id=\"ph2\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-04.png)</ph>"
    },
    {
      "content": "在“Web 托管计划”下拉列表中，选择离你最近的区域。此设置指定你的 VM 将在哪个数据中心运行。",
      "pos": [
        3483,
        3532
      ]
    },
    {
      "content": "在“数据库”下拉列表中，选择“创建免费的 20 MB SQL 数据库”。",
      "pos": [
        3536,
        3572
      ]
    },
    {
      "pos": [
        3576,
        3618
      ],
      "content": "在“数据库连接字符串名称”框中，保留默认值 <bpt id=\"p1\">*</bpt>DefaultConnection<ept id=\"p1\">*</ept>。"
    },
    {
      "content": "单击框底部的箭头。该向导将前进到“指定数据库设置”步骤。",
      "pos": [
        3622,
        3650
      ]
    },
    {
      "pos": [
        3654,
        3798
      ],
      "content": "在“名称”框中，输入 <bpt id=\"p1\">*</bpt><ph id=\"ph1\">`ContactDB`</ph><ept id=\"p1\">*</ept>。<ph id=\"ph2\">![</ph>数据库设置<ph id=\"ph3\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-05.png)</ph>"
    },
    {
      "content": "在“服务器”框中，选择“新建 SQL 数据库”服务器。或者，如果你之前创建了 SQL Server 数据库，则可从下拉列表控件中选择 SQL Server。",
      "pos": [
        3804,
        3882
      ]
    },
    {
      "content": "将“区域”设置为创建 Web 应用的同一区域。",
      "pos": [
        3887,
        3910
      ]
    },
    {
      "content": "输入管理员“登录名”和“密码”。如果你选择了“新建 SQL 数据库服务器”，则在此处不要输入现有名称和密码。你应输入新的名称和密码，你现在定义的名称和密码将在你以后访问数据库时使用。如果你选择了之前创建的 SQL Server，系统将提示你输入之前创建的 SQL Server 帐户名称的密码。本教程将不选中“高级”框。",
      "pos": [
        3915,
        4075
      ]
    },
    {
      "content": "单击对话框右下角的复选标记以指示你已完成操作。",
      "pos": [
        4080,
        4103
      ]
    },
    {
      "content": "“Azure 管理门户”返回到“Web Apps”页面，并且“状态”列显示正在创建 Web 应用。稍后（通常不到一分钟），“状态”列会显示已成功创建 Web 应用。在左侧的导航栏中，你的帐户中拥有的 Web 应用的数量将会显示在“Web 应用”图标旁边，而数据库的数量将会显示在“SQL 数据库”图标旁边。",
      "pos": [
        4105,
        4258
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Create-an-ASP.NET-Web-Forms-Application\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>创建 ASP.NET Web 窗体应用程序",
      "pos": [
        4261,
        4336
      ]
    },
    {
      "content": "你已经创建了一个 Web 应用，但其中还没有内容。下一步将创建要发布到 Azure 的 Visual Studio Web 应用程序。",
      "pos": [
        4338,
        4405
      ]
    },
    {
      "content": "创建项目",
      "pos": [
        4409,
        4413
      ]
    },
    {
      "content": "在 Visual Studio 中，从“文件”菜单选择“新建项目”。",
      "pos": [
        4418,
        4452
      ]
    },
    {
      "content": "文件菜单 - 新建项目",
      "pos": [
        4454,
        4465
      ]
    },
    {
      "content": "在左侧依次选择“模板”、“Visual C#”、“Web”模板组。",
      "pos": [
        4576,
        4609
      ]
    },
    {
      "content": "在中心列中选择“ASP.NET Web 应用程序”模板。",
      "pos": [
        4614,
        4642
      ]
    },
    {
      "pos": [
        4646,
        4794
      ],
      "content": "将你的项目命名为 <bpt id=\"p1\">*</bpt>ContactManager<ept id=\"p1\">*</ept> 并单击“确定”。<ph id=\"ph1\">![</ph>新建项目对话框<ph id=\"ph2\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms02.png)</ph>"
    },
    {
      "pos": [
        4804,
        4873
      ],
      "content": "在本系列教程中，项目名称为 <bpt id=\"p1\">**</bpt>ContactManager<ept id=\"p1\">**</ept>。建议使用与此完全相同的项目名称，以便整个系列教程中提供的代码按预期运行。"
    },
    {
      "content": "在“新建 ASP.NET 项目”对话框中，选择“Web 窗体”模板。取消选中“在云中托管”（如果已选中），然后单击“确定”。",
      "pos": [
        4878,
        4940
      ]
    },
    {
      "content": "“新建 ASP.NET 项目”对话框",
      "pos": [
        4942,
        4960
      ]
    },
    {
      "content": "随后将创建 Web 窗体应用程序。",
      "pos": [
        5066,
        5083
      ]
    },
    {
      "content": "更新母版页",
      "pos": [
        5087,
        5092
      ]
    },
    {
      "content": "在 ASP.NET Web 窗体中，母版页允许你在应用程序中创建一致的页面布局。可以使用单个母版页定义应用程序中所有页（或一组页）的外观和标准行为。然后，你可以创建包含想要显示的内容的各个内容页。当用户请求内容页时，ASP.NET 会将内容页与母版页合并，以生成将母版面布局与内容页中的内容相结合的输出。新站点需要更新应用程序名称和链接。该链接将指向显示联系人详细信息的页。若要进行这些更改，请修改母版页上的 HTML。",
      "pos": [
        5093,
        5303
      ]
    },
    {
      "content": "在“解决方案资源管理器”中，找到并打开“Site.Master”页。",
      "pos": [
        5308,
        5342
      ]
    },
    {
      "content": "如果该页在“设计”视图中，请切换到“源”视图。",
      "pos": [
        5346,
        5369
      ]
    },
    {
      "content": "通过修改或添加标记以更新母版页，从而页面的标记显示如下：",
      "pos": [
        5373,
        5401
      ]
    },
    {
      "content": "&amp;lt;%@ Master Language=\"C#\" AutoEventWireup=\"true\" CodeBehind=\"Site.master.cs\" Inherits=\"ContactManager.SiteMaster\" %&gt;",
      "pos": [
        5429,
        5547
      ]
    },
    {
      "content": "&amp;lt;!DOCTYPE html&gt;",
      "pos": [
        5549,
        5567
      ]
    },
    {
      "content": "&amp;lt;html lang=\"en\"&gt;",
      "pos": [
        5569,
        5588
      ]
    },
    {
      "content": "&amp;lt;head runat=\"server\"&gt;",
      "pos": [
        5589,
        5613
      ]
    },
    {
      "content": "&amp;lt;meta charset=\"utf-8\" /&gt;",
      "pos": [
        5618,
        5645
      ]
    },
    {
      "content": "&amp;lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt;",
      "pos": [
        5650,
        5725
      ]
    },
    {
      "content": "&amp;lt;title&gt;&amp;lt;%: Page.Title %&gt; -",
      "pos": [
        5730,
        5762
      ]
    },
    {
      "content": "Contact Manager",
      "pos": [
        5769,
        5784
      ]
    },
    {
      "content": "&amp;lt;/title&gt;",
      "pos": [
        5791,
        5802
      ]
    },
    {
      "content": "&amp;lt;/head&gt;",
      "pos": [
        6074,
        6084
      ]
    },
    {
      "content": "&amp;lt;body&gt;",
      "pos": [
        6085,
        6094
      ]
    },
    {
      "content": "&amp;lt;form runat=\"server\"&gt;",
      "pos": [
        6099,
        6123
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptManager runat=\"server\"&gt;",
      "pos": [
        6132,
        6169
      ]
    },
    {
      "content": "&amp;lt;Scripts&gt;",
      "pos": [
        6182,
        6194
      ]
    },
    {
      "content": "&amp;lt;%--To learn more about bundling scripts in ScriptManager see http://go.microsoft.com/fwlink/?LinkID=301884 --%&gt;",
      "pos": [
        6211,
        6326
      ]
    },
    {
      "content": "&amp;lt;%--Framework Scripts--%&gt;",
      "pos": [
        6343,
        6371
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"MsAjaxBundle\" /&gt;",
      "pos": [
        6388,
        6434
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"jquery\" /&gt;",
      "pos": [
        6451,
        6491
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"bootstrap\" /&gt;",
      "pos": [
        6508,
        6551
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"respond\" /&gt;",
      "pos": [
        6568,
        6609
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"WebForms.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/WebForms.js\" /&gt;",
      "pos": [
        6626,
        6731
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"WebUIValidation.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/WebUIValidation.js\" /&gt;",
      "pos": [
        6748,
        6867
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"MenuStandards.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/MenuStandards.js\" /&gt;",
      "pos": [
        6884,
        6999
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"GridView.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/GridView.js\" /&gt;",
      "pos": [
        7016,
        7121
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"DetailsView.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/DetailsView.js\" /&gt;",
      "pos": [
        7138,
        7249
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"TreeView.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/TreeView.js\" /&gt;",
      "pos": [
        7266,
        7371
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"WebParts.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/WebParts.js\" /&gt;",
      "pos": [
        7388,
        7493
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"Focus.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/Focus.js\" /&gt;",
      "pos": [
        7510,
        7609
      ]
    },
    {
      "content": "&amp;lt;asp:ScriptReference Name=\"WebFormsBundle\" /&gt;",
      "pos": [
        7626,
        7674
      ]
    },
    {
      "content": "&amp;lt;%--Site Scripts--%&gt;",
      "pos": [
        7691,
        7714
      ]
    },
    {
      "content": "&amp;lt;/Scripts&gt;",
      "pos": [
        7727,
        7740
      ]
    },
    {
      "content": "&amp;lt;/asp:ScriptManager&gt;",
      "pos": [
        7749,
        7772
      ]
    },
    {
      "content": "&amp;lt;/body&gt;",
      "pos": [
        10436,
        10446
      ]
    },
    {
      "content": "&amp;lt;/html&gt;",
      "pos": [
        10447,
        10457
      ]
    },
    {
      "content": "在本教程的后面，你将要添加 Web 窗体基架。基架将创建上述“联系人演示”链接引用的页。",
      "pos": [
        10466,
        10510
      ]
    },
    {
      "content": "在本地运行应用程序",
      "pos": [
        10514,
        10523
      ]
    },
    {
      "content": "在“解决方案资源管理器”中，右键单击“Default.aspx”页并选择“设为起始页”。",
      "pos": [
        10530,
        10574
      ]
    },
    {
      "content": "接下来，按“CTRL+F5”运行应用程序。应用程序的默认页会显示在默认浏览器窗口中。",
      "pos": [
        10579,
        10621
      ]
    },
    {
      "content": "联系人 - 创建新 Web 应用",
      "pos": [
        10623,
        10639
      ]
    },
    {
      "content": "这就是你创建将要部署到 Azure 的应用程序目前所需的全部操作。稍后，你将要添加数据库功能以及所需的页来显示和编辑联系人数据。",
      "pos": [
        10748,
        10812
      ]
    },
    {
      "content": "将应用程序部署到 Azure",
      "pos": [
        10816,
        10830
      ]
    },
    {
      "content": "创建并在本地运行应用程序后，可以将应用程序部署到 Azure。",
      "pos": [
        10831,
        10862
      ]
    },
    {
      "content": "在 Azure 管理门户中，找到你的 Web 应用，在“仪表板”页面的速览，下载“发布配置文件”。",
      "pos": [
        10867,
        10916
      ]
    },
    {
      "content": "在 Visual Studio 中，在“解决方案资源管理器”中右键单击该项目，从上下文菜单中选择“发布”。",
      "pos": [
        10921,
        10974
      ]
    },
    {
      "content": "选择“发布”",
      "pos": [
        10982,
        10988
      ]
    },
    {
      "content": "此时将显示“发布 Web”对话框。",
      "pos": [
        11100,
        11117
      ]
    },
    {
      "content": "在“发布 Web”对话框的“配置文件”选项卡中，单击“导入”。",
      "pos": [
        11124,
        11155
      ]
    },
    {
      "content": "选择刚刚下载的配置文件，点击确认。",
      "pos": [
        11166,
        11183
      ]
    },
    {
      "content": "在“发布 Web”对话框中，单击“发布”。",
      "pos": [
        11188,
        11209
      ]
    },
    {
      "content": "“发布 Web”对话框",
      "pos": [
        11211,
        11222
      ]
    },
    {
      "content": "你将在 Visual Studio 中的“Web 发布活动”窗口中看到总体发布状态：",
      "pos": [
        11328,
        11370
      ]
    },
    {
      "content": "Web 发布活动",
      "pos": [
        11372,
        11380
      ]
    },
    {
      "content": "你创建的应用程序现在在云中运行。下次从 Visual Studio 部署该应用程序时，仅会部署已更改（或新的）文件。",
      "pos": [
        11489,
        11547
      ]
    },
    {
      "content": "浏览器中的应用",
      "pos": [
        11549,
        11556
      ]
    },
    {
      "pos": [
        11664,
        11919
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>如果在发布已建立的 Web 应用时遇到错误，则可以在添加新的文件之前清除该位置。再次发布应用程序，但这次请在“发布 Web”对话框中选择“设置”选项卡。然后，将配置设置为“调试”，并选择“删除目标位置的其他文件”选项。选择“发布”以再次部署应用程序。<ph id=\"ph2\">![</ph>“发布 Web”对话框<ph id=\"ph3\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms11.png)</ph>"
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Add-a-Database-to-the-Application\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>向应用程序添加数据库",
      "pos": [
        11923,
        11981
      ]
    },
    {
      "content": "接下来，你将更新 Web 窗体应用程序以添加显示和更新联系人以及在默认数据库中存储数据的功能。当你创建 Web 窗体项目时，默认情况下也会创建数据库。应用程序将使用 Entity Framework 访问数据库并读取和更新数据库中的数据。",
      "pos": [
        11983,
        12102
      ]
    },
    {
      "content": "添加数据模型类",
      "pos": [
        12106,
        12113
      ]
    },
    {
      "content": "首先，使用代码创建一个简单的数据模型。此数据模型将包含在名为 <ph id=\"ph1\">`Contacts`</ph> 的类中。选择 <ph id=\"ph2\">`Contacts`</ph> 类名的目的是避免与 Web 窗体模板创建的 Contact.aspx.cs 文件中包含的 <ph id=\"ph3\">`Contact`</ph> 类名冲突。",
      "pos": [
        12115,
        12235
      ]
    },
    {
      "content": "在“解决方案资源管理器”中，右键单击“模型”文件夹，然后依次选择“添加”、“类”。",
      "pos": [
        12240,
        12281
      ]
    },
    {
      "content": "选择类",
      "pos": [
        12283,
        12286
      ]
    },
    {
      "content": "此时将显示“添加新项”对话框。",
      "pos": [
        12392,
        12407
      ]
    },
    {
      "pos": [
        12414,
        12552
      ],
      "content": "将此新类命名为 <bpt id=\"p1\">*</bpt>Contacts.cs<ept id=\"p1\">*</ept>。<ph id=\"ph1\">![</ph>“添加新项”对话框<ph id=\"ph2\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13.png)</ph>"
    },
    {
      "pos": [
        12556,
        12674
      ],
      "content": "将默认代码替换为以下代码：  \n <pre class=\"prettyprint\">\nusing System.ComponentModel.DataAnnotations;\nusing System.Globalization;",
      "leadings": [
        "",
        "   ",
        "",
        ""
      ],
      "nodes": [
        {
          "content": "将默认代码替换为以下代码：",
          "pos": [
            0,
            13
          ]
        },
        {
          "content": "using System.ComponentModel.DataAnnotations;",
          "pos": [
            43,
            87
          ]
        },
        {
          "content": "using System.Globalization;",
          "pos": [
            88,
            115
          ]
        }
      ]
    },
    {
      "content": "namespace ContactManager.Models",
      "pos": [
        12676,
        12707
      ]
    },
    {
      "content": "{",
      "pos": [
        12708,
        12709
      ]
    },
    {
      "content": "public class Contacts",
      "pos": [
        12714,
        12735
      ]
    },
    {
      "content": "{",
      "pos": [
        12740,
        12741
      ]
    },
    {
      "content": "[ScaffoldColumn(false)]",
      "pos": [
        12750,
        12773
      ]
    },
    {
      "content": "[Key]",
      "pos": [
        12782,
        12787
      ]
    },
    {
      "content": "public int ContactId { get; set; }",
      "pos": [
        12796,
        12830
      ]
    },
    {
      "content": "public string Name { get; set; }",
      "pos": [
        12839,
        12871
      ]
    },
    {
      "content": "public string Address { get; set; }",
      "pos": [
        12880,
        12915
      ]
    },
    {
      "content": "public string City { get; set; }",
      "pos": [
        12924,
        12956
      ]
    },
    {
      "content": "public string State { get; set; }",
      "pos": [
        12965,
        12998
      ]
    },
    {
      "content": "public string Zip { get; set; }",
      "pos": [
        13007,
        13038
      ]
    },
    {
      "content": "[DataType(DataType.EmailAddress)]",
      "pos": [
        13047,
        13080
      ]
    },
    {
      "content": "public string Email { get; set; }",
      "pos": [
        13089,
        13122
      ]
    },
    {
      "content": "}",
      "pos": [
        13127,
        13128
      ]
    },
    {
      "content": "}",
      "pos": [
        13129,
        13130
      ]
    },
    {
      "pos": [
        13139,
        13300
      ],
      "content": "“Contacts”类定义你将为每个联系人存储的数据以及数据库需要的主键 (<ph id=\"ph1\">`ContactID`</ph>)。“Contacts”类表示要显示的联系人数据。Contacts 对象的每个实例将对应于关系数据库表中的某行，Contacts 类的每个属性将映射到关系数据库表中的某列。在本教程的后面，你将要查看数据库中包含的联系人数据。"
    },
    {
      "content": "Web 窗体基架",
      "pos": [
        13305,
        13313
      ]
    },
    {
      "content": "前面你已创建“Contacts”模型类。现在，你可以使用 Web 窗体基架以生成处理此数据时使用的“列表”、“插入”、“编辑”和“删除”页。Web Forms Scaffolder 使用实体框架、引导和动态数据。默认情况下，在使用 Visual Studio 2013 时，Web Forms Scaffolder 将以扩展形式安装到项目中，作为项目模板的一部分。",
      "pos": [
        13315,
        13497
      ]
    },
    {
      "content": "可以执行以下步骤来使用 Web Forms Scaffolder。",
      "pos": [
        13499,
        13532
      ]
    },
    {
      "content": "在 Visual Studio 中，从菜单栏中依次选择“工具”、“扩展和更新”。此时将显示“扩展和更新”对话框。",
      "pos": [
        13537,
        13593
      ]
    },
    {
      "content": "从对话框的左窗格中，依次选择“联机”、“Visual Studio 库”、“工具”和“基架”。",
      "pos": [
        13597,
        13644
      ]
    },
    {
      "content": "如果没有在列表中看到“Web 窗体基架”，请在对话框右侧的搜索框中输入“Web 窗体基架”。",
      "pos": [
        13648,
        13694
      ]
    },
    {
      "content": "如果尚未安装 Web 窗体基架，请选择“下载”以下载并安装“Web 窗体基架”。根据需要重新启动 Visual Studio。在提示时，请务必保存对项目所做的更改。",
      "pos": [
        13700,
        13782
      ]
    },
    {
      "content": "“扩展和更新”对话框",
      "pos": [
        13784,
        13794
      ]
    },
    {
      "pos": [
        13911,
        13952
      ],
      "content": "生成项目 (<bpt id=\"p1\">**</bpt>Ctrl+Shift+B<ept id=\"p1\">**</ept>).在使用基架机制之前，必须生成项目。"
    },
    {
      "content": "在“解决方案资源管理器”中，右键单击“项目”，然后依次选择“添加”、“新建基架项”。此时将显示“添加基架”对话框。",
      "pos": [
        13958,
        14015
      ]
    },
    {
      "content": "从左窗格中选择“Web 窗体”，并从中央窗格中选择“使用实体框架的 Web 窗体页”。然后单击“添加”。",
      "pos": [
        14019,
        14071
      ]
    },
    {
      "content": "“添加基架”对话框",
      "pos": [
        14073,
        14082
      ]
    },
    {
      "content": "此时将显示“添加 Web 窗体页”对话框。",
      "pos": [
        14189,
        14210
      ]
    },
    {
      "pos": [
        14217,
        14472
      ],
      "content": "在“添加 Web 窗体页”对话框中，将“模型类”设置为 <ph id=\"ph1\">`Contacts (ContactManager.Models)`</ph>。将“数据上下文类”设置为 <ph id=\"ph2\">`ApplicationDbContext (ContactManager.Models)`</ph>。然后单击“添加”。<ph id=\"ph3\">![</ph>“添加 Web 窗体页”对话框<ph id=\"ph4\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13b.png)</ph>"
    },
    {
      "pos": [
        14474,
        14673
      ],
      "content": "Web 窗体基架添加的新文件夹包含<bpt id=\"p1\">*</bpt>Default.aspx<ept id=\"p1\">*</ept>、<bpt id=\"p2\">*</bpt>Delete.aspx<ept id=\"p2\">*</ept>、<bpt id=\"p3\">*</bpt>Edit.aspx<ept id=\"p3\">*</ept> 和 <bpt id=\"p4\">*</bpt>Insert.aspx<ept id=\"p4\">*</ept> 页。此外，Web 窗体基架还会创建 <bpt id=\"p5\">*</bpt>DynamicData<ept id=\"p5\">*</ept> 文件夹，其中包含 <bpt id=\"p6\">*</bpt>EntityTemplates<ept id=\"p6\">*</ept> 文件夹和 <bpt id=\"p7\">*</bpt>FieldTemplates<ept id=\"p7\">*</ept> 文件夹。<ph id=\"ph1\">`ApplicationDbContext`</ph> 将用于成员资格数据库和联系人数据。"
    },
    {
      "content": "将应用程序配置为使用数据模型",
      "pos": [
        14678,
        14692
      ]
    },
    {
      "content": "接下来的任务是启用 Code First 迁移功能以便基于你创建的数据模型创建数据库。此外，你将要添加示例数据和数据初始值设定项。",
      "pos": [
        14694,
        14759
      ]
    },
    {
      "content": "在“工具”菜单中，依次选择“NuGet Package Manager”和“Package Manager Console”。",
      "pos": [
        14764,
        14827
      ]
    },
    {
      "content": "“添加 Web 窗体页”对话框",
      "pos": [
        14829,
        14844
      ]
    },
    {
      "pos": [
        14956,
        15043
      ],
      "content": "在“Package Manager Console”窗口中，输入以下命令：  \n <pre class=\"prettyprint\">\nenable-migrations",
      "leadings": [
        "",
        "   ",
        ""
      ],
      "nodes": [
        {
          "content": "在“Package Manager Console”窗口中，输入以下命令：",
          "pos": [
            0,
            37
          ]
        },
        {
          "content": "enable-migrations",
          "pos": [
            67,
            84
          ]
        }
      ]
    },
    {
      "content": "Enable-migrations 命令将创建一个 <bpt id=\"p1\">*</bpt>Migrations<ept id=\"p1\">*</ept> 文件夹，并在该文件夹中放入一个可编辑以对数据库进行种子设定并配置数据迁移的 <bpt id=\"p2\">*</bpt>Configuration.cs<ept id=\"p2\">*</ept> 文件。  \n3.",
      "pos": [
        15050,
        15154
      ]
    },
    {
      "content": "在“Package Manager Console”窗口中，输入以下命令：",
      "pos": [
        15155,
        15192
      ]
    },
    {
      "content": "add-migration Initial",
      "pos": [
        15225,
        15246
      ]
    },
    {
      "content": "<ph id=\"ph1\">`add-migration Initial`</ph> 命令将在创建数据库的 <bpt id=\"p1\">*</bpt>Migrations<ept id=\"p1\">*</ept> 文件夹中生成一个名为",
      "pos": [
        15253,
        15311
      ]
    },
    {
      "content": "Initial 的文件。第一个参数 (Initial) 是任意参数并将用于创建文件名称。你可以在“解决方案资源管理器”中查看新的类文件。在 <ph id=\"ph1\">`Initial`</ph>中，<ph id=\"ph2\">`Up`</ph> 方法用于创建 <ph id=\"ph3\">`Contact`</ph>，而 <ph id=\"ph4\">`Down`</ph> 方法（在你想要返回到以前的状态时使用）用于删除该表。  \n4.",
      "pos": [
        15324,
        15467
      ]
    },
    {
      "content": "打开 <bpt id=\"p1\">*</bpt>Migrations\\\\Configuration.cs<ept id=\"p1\">*</ept> 文件。 \n5.",
      "pos": [
        15468,
        15509
      ]
    },
    {
      "content": "添加以下命名空间：",
      "pos": [
        15510,
        15519
      ]
    },
    {
      "content": "using ContactManager.Models;",
      "pos": [
        15552,
        15580
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n6.</ph> 将 <ph id=\"ph2\">`Seed`</ph>方法替换为以下代码：",
      "pos": [
        15587,
        15609
      ]
    },
    {
      "content": "protected override void Seed(ContactManager.Models.ApplicationDbContext context)",
      "pos": [
        15642,
        15722
      ]
    },
    {
      "content": "{",
      "pos": [
        15723,
        15724
      ]
    },
    {
      "content": "context.Contacts.AddOrUpdate(p =&gt; p.Name,",
      "pos": [
        15729,
        15770
      ]
    },
    {
      "content": "new Contacts",
      "pos": [
        15778,
        15790
      ]
    },
    {
      "content": "{",
      "pos": [
        15798,
        15799
      ]
    },
    {
      "content": "ContactId = 1,",
      "pos": [
        15811,
        15825
      ]
    },
    {
      "content": "Name = \"Ivan Irons\",",
      "pos": [
        15837,
        15857
      ]
    },
    {
      "content": "Address = \"One Microsoft Way\",",
      "pos": [
        15869,
        15899
      ]
    },
    {
      "content": "City = \"Redmond\",",
      "pos": [
        15911,
        15928
      ]
    },
    {
      "content": "State = \"WA\",",
      "pos": [
        15940,
        15953
      ]
    },
    {
      "content": "Zip = \"10999\",",
      "pos": [
        15965,
        15979
      ]
    },
    {
      "content": "Email = \"ivani@wideworldimporters.com\",",
      "pos": [
        15991,
        16030
      ]
    },
    {
      "content": "},",
      "pos": [
        16038,
        16040
      ]
    },
    {
      "content": "new Contacts",
      "pos": [
        16048,
        16060
      ]
    },
    {
      "content": "{",
      "pos": [
        16069,
        16070
      ]
    },
    {
      "content": "ContactId = 2,",
      "pos": [
        16083,
        16097
      ]
    },
    {
      "content": "Name = \"Brent Scholl\",",
      "pos": [
        16110,
        16132
      ]
    },
    {
      "content": "Address = \"5678 1st Ave W\",",
      "pos": [
        16145,
        16172
      ]
    },
    {
      "content": "City = \"Redmond\",",
      "pos": [
        16185,
        16202
      ]
    },
    {
      "content": "State = \"WA\",",
      "pos": [
        16215,
        16228
      ]
    },
    {
      "content": "Zip = \"10999\",",
      "pos": [
        16241,
        16255
      ]
    },
    {
      "content": "Email = \"brents@wideworldimporters.com\",",
      "pos": [
        16268,
        16308
      ]
    },
    {
      "content": "},",
      "pos": [
        16317,
        16319
      ]
    },
    {
      "content": "new Contacts",
      "pos": [
        16328,
        16340
      ]
    },
    {
      "content": "{",
      "pos": [
        16349,
        16350
      ]
    },
    {
      "content": "ContactId = 3,",
      "pos": [
        16363,
        16377
      ]
    },
    {
      "content": "Name = \"Terrell Bettis\",",
      "pos": [
        16390,
        16414
      ]
    },
    {
      "content": "Address = \"9012 State St\",",
      "pos": [
        16427,
        16453
      ]
    },
    {
      "content": "City = \"Redmond\",",
      "pos": [
        16466,
        16483
      ]
    },
    {
      "content": "State = \"WA\",",
      "pos": [
        16496,
        16509
      ]
    },
    {
      "content": "Zip = \"10999\",",
      "pos": [
        16522,
        16536
      ]
    },
    {
      "content": "Email = \"terrellb@wideworldimporters.com\",",
      "pos": [
        16549,
        16591
      ]
    },
    {
      "content": "},",
      "pos": [
        16600,
        16602
      ]
    },
    {
      "content": "new Contacts",
      "pos": [
        16611,
        16623
      ]
    },
    {
      "content": "{",
      "pos": [
        16632,
        16633
      ]
    },
    {
      "content": "ContactId = 4,",
      "pos": [
        16646,
        16660
      ]
    },
    {
      "content": "Name = \"Jo Cooper\",",
      "pos": [
        16673,
        16692
      ]
    },
    {
      "content": "Address = \"3456 Maple St\",",
      "pos": [
        16705,
        16731
      ]
    },
    {
      "content": "City = \"Redmond\",",
      "pos": [
        16744,
        16761
      ]
    },
    {
      "content": "State = \"WA\",",
      "pos": [
        16774,
        16787
      ]
    },
    {
      "content": "Zip = \"10999\",",
      "pos": [
        16800,
        16814
      ]
    },
    {
      "content": "Email = \"joc@wideworldimporters.com\",",
      "pos": [
        16827,
        16864
      ]
    },
    {
      "content": "},",
      "pos": [
        16873,
        16875
      ]
    },
    {
      "content": "new Contacts",
      "pos": [
        16884,
        16896
      ]
    },
    {
      "content": "{",
      "pos": [
        16905,
        16906
      ]
    },
    {
      "content": "ContactId = 5,",
      "pos": [
        16919,
        16933
      ]
    },
    {
      "content": "Name = \"Ines Burnett\",",
      "pos": [
        16946,
        16968
      ]
    },
    {
      "content": "Address = \"7890 2nd Ave E\",",
      "pos": [
        16981,
        17008
      ]
    },
    {
      "content": "City = \"Redmond\",",
      "pos": [
        17021,
        17038
      ]
    },
    {
      "content": "State = \"WA\",",
      "pos": [
        17051,
        17064
      ]
    },
    {
      "content": "Zip = \"10999\",",
      "pos": [
        17077,
        17091
      ]
    },
    {
      "content": "Email = \"inesb@wideworldimporters.com\",",
      "pos": [
        17104,
        17143
      ]
    },
    {
      "content": "}",
      "pos": [
        17152,
        17153
      ]
    },
    {
      "content": ");",
      "pos": [
        17162,
        17164
      ]
    },
    {
      "content": "}",
      "pos": [
        17165,
        17166
      ]
    },
    {
      "content": "此代码将用联系信息初始化数据库或对其进行种子设定。有关对数据库进行种子设定的更多信息，请参阅<bpt id=\"p1\">[</bpt><ept id=\"p1\">对 Entity Framework (EF) 数据库进行种子设定和调试](http://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx)</ept>。  \n7.",
      "pos": [
        17174,
        17368
      ]
    },
    {
      "content": "在“Package Manager Console”中输入以下命令：",
      "pos": [
        17369,
        17403
      ]
    },
    {
      "content": "update-database",
      "pos": [
        17436,
        17451
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n`update-database`</ph>用于运行将创建数据库的初始迁移。默认情况下，将以 SQL Server Express LocalDB 数据库的形式创建数据库。<ph id=\"ph2\">![Package Manager Console](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13d.png)</ph>",
      "pos": [
        17458,
        17671
      ]
    },
    {
      "content": "在本地运行应用程序并显示数据",
      "pos": [
        17676,
        17690
      ]
    },
    {
      "content": "现在，请运行应用程序，以了解如何查看联系人。",
      "pos": [
        17692,
        17714
      ]
    },
    {
      "content": "首先，请生成项目（“Ctrl+Shift+B”）。",
      "pos": [
        17719,
        17744
      ]
    },
    {
      "pos": [
        17750,
        17794
      ],
      "content": "按“Ctrl+F5”运行应用程序。浏览器将打开并显示 <bpt id=\"p1\">*</bpt>Default.aspx<ept id=\"p1\">*</ept> 页。"
    },
    {
      "content": "选择页面顶部的“联系人演示”链接以显示“联系人列表”页。",
      "pos": [
        17798,
        17826
      ]
    },
    {
      "content": "联系人列表页",
      "pos": [
        17828,
        17834
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Enable-SSL-for-the-Project\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>为项目启用 SSL",
      "pos": [
        17945,
        17995
      ]
    },
    {
      "content": "安全套接字层 (SSL) 是一种协议，定义为允许 Web 服务器与 Web 客户端通过使用加密以更安全的方式通信。如果不使用 SSL，在客户端与服务器之间发送数据时，对网络具有实际访问权限的任何人都可以探查数据包。此外，通过一般 HTTP 进行的几种常见身份验证方案也是不安全的。尤其是，基本身份验证和窗体身份验证会发送未加密的凭据。为确保安全，这些身份验证方案必须使用 SSL。",
      "pos": [
        17997,
        18187
      ]
    },
    {
      "pos": [
        18192,
        18245
      ],
      "content": "在“解决方案资源管理器”中，单击“ContactManager”项目，然后按<bpt id=\"p1\">**</bpt>F4<ept id=\"p1\">**</ept>显示“属性”窗口。"
    },
    {
      "pos": [
        18250,
        18271
      ],
      "content": "将“已启用 SSL”更改为 <ph id=\"ph1\">`true`</ph>。"
    },
    {
      "pos": [
        18276,
        18473
      ],
      "content": "复制 <bpt id=\"p1\">**</bpt>SSL URL<ept id=\"p1\">**</ept> 以便稍后使用。SSL URL 将为 <ph id=\"ph1\">`https://localhost:44300/`</ph>，除非你之前已创建 SSL Web 应用（如下所示）。<ph id=\"ph2\">![</ph>项目属性<ph id=\"ph3\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms18.png)</ph>"
    },
    {
      "content": "在“解决方案资源管理器”中，右键单击“Contact Manager”项目，然后单击“属性”。",
      "pos": [
        18479,
        18526
      ]
    },
    {
      "content": "在左侧选项卡中，单击“Web”。",
      "pos": [
        18530,
        18546
      ]
    },
    {
      "content": "将“项目 URL”更改为使用前面保存的“SSL URL”。",
      "pos": [
        18550,
        18579
      ]
    },
    {
      "content": "项目 Web 属性",
      "pos": [
        18581,
        18590
      ]
    },
    {
      "content": "按“CTRL+S”保存该页。",
      "pos": [
        18701,
        18715
      ]
    },
    {
      "content": "按“Ctrl+F5”运行应用程序。Visual Studio 将显示一个选项用于避免 SSL 警告。",
      "pos": [
        18719,
        18769
      ]
    },
    {
      "content": "单击“是”以信任 IIS Express SSL 证书并继续。",
      "pos": [
        18775,
        18806
      ]
    },
    {
      "content": "IIS Express SSL 证书详细信息",
      "pos": [
        18808,
        18830
      ]
    },
    {
      "content": "此时将显示一条安全警告。",
      "pos": [
        18935,
        18947
      ]
    },
    {
      "content": "单击“是”将证书安装到本地主机。",
      "pos": [
        18955,
        18971
      ]
    },
    {
      "content": "“安全警告”对话框",
      "pos": [
        18973,
        18982
      ]
    },
    {
      "content": "此时将显示浏览器窗口。",
      "pos": [
        19088,
        19099
      ]
    },
    {
      "content": "你可以在本地使用 SSL 轻松测试 Web 应用。",
      "pos": [
        19101,
        19126
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Add-an-OAuth-2.0-Provider\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>添加 OAuth 2.0 提供程序",
      "pos": [
        19132,
        19189
      ]
    },
    {
      "content": "ASP.NET Web 窗体为成员资格和身份验证提供了增强的选项。这些增强功能包括 OAuth。OAuth 是一种开放协议，允许以一种简单而标准的方法从 Web、移动和桌面应用程序进行安全授权。ASP.NET MVC Internet 模板使用 OAuth 公开将 Facebook、Twitter、Google 和 Microsoft 作为身份验证提供程序。虽然本教程仅使用 Google 作为身份验证提供程序，但你可轻松修改代码以使用任何提供程序。实施其他提供程序的步骤与你将在本教程中看到的步骤非常类似。",
      "pos": [
        19191,
        19446
      ]
    },
    {
      "pos": [
        19448,
        19513
      ],
      "content": "除了身份验证外，本教程还将使用角色实施授权。只有你添加到 <ph id=\"ph1\">`canEdit`</ph> 角色中的用户将能更改数据（创建、编辑或删除联系人）。"
    },
    {
      "content": "可以执行以下步骤来添加 Google 身份验证提供程序。",
      "pos": [
        19515,
        19543
      ]
    },
    {
      "pos": [
        19548,
        19583
      ],
      "content": "打开 <bpt id=\"p1\">*</bpt>App_Start\\\\Startup.Auth.cs<ept id=\"p1\">*</ept> 文件。"
    },
    {
      "pos": [
        19588,
        19848
      ],
      "content": "从 `app.UseGoogleAuthentication()` 方法中删除注释字符，使该方法如下所示：  \n <pre class=\"prettyprint\">\n         app.UseGoogleAuthentication(new GoogleOAuth2AuthenticationOptions()\n         {\n             ClientId = \"\",\n             ClientSecret = \"\"\n         });",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "从 <ph id=\"ph1\">`app.UseGoogleAuthentication()`</ph> 方法中删除注释字符，使该方法如下所示：",
          "pos": [
            0,
            53
          ]
        },
        {
          "content": "app.UseGoogleAuthentication(new GoogleOAuth2AuthenticationOptions()",
          "pos": [
            92,
            159
          ]
        },
        {
          "content": "{",
          "pos": [
            169,
            170
          ]
        },
        {
          "content": "ClientId = \"\",",
          "pos": [
            184,
            198
          ]
        },
        {
          "content": "ClientSecret = \"\"",
          "pos": [
            212,
            229
          ]
        },
        {
          "content": "});",
          "pos": [
            239,
            242
          ]
        }
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n3.</ph> 导航到 <bpt id=\"p1\">[</bpt><ept id=\"p1\">Google Developers Console](https://console.developers.google.com/)</ept>。你还需要使用 Google 开发人员电子邮件帐户 (gmail.com） 登录。如果你没有 Google 帐户，请选择“创建帐户”链接。接下来，你将看到<bpt id=\"p2\">**</bpt>Google Developers Console<ept id=\"p2\">**</ept>。<ph id=\"ph2\">![Google Developers Console](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21a.png)</ph>",
      "pos": [
        19855,
        20170
      ]
    },
    {
      "content": "单击“创建项目”按钮，然后输入项目名称和 ID（可以使用默认值）。然后，单击“协议复选框”和“创建”按钮。",
      "pos": [
        20177,
        20230
      ]
    },
    {
      "content": "Google - 新建项目",
      "pos": [
        20232,
        20245
      ]
    },
    {
      "content": "几秒钟后，将会创建新项目，并且浏览器将显示新项目页。",
      "pos": [
        20352,
        20378
      ]
    },
    {
      "content": "在左侧选项卡中，单击“API 和身份验证”，然后单击“凭据”。",
      "pos": [
        20382,
        20413
      ]
    },
    {
      "content": "单击“OAuth”下的“创建新客户端 ID”。此时将显示“创建客户端 ID”对话框。",
      "pos": [
        20417,
        20459
      ]
    },
    {
      "content": "Google - 创建客户端 ID",
      "pos": [
        20461,
        20478
      ]
    },
    {
      "content": "在“创建客户端 ID”对话框中，保留默认“ Web 应用”作为应用程序类型。",
      "pos": [
        20590,
        20628
      ]
    },
    {
      "content": "将“授权的 JavaScript 来源”设置为你之前在本教程中使用的 SSL URL（****https://localhost:44300/**除非你已创建其他 SSL 项目）。此 URL 是应用程序的来源。对于此示例，你只需输入 localhost 测试 URL。但是，你可以针对 localhost 和生产环境输入多个 URL。",
      "pos": [
        20634,
        20801
      ]
    },
    {
      "pos": [
        20806,
        20893
      ],
      "content": "将“授权的重定向 URI”设置为：\n <pre class=\"prettyprint\">  \nhttps://localhost:44300/signin-google",
      "leadings": [
        "",
        "   ",
        ""
      ],
      "nodes": [
        {
          "content": "将“授权的重定向 URI”设置为：",
          "pos": [
            0,
            17
          ]
        },
        {
          "content": "https://localhost:44300/signin-google",
          "pos": [
            47,
            84
          ]
        }
      ]
    },
    {
      "content": "此值是 ASP.NET OAuth 用户与 Google OAuth 服务器通信时使用的 URI。请记住上面使用的 SSL URL（****https://localhost:44300/**除非你已创建其他 SSL 项目）。\n10.",
      "pos": [
        20902,
        21019
      ]
    },
    {
      "content": "单击“创建客户端 ID”按钮。\n11.",
      "pos": [
        21020,
        21039
      ]
    },
    {
      "content": "在 Visual Studio 中，通过复制 <bpt id=\"p1\">**</bpt>AppId<ept id=\"p1\">**</ept> 和“应用密码”并粘贴到方法中，来更新 <bpt id=\"p2\">*</bpt>Startup.Auth.cs<ept id=\"p2\">*</ept> 页的 <ph id=\"ph1\">`UseGoogleAuthentication`</ph> 方法。下面显示的 <bpt id=\"p3\">**</bpt>AppId<ept id=\"p3\">**</ept> 和“应用密码”值是示例，它们不可用。",
      "pos": [
        21040,
        21176
      ]
    },
    {
      "content": "using System;",
      "pos": [
        21211,
        21224
      ]
    },
    {
      "content": "using Microsoft.AspNet.Identity;",
      "pos": [
        21225,
        21257
      ]
    },
    {
      "content": "using Microsoft.AspNet.Identity.EntityFramework;",
      "pos": [
        21258,
        21306
      ]
    },
    {
      "content": "using Microsoft.AspNet.Identity.Owin;",
      "pos": [
        21307,
        21344
      ]
    },
    {
      "content": "using Microsoft.Owin;",
      "pos": [
        21345,
        21366
      ]
    },
    {
      "content": "using Microsoft.Owin.Security.Cookies;",
      "pos": [
        21367,
        21405
      ]
    },
    {
      "content": "using Microsoft.Owin.Security.DataProtection;",
      "pos": [
        21406,
        21451
      ]
    },
    {
      "content": "using Microsoft.Owin.Security.Google;",
      "pos": [
        21452,
        21489
      ]
    },
    {
      "content": "using Owin;",
      "pos": [
        21490,
        21501
      ]
    },
    {
      "content": "using ContactManager.Models;",
      "pos": [
        21502,
        21530
      ]
    },
    {
      "content": "namespace ContactManager",
      "pos": [
        21532,
        21556
      ]
    },
    {
      "content": "{",
      "pos": [
        21557,
        21558
      ]
    },
    {
      "content": "public partial class Startup {",
      "pos": [
        21563,
        21593
      ]
    },
    {
      "content": "}",
      "pos": [
        23797,
        23798
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n12.</ph> 按“Ctrl + F5”构建并运行应用程序。单击“登录”链接。\n13.",
      "pos": [
        23805,
        23845
      ]
    },
    {
      "content": "在“使用其他服务进行登录”下，单击“Google”。<ph id=\"ph1\">![Log in](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21d.png)</ph><ph id=\"ph2\">  \n14.</ph> 如果需要输入你的凭据，你将被重定向到 google 站点，你可以在这里输入你的凭据。<ph id=\"ph3\">![Google - 登录](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21e.png)</ph><ph id=\"ph4\">  \n15.</ph> 输入你的凭据后，系统将提示你刚创建的 Web 应用，以便授予其权限：<ph id=\"ph5\">![项目默认服务帐户](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21f.png)</ph><ph id=\"ph6\">  \n16.</ph> 单击“接受”。现在，你将被重定向回到“ContactManager”应用程序的“注册”页，你可以在该页中注册 Google 帐户。<ph id=\"ph7\">![使用你的 Google 帐户注册](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21g.png)</ph><ph id=\"ph8\">  \n17.</ph> 你可以选择更改 Gmail 帐户使用的本地电子邮件注册名称，但是，你通常会保留默认电子邮件别名（即，用于身份验证的名称）。单击“登录”。",
      "pos": [
        23846,
        24582
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Use-the-Membership-API-to-Restrict-Access\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>使用成员资格 API 来限制访问",
      "pos": [
        24586,
        24658
      ]
    },
    {
      "content": "ASP.NET 标识是在生成 ASP.NET Web 应用时用于身份验证的成员资格系统。它可以轻松地将特定于用户的配置文件数据与应用程序数据相集成。此外，ASP.NET 标识允许你为应用程序中的用户配置文件选择持久模型。你可以将数据存储在 SQL Server 数据库或其他数据存储中，包括 Azure 存储表等 <bpt id=\"p1\">*</bpt>NoSQL<ept id=\"p1\">*</ept> 数据存储。",
      "pos": [
        24660,
        24830
      ]
    },
    {
      "content": "通过使用默认的 ASP.NET Web 窗体模板，你可以获得在运行应用程序时立即可用的内置成员资格功能。你将使用 ASP.NET 标识添加管理员角色并将用户分配给该角色。然后，你将学习如何限制对管理文件夹和该文件夹中用于修改联系人数据的页面的访问。",
      "pos": [
        24832,
        24956
      ]
    },
    {
      "content": "添加管理员",
      "pos": [
        24961,
        24966
      ]
    },
    {
      "content": "通过 ASP.NET 标识，你可以使用代码添加管理员角色并将用户分配给该角色。",
      "pos": [
        24968,
        25007
      ]
    },
    {
      "pos": [
        25012,
        25069
      ],
      "content": "在“解决方案资源管理器”，打开 <bpt id=\"p1\">*</bpt>Migrations<ept id=\"p1\">*</ept> 文件夹中的 <bpt id=\"p2\">*</bpt>Configuration.cs<ept id=\"p2\">*</ept> 文件。"
    },
    {
      "pos": [
        25073,
        25237
      ],
      "content": "在 `ContactManger.Migrations` 命名空间中添加以下 `using` 语句：  \n <pre class=\"prettyprint\">\nusing Microsoft.AspNet.Identity;\nusing Microsoft.AspNet.Identity.EntityFramework;",
      "leadings": [
        "",
        "   ",
        "",
        ""
      ],
      "nodes": [
        {
          "content": "在 <ph id=\"ph1\">`ContactManger.Migrations`</ph> 命名空间中添加以下 <ph id=\"ph2\">`using`</ph> 语句：",
          "pos": [
            0,
            50
          ]
        },
        {
          "content": "using Microsoft.AspNet.Identity;",
          "pos": [
            80,
            112
          ]
        },
        {
          "content": "using Microsoft.AspNet.Identity.EntityFramework;",
          "pos": [
            113,
            161
          ]
        }
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n3.</ph> 将以下 <ph id=\"ph2\">`AddUserAndRole`</ph> 方法添加到 <ph id=\"ph3\">`Seed`</ph> 方法后面的 <ph id=\"ph4\">`Configuration`</ph> 类：",
      "pos": [
        25244,
        25306
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n4.</ph> 从 <ph id=\"ph2\">`Seed`</ph> 方法的开头添加对 <ph id=\"ph3\">`AddUserAndRole`</ph> 方法的调用。请注意，这里只显示了 <ph id=\"ph4\">`Seed`</ph> 方法的开头。",
      "pos": [
        26598,
        26667
      ]
    },
    {
      "content": "AddUserAndRole(context);",
      "pos": [
        26805,
        26829
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n5.</ph> 保存所有更改后，在“Package Manager Console”中运行以下命令：",
      "pos": [
        26843,
        26889
      ]
    },
    {
      "content": "Update-Database",
      "pos": [
        26922,
        26937
      ]
    },
    {
      "content": "此代码会创建名为 <ph id=\"ph1\">`canEdit`</ph> 的新角色，创建电子邮件为 canEditUser@wideworldimporters.com 的新本地用户。然后，该代码会将添加 canEditUser@wideworldimporters.com 到 <ph id=\"ph2\">`canEdit`</ph> 角色。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt><ept id=\"p1\">ASP.NET 标识](http://www.asp.net/identity)</ept>资源页。",
      "pos": [
        26944,
        27135
      ]
    },
    {
      "content": "限制对管理文件夹的访问",
      "pos": [
        27140,
        27151
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>ContactManager<ept id=\"p1\">**</ept> 示例应用程序允许匿名用户和已登录用户查看联系人。但是，在完成本部分后，只有分配给“canEdit”角色的已登录用户才能修改联系人。",
      "pos": [
        27153,
        27237
      ]
    },
    {
      "pos": [
        27239,
        27291
      ],
      "content": "你将要创建一个名为 <bpt id=\"p1\">*</bpt>Admin<ept id=\"p1\">*</ept> 的文件夹，只有分配给“canEdit”角色的用户才可以访问该文件夹。"
    },
    {
      "pos": [
        27296,
        27355
      ],
      "content": "在“解决方案资源管理器”中，将一个子文件夹添加到 <bpt id=\"p1\">*</bpt>Contacts<ept id=\"p1\">*</ept> 文件夹，并命名新的子文件夹为 <bpt id=\"p2\">*</bpt>Admin<ept id=\"p2\">*</ept>。"
    },
    {
      "pos": [
        27359,
        27405
      ],
      "content": "将以下文件从 <bpt id=\"p1\">*</bpt>Contacts<ept id=\"p1\">*</ept> 文件夹移动到 <bpt id=\"p2\">*</bpt>Contacts/Admin<ept id=\"p2\">*</ept> 文件夹："
    },
    {
      "content": "Delete.aspx * 和 * Delete.aspx.cs",
      "pos": [
        27415,
        27447
      ]
    },
    {
      "content": "Edit.aspx * 和 * Edit.aspx.cs",
      "pos": [
        27456,
        27484
      ]
    },
    {
      "content": "Insert.aspx * 和 * Insert.aspx.cs",
      "pos": [
        27493,
        27525
      ]
    },
    {
      "pos": [
        27530,
        27926
      ],
      "content": "通过在链接到 *Insert.aspx*、*Edit.aspx* 和 *Delete.aspx* 的页面引用之前添加“Admin/”更新 *Contacts/Default.aspx* 中的链接引用：  \n <pre class=\"prettyprint\">\n&lt;%@ Page Title=\"ContactsList\" Language=\"C#\" MasterPageFile=\"~/Site.Master\" CodeBehind=\"Default.aspx.cs\" Inherits=\"ContactManager.Contacts.Default\" ViewStateMode=\"Disabled\" %>\n&lt;%@ Register TagPrefix=\"FriendlyUrls\" Namespace=\"Microsoft.AspNet.FriendlyUrls\" %>",
      "leadings": [
        "",
        "   ",
        "",
        ""
      ],
      "nodes": [
        {
          "content": "通过在链接到 <bpt id=\"p1\">*</bpt>Insert.aspx<ept id=\"p1\">*</ept>、<bpt id=\"p2\">*</bpt>Edit.aspx<ept id=\"p2\">*</ept> 和 <bpt id=\"p3\">*</bpt>Delete.aspx<ept id=\"p3\">*</ept> 的页面引用之前添加“Admin/”更新 <bpt id=\"p4\">*</bpt>Contacts/Default.aspx<ept id=\"p4\">*</ept> 中的链接引用：",
          "pos": [
            0,
            100
          ]
        },
        {
          "content": "&amp;lt;%@ Page Title=\"ContactsList\" Language=\"C#\" MasterPageFile=\"~/Site.Master\" CodeBehind=\"Default.aspx.cs\" Inherits=\"ContactManager.Contacts.Default\" ViewStateMode=\"Disabled\" %&gt;",
          "pos": [
            130,
            307
          ]
        },
        {
          "content": "&amp;lt;%@ Register TagPrefix=\"FriendlyUrls\" Namespace=\"Microsoft.AspNet.FriendlyUrls\" %&gt;",
          "pos": [
            308,
            393
          ]
        }
      ]
    },
    {
      "content": "&amp;lt;asp:Content runat=\"server\" ContentPlaceHolderID=\"MainContent\"&gt;",
      "pos": [
        27928,
        27994
      ]
    },
    {
      "content": "&amp;lt;h2&gt;联系人列表&amp;lt;/h2&gt;",
      "pos": [
        27999,
        28019
      ]
    },
    {
      "content": "&amp;lt;p&gt;",
      "pos": [
        28024,
        28030
      ]
    },
    {
      "content": "&amp;lt;asp:HyperLink runat=\"server\" NavigateUrl=\"",
      "pos": [
        28039,
        28085
      ]
    },
    {
      "content": "Admin/",
      "pos": [
        28091,
        28097
      ]
    },
    {
      "content": "Insert.aspx\" Text=\"Create new\" /&gt;",
      "pos": [
        28104,
        28137
      ]
    },
    {
      "content": "&amp;lt;/p&gt;",
      "pos": [
        28142,
        28149
      ]
    },
    {
      "content": "&amp;lt;div&gt;",
      "pos": [
        28154,
        28162
      ]
    },
    {
      "content": "&amp;lt;asp:ListView runat=\"server\"",
      "pos": [
        28171,
        28202
      ]
    },
    {
      "content": "DataKeyNames=\"ContactId\" ItemType=\"ContactManager.Models.Contacts\"",
      "pos": [
        28215,
        28281
      ]
    },
    {
      "content": "AutoGenerateColumns=\"false\"",
      "pos": [
        28294,
        28321
      ]
    },
    {
      "content": "AllowPaging=\"true\" AllowSorting=\"true\"",
      "pos": [
        28334,
        28372
      ]
    },
    {
      "content": "SelectMethod=\"GetData\"&gt;",
      "pos": [
        28385,
        28408
      ]
    },
    {
      "content": "&amp;lt;EmptyDataTemplate&gt;",
      "pos": [
        28421,
        28443
      ]
    },
    {
      "content": "未找到联系人条目",
      "pos": [
        28460,
        28468
      ]
    },
    {
      "content": "&amp;lt;/EmptyDataTemplate&gt;",
      "pos": [
        28481,
        28504
      ]
    },
    {
      "content": "&amp;lt;LayoutTemplate&gt;",
      "pos": [
        28517,
        28536
      ]
    },
    {
      "content": "&amp;lt;table class=\"table\"&gt;",
      "pos": [
        28553,
        28577
      ]
    },
    {
      "content": "&amp;lt;thead&gt;",
      "pos": [
        28598,
        28608
      ]
    },
    {
      "content": "&amp;lt;tr&gt;",
      "pos": [
        28633,
        28640
      ]
    },
    {
      "content": "&amp;lt;th&gt;名称&amp;lt;/th&gt;",
      "pos": [
        28669,
        28686
      ]
    },
    {
      "content": "&amp;lt;th&gt;地址&amp;lt;/th&gt;",
      "pos": [
        28715,
        28732
      ]
    },
    {
      "content": "&amp;lt;th&gt;城市&amp;lt;/th&gt;",
      "pos": [
        28761,
        28778
      ]
    },
    {
      "content": "&amp;lt;th&gt;省/市/自治区&amp;lt;/th&gt;",
      "pos": [
        28807,
        28829
      ]
    },
    {
      "content": "&amp;lt;th&gt;邮政编码&amp;lt;/th&gt;",
      "pos": [
        28858,
        28877
      ]
    },
    {
      "content": "&amp;lt;th&gt;电子邮件&amp;lt;/th&gt;",
      "pos": [
        28906,
        28925
      ]
    },
    {
      "content": "&amp;lt;th&gt;&amp;amp;nbsp;&amp;lt;/th&gt;",
      "pos": [
        28954,
        28979
      ]
    },
    {
      "content": "&amp;lt;/tr&gt;",
      "pos": [
        29004,
        29012
      ]
    },
    {
      "content": "&amp;lt;/thead&gt;",
      "pos": [
        29033,
        29044
      ]
    },
    {
      "content": "&amp;lt;tbody&gt;",
      "pos": [
        29065,
        29075
      ]
    },
    {
      "content": "&amp;lt;tr runat=\"server\" id=\"itemPlaceholder\" /&gt;",
      "pos": [
        29100,
        29145
      ]
    },
    {
      "content": "&amp;lt;/tbody&gt;",
      "pos": [
        29166,
        29177
      ]
    },
    {
      "content": "&amp;lt;/table&gt;",
      "pos": [
        29194,
        29205
      ]
    },
    {
      "content": "&amp;lt;/LayoutTemplate&gt;",
      "pos": [
        29218,
        29238
      ]
    },
    {
      "content": "&amp;lt;ItemTemplate&gt;",
      "pos": [
        29251,
        29268
      ]
    },
    {
      "content": "&amp;lt;tr&gt;",
      "pos": [
        29285,
        29292
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        29313,
        29320
      ]
    },
    {
      "content": "&amp;lt;asp:DynamicControl runat=\"server\" DataField=\"Name\" ID=\"Name\" Mode=\"ReadOnly\" /&gt;",
      "pos": [
        29345,
        29428
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        29449,
        29457
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        29478,
        29485
      ]
    },
    {
      "content": "&amp;lt;asp:DynamicControl runat=\"server\" DataField=\"Address\" ID=\"Address\" Mode=\"ReadOnly\" /&gt;",
      "pos": [
        29510,
        29599
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        29620,
        29628
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        29649,
        29656
      ]
    },
    {
      "content": "&amp;lt;asp:DynamicControl runat=\"server\" DataField=\"City\" ID=\"City\" Mode=\"ReadOnly\" /&gt;",
      "pos": [
        29681,
        29764
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        29785,
        29793
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        29814,
        29821
      ]
    },
    {
      "content": "&amp;lt;asp:DynamicControl runat=\"server\" DataField=\"State\" ID=\"State\" Mode=\"ReadOnly\" /&gt;",
      "pos": [
        29846,
        29931
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        29952,
        29960
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        29981,
        29988
      ]
    },
    {
      "content": "&amp;lt;asp:DynamicControl runat=\"server\" DataField=\"Zip\" ID=\"Zip\" Mode=\"ReadOnly\" /&gt;",
      "pos": [
        30013,
        30094
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        30115,
        30123
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        30144,
        30151
      ]
    },
    {
      "content": "&amp;lt;asp:DynamicControl runat=\"server\" DataField=\"Email\" ID=\"Email\" Mode=\"ReadOnly\" /&gt;",
      "pos": [
        30176,
        30261
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        30282,
        30290
      ]
    },
    {
      "content": "&amp;lt;td&gt;",
      "pos": [
        30311,
        30318
      ]
    },
    {
      "content": "&amp;lt;a href=\"",
      "pos": [
        30343,
        30355
      ]
    },
    {
      "content": "Admin/",
      "pos": [
        30361,
        30367
      ]
    },
    {
      "content": "Edit.aspx?ContactId=&amp;lt;%#: Item.ContactId%&gt;\"&gt;Edit&amp;lt;/a&gt; |",
      "pos": [
        30374,
        30433
      ]
    },
    {
      "content": "&amp;lt;a href=\"",
      "pos": [
        30459,
        30471
      ]
    },
    {
      "content": "Admin/",
      "pos": [
        30477,
        30483
      ]
    },
    {
      "content": "Delete.aspx?ContactId=&amp;lt;%#: Item.ContactId%&gt;\"&gt;Delete&amp;lt;/a&gt;",
      "pos": [
        30490,
        30551
      ]
    },
    {
      "content": "&amp;lt;/td&gt;",
      "pos": [
        30572,
        30580
      ]
    },
    {
      "content": "&amp;lt;/tr&gt;",
      "pos": [
        30597,
        30605
      ]
    },
    {
      "content": "&amp;lt;/ItemTemplate&gt;",
      "pos": [
        30618,
        30636
      ]
    },
    {
      "content": "&amp;lt;/asp:ListView&gt;",
      "pos": [
        30645,
        30663
      ]
    },
    {
      "content": "&amp;lt;/div&gt;",
      "pos": [
        30668,
        30677
      ]
    },
    {
      "content": "&amp;lt;/asp:Content&gt;",
      "pos": [
        30678,
        30695
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n4.</ph> 对于以下三个文件，将 <ph id=\"ph2\">`Response.Redirect(\"Default.aspx\")`</ph> 代码的六个引用更新为 <ph id=\"ph3\">`Response.Redirect(\"~/Contacts/Default.aspx\")`</ph>：  \n    <bpt id=\"p1\">- *</bpt>Delete.aspx.cs<ept id=\"p1\">*</ept><bpt id=\"p2\">\n    - *</bpt>Edit.aspx.cs<ept id=\"p2\">*</ept><bpt id=\"p3\">\n    - *</bpt>Insert.aspx.cs<ept id=\"p3\">*</ept>",
      "pos": [
        30702,
        30880
      ]
    },
    {
      "pos": [
        30920,
        30983
      ],
      "content": "若要限制对 <bpt id=\"p1\">*</bpt>Admin<ept id=\"p1\">*</ept> 文件夹的访问，请在“解决方案资源管理器”中右键单击 <bpt id=\"p2\">*</bpt>Admin<ept id=\"p2\">*</ept> 文件夹，然后选择“添加新项”。"
    },
    {
      "pos": [
        30987,
        31059
      ],
      "content": "从 Visual C# Web 模板列表中，从中间列表中选择“Web 配置文件”，接受 <bpt id=\"p1\">*</bpt>Web.config<ept id=\"p1\">*</ept> 的默认名称，然后选择“添加”。"
    },
    {
      "pos": [
        31063,
        31338
      ],
      "content": "将 *Web.config* 文件中的现有 XML 内容替换为以下内容：\n <pre class=\"prettyprint\">\n&lt;?xml version=\"1.0\"?>\n&lt;configuration>\n&lt;system.web>\n &lt;authorization>\n   &lt;allow roles=\"canEdit\"/>\n   &lt;deny users=\"*\"/>\n &lt;/authorization>\n&lt;/system.web>\n&lt;/configuration>",
      "leadings": [
        "",
        "   ",
        "",
        "",
        "  ",
        "   ",
        "   ",
        "   ",
        "   ",
        "  ",
        ""
      ],
      "nodes": [
        {
          "content": "将 <bpt id=\"p1\">*</bpt>Web.config<ept id=\"p1\">*</ept> 文件中的现有 XML 内容替换为以下内容：",
          "pos": [
            0,
            36
          ]
        },
        {
          "content": "&amp;lt;?xml version=\"1.0\"?&gt;",
          "pos": [
            64,
            88
          ]
        },
        {
          "content": "&amp;lt;configuration&gt;",
          "pos": [
            89,
            107
          ]
        },
        {
          "content": "&amp;lt;system.web&gt;",
          "pos": [
            108,
            123
          ]
        },
        {
          "content": "&amp;lt;authorization&gt;",
          "pos": [
            125,
            143
          ]
        },
        {
          "content": "&amp;lt;allow roles=\"canEdit\"/&gt;",
          "pos": [
            147,
            174
          ]
        },
        {
          "content": "&amp;lt;deny users=\"*\"/&gt;",
          "pos": [
            178,
            198
          ]
        },
        {
          "content": "&amp;lt;/authorization&gt;",
          "pos": [
            200,
            219
          ]
        },
        {
          "content": "&amp;lt;/system.web&gt;",
          "pos": [
            220,
            236
          ]
        },
        {
          "content": "&amp;lt;/configuration&gt;",
          "pos": [
            237,
            256
          ]
        }
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n8.</ph> 保存 <bpt id=\"p1\">*</bpt>Web.config<ept id=\"p1\">*</ept> 文件。<bpt id=\"p2\">*</bpt>Web.config<ept id=\"p2\">*</ept> 文件指定只有分配给“canEdit”角色的用户才能访问 <bpt id=\"p3\">*</bpt>Admin<ept id=\"p3\">*</ept> 文件夹中包含的页。",
      "pos": [
        31345,
        31426
      ]
    },
    {
      "content": "如果不属于“canEdit”角色的用户尝试修改数据，则系统会将他们重定向到“登录”页。",
      "pos": [
        31429,
        31472
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Deploy-the-Application-with-the-Database-to-Azure\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>将包含数据库的应用程序部署到 Azure",
      "pos": [
        31476,
        31560
      ]
    },
    {
      "content": "Web 应用现已完成，你可以将其发布到 Azure。",
      "pos": [
        31563,
        31589
      ]
    },
    {
      "content": "发布应用程序",
      "pos": [
        31594,
        31600
      ]
    },
    {
      "content": "在 Visual Studio 中生成项目（“Ctrl+Shift+B”）",
      "pos": [
        31605,
        31642
      ]
    },
    {
      "content": "在“解决方案资源管理器”中，右键单击该项目并选择“发布”。",
      "pos": [
        31646,
        31675
      ]
    },
    {
      "content": "发布菜单选项",
      "pos": [
        31677,
        31683
      ]
    },
    {
      "content": "此时将显示“发布 Web”对话框。",
      "pos": [
        31789,
        31806
      ]
    },
    {
      "content": "“发布 Web”对话框",
      "pos": [
        31808,
        31819
      ]
    },
    {
      "content": "从“配置文件”选项卡中，选择“导入”（如果尚未导入）。",
      "pos": [
        31931,
        31958
      ]
    },
    {
      "content": "选择已经下载好的“发布配置文件”。",
      "pos": [
        31963,
        31980
      ]
    },
    {
      "content": "单击“设置”选项卡。",
      "pos": [
        31984,
        31994
      ]
    },
    {
      "content": "选择“现有 Web 应用”对话框",
      "pos": [
        31996,
        32012
      ]
    },
    {
      "content": "将“配置”下拉框设置为“调试”。",
      "pos": [
        32123,
        32139
      ]
    },
    {
      "content": "单击“ApplicationDbContext”旁边的“向下箭头”图标，并将其设置为“ContactDB”。",
      "pos": [
        32143,
        32197
      ]
    },
    {
      "pos": [
        32201,
        32296
      ],
      "content": "选中“执行 Code First 迁移”复选框。在此示例中，仅当首次发布应用程序时才应选中此复选框。这样，便只会调用 <bpt id=\"p1\">*</bpt>Configuration.cs<ept id=\"p1\">*</ept> 文件中的 <bpt id=\"p2\">*</bpt>Seed<ept id=\"p2\">*</ept> 方法一次。"
    },
    {
      "content": "然后，单击“发布”。你的应用程序将发布到 Azure。",
      "pos": [
        32304,
        32331
      ]
    },
    {
      "pos": [
        32334,
        32457
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>如果在创建发布配置文件后关闭再重新打开 Visual Studio，你可能在下拉列表中看不到连接字符串。在这种情况下，请不要编辑前面创建的发布配置文件，而是像先前一样创建一个新的配置文件，然后在“设置”选项卡遵循以下步骤。"
    },
    {
      "content": "在 Azure 中查看应用程序",
      "pos": [
        32462,
        32477
      ]
    },
    {
      "content": "在浏览器中，单击“联系人演示”链接。此时将显示“联系人列表”。",
      "pos": [
        32482,
        32513
      ]
    },
    {
      "content": "浏览器中列出的联系人",
      "pos": [
        32515,
        32525
      ]
    },
    {
      "content": "在“联系人列表”页上选择“新建”。",
      "pos": [
        32637,
        32654
      ]
    },
    {
      "content": "浏览器中列出的联系人",
      "pos": [
        32656,
        32666
      ]
    },
    {
      "content": "你将被重定向到“登录”页，因为你尚未使用可修改联系人的帐户登录。",
      "pos": [
        32772,
        32804
      ]
    },
    {
      "pos": [
        32808,
        33001
      ],
      "content": "在输入以下电子邮件和密码后，请单击“登录”按钮。“电子邮件”：<ph id=\"ph1\">`canEditUser@wideworldimporters.com`</ph>“密码”：<ph id=\"ph2\">`Pa$$word1`</ph><ph id=\"ph3\">![</ph>登录页<ph id=\"ph4\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms28.png)</ph>"
    },
    {
      "pos": [
        33008,
        33290
      ],
      "content": "为每个字段输入新数据，然后按“插入”按钮。<ph id=\"ph1\">![</ph>添加新联系人页<ph id=\"ph2\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms30.png)</ph> <bpt id=\"p1\">*</bpt>EditContactList.aspx<ept id=\"p1\">*</ept> 页中将显示新记录。<ph id=\"ph3\">![</ph>添加新联系人页<ph id=\"ph4\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms31.png)</ph>"
    },
    {
      "content": "选择“注销”链接。",
      "pos": [
        33295,
        33304
      ]
    },
    {
      "content": "停止应用程序",
      "pos": [
        33309,
        33315
      ]
    },
    {
      "content": "为了防止其他人注册和使用你的示例应用程序，你可以停止该 Web 应用。",
      "pos": [
        33317,
        33352
      ]
    },
    {
      "content": "在 Visual Studio 中，从“视图菜单”选择“服务器资源管理器”。",
      "pos": [
        33357,
        33395
      ]
    },
    {
      "content": "在“服务器资源管理器”中，导航到“ Web 应用”。",
      "pos": [
        33400,
        33426
      ]
    },
    {
      "content": "右键单击每个 Web 应用实例并选择“停止 Web 应用”。",
      "pos": [
        33430,
        33460
      ]
    },
    {
      "content": "停止 Web 应用菜单项",
      "pos": [
        33462,
        33474
      ]
    },
    {
      "content": "或者，也可以从 Azure 管理门户中选择该 Web 应用，然后单击页面底部的“停止”图标。",
      "pos": [
        33588,
        33634
      ]
    },
    {
      "content": "添加新联系人页",
      "pos": [
        33636,
        33643
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Review-the-Database\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>查看数据库",
      "pos": [
        33753,
        33792
      ]
    },
    {
      "content": "必须知道如何直接查看和修改数据库。如果知道如何直接处理数据库，就可以确认数据库中的数据，同时了解数据在每个表中的存储方式。",
      "pos": [
        33794,
        33855
      ]
    },
    {
      "content": "检查 SQL Azure 数据库",
      "pos": [
        33860,
        33876
      ]
    },
    {
      "content": "在 Visual Studio 中打开“服务器资源管理器”并导航到“ContactDB”。",
      "pos": [
        33881,
        33926
      ]
    },
    {
      "content": "右键单击“ContactDB”并选择“在 SQL Server 对象资源管理器中打开”。",
      "pos": [
        33930,
        33974
      ]
    },
    {
      "content": "“在 SQL Server 对象资源管理器中打开”菜单项",
      "pos": [
        33976,
        34004
      ]
    },
    {
      "pos": [
        34115,
        34421
      ],
      "content": "如果显示了“添加防火墙规则”对话框，请选择“添加防火墙规则”。如果无法从 Visual Studio 展开“SQL 数据库”并且无法查看“ContactDB”，你可以按照说明打开一个或一系列防火墙端口。为此，请遵照 <bpt id=\"p1\">[</bpt>MVC 教程<ept id=\"p1\">](/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database)</ept>结尾处的“设置 Azure 防火墙规则”下的说明操作。或者，你也可以通过在本地生成、运行应用程序并在其中添加数据（在 Visual Studio 中按“CTRL+F5”）查看本地数据库的数据。"
    },
    {
      "pos": [
        34428,
        34610
      ],
      "content": "如果显示了“连接到服务器”对话框，请输入在本教程开头创建的“密码”，然后按“连接”按钮。如果你不记得密码，可以在本地项目文件中找到它。在“解决方案资源管理器”中展开 <bpt id=\"p1\">*</bpt>Properties<ept id=\"p1\">*</ept> 文件夹，然后展开 <bpt id=\"p2\">*</bpt>PublishProfiles<ept id=\"p2\">*</ept> 文件夹。打开 <bpt id=\"p3\">*</bpt>contactmanager.pubxml<ept id=\"p3\">*</ept> 文件（你的文件可能具有不同的名称）。搜索发布密码的文件。"
    },
    {
      "content": "展开“contactDB”数据库，然后展开“表”。",
      "pos": [
        34615,
        34640
      ]
    },
    {
      "content": "右键单击“dbo.AspNetUsers”表并选择“查看数据”。",
      "pos": [
        34644,
        34676
      ]
    },
    {
      "content": "“查看数据”菜单项",
      "pos": [
        34678,
        34687
      ]
    },
    {
      "content": "你可以查看与 canEditUser@contoso.com 用户关联的数据。",
      "pos": [
        34793,
        34832
      ]
    },
    {
      "content": "ContactManager 窗口",
      "pos": [
        34834,
        34851
      ]
    },
    {
      "content": "通过编辑数据库将用户添加到管理员角色",
      "pos": [
        34963,
        34981
      ]
    },
    {
      "content": "在本教程的前面部分，你使用代码将用户添加到了 canEdit 角色。一种替代方法是直接操作成员资格表中的数据。以下步骤说明如何使用此替代方法将用户添加到角色。",
      "pos": [
        34983,
        35062
      ]
    },
    {
      "content": "在“SQL Server 对象资源管理器”中，右键单击“dbo.AspNetUserRoles”，然后选择“查看数据”。",
      "pos": [
        35067,
        35127
      ]
    },
    {
      "content": "AspNetUserRoles 数据",
      "pos": [
        35129,
        35147
      ]
    },
    {
      "pos": [
        35258,
        35408
      ],
      "content": "复制 <bpt id=\"p1\">*</bpt>RoleId<ept id=\"p1\">*</ept> 并将其粘贴到空（新）行中。<ph id=\"ph1\">![</ph>AspNetUserRoles 数据<ph id=\"ph2\">](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms37.png)</ph>"
    },
    {
      "pos": [
        35414,
        35459
      ],
      "content": "在“dbo.AspNetUsers”表中，找到你要放入角色的用户并复制该用户的 <bpt id=\"p1\">*</bpt>Id<ept id=\"p1\">*</ept>。"
    },
    {
      "pos": [
        35463,
        35510
      ],
      "content": "将复制的 <bpt id=\"p1\">*</bpt>Id<ept id=\"p1\">*</ept> 粘贴到“AspNetUserRoles”表中新行的“UserId”字段内。"
    },
    {
      "pos": [
        35515,
        35549
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>我们正在开发可显著简化用户和角色管理的工具。"
    },
    {
      "content": "<ph id=\"ph1\">&lt;a name=\"Next-Steps\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>后续步骤",
      "pos": [
        35553,
        35582
      ]
    },
    {
      "content": "有关 ASP.NET Web 窗体的详细信息，请参阅 ASP.NET Web 应用上的 <bpt id=\"p1\">[</bpt>了解 ASP.NET Web 窗体<ept id=\"p1\">](http://www.asp.net/web-forms)</ept>和 <bpt id=\"p2\">[</bpt>Azure 教程和指南<ept id=\"p2\">](/documentation/services/web-sites/#net)</ept>。",
      "pos": [
        35583,
        35732
      ]
    },
    {
      "pos": [
        35734,
        35946
      ],
      "content": "本教程基于 Rick Anderson 在 Tom Dykstra 和 Barry Dorrans 的帮助下编写的 MVC 教程<bpt id=\"p1\">[</bpt>创建包含身份验证和 SQL 数据库的 ASP.NET MVC 应用并部署到 Azure  Web 应用<ept id=\"p1\">](/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database)</ept>。"
    },
    {
      "pos": [
        35948,
        36107
      ],
      "content": "请提供有关你喜欢的内容或者你希望看到改善的内容的反馈，不仅关于教程本身，也关于它所演示的产品。你的反馈将帮助我们确定优先改进哪些方面。你还可以在<bpt id=\"p1\">[</bpt>教我编写代码<ept id=\"p1\">](http://aspnet.uservoice.com/forums/228522-show-me-how-with-code)</ept>上请求帮助以及对新主题投票。"
    }
  ],
  "content": "<properties \n    pageTitle=\"创建包含成员资格、OAuth 和 SQL 数据库的安全 ASP.NET Web 窗体应用并部署到 Azure Web 应用\" \n    description=\"本教程说明如何生成整合了 SQL 数据库的安全 ASP.NET 4.5 Web 窗体 Web 应用并将其部署到 Azure。\" \n    services=\"app-service\\web\" \n    documentationCenter=\".net\" \n    authors=\"Erikre\" \n    manager=\"wpickett\" \n    editor=\"jimbe\"/>\n\n<tags \n    ms.service=\"web-sites\" \n    ms.date=\"12/10/2015\" \n    wacn.date=\"02/17/2016\"/>\n\n\n# 创建包含成员资格、OAuth 和 SQL 数据库的安全 ASP.NET Web 窗体应用并部署到 Azure Web 应用\n\n##概述\n本教程说明如何生成整合了 SQL 数据库的安全 ASP.NET 4.5 Web 窗体 Web 应用并将其部署到 Azure。\n\n>[AZURE.NOTE]有关本教程中的 MVC 版本，请参阅[创建包含身份验证和 SQLDB 的 ASP.NET MVC 应用并将其部署到 Azure Web 应用](/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database)。\n\n你可以免费注册一个 Azure 帐户，而且，如果你还没有 Visual Studio 2013，则此 SDK 会自动安装 Visual Studio 2013 for Web Express。你可以免费开始针对 Azure 进行开发。\n\n本教程假定你之前未使用过 Azure。完成本教程之后，你将能够在云中启动并运行使用云数据库的 Web 应用。\n\n学习内容：\n\n- 如何创建 ASP.NET 4.5 Web 窗体项目并将其发布到 Azure Web 应用。\n- 如何使用 OAuth 和 ASP.NET 成员资格保护你的应用程序。\n- 如何为成员资格和应用程序数据使用单个数据库。\n- 如何使用 Web 窗体基架创建网页以便修改数据。\n- 如何使用新成员资格 API 添加用户和角色。\n- 如何使用 SQL 数据库在 Azure 中存储数据。\n\n你将生成一个简单的联系人列表 Web 应用，该应用程序基于 ASP.NET 4.5 Web 窗体构建并使用实体框架进行数据库访问。下图显示了用于对数据库进行读取和写入访问的 Web 窗体页：\n\n![联系人 - 编辑页](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms00.png)\n\n>[AZURE.NOTE]若要完成本教程，您需要一个 Azure 帐户。如果您没有帐户，则可以<a href=\"/pricing/1rmb-trial/\" target=\"_blank\">注册获取试用版</a>。\n\n##<a name=\"set-up-the-development-environment\"></a>设置开发环境 \n若要开始，请通过安装 Visual Studio 2013 和 Azure SDK for .NET 来设置开发环境。\n\n1. 安装 [Visual Studio 2013](https://www.visualstudio.com/zh-cn/downloads)（如果尚未安装）。  \n2. 安装 [Azure SDK for Visual Studio 2013](http://go.microsoft.com/fwlink/?linkid=324322&clcid=0x409)。本教程需要先安装 Visual Studio 2013，然后再安装 Azure SDK for Visual Studio 2013。根据计算机上已有 SDK 依赖项数量的不同，安装 SDK 可能耗时较长，从几分钟到半小时或更长时间不等。  \n\n3. 如果系统提示你是要运行还是保存可执行安装文件，请单击“运行”。\n4. 在“Web 平台安装程序”窗口中，单击“安装”，然后进行安装。![Web 平台安装程序](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-01.png)  \n\n      如果你已安装 SDK，则会安装 0 个项。要安装的项数将显示在“Web 平台安装程序”窗口的左下角。\n\n5. 如果您还没有 **Visual Studio Update 2**，请下载并安装 **<!--[-->Visual Studio 2013 Update 2<!--](http://www.microsoft.com/download/details.aspx?id=42666)-->** 或更高版本。\n\n    >[AZURE.NOTE]只有安装了 Visual Studio 2013 Update 2 或更高版本才能使用 Goggle OAuth 2.0 以及在本地使用 SSL，而不会显示任何警告。此外，你需要通过 Update 2 来使用 Web 窗体基架。\n\n安装完成后，你便做好了开发准备工作。\n\n##<a name=\"Set-up-the-Azure-environment\"></a>设置 Azure 环境\n在本部分中，你将通过在 Azure 中创建 Azure 和 SQL 数据库来设置 Azure 环境。\n\n###在 Azure 中创建 Web 应用和 SQL 数据库 \n在本教程中，你的 Web 应用将在共享宿主环境中运行，这意味着它将在与 Azure 中与其他 Web 应用共享的虚拟机 (VM) 上运行。共享宿主环境是一种在云中开始工作的低成本方式。稍后，如果你的 Web 流量增加，则应用程序可进行扩展，通过在专用 VM 上运行来满足需要。如果你需要一个更复杂的体系结构，则可迁移到 Azure 云服务。云服务在你可根据自己的需求进行配置的专用 VM 上运行。\n\nAzure SQL 数据库是根据 SQL Server 技术构建的基于云的关系数据库服务。可以与 SQL Server 一起使用的工具和应用程序也可用于 SQL 数据库。\n\n1. 在 [ Azure 管理门户](https://manage.windowsazure.cn)中，单击左侧选项卡中的“Web Apps”，然后单击“新建”。![Web 平台安装程序](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-02.png)\n2. 单击“Web App”，然后单击“自定义创建”。![自定义创建](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-03.png) “新建 Web App - 自定义创建”向导将打开。  \n\n3. 在该向导的“创建 Web App”步骤中，在“URL”框中输入将用作你的应用程序的唯一 URL 的字符串。完整的 URL 将包含你在此处输入的内容和你在文本框旁边看到的后缀。图中显示了一个 URL，但可能已有人使用了该 URL，因此**必须另外选择一个 URL**。![联系人 - 创建新 Web 应用](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-04.png)\n4. 在“Web 托管计划”下拉列表中，选择离你最近的区域。此设置指定你的 VM 将在哪个数据中心运行。\n5. 在“数据库”下拉列表中，选择“创建免费的 20 MB SQL 数据库”。\n6. 在“数据库连接字符串名称”框中，保留默认值 *DefaultConnection*。\n7. 单击框底部的箭头。该向导将前进到“指定数据库设置”步骤。\n8. 在“名称”框中，输入 *`ContactDB`*。![数据库设置](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/Intro-SecureWebForms-05.png)  \n9. 在“服务器”框中，选择“新建 SQL 数据库”服务器。或者，如果你之前创建了 SQL Server 数据库，则可从下拉列表控件中选择 SQL Server。\n10. 将“区域”设置为创建 Web 应用的同一区域。\n11. 输入管理员“登录名”和“密码”。如果你选择了“新建 SQL 数据库服务器”，则在此处不要输入现有名称和密码。你应输入新的名称和密码，你现在定义的名称和密码将在你以后访问数据库时使用。如果你选择了之前创建的 SQL Server，系统将提示你输入之前创建的 SQL Server 帐户名称的密码。本教程将不选中“高级”框。\n12. 单击对话框右下角的复选标记以指示你已完成操作。\n\n“Azure 管理门户”返回到“Web Apps”页面，并且“状态”列显示正在创建 Web 应用。稍后（通常不到一分钟），“状态”列会显示已成功创建 Web 应用。在左侧的导航栏中，你的帐户中拥有的 Web 应用的数量将会显示在“Web 应用”图标旁边，而数据库的数量将会显示在“SQL 数据库”图标旁边。\n##<a name=\"Create-an-ASP.NET-Web-Forms-Application\"></a>创建 ASP.NET Web 窗体应用程序 \n你已经创建了一个 Web 应用，但其中还没有内容。下一步将创建要发布到 Azure 的 Visual Studio Web 应用程序。\n###创建项目 \n1. 在 Visual Studio 中，从“文件”菜单选择“新建项目”。![文件菜单 - 新建项目](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms01.png)  \n2. 在左侧依次选择“模板”、“Visual C#”、“Web”模板组。 \n3. 在中心列中选择“ASP.NET Web 应用程序”模板。\n4. 将你的项目命名为 *ContactManager* 并单击“确定”。![新建项目对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms02.png)  \n\n      在本系列教程中，项目名称为 **ContactManager**。建议使用与此完全相同的项目名称，以便整个系列教程中提供的代码按预期运行。\n\n5. 在“新建 ASP.NET 项目”对话框中，选择“Web 窗体”模板。取消选中“在云中托管”（如果已选中），然后单击“确定”。![“新建 ASP.NET 项目”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms03.png) 随后将创建 Web 窗体应用程序。\n###更新母版页\n在 ASP.NET Web 窗体中，母版页允许你在应用程序中创建一致的页面布局。可以使用单个母版页定义应用程序中所有页（或一组页）的外观和标准行为。然后，你可以创建包含想要显示的内容的各个内容页。当用户请求内容页时，ASP.NET 会将内容页与母版页合并，以生成将母版面布局与内容页中的内容相结合的输出。新站点需要更新应用程序名称和链接。该链接将指向显示联系人详细信息的页。若要进行这些更改，请修改母版页上的 HTML。\n\n1. 在“解决方案资源管理器”中，找到并打开“Site.Master”页。\n2. 如果该页在“设计”视图中，请切换到“源”视图。\n3. 通过修改或添加标记以更新母版页，从而页面的标记显示如下：\n\n<pre class=\"prettyprint\">\n&lt;%@ Master Language=\"C#\" AutoEventWireup=\"true\" CodeBehind=\"Site.master.cs\" Inherits=\"ContactManager.SiteMaster\" %>\n\n&lt;!DOCTYPE html>\n\n&lt;html lang=\"en\">\n&lt;head runat=\"server\">\n    &lt;meta charset=\"utf-8\" />\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    &lt;title>&lt;%: Page.Title %> - <mark>Contact Manager</mark>&lt;/title>\n\n    &lt;asp:PlaceHolder runat=\"server\">\n        &lt;%: Scripts.Render(\"~/bundles/modernizr\") %>\n    &lt;/asp:PlaceHolder>\n    &lt;webopt:bundlereference runat=\"server\" path=\"~/Content/css\" />\n    &lt;link href=\"~/favicon.ico\" rel=\"shortcut icon\" type=\"image/x-icon\" />\n\n&lt;/head>\n&lt;body>\n    &lt;form runat=\"server\">\n        &lt;asp:ScriptManager runat=\"server\">\n            &lt;Scripts>\n                &lt;%--To learn more about bundling scripts in ScriptManager see http://go.microsoft.com/fwlink/?LinkID=301884 --%>\n                &lt;%--Framework Scripts--%>\n                &lt;asp:ScriptReference Name=\"MsAjaxBundle\" />\n                &lt;asp:ScriptReference Name=\"jquery\" />\n                &lt;asp:ScriptReference Name=\"bootstrap\" />\n                &lt;asp:ScriptReference Name=\"respond\" />\n                &lt;asp:ScriptReference Name=\"WebForms.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/WebForms.js\" />\n                &lt;asp:ScriptReference Name=\"WebUIValidation.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/WebUIValidation.js\" />\n                &lt;asp:ScriptReference Name=\"MenuStandards.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/MenuStandards.js\" />\n                &lt;asp:ScriptReference Name=\"GridView.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/GridView.js\" />\n                &lt;asp:ScriptReference Name=\"DetailsView.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/DetailsView.js\" />\n                &lt;asp:ScriptReference Name=\"TreeView.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/TreeView.js\" />\n                &lt;asp:ScriptReference Name=\"WebParts.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/WebParts.js\" />\n                &lt;asp:ScriptReference Name=\"Focus.js\" Assembly=\"System.Web\" Path=\"~/Scripts/WebForms/Focus.js\" />\n                &lt;asp:ScriptReference Name=\"WebFormsBundle\" />\n                &lt;%--Site Scripts--%>\n            &lt;/Scripts>\n        &lt;/asp:ScriptManager>\n\n        &lt;div class=\"navbar navbar-inverse navbar-fixed-top\">\n            &lt;div class=\"container\">\n                &lt;div class=\"navbar-header\">\n                    &lt;button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-collapse\">\n                        &lt;span class=\"icon-bar\">&lt;/span>\n                        &lt;span class=\"icon-bar\">&lt;/span>\n                        &lt;span class=\"icon-bar\">&lt;/span>\n                    &lt;/button>\n                    &lt;a class=\"navbar-brand\" runat=\"server\" <mark>id=\"ContactDemoLink\"</mark> href=\"~/<mark>Contacts/Default.aspx</mark>\"><mark>Contact Demo</mark>&lt;/a>\n                &lt;/div>\n                &lt;div class=\"navbar-collapse collapse\">\n                    &lt;ul class=\"nav navbar-nav\">\n                        &lt;li>&lt;a runat=\"server\" href=\"~/\">主页&lt;/a>&lt;/li>\n                        &lt;li>&lt;a runat=\"server\" href=\"~/About\">关于&lt;/a>&lt;/li>\n                        &lt;li>&lt;a runat=\"server\" href=\"~/Contact\">联系人&lt;/a>&lt;/li>\n                    &lt;/ul>\n                    &lt;asp:LoginView runat=\"server\" ViewStateMode=\"Disabled\">\n                        &lt;AnonymousTemplate>\n                            &lt;ul class=\"nav navbar-nav navbar-right\">\n                                &lt;li>&lt;a runat=\"server\" href=\"~/Account/Register\">注册&lt;/a>&lt;/li>\n                                &lt;li>&lt;a runat=\"server\" href=\"~/Account/Login\">登录&lt;/a>&lt;/li>\n                            &lt;/ul>\n                        &lt;/AnonymousTemplate>\n                        &lt;LoggedInTemplate>\n                            &lt;ul class=\"nav navbar-nav navbar-right\">\n                                &lt;li>&lt;a runat=\"server\" href=\"~/Account/Manage\" title=\"Manage your account\">你好，&lt;%: Context.User.Identity.GetUserName()  %> !&lt;/a>&lt;/li>\n                                &lt;li>\n                                    &lt;asp:LoginStatus runat=\"server\" LogoutAction=\"Redirect\" LogoutText=\"Log off\" LogoutPageUrl=\"~/\" OnLoggingOut=\"Unnamed_LoggingOut\" />\n                                &lt;/li>\n                            &lt;/ul>\n                        &lt;/LoggedInTemplate>\n                    &lt;/asp:LoginView>\n                &lt;/div>\n            &lt;/div>\n        &lt;/div>\n        &lt;div class=\"container body-content\">\n            &lt;asp:ContentPlaceHolder ID=\"MainContent\" runat=\"server\">\n            &lt;/asp:ContentPlaceHolder>\n            &lt;hr />\n            &lt;footer>\n                &lt;p>复制(&amp;C); &lt;%: DateTime.Now.Year %> - <mark>联系人管理器</mark>&lt;/p>\n            &lt;/footer>\n        &lt;/div>\n    &lt;/form>\n&lt;/body>\n&lt;/html>\n</pre>\n\n在本教程的后面，你将要添加 Web 窗体基架。基架将创建上述“联系人演示”链接引用的页。\n###在本地运行应用程序 \n \n1. 在“解决方案资源管理器”中，右键单击“Default.aspx”页并选择“设为起始页”。 \n2. 接下来，按“CTRL+F5”运行应用程序。应用程序的默认页会显示在默认浏览器窗口中。![联系人 - 创建新 Web 应用](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms04.png)  \n\n这就是你创建将要部署到 Azure 的应用程序目前所需的全部操作。稍后，你将要添加数据库功能以及所需的页来显示和编辑联系人数据。\n###将应用程序部署到 Azure\n创建并在本地运行应用程序后，可以将应用程序部署到 Azure。\n\n1. 在 Azure 管理门户中，找到你的 Web 应用，在“仪表板”页面的速览，下载“发布配置文件”。\n\n1. 在 Visual Studio 中，在“解决方案资源管理器”中右键单击该项目，从上下文菜单中选择“发布”。\n\n    ![选择“发布”](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms05.png) \n\n    此时将显示“发布 Web”对话框。  \n\n2. 在“发布 Web”对话框的“配置文件”选项卡中，单击“导入”。\n      \n3. 选择刚刚下载的配置文件，点击确认。\n\n4. 在“发布 Web”对话框中，单击“发布”。![“发布 Web”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms08.png) 你将在 Visual Studio 中的“Web 发布活动”窗口中看到总体发布状态：![Web 发布活动](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms09.png)  \n\n你创建的应用程序现在在云中运行。下次从 Visual Studio 部署该应用程序时，仅会部署已更改（或新的）文件。![浏览器中的应用](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms10.png)\n\n>[AZURE.NOTE]如果在发布已建立的 Web 应用时遇到错误，则可以在添加新的文件之前清除该位置。再次发布应用程序，但这次请在“发布 Web”对话框中选择“设置”选项卡。然后，将配置设置为“调试”，并选择“删除目标位置的其他文件”选项。选择“发布”以再次部署应用程序。![“发布 Web”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms11.png)\n\n##<a name=\"Add-a-Database-to-the-Application\"></a>向应用程序添加数据库 \n接下来，你将更新 Web 窗体应用程序以添加显示和更新联系人以及在默认数据库中存储数据的功能。当你创建 Web 窗体项目时，默认情况下也会创建数据库。应用程序将使用 Entity Framework 访问数据库并读取和更新数据库中的数据。\n###添加数据模型类 \n首先，使用代码创建一个简单的数据模型。此数据模型将包含在名为 `Contacts` 的类中。选择 `Contacts` 类名的目的是避免与 Web 窗体模板创建的 Contact.aspx.cs 文件中包含的 `Contact` 类名冲突。\n\n1. 在“解决方案资源管理器”中，右键单击“模型”文件夹，然后依次选择“添加”、“类”。![选择类](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms12.png) 此时将显示“添加新项”对话框。  \n\n2. 将此新类命名为 *Contacts.cs*。![“添加新项”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13.png)\n3. 将默认代码替换为以下代码：  \n    <pre class=\"prettyprint\">\nusing System.ComponentModel.DataAnnotations;\nusing System.Globalization;\n\nnamespace ContactManager.Models\n{\n    public class Contacts\n    {\n        [ScaffoldColumn(false)]\n        [Key]\n        public int ContactId { get; set; }\n        public string Name { get; set; }\n        public string Address { get; set; }\n        public string City { get; set; }\n        public string State { get; set; }\n        public string Zip { get; set; }\n        [DataType(DataType.EmailAddress)]\n        public string Email { get; set; }\n    }\n}\n</pre>\n\n“Contacts”类定义你将为每个联系人存储的数据以及数据库需要的主键 (`ContactID`)。“Contacts”类表示要显示的联系人数据。Contacts 对象的每个实例将对应于关系数据库表中的某行，Contacts 类的每个属性将映射到关系数据库表中的某列。在本教程的后面，你将要查看数据库中包含的联系人数据。\n\n###Web 窗体基架 \n前面你已创建“Contacts”模型类。现在，你可以使用 Web 窗体基架以生成处理此数据时使用的“列表”、“插入”、“编辑”和“删除”页。Web Forms Scaffolder 使用实体框架、引导和动态数据。默认情况下，在使用 Visual Studio 2013 时，Web Forms Scaffolder 将以扩展形式安装到项目中，作为项目模板的一部分。\n\n可以执行以下步骤来使用 Web Forms Scaffolder。\n\n1. 在 Visual Studio 中，从菜单栏中依次选择“工具”、“扩展和更新”。此时将显示“扩展和更新”对话框。\n2. 从对话框的左窗格中，依次选择“联机”、“Visual Studio 库”、“工具”和“基架”。\n3. 如果没有在列表中看到“Web 窗体基架”，请在对话框右侧的搜索框中输入“Web 窗体基架”。  \n4. 如果尚未安装 Web 窗体基架，请选择“下载”以下载并安装“Web 窗体基架”。根据需要重新启动 Visual Studio。在提示时，请务必保存对项目所做的更改。![“扩展和更新”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/ExtensionsAndUpdatesDB.png)  \n5. 生成项目 (**Ctrl+Shift+B**).在使用基架机制之前，必须生成项目。  \n6. 在“解决方案资源管理器”中，右键单击“项目”，然后依次选择“添加”、“新建基架项”。此时将显示“添加基架”对话框。\n7. 从左窗格中选择“Web 窗体”，并从中央窗格中选择“使用实体框架的 Web 窗体页”。然后单击“添加”。![“添加基架”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13a.png) 此时将显示“添加 Web 窗体页”对话框。  \n\n8. 在“添加 Web 窗体页”对话框中，将“模型类”设置为 `Contacts (ContactManager.Models)`。将“数据上下文类”设置为 `ApplicationDbContext (ContactManager.Models)`。然后单击“添加”。![“添加 Web 窗体页”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13b.png)\n\nWeb 窗体基架添加的新文件夹包含*Default.aspx*、*Delete.aspx*、*Edit.aspx* 和 *Insert.aspx* 页。此外，Web 窗体基架还会创建 *DynamicData* 文件夹，其中包含 *EntityTemplates* 文件夹和 *FieldTemplates* 文件夹。`ApplicationDbContext` 将用于成员资格数据库和联系人数据。\n\n###将应用程序配置为使用数据模型 \n接下来的任务是启用 Code First 迁移功能以便基于你创建的数据模型创建数据库。此外，你将要添加示例数据和数据初始值设定项。\n\n1. 在“工具”菜单中，依次选择“NuGet Package Manager”和“Package Manager Console”。![“添加 Web 窗体页”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13c.png)  \n2. 在“Package Manager Console”窗口中，输入以下命令：  \n    <pre class=\"prettyprint\">\nenable-migrations\n</pre>Enable-migrations 命令将创建一个 *Migrations* 文件夹，并在该文件夹中放入一个可编辑以对数据库进行种子设定并配置数据迁移的 *Configuration.cs* 文件。  \n3. 在“Package Manager Console”窗口中，输入以下命令：  \n    <pre class=\"prettyprint\">\nadd-migration Initial\n</pre>`add-migration Initial` 命令将在创建数据库的 *Migrations* 文件夹中生成一个名为 <date_stamp>Initial 的文件。第一个参数 (Initial) 是任意参数并将用于创建文件名称。你可以在“解决方案资源管理器”中查看新的类文件。在 `Initial`中，`Up` 方法用于创建 `Contact`，而 `Down` 方法（在你想要返回到以前的状态时使用）用于删除该表。  \n4. 打开 *Migrations\\\\Configuration.cs* 文件。 \n5. 添加以下命名空间：  \n    <pre class=\"prettyprint\">\nusing ContactManager.Models;\n</pre>\n6. 将 `Seed`方法替换为以下代码：  \n    <pre class=\"prettyprint\">\nprotected override void Seed(ContactManager.Models.ApplicationDbContext context)\n{\n    context.Contacts.AddOrUpdate(p => p.Name,\n       new Contacts\n       {\n           ContactId = 1,\n           Name = \"Ivan Irons\",\n           Address = \"One Microsoft Way\",\n           City = \"Redmond\",\n           State = \"WA\",\n           Zip = \"10999\",\n           Email = \"ivani@wideworldimporters.com\",\n       },\n       new Contacts\n        {\n            ContactId = 2,\n            Name = \"Brent Scholl\",\n            Address = \"5678 1st Ave W\",\n            City = \"Redmond\",\n            State = \"WA\",\n            Zip = \"10999\",\n            Email = \"brents@wideworldimporters.com\",\n        },\n        new Contacts\n        {\n            ContactId = 3,\n            Name = \"Terrell Bettis\",\n            Address = \"9012 State St\",\n            City = \"Redmond\",\n            State = \"WA\",\n            Zip = \"10999\",\n            Email = \"terrellb@wideworldimporters.com\",\n        },\n        new Contacts\n        {\n            ContactId = 4,\n            Name = \"Jo Cooper\",\n            Address = \"3456 Maple St\",\n            City = \"Redmond\",\n            State = \"WA\",\n            Zip = \"10999\",\n            Email = \"joc@wideworldimporters.com\",\n        },\n        new Contacts\n        {\n            ContactId = 5,\n            Name = \"Ines Burnett\",\n            Address = \"7890 2nd Ave E\",\n            City = \"Redmond\",\n            State = \"WA\",\n            Zip = \"10999\",\n            Email = \"inesb@wideworldimporters.com\",\n        }\n        );\n}\n</pre>\n此代码将用联系信息初始化数据库或对其进行种子设定。有关对数据库进行种子设定的更多信息，请参阅[对 Entity Framework (EF) 数据库进行种子设定和调试](http://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx)。  \n7. 在“Package Manager Console”中输入以下命令：  \n    <pre class=\"prettyprint\">\nupdate-database\n</pre>\n`update-database`用于运行将创建数据库的初始迁移。默认情况下，将以 SQL Server Express LocalDB 数据库的形式创建数据库。![Package Manager Console](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms13d.png)\n\n###在本地运行应用程序并显示数据 \n现在，请运行应用程序，以了解如何查看联系人。\n\n1. 首先，请生成项目（“Ctrl+Shift+B”）。  \n2. 按“Ctrl+F5”运行应用程序。浏览器将打开并显示 *Default.aspx* 页。\n3. 选择页面顶部的“联系人演示”链接以显示“联系人列表”页。![联系人列表页](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms17.png)  \n\n##<a name=\"Enable-SSL-for-the-Project\"></a>为项目启用 SSL \n安全套接字层 (SSL) 是一种协议，定义为允许 Web 服务器与 Web 客户端通过使用加密以更安全的方式通信。如果不使用 SSL，在客户端与服务器之间发送数据时，对网络具有实际访问权限的任何人都可以探查数据包。此外，通过一般 HTTP 进行的几种常见身份验证方案也是不安全的。尤其是，基本身份验证和窗体身份验证会发送未加密的凭据。为确保安全，这些身份验证方案必须使用 SSL。\n\n1. 在“解决方案资源管理器”中，单击“ContactManager”项目，然后按**F4**显示“属性”窗口。 \n2. 将“已启用 SSL”更改为 `true`。 \n3. 复制 **SSL URL** 以便稍后使用。SSL URL 将为 `https://localhost:44300/`，除非你之前已创建 SSL Web 应用（如下所示）。![项目属性](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms18.png)  \n4. 在“解决方案资源管理器”中，右键单击“Contact Manager”项目，然后单击“属性”。\n5. 在左侧选项卡中，单击“Web”。\n6. 将“项目 URL”更改为使用前面保存的“SSL URL”。![项目 Web 属性](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms19.png)  \n7. 按“CTRL+S”保存该页。\n8. 按“Ctrl+F5”运行应用程序。Visual Studio 将显示一个选项用于避免 SSL 警告。  \n9. 单击“是”以信任 IIS Express SSL 证书并继续。![IIS Express SSL 证书详细信息](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms20.png)此时将显示一条安全警告。  \n\n10. 单击“是”将证书安装到本地主机。![“安全警告”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21.png) 此时将显示浏览器窗口。\n\n你可以在本地使用 SSL 轻松测试 Web 应用。\n\n\n\n##<a name=\"Add-an-OAuth-2.0-Provider\"></a>添加 OAuth 2.0 提供程序 \nASP.NET Web 窗体为成员资格和身份验证提供了增强的选项。这些增强功能包括 OAuth。OAuth 是一种开放协议，允许以一种简单而标准的方法从 Web、移动和桌面应用程序进行安全授权。ASP.NET MVC Internet 模板使用 OAuth 公开将 Facebook、Twitter、Google 和 Microsoft 作为身份验证提供程序。虽然本教程仅使用 Google 作为身份验证提供程序，但你可轻松修改代码以使用任何提供程序。实施其他提供程序的步骤与你将在本教程中看到的步骤非常类似。\n\n除了身份验证外，本教程还将使用角色实施授权。只有你添加到 `canEdit` 角色中的用户将能更改数据（创建、编辑或删除联系人）。\n\n可以执行以下步骤来添加 Google 身份验证提供程序。\n\n1. 打开 *App_Start\\\\Startup.Auth.cs* 文件。 \n2. 从 `app.UseGoogleAuthentication()` 方法中删除注释字符，使该方法如下所示：  \n    <pre class=\"prettyprint\">\n            app.UseGoogleAuthentication(new GoogleOAuth2AuthenticationOptions()\n            {\n                ClientId = \"\",\n                ClientSecret = \"\"\n            });\n</pre>\n3. 导航到 [Google Developers Console](https://console.developers.google.com/)。你还需要使用 Google 开发人员电子邮件帐户 (gmail.com） 登录。如果你没有 Google 帐户，请选择“创建帐户”链接。接下来，你将看到**Google Developers Console**。![Google Developers Console](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21a.png)  \n\n4. 单击“创建项目”按钮，然后输入项目名称和 ID（可以使用默认值）。然后，单击“协议复选框”和“创建”按钮。![Google - 新建项目](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21b.png) 几秒钟后，将会创建新项目，并且浏览器将显示新项目页。\n5. 在左侧选项卡中，单击“API 和身份验证”，然后单击“凭据”。\n6. 单击“OAuth”下的“创建新客户端 ID”。此时将显示“创建客户端 ID”对话框。![Google - 创建客户端 ID](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21c.png)  \n7. 在“创建客户端 ID”对话框中，保留默认“ Web 应用”作为应用程序类型。  \n8. 将“授权的 JavaScript 来源”设置为你之前在本教程中使用的 SSL URL（****https://localhost:44300/**除非你已创建其他 SSL 项目）。此 URL 是应用程序的来源。对于此示例，你只需输入 localhost 测试 URL。但是，你可以针对 localhost 和生产环境输入多个 URL。\n\n9. 将“授权的重定向 URI”设置为：\n    <pre class=\"prettyprint\">  \nhttps://localhost:44300/signin-google  \n</pre>此值是 ASP.NET OAuth 用户与 Google OAuth 服务器通信时使用的 URI。请记住上面使用的 SSL URL（****https://localhost:44300/**除非你已创建其他 SSL 项目）。\n10. 单击“创建客户端 ID”按钮。\n11. 在 Visual Studio 中，通过复制 **AppId** 和“应用密码”并粘贴到方法中，来更新 *Startup.Auth.cs* 页的 `UseGoogleAuthentication` 方法。下面显示的 **AppId** 和“应用密码”值是示例，它们不可用。  \n    <pre class=\"prettyprint\">  \nusing System;\nusing Microsoft.AspNet.Identity;\nusing Microsoft.AspNet.Identity.EntityFramework;\nusing Microsoft.AspNet.Identity.Owin;\nusing Microsoft.Owin;\nusing Microsoft.Owin.Security.Cookies;\nusing Microsoft.Owin.Security.DataProtection;\nusing Microsoft.Owin.Security.Google;\nusing Owin;\nusing ContactManager.Models;\n\nnamespace ContactManager\n{\n    public partial class Startup {\n\n        //  http://go.microsoft.com/fwlink/?LinkId=301883\n        public void ConfigureAuth(IAppBuilder app)\n        {\n            // Configure the db context and user manager to use a single instance per request\n            app.CreatePerOwinContext(ApplicationDbContext.Create);\n            app.CreatePerOwinContext<ApplicationUserManager>(ApplicationUserManager.Create);\n\n            // Enable the application to use a cookie to store information for the signed in user\n            // and to use a cookie to temporarily store information about a user logging in with a third party login provider\n            // Configure the sign in cookie\n            app.UseCookieAuthentication(new CookieAuthenticationOptions\n            {\n                AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie,\n                LoginPath = new PathString(\"/Account/Login\"),\n                Provider = new CookieAuthenticationProvider\n                {\n                    OnValidateIdentity = SecurityStampValidator.OnValidateIdentity&lt;ApplicationUserManager, ApplicationUser>(\n                        validateInterval: TimeSpan.FromMinutes(20),\n                        regenerateIdentity: (manager, user) => user.GenerateUserIdentityAsync(manager))\n                }\n            });\n            // Use a cookie to temporarily store information about a user logging in with a third party login provider\n            app.UseExternalSignInCookie(DefaultAuthenticationTypes.ExternalCookie);\n\n            // Uncomment the following lines to enable logging in with third party login providers\n            //app.UseMicrosoftAccountAuthentication(\n            //    clientId: \"\",\n            //    clientSecret: \"\");\n\n            //app.UseTwitterAuthentication(\n            //   consumerKey: \"\",\n            //   consumerSecret: \"\");\n\n            //app.UseFacebookAuthentication(\n            //   appId: \"\",\n            //   appSecret: \"\");\n\n            app.UseGoogleAuthentication(new GoogleOAuth2AuthenticationOptions()\n            {\n                ClientId = \"<mark>000000000000.apps.googleusercontent.com</mark>\",\n                ClientSecret = \"<mark>00000000000</mark>\"\n            });\n        }\n    }\n}\n</pre>\n12. 按“Ctrl + F5”构建并运行应用程序。单击“登录”链接。\n13. 在“使用其他服务进行登录”下，单击“Google”。![Log in](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21d.png)  \n14. 如果需要输入你的凭据，你将被重定向到 google 站点，你可以在这里输入你的凭据。![Google - 登录](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21e.png)  \n15. 输入你的凭据后，系统将提示你刚创建的 Web 应用，以便授予其权限：![项目默认服务帐户](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21f.png)  \n16. 单击“接受”。现在，你将被重定向回到“ContactManager”应用程序的“注册”页，你可以在该页中注册 Google 帐户。![使用你的 Google 帐户注册](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms21g.png)  \n17. 你可以选择更改 Gmail 帐户使用的本地电子邮件注册名称，但是，你通常会保留默认电子邮件别名（即，用于身份验证的名称）。单击“登录”。\n\n##<a name=\"Use-the-Membership-API-to-Restrict-Access\"></a>使用成员资格 API 来限制访问 \nASP.NET 标识是在生成 ASP.NET Web 应用时用于身份验证的成员资格系统。它可以轻松地将特定于用户的配置文件数据与应用程序数据相集成。此外，ASP.NET 标识允许你为应用程序中的用户配置文件选择持久模型。你可以将数据存储在 SQL Server 数据库或其他数据存储中，包括 Azure 存储表等 *NoSQL* 数据存储。\n\n通过使用默认的 ASP.NET Web 窗体模板，你可以获得在运行应用程序时立即可用的内置成员资格功能。你将使用 ASP.NET 标识添加管理员角色并将用户分配给该角色。然后，你将学习如何限制对管理文件夹和该文件夹中用于修改联系人数据的页面的访问。\n\n###添加管理员 \n通过 ASP.NET 标识，你可以使用代码添加管理员角色并将用户分配给该角色。\n\n1. 在“解决方案资源管理器”，打开 *Migrations* 文件夹中的 *Configuration.cs* 文件。\n2. 在 `ContactManger.Migrations` 命名空间中添加以下 `using` 语句：  \n    <pre class=\"prettyprint\">\nusing Microsoft.AspNet.Identity;\nusing Microsoft.AspNet.Identity.EntityFramework;\n</pre>\n3. 将以下 `AddUserAndRole` 方法添加到 `Seed` 方法后面的 `Configuration` 类：  \n    <pre class=\"prettyprint\">\n    public void AddUserAndRole(ContactManager.Models.ApplicationDbContext context)\n    {\n        IdentityResult IdRoleResult;\n        IdentityResult IdUserResult;\n\n        var roleStore = new RoleStore&lt;IdentityRole>(context);\n        var roleMgr = new RoleManager&lt;IdentityRole>(roleStore);\n\n        if (!roleMgr.RoleExists(\"canEdit\"))\n        {\n            IdRoleResult = roleMgr.Create(new IdentityRole { Name = \"canEdit\" });\n        }\n\n        //var userStore = new UserStore&lt;ApplicationUser>(context);\n        //var userMgr = new UserManager&lt;ApplicationUser>(userStore);\n        var userMgr = new UserManager&lt;ApplicationUser>(new UserStore&lt;ApplicationUser>(context));\n\n        var appUser = new ApplicationUser\n        {\n            UserName = \"canEditUser@wideworldimporters.com\",\n            Email = \"canEditUser@wideworldimporters.com\"\n        };\n        IdUserResult = userMgr.Create(appUser, \"Pa$$word1\");\n\n        if (!userMgr.IsInRole(userMgr.FindByEmail(\"canEditUser@wideworldimporters.com\").Id, \"canEdit\"))\n        {\n          //  IdUserResult = userMgr.AddToRole(appUser.Id, \"canEdit\");\n            IdUserResult = userMgr.AddToRole(userMgr.FindByEmail(\"canEditUser@wideworldimporters.com\").Id, \"canEdit\");\n        }\n    }\n</pre>\n4. 从 `Seed` 方法的开头添加对 `AddUserAndRole` 方法的调用。请注意，这里只显示了 `Seed` 方法的开头。  \n    <pre class=\"prettyprint\">\n    protected override void Seed(ContactManager.Models.ApplicationDbContext context)\n    {\n        <mark>AddUserAndRole(context);</mark>\n</pre>\n5. 保存所有更改后，在“Package Manager Console”中运行以下命令：  \n    <pre class=\"prettyprint\">\nUpdate-Database\n</pre>此代码会创建名为 `canEdit` 的新角色，创建电子邮件为 canEditUser@wideworldimporters.com 的新本地用户。然后，该代码会将添加 canEditUser@wideworldimporters.com 到 `canEdit` 角色。有关详细信息，请参阅 [ASP.NET 标识](http://www.asp.net/identity)资源页。\n\n###限制对管理文件夹的访问 \n**ContactManager** 示例应用程序允许匿名用户和已登录用户查看联系人。但是，在完成本部分后，只有分配给“canEdit”角色的已登录用户才能修改联系人。\n\n你将要创建一个名为 *Admin* 的文件夹，只有分配给“canEdit”角色的用户才可以访问该文件夹。\n\n1. 在“解决方案资源管理器”中，将一个子文件夹添加到 *Contacts* 文件夹，并命名新的子文件夹为 *Admin*。\n2. 将以下文件从 *Contacts* 文件夹移动到 *Contacts/Admin* 文件夹：  \n    - *Delete.aspx * 和 * Delete.aspx.cs*\n    - *Edit.aspx * 和 * Edit.aspx.cs*\n    - *Insert.aspx * 和 * Insert.aspx.cs*\n3. 通过在链接到 *Insert.aspx*、*Edit.aspx* 和 *Delete.aspx* 的页面引用之前添加“Admin/”更新 *Contacts/Default.aspx* 中的链接引用：  \n    <pre class=\"prettyprint\">\n&lt;%@ Page Title=\"ContactsList\" Language=\"C#\" MasterPageFile=\"~/Site.Master\" CodeBehind=\"Default.aspx.cs\" Inherits=\"ContactManager.Contacts.Default\" ViewStateMode=\"Disabled\" %>\n&lt;%@ Register TagPrefix=\"FriendlyUrls\" Namespace=\"Microsoft.AspNet.FriendlyUrls\" %>\n\n&lt;asp:Content runat=\"server\" ContentPlaceHolderID=\"MainContent\">\n    &lt;h2>联系人列表&lt;/h2>\n    &lt;p>\n        &lt;asp:HyperLink runat=\"server\" NavigateUrl=\"<mark>Admin/</mark>Insert.aspx\" Text=\"Create new\" />\n    &lt;/p>\n    &lt;div>\n        &lt;asp:ListView runat=\"server\"\n            DataKeyNames=\"ContactId\" ItemType=\"ContactManager.Models.Contacts\"\n            AutoGenerateColumns=\"false\"\n            AllowPaging=\"true\" AllowSorting=\"true\"\n            SelectMethod=\"GetData\">\n            &lt;EmptyDataTemplate>\n                未找到联系人条目\n            &lt;/EmptyDataTemplate>\n            &lt;LayoutTemplate>\n                &lt;table class=\"table\">\n                    &lt;thead>\n                        &lt;tr>\n                            &lt;th>名称&lt;/th>\n                            &lt;th>地址&lt;/th>\n                            &lt;th>城市&lt;/th>\n                            &lt;th>省/市/自治区&lt;/th>\n                            &lt;th>邮政编码&lt;/th>\n                            &lt;th>电子邮件&lt;/th>\n                            &lt;th>&amp;nbsp;&lt;/th>\n                        &lt;/tr>\n                    &lt;/thead>\n                    &lt;tbody>\n                        &lt;tr runat=\"server\" id=\"itemPlaceholder\" />\n                    &lt;/tbody>\n                &lt;/table>\n            &lt;/LayoutTemplate>\n            &lt;ItemTemplate>\n                &lt;tr>\n                    &lt;td>\n                        &lt;asp:DynamicControl runat=\"server\" DataField=\"Name\" ID=\"Name\" Mode=\"ReadOnly\" />\n                    &lt;/td>\n                    &lt;td>\n                        &lt;asp:DynamicControl runat=\"server\" DataField=\"Address\" ID=\"Address\" Mode=\"ReadOnly\" />\n                    &lt;/td>\n                    &lt;td>\n                        &lt;asp:DynamicControl runat=\"server\" DataField=\"City\" ID=\"City\" Mode=\"ReadOnly\" />\n                    &lt;/td>\n                    &lt;td>\n                        &lt;asp:DynamicControl runat=\"server\" DataField=\"State\" ID=\"State\" Mode=\"ReadOnly\" />\n                    &lt;/td>\n                    &lt;td>\n                        &lt;asp:DynamicControl runat=\"server\" DataField=\"Zip\" ID=\"Zip\" Mode=\"ReadOnly\" />\n                    &lt;/td>\n                    &lt;td>\n                        &lt;asp:DynamicControl runat=\"server\" DataField=\"Email\" ID=\"Email\" Mode=\"ReadOnly\" />\n                    &lt;/td>\n                    &lt;td>\n                        &lt;a href=\"<mark>Admin/</mark>Edit.aspx?ContactId=&lt;%#: Item.ContactId%>\">Edit&lt;/a> | \n                        &lt;a href=\"<mark>Admin/</mark>Delete.aspx?ContactId=&lt;%#: Item.ContactId%>\">Delete&lt;/a>\n                    &lt;/td>\n                &lt;/tr>\n            &lt;/ItemTemplate>\n        &lt;/asp:ListView>\n    &lt;/div>\n&lt;/asp:Content>\n</pre>\n4. 对于以下三个文件，将 `Response.Redirect(\"Default.aspx\")` 代码的六个引用更新为 `Response.Redirect(\"~/Contacts/Default.aspx\")`：  \n    - *Delete.aspx.cs*\n    - *Edit.aspx.cs*\n    - *Insert.aspx.cs*  \n\n    现在，当你显示和更新联系人数据时，这些链接都可正常工作。\n5. 若要限制对 *Admin* 文件夹的访问，请在“解决方案资源管理器”中右键单击 *Admin* 文件夹，然后选择“添加新项”。\n6. 从 Visual C# Web 模板列表中，从中间列表中选择“Web 配置文件”，接受 *Web.config* 的默认名称，然后选择“添加”。\n7. 将 *Web.config* 文件中的现有 XML 内容替换为以下内容：\n    <pre class=\"prettyprint\">\n&lt;?xml version=\"1.0\"?>\n&lt;configuration>\n  &lt;system.web>\n    &lt;authorization>\n      &lt;allow roles=\"canEdit\"/>\n      &lt;deny users=\"*\"/>\n    &lt;/authorization>\n  &lt;/system.web>\n&lt;/configuration>\n</pre>\n8. 保存 *Web.config* 文件。*Web.config* 文件指定只有分配给“canEdit”角色的用户才能访问 *Admin* 文件夹中包含的页。 \n\n如果不属于“canEdit”角色的用户尝试修改数据，则系统会将他们重定向到“登录”页。\n\n##<a name=\"Deploy-the-Application-with-the-Database-to-Azure\"></a>将包含数据库的应用程序部署到 Azure \n Web 应用现已完成，你可以将其发布到 Azure。\n\n###发布应用程序 \n1. 在 Visual Studio 中生成项目（“Ctrl+Shift+B”）\n2. 在“解决方案资源管理器”中，右键单击该项目并选择“发布”。![发布菜单选项](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms22.png) 此时将显示“发布 Web”对话框。![“发布 Web”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms22a.png)  \n3. 从“配置文件”选项卡中，选择“导入”（如果尚未导入）。 \n4. 选择已经下载好的“发布配置文件”。\n6. 单击“设置”选项卡。![选择“现有 Web 应用”对话框](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms26.png)  \n7. 将“配置”下拉框设置为“调试”。\n8. 单击“ApplicationDbContext”旁边的“向下箭头”图标，并将其设置为“ContactDB”。\n9. 选中“执行 Code First 迁移”复选框。在此示例中，仅当首次发布应用程序时才应选中此复选框。这样，便只会调用 *Configuration.cs* 文件中的 *Seed* 方法一次。  \n\n10. 然后，单击“发布”。你的应用程序将发布到 Azure。\n\n>[AZURE.NOTE]如果在创建发布配置文件后关闭再重新打开 Visual Studio，你可能在下拉列表中看不到连接字符串。在这种情况下，请不要编辑前面创建的发布配置文件，而是像先前一样创建一个新的配置文件，然后在“设置”选项卡遵循以下步骤。\n\n###在 Azure 中查看应用程序 \n1. 在浏览器中，单击“联系人演示”链接。此时将显示“联系人列表”。![浏览器中列出的联系人](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms27.png)  \n\n2. 在“联系人列表”页上选择“新建”。![浏览器中列出的联系人](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms29.png) 你将被重定向到“登录”页，因为你尚未使用可修改联系人的帐户登录。\n3. 在输入以下电子邮件和密码后，请单击“登录”按钮。“电子邮件”：`canEditUser@wideworldimporters.com`“密码”：`Pa$$word1`![登录页](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms28.png)  \n\n4. 为每个字段输入新数据，然后按“插入”按钮。![添加新联系人页](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms30.png) *EditContactList.aspx* 页中将显示新记录。![添加新联系人页](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms31.png)\n\n5. 选择“注销”链接。\n\n###停止应用程序 \n为了防止其他人注册和使用你的示例应用程序，你可以停止该 Web 应用。\n\n1. 在 Visual Studio 中，从“视图菜单”选择“服务器资源管理器”。 \n2. 在“服务器资源管理器”中，导航到“ Web 应用”。\n3. 右键单击每个 Web 应用实例并选择“停止 Web 应用”。![停止 Web 应用菜单项](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms26a.png)  \n\n    或者，也可以从 Azure 管理门户中选择该 Web 应用，然后单击页面底部的“停止”图标。![添加新联系人页](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms26b.png)\n\n##<a name=\"Review-the-Database\"></a>查看数据库 \n必须知道如何直接查看和修改数据库。如果知道如何直接处理数据库，就可以确认数据库中的数据，同时了解数据在每个表中的存储方式。\n\n###检查 SQL Azure 数据库 \n1. 在 Visual Studio 中打开“服务器资源管理器”并导航到“ContactDB”。\n2. 右键单击“ContactDB”并选择“在 SQL Server 对象资源管理器中打开”。![“在 SQL Server 对象资源管理器中打开”菜单项](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms32.png)  \n3. 如果显示了“添加防火墙规则”对话框，请选择“添加防火墙规则”。如果无法从 Visual Studio 展开“SQL 数据库”并且无法查看“ContactDB”，你可以按照说明打开一个或一系列防火墙端口。为此，请遵照 [MVC 教程](/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database)结尾处的“设置 Azure 防火墙规则”下的说明操作。或者，你也可以通过在本地生成、运行应用程序并在其中添加数据（在 Visual Studio 中按“CTRL+F5”）查看本地数据库的数据。  \n\n4. 如果显示了“连接到服务器”对话框，请输入在本教程开头创建的“密码”，然后按“连接”按钮。如果你不记得密码，可以在本地项目文件中找到它。在“解决方案资源管理器”中展开 *Properties* 文件夹，然后展开 *PublishProfiles* 文件夹。打开 *contactmanager.pubxml* 文件（你的文件可能具有不同的名称）。搜索发布密码的文件。\n\n5. 展开“contactDB”数据库，然后展开“表”。\n6. 右键单击“dbo.AspNetUsers”表并选择“查看数据”。![“查看数据”菜单项](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms34.png) 你可以查看与 canEditUser@contoso.com 用户关联的数据。![ContactManager 窗口](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms35.png)  \n\n###通过编辑数据库将用户添加到管理员角色 \n在本教程的前面部分，你使用代码将用户添加到了 canEdit 角色。一种替代方法是直接操作成员资格表中的数据。以下步骤说明如何使用此替代方法将用户添加到角色。\n\n1. 在“SQL Server 对象资源管理器”中，右键单击“dbo.AspNetUserRoles”，然后选择“查看数据”。![AspNetUserRoles 数据](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms36.png)  \n2. 复制 *RoleId* 并将其粘贴到空（新）行中。![AspNetUserRoles 数据](./media/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/SecureWebForms37.png)  \n3. 在“dbo.AspNetUsers”表中，找到你要放入角色的用户并复制该用户的 *Id*。\n4. 将复制的 *Id* 粘贴到“AspNetUserRoles”表中新行的“UserId”字段内。  \n\n>[AZURE.NOTE]我们正在开发可显著简化用户和角色管理的工具。\n\n##<a name=\"Next-Steps\"></a>后续步骤\n有关 ASP.NET Web 窗体的详细信息，请参阅 ASP.NET Web 应用上的 [了解 ASP.NET Web 窗体](http://www.asp.net/web-forms)和 [Azure 教程和指南](/documentation/services/web-sites/#net)。\n\n本教程基于 Rick Anderson 在 Tom Dykstra 和 Barry Dorrans 的帮助下编写的 MVC 教程[创建包含身份验证和 SQL 数据库的 ASP.NET MVC 应用并部署到 Azure  Web 应用](/documentation/articles/web-sites-dotnet-deploy-aspnet-mvc-app-membership-oauth-sql-database)。\n\n请提供有关你喜欢的内容或者你希望看到改善的内容的反馈，不仅关于教程本身，也关于它所演示的产品。你的反馈将帮助我们确定优先改进哪些方面。你还可以在[教我编写代码](http://aspnet.uservoice.com/forums/228522-show-me-how-with-code)上请求帮助以及对新主题投票。\n\n \n\n<!---HONumber=71-->"
}