{
  "nodes": [
    {
      "content": "服务总线体系结构 | Azure",
      "pos": [
        27,
        43
      ]
    },
    {
      "content": "介绍 Azure 服务总线的消息处理体系结构。",
      "pos": [
        61,
        84
      ]
    },
    {
      "content": "服务总线体系结构",
      "pos": [
        297,
        305
      ]
    },
    {
      "content": "本文介绍 Azure 服务总线的消息处理体系结构。",
      "pos": [
        307,
        332
      ]
    },
    {
      "content": "服务总线缩放单位",
      "pos": [
        337,
        345
      ]
    },
    {
      "pos": [
        347,
        407
      ],
      "content": "服务总线按<bpt id=\"p1\">*</bpt>缩放单位<ept id=\"p1\">*</ept>进行组织。缩放单位是部署单位，包含运行服务所需的全部组件。每个区域部署一个或多个服务总线缩放单位。"
    },
    {
      "content": "一个服务总线命名空间映射到一个缩放单位。缩放单位处理所有类型的服务总线实体：中继和中转消息实体（队列、主题、订阅）。服务总线缩放单位由以下组件构成：",
      "pos": [
        409,
        483
      ]
    },
    {
      "pos": [
        487,
        541
      ],
      "content": "<bpt id=\"p1\">**</bpt>一组网关节点。<ept id=\"p1\">**</ept> 网关节点对传入请求进行身份验证并处理中继请求。每个网关节点都有一个公共 IP 地址。"
    },
    {
      "pos": [
        545,
        577
      ],
      "content": "<bpt id=\"p1\">**</bpt>一组消息代理节点。<ept id=\"p1\">**</ept> 消息代理节点处理有关消息实体的请求。"
    },
    {
      "pos": [
        581,
        613
      ],
      "content": "<bpt id=\"p1\">**</bpt>一组通知节点。<ept id=\"p1\">**</ept> 通知节点向所有已注册的设备发送推送通知。"
    },
    {
      "pos": [
        617,
        676
      ],
      "content": "<bpt id=\"p1\">**</bpt>一个网关存储。<ept id=\"p1\">**</ept> 网关存储保存此缩放单位中定义的每个实体的数据。网关存储在 SQL Azure 数据库顶层实施。"
    },
    {
      "pos": [
        680,
        929
      ],
      "content": "<bpt id=\"p1\">**</bpt>多个消息存储。<ept id=\"p1\">**</ept> 消息存储保存此缩放单位中定义的所有队列、主题和订阅的消息。它还包含所有订阅数据。除非启用了<bpt id=\"p2\">[</bpt>分区消息实体<ept id=\"p2\">](/documentation/articles/service-bus-partitioning)</ept>，否则队列或主题将映射到一个消息存储。订阅是存储在与其父主题相同的消息存储中。除了服务总线<bpt id=\"p3\">[</bpt>高级消息传送<ept id=\"p3\">](/documentation/articles/service-bus-premium-messaging)</ept>外，消息存储在 SQL Azure 数据库顶层实施。"
    },
    {
      "pos": [
        933,
        996
      ],
      "content": "<bpt id=\"p1\">**</bpt>多个注册存储。<ept id=\"p1\">**</ept> 注册存储包含此缩放单位中定义的所有通知中心的设备注册。注册存储在 SQL Azure 数据库顶层实施。"
    },
    {
      "content": "容器",
      "pos": [
        1001,
        1003
      ]
    },
    {
      "content": "将为每个消息实体分配特定的容器。容器是一种逻辑构造，它刚好使用一个消息存储来存储此容器的所有相关数据。将为每个容器分配一个消息代理节点。通常，容器比消息代理节点要多。因此，每个消息代理节点将加载多个容器。消息代理节点的容器分配经过适当的组织，可以均衡加载所有消息代理节点。如果加载模式发生更改（例如其中一个容器变得十分繁忙），或消息代理节点暂时不可用，则会在消息代理节点之间重新分配容器。",
      "pos": [
        1005,
        1199
      ]
    },
    {
      "content": "处理传入消息请求",
      "pos": [
        1204,
        1212
      ]
    },
    {
      "content": "当客户端向服务总线发送请求时，Azure 负载平衡器将其路由到任何一个网关节点。网关节点将为请求授权。如果该请求涉及到某个消息实体（队列、主题、订阅），则网关节点将在网关存储中查找该实体，并判断实体位于哪个消息存储中。然后，它将查询哪些消息代理节点目前正在为此容器提供服务，并将请求发送到该消息代理节点。消息代理节点将处理请求并更新容器存储中的实体状态。然后，消息代理节点向网关节点发送响应，而网关节点向发出原始请求的客户端发送相应的响应。",
      "pos": [
        1214,
        1434
      ]
    },
    {
      "content": "处理传入消息请求",
      "pos": [
        1438,
        1446
      ]
    },
    {
      "content": "处理传入中继请求",
      "pos": [
        1499,
        1507
      ]
    },
    {
      "content": "当客户端向服务总线发送请求时，Azure 负载平衡器将其路由到任何一个网关节点。如果请求为侦听请求，网关节点将创建新的中继。如果请求是对特定中继的连接请求，网关节点会将连接请求转发给拥有中继的网关节点。拥有中继的网关节点向侦听客户端发送会合请求，要求侦听器与接收连接请求的网关节点创建一个临时通道。",
      "pos": [
        1509,
        1658
      ]
    },
    {
      "content": "建立中继连接后，客户端可以通过用于会合的网关节点交换消息。",
      "pos": [
        1660,
        1689
      ]
    },
    {
      "content": "处理传入中继请求",
      "pos": [
        1693,
        1701
      ]
    },
    {
      "content": "处理传入通知中心请求",
      "pos": [
        1754,
        1764
      ]
    },
    {
      "content": "当客户端向服务总线发送请求时，Azure 负载平衡器将其路由到任何一个网关节点。如果请求是现有通知中心的设备注册，网关节点会将注册写入注册存储，并向调用设备发送回复。如果请求是通知消息，网关节点将消息排入通知队列。其中一个通知节点将在通知队列中取消消息排队，并将该消息发送到注册存储中注册的所有设备。如果某个消息要由许多设备接收，则多个通知节点会参与将消息发送到设备的操作。",
      "pos": [
        1766,
        1953
      ]
    },
    {
      "content": "处理传入通知中心请求",
      "pos": [
        1957,
        1967
      ]
    },
    {
      "content": "后续步骤",
      "pos": [
        2020,
        2024
      ]
    },
    {
      "content": "在阅读有关服务总线工作原理的概述后，请访问以下链接：",
      "pos": [
        2026,
        2052
      ]
    },
    {
      "content": "服务总线消息传送概述",
      "pos": [
        2057,
        2067
      ]
    },
    {
      "content": "服务总线基础知识",
      "pos": [
        2128,
        2136
      ]
    },
    {
      "content": "使用服务总线队列的队列消息解决方案",
      "pos": [
        2208,
        2225
      ]
    }
  ],
  "content": "<properties \n   pageTitle=\"服务总线体系结构 | Azure\"\n   description=\"介绍 Azure 服务总线的消息处理体系结构。\"\n   services=\"service-bus\"\n   documentationCenter=\"na\"\n   authors=\"sethmanheim\"\n   manager=\"timlt\"\n   editor=\"tysonn\" />\n<tags \n   ms.service=\"service-bus\"\n   ms.date=\"11/06/2015\"\n   wacn.date=\"12/17/2015\" />\n\n# 服务总线体系结构\n\n本文介绍 Azure 服务总线的消息处理体系结构。\n\n## 服务总线缩放单位\n\n服务总线按*缩放单位*进行组织。缩放单位是部署单位，包含运行服务所需的全部组件。每个区域部署一个或多个服务总线缩放单位。\n\n一个服务总线命名空间映射到一个缩放单位。缩放单位处理所有类型的服务总线实体：中继和中转消息实体（队列、主题、订阅）。服务总线缩放单位由以下组件构成：\n\n- **一组网关节点。** 网关节点对传入请求进行身份验证并处理中继请求。每个网关节点都有一个公共 IP 地址。\n\n- **一组消息代理节点。** 消息代理节点处理有关消息实体的请求。\n\n- **一组通知节点。** 通知节点向所有已注册的设备发送推送通知。\n\n- **一个网关存储。** 网关存储保存此缩放单位中定义的每个实体的数据。网关存储在 SQL Azure 数据库顶层实施。\n\n- **多个消息存储。** 消息存储保存此缩放单位中定义的所有队列、主题和订阅的消息。它还包含所有订阅数据。除非启用了[分区消息实体](/documentation/articles/service-bus-partitioning)，否则队列或主题将映射到一个消息存储。订阅是存储在与其父主题相同的消息存储中。除了服务总线[高级消息传送](/documentation/articles/service-bus-premium-messaging)外，消息存储在 SQL Azure 数据库顶层实施。\n\n- **多个注册存储。** 注册存储包含此缩放单位中定义的所有通知中心的设备注册。注册存储在 SQL Azure 数据库顶层实施。\n\n## 容器\n\n将为每个消息实体分配特定的容器。容器是一种逻辑构造，它刚好使用一个消息存储来存储此容器的所有相关数据。将为每个容器分配一个消息代理节点。通常，容器比消息代理节点要多。因此，每个消息代理节点将加载多个容器。消息代理节点的容器分配经过适当的组织，可以均衡加载所有消息代理节点。如果加载模式发生更改（例如其中一个容器变得十分繁忙），或消息代理节点暂时不可用，则会在消息代理节点之间重新分配容器。\n\n## 处理传入消息请求\n\n当客户端向服务总线发送请求时，Azure 负载平衡器将其路由到任何一个网关节点。网关节点将为请求授权。如果该请求涉及到某个消息实体（队列、主题、订阅），则网关节点将在网关存储中查找该实体，并判断实体位于哪个消息存储中。然后，它将查询哪些消息代理节点目前正在为此容器提供服务，并将请求发送到该消息代理节点。消息代理节点将处理请求并更新容器存储中的实体状态。然后，消息代理节点向网关节点发送响应，而网关节点向发出原始请求的客户端发送相应的响应。\n\n![处理传入消息请求](./media/service-bus-architecture/IC690644.png)\n\n## 处理传入中继请求\n\n当客户端向服务总线发送请求时，Azure 负载平衡器将其路由到任何一个网关节点。如果请求为侦听请求，网关节点将创建新的中继。如果请求是对特定中继的连接请求，网关节点会将连接请求转发给拥有中继的网关节点。拥有中继的网关节点向侦听客户端发送会合请求，要求侦听器与接收连接请求的网关节点创建一个临时通道。\n\n建立中继连接后，客户端可以通过用于会合的网关节点交换消息。\n\n![处理传入中继请求](./media/service-bus-architecture/IC690645.png)\n\n## 处理传入通知中心请求\n\n当客户端向服务总线发送请求时，Azure 负载平衡器将其路由到任何一个网关节点。如果请求是现有通知中心的设备注册，网关节点会将注册写入注册存储，并向调用设备发送回复。如果请求是通知消息，网关节点将消息排入通知队列。其中一个通知节点将在通知队列中取消消息排队，并将该消息发送到注册存储中注册的所有设备。如果某个消息要由许多设备接收，则多个通知节点会参与将消息发送到设备的操作。\n\n![处理传入通知中心请求](./media/service-bus-architecture/IC690646.png)\n\n## 后续步骤\n\n在阅读有关服务总线工作原理的概述后，请访问以下链接：\n\n- [服务总线消息传送概述](/documentation/articles/service-bus-messaging-overview)\n- [服务总线基础知识](/documentation/articles/service-bus-fundamentals-hybrid-solutions)\n- [使用服务总线队列的队列消息解决方案](/documentation/articles/service-bus-dotnet-multi-tier-app-using-service-bus-queues)\n\n<!---HONumber=Mooncake_1207_2015-->"
}