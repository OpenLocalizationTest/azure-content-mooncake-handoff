{
  "nodes": [
    {
      "content": "How to useAzure CDN Management Portal advanced features - Azure feature guide",
      "pos": [
        78,
        155
      ]
    },
    {
      "content": "Learn how to use advanced features of Azure CDN management portal to manage CDN endpoint",
      "pos": [
        296,
        384
      ]
    },
    {
      "content": "Azure CDN 管理门户使用指南",
      "pos": [
        573,
        591
      ]
    },
    {
      "content": "[AZURE.SELECTOR]",
      "pos": [
        595,
        611
      ]
    },
    {
      "content": "中文版",
      "pos": [
        615,
        618
      ]
    },
    {
      "content": "English Version",
      "pos": [
        681,
        696
      ]
    },
    {
      "content": "Azure 内容传送网络 (CDN) 通过遍布在中国大陆的众多物理节点上缓存Azure平台上的Storage Blob，Cloud Service和WebSites的静态内容，为开发人员提供一个传送高带宽内容的解决方案。目前本CDN服务也同时支持没有部署在Azure平台上的源站。",
      "pos": [
        762,
        902
      ]
    },
    {
      "pos": [
        904,
        967
      ],
      "content": "有关 Azure CDN 的详细信息和价格，请参阅 <bpt id=\"p1\">[</bpt>Azure CDN服务介绍<ept id=\"p1\">](/home/features/cdn/)</ept>。"
    },
    {
      "content": "概览",
      "pos": [
        972,
        974
      ]
    },
    {
      "content": "域名管理",
      "pos": [
        987,
        991
      ]
    },
    {
      "content": "流量报表",
      "pos": [
        1004,
        1008
      ]
    },
    {
      "content": "带宽报表",
      "pos": [
        1021,
        1025
      ]
    },
    {
      "content": "缓存刷新",
      "pos": [
        1038,
        1042
      ]
    },
    {
      "content": "内容预取",
      "pos": [
        1055,
        1059
      ]
    },
    {
      "content": "日志下载",
      "pos": [
        1072,
        1076
      ]
    },
    {
      "content": "服务检查",
      "pos": [
        1089,
        1093
      ]
    },
    {
      "pos": [
        1107,
        1144
      ],
      "content": "<bpt id=\"p1\">**</bpt>Azure CDN管理页面概览<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step1\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "本页面显示了您的CDN订阅账号的基本信息。",
      "pos": [
        1146,
        1167
      ]
    },
    {
      "content": "共有加速域名",
      "pos": [
        1183,
        1189
      ]
    },
    {
      "content": "当前Azure订阅下已经创建的加速域名的统计数字。",
      "pos": [
        1193,
        1218
      ]
    },
    {
      "content": "已启用加速域名",
      "pos": [
        1226,
        1233
      ]
    },
    {
      "content": "当前Azure订阅下目前处于启用状态的加速域名的统计数字。",
      "pos": [
        1237,
        1266
      ]
    },
    {
      "content": "当月总流量",
      "pos": [
        1274,
        1279
      ]
    },
    {
      "content": "当前Azure订阅下本月所有的加速域名使用的流量总和，单位是MB.",
      "pos": [
        1283,
        1316
      ]
    },
    {
      "content": "当月流量",
      "pos": [
        1324,
        1328
      ]
    },
    {
      "content": "当前Azure订阅下当月每天的流量信息，单位是MB。 如果您需要了更详细的流量信息，可以在左侧的导航窗格中单击 “流量报表”，进入流量统计报表页面。",
      "pos": [
        1332,
        1406
      ]
    },
    {
      "content": "当月带宽",
      "pos": [
        1415,
        1419
      ]
    },
    {
      "content": "当月每天的峰值带宽信息，单位是Kb/s。 如果您需要了解更详细的带宽信息，可以在左侧的导航窗格中单击 “带宽报表”，进入带宽统计报表页面。",
      "pos": [
        1422,
        1491
      ]
    },
    {
      "pos": [
        1503,
        1529
      ],
      "content": "<bpt id=\"p1\">**</bpt>域名管理<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step2\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "pos": [
        1531,
        1675
      ],
      "content": "单击左侧导航窗格中 “域名管理”时，将显示当前Azure订阅下已经创建的所有CDN加速域名的列表视图。 你可以通过Azure订阅下拉列表选择不同的订阅查看不同订阅下的CDN加速域名信息。同时可以对加速域名进行<bpt id=\"p1\">**</bpt>“修改配置”<ept id=\"p1\">**</ept>，<bpt id=\"p2\">**</bpt>“缓存规则配置”<ept id=\"p2\">**</ept>和<bpt id=\"p3\">**</bpt>“访问控制管理”<ept id=\"p3\">**</ept>等操作。"
    },
    {
      "content": "加速域名列表视图",
      "pos": [
        1683,
        1691
      ]
    },
    {
      "content": "域名列表视图包括：",
      "pos": [
        1710,
        1719
      ]
    },
    {
      "content": "加速域名，用于访问CDN缓存内容的域名，该域名必须有相应的ICP备案信息。",
      "pos": [
        1727,
        1764
      ]
    },
    {
      "pos": [
        1769,
        1814
      ],
      "content": "CDN 域名，由Azure CDN平台提供，都是以 <bpt id=\"p1\">**</bpt>.mschcdn.com<ept id=\"p1\">**</ept>结尾。"
    },
    {
      "content": "源站地址，CDN所缓存内容的原始位置。",
      "pos": [
        1819,
        1838
      ]
    },
    {
      "content": "加速类型 （目前支持“网站加速”，“下载加速”，“HTTP点播加速”和“流媒体直播加速”）",
      "pos": [
        1843,
        1888
      ]
    },
    {
      "pos": [
        1893,
        1934
      ],
      "content": "状态，开启或者关闭（包括ICP审核，需要CNAME配置，禁用等非<bpt id=\"p1\">**</bpt>开启<ept id=\"p1\">**</ept>状态）"
    },
    {
      "pos": [
        1937,
        1998
      ],
      "content": "**注意**\n您需要在CDN服务生效后（60分钟内），对你的加速域名配置CNAME映射信息，映射到微软提供的CDN域名。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "您需要在CDN服务生效后（60分钟内），对你的加速域名配置CNAME映射信息，映射到微软提供的CDN域名。",
          "pos": [
            7,
            60
          ]
        }
      ]
    },
    {
      "pos": [
        2001,
        2036
      ],
      "content": "**注意**\n只有状态为**开启**的域名才可以正常使用CDN服务。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "只有状态为<bpt id=\"p1\">**</bpt>开启<ept id=\"p1\">**</ept>的域名才可以正常使用CDN服务。",
          "pos": [
            7,
            34
          ]
        }
      ]
    },
    {
      "content": "缓存规则配置视图",
      "pos": [
        2045,
        2053
      ]
    },
    {
      "content": "如上图，系统会根据缓存规则设置默认规则。用户可以根据需求加以调整。用户规则优先匹配，如果用户规则未命中，则逐条执行系统默认缓存规则。",
      "pos": [
        2066,
        2132
      ]
    },
    {
      "content": "缓存规则配置",
      "pos": [
        2142,
        2148
      ]
    },
    {
      "content": "用户点击“配置缓存规则”后，可以根据需求设置对域名的缓存规则，包括：",
      "pos": [
        2152,
        2186
      ]
    },
    {
      "content": "根据目录进行配置",
      "pos": [
        2190,
        2198
      ]
    },
    {
      "pos": [
        2204,
        2280
      ],
      "content": "目录必须以 \"/\" 开头，比如： \"/pic\", \"/doc\", \"/htdoc/data\" 等等。后台会匹配指定目录下的所有文件，<bpt id=\"p1\">**</bpt>包括子目录<ept id=\"p1\">**</ept>。"
    },
    {
      "content": "根据文件后缀配置",
      "pos": [
        2284,
        2292
      ]
    },
    {
      "pos": [
        2298,
        2378
      ],
      "content": "常用文件后缀名，比如：\"jpg\", \"png\", \"gif\", \"txt\", \"m4v\", \"mp3\" 等等。后台会匹配 <bpt id=\"p1\">**</bpt>所有文件夹下<ept id=\"p1\">**</ept> 指定的文件后缀。"
    },
    {
      "content": "根据全路径配置",
      "pos": [
        2382,
        2389
      ]
    },
    {
      "pos": [
        2395,
        2476
      ],
      "content": "用来指定 <bpt id=\"p1\">**</bpt>一个文件<ept id=\"p1\">**</ept>，必须以 \"/\" 开头。比如：\"/sites/doc/example.doc\"。<bpt id=\"p2\">**</bpt>注意<ept id=\"p2\">**</ept>：如果用户填的全路径是\"/\"，则它匹配首页。"
    },
    {
      "pos": [
        2479,
        2571
      ],
      "content": "**注意**\n用户填写配置规则时，字符串中不要包含 “{”, “}”, “(”, “)”, “[”, “]”, “.”, “?\", “*”, “\\”, “^”, “$” 等特殊字符。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "用户填写配置规则时，字符串中不要包含 “{”, “}”, “(”, “)”, “[”, “]”, “.”, “?\", “*”, “\\”, “^”, “$” 等特殊字符。",
          "pos": [
            7,
            91
          ]
        }
      ]
    },
    {
      "pos": [
        2574,
        2594
      ],
      "content": "**注意**\n时间填为0表示禁止缓存。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "时间填为0表示禁止缓存。",
          "pos": [
            7,
            19
          ]
        }
      ]
    },
    {
      "content": "缓存配置顺序",
      "pos": [
        2603,
        2609
      ]
    },
    {
      "pos": [
        2613,
        2667
      ],
      "content": "系统根据配置顺序<bpt id=\"p1\">**</bpt>逐条匹配<ept id=\"p1\">**</ept>，最先配置的规则具有最高优先级。规则被匹配后，其后的规则<bpt id=\"p2\">**</bpt>不再<ept id=\"p2\">**</ept>被匹配。"
    },
    {
      "content": "预定义模板",
      "pos": [
        2676,
        2681
      ]
    },
    {
      "content": "用户可以通过 “应用预定义模板” 快速创建缓存配置规则。上图列出了用户选中“应用预定义模板”后，选择“常见文件”后创建的一个规则。用户可以根据需求对自动创建的规则进行修改。",
      "pos": [
        2685,
        2771
      ]
    },
    {
      "content": "禁止缓存设置",
      "pos": [
        2780,
        2786
      ]
    },
    {
      "content": "勾选“设置为禁止缓存”，则该加速域名将不会被缓存。",
      "pos": [
        2790,
        2815
      ]
    },
    {
      "content": "访问控制管理",
      "pos": [
        2824,
        2830
      ]
    },
    {
      "content": "通过访问控制管理，用户可以设置配置Referer黑白名单，从而实现防盗链。",
      "pos": [
        2834,
        2871
      ]
    },
    {
      "content": "当防盗链开启之后，便可以编辑外链规则。每条规则是一个路径和文件名的组合。比如/ *.png表示根目录下所有的png文件。",
      "pos": [
        2881,
        2941
      ]
    },
    {
      "content": "每条规则是一个路径和文件名的组合。比如/ *.png表示根目录下所有的png文件。",
      "pos": [
        2943,
        2984
      ]
    },
    {
      "content": "如果设置了黑名单，那么当Referer在黑名单里面的时候，不允许访问，其他情况可以访问。",
      "pos": [
        2988,
        3032
      ]
    },
    {
      "content": "如果设置了白名单，那么只有当Referer是白名单中的域名时，才可以访问 。",
      "pos": [
        3035,
        3073
      ]
    },
    {
      "content": "点击“提交”按钮之后，等待操作结束，会显示操作是否成功。如果点击“提交并关闭”按钮，那么对话框会立即关闭。当用户下次再打开对话框时，会显示上次操作的状态。",
      "pos": [
        3075,
        3152
      ]
    },
    {
      "pos": [
        3157,
        3185
      ],
      "content": "<bpt id=\"p1\">**</bpt>流量统计报表<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step3\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "pos": [
        3187,
        3271
      ],
      "content": "你可以选择要查询的订阅（单选）、时间范围、加速域名（单个域名或全部），单击<bpt id=\"p1\">**</bpt>刷新<ept id=\"p1\">**</ept>按钮后界面将显示符合条件的流量统计报表，数据格式及含义请参见实际页面中的详细说明。"
    },
    {
      "content": "流量统计报表具有以下功能：",
      "pos": [
        3283,
        3296
      ]
    },
    {
      "content": "有多个Azure 订阅的用户，可以查看单个订阅的流量以及回源流量统计。",
      "pos": [
        3304,
        3339
      ]
    },
    {
      "content": "有多个加速域名的Azure订阅，可以查询单个加速域名流量（以及回源流量）统计结果和所有加速域名流量（以及回源流量）汇总。",
      "pos": [
        3344,
        3404
      ]
    },
    {
      "content": "最小查询粒度精确到小时。",
      "pos": [
        3409,
        3421
      ]
    },
    {
      "content": "提供多种查询时间范围。 用户可以查询最近24小时，昨天，今天，最近七天，最近十五天，最近三十天和上个月的流量统计。也可以选择查询某个特定的时间段的流量以及回源流量 （统计时间范围不超过九十天）。",
      "pos": [
        3426,
        3523
      ]
    },
    {
      "pos": [
        3528,
        3556
      ],
      "content": "<bpt id=\"p1\">**</bpt>带宽统计报表<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step4\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "pos": [
        3558,
        3637
      ],
      "content": "选择要查询的订阅（单选）、时间范围、加速域名（单选和全部），单击<bpt id=\"p1\">**</bpt>刷新<ept id=\"p1\">**</ept>按钮后界面将显示符合条件的带宽统计报表，数据格式及含义请参见实际页面中的详细说明。"
    },
    {
      "content": "带宽统计报表具有以下功能：",
      "pos": [
        3649,
        3662
      ]
    },
    {
      "content": "有多个Azure 订阅的用户，可以查询单个订阅的带宽统计和回源带宽统计。",
      "pos": [
        3670,
        3706
      ]
    },
    {
      "content": "有多个加速域名的Azure订阅，可以查询单个加速域名带宽（以及回源带宽）统计结果和所有加速域名带宽（以及回源带宽）汇总。",
      "pos": [
        3711,
        3771
      ]
    },
    {
      "content": "最小查询粒度精确到小时。",
      "pos": [
        3776,
        3788
      ]
    },
    {
      "content": "显示带宽峰值出现时间。",
      "pos": [
        3793,
        3804
      ]
    },
    {
      "content": "提供多种查询时间范围灵活选择。 你可以查询最近24小时，昨天，今天，最近七天，最近十五天，最近三十天和上个月的带宽统计。也可以选择查询某个特定的时间段的带宽（统计时间范围不超过九十天）。",
      "pos": [
        3809,
        3902
      ]
    },
    {
      "pos": [
        3907,
        3933
      ],
      "content": "<bpt id=\"p1\">**</bpt>缓存刷新<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step5\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "单击左侧导航窗格中“缓存刷新”，可以对指定的文件或者目录进行手动刷新。",
      "pos": [
        3935,
        3970
      ]
    },
    {
      "content": "缓存刷新列表视图",
      "pos": [
        3978,
        3986
      ]
    },
    {
      "pos": [
        3990,
        4071
      ],
      "content": "选择要查询的订阅（单选）、状态、时间范围、加速域名（单选），单击<bpt id=\"p1\">**</bpt>查询刷新结果<ept id=\"p1\">**</ept>后界面将显示符合条件的缓存刷新记录，数据格式及含义请参见实际页面中的详细说明。"
    },
    {
      "content": "缓存刷新列表视图包括：",
      "pos": [
        4088,
        4099
      ]
    },
    {
      "content": "加速域名，用于访问CDN缓存内容的URL",
      "pos": [
        4107,
        4127
      ]
    },
    {
      "content": "状态 (常见状态：成功，失败，刷新中）",
      "pos": [
        4132,
        4151
      ]
    },
    {
      "content": "提交时间",
      "pos": [
        4156,
        4160
      ]
    },
    {
      "content": "检测时间",
      "pos": [
        4165,
        4169
      ]
    },
    {
      "content": "如果缓存刷新规则提交成功，状态栏会显示成功字样。如果失败的话，需要检查的缓存刷新规则是否正确。如果有问题，需要重新创建并提交缓存刷新规则。",
      "pos": [
        4171,
        4240
      ]
    },
    {
      "content": "缓存刷新规则提交",
      "pos": [
        4248,
        4256
      ]
    },
    {
      "content": "既可以对单个文件，也可以对一个目录下的所有文件配置缓存刷新规则。",
      "pos": [
        4260,
        4292
      ]
    },
    {
      "content": "文件缓存刷新规则提交",
      "pos": [
        4301,
        4311
      ]
    },
    {
      "content": "此任务包括下列步骤：",
      "pos": [
        4323,
        4333
      ]
    },
    {
      "content": "单击 “提交文件刷新”按钮，进入文件刷新视图。",
      "pos": [
        4338,
        4361
      ]
    },
    {
      "content": "在“文件刷新”对话框中，从加速域名列表中选取你要配置的域名，输入相应文件路径。",
      "pos": [
        4365,
        4404
      ]
    },
    {
      "content": "你可以单击“+”增加新的规则，也可以单击“x”来删除对应的文件。",
      "pos": [
        4408,
        4440
      ]
    },
    {
      "content": "单击“提交”。",
      "pos": [
        4444,
        4451
      ]
    },
    {
      "content": "这样，新建的文件缓存规则就会显示在缓存刷新列表视图中。",
      "pos": [
        4453,
        4480
      ]
    },
    {
      "pos": [
        4483,
        4539
      ],
      "content": "**注意**\n当加速域名尚未ICP验证通过时，无法进行文件刷新操作，加速域名下拉列表为空。请等待后台验证通过。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "当加速域名尚未ICP验证通过时，无法进行文件刷新操作，加速域名下拉列表为空。请等待后台验证通过。",
          "pos": [
            7,
            55
          ]
        }
      ]
    },
    {
      "content": "目录缓存刷新规则提交",
      "pos": [
        4548,
        4558
      ]
    },
    {
      "content": "此任务包括下列步骤：",
      "pos": [
        4571,
        4581
      ]
    },
    {
      "content": "单击 “提交目录刷新”按钮，进入目录刷新视图。",
      "pos": [
        4586,
        4609
      ]
    },
    {
      "content": "在“目录刷新”对话框中，从加速域名列表中选取你要配置的域名，输入相应目录路径。",
      "pos": [
        4613,
        4652
      ]
    },
    {
      "content": "你可以单击“+”增加新的规则，也可以单击“x”来删除对应的目录。",
      "pos": [
        4656,
        4688
      ]
    },
    {
      "content": "单击“提交”。",
      "pos": [
        4692,
        4699
      ]
    },
    {
      "content": "这样，新建的目录缓存规则就会显示在缓存刷新列表视图中",
      "pos": [
        4701,
        4727
      ]
    },
    {
      "pos": [
        4732,
        4758
      ],
      "content": "<bpt id=\"p1\">**</bpt>内容预取<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step6\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "单击左侧的导航窗格中 “内容预取”，可以对指定的文件进行内容预取和预取进度查询操作。",
      "pos": [
        4759,
        4801
      ]
    },
    {
      "content": "内容预取是指预先将指定URL的内容从源站缓存到CDN节点，这样可以消除用户第一次访问该资源时的等待时间。内容预取一般被用在进行大文件分发时的场景，可以有效的提升用户访问体验。",
      "pos": [
        4803,
        4890
      ]
    },
    {
      "content": "内容预取列表视图",
      "pos": [
        4899,
        4907
      ]
    },
    {
      "pos": [
        4911,
        4993
      ],
      "content": "可以选择要查询的订阅（单选）、状态、时间范围、加速域名（单选），单击<bpt id=\"p1\">**</bpt>查询预取结果<ept id=\"p1\">**</ept>后界面将显示符合条件的预缓存记录，数据格式及含义请参见实际页面中的详细说明。"
    },
    {
      "content": "内容预取列表视图包括：",
      "pos": [
        5011,
        5022
      ]
    },
    {
      "content": "加速域名，用于访问CDN缓存内容的URL",
      "pos": [
        5030,
        5050
      ]
    },
    {
      "content": "状态 （常见状态：成功，失败，进行中）",
      "pos": [
        5055,
        5074
      ]
    },
    {
      "content": "提交时间",
      "pos": [
        5079,
        5083
      ]
    },
    {
      "content": "如果预缓存规则提交成功，状态栏会显示成功字样。如果失败的话，需要检查的预缓存规则是否正确。如果有问题，需要重新创建并提交预缓存规则。",
      "pos": [
        5086,
        5152
      ]
    },
    {
      "content": "预缓存规则提交",
      "pos": [
        5160,
        5167
      ]
    },
    {
      "content": "可以对单个文件或者多个文件配置预缓存。",
      "pos": [
        5171,
        5190
      ]
    },
    {
      "content": "此任务包括下列步骤：",
      "pos": [
        5201,
        5211
      ]
    },
    {
      "content": "单击 “提交预缓存加载”按钮，进入预缓存加载视图。",
      "pos": [
        5216,
        5241
      ]
    },
    {
      "content": "在“预缓存加载”对话框中，从加速域名列表中选取你要配置的域名，输入相应文件路径。",
      "pos": [
        5245,
        5285
      ]
    },
    {
      "content": "你可以单击“+”增加新的规则，也可以单击“x”来删除对应的文件。",
      "pos": [
        5289,
        5321
      ]
    },
    {
      "content": "单击“提交”。",
      "pos": [
        5325,
        5332
      ]
    },
    {
      "content": "这样，新建的预缓存加载规则就会显示在预缓存加载列表视图中。",
      "pos": [
        5334,
        5363
      ]
    },
    {
      "pos": [
        5368,
        5394
      ],
      "content": "<bpt id=\"p1\">**</bpt>日志下载<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step7\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "单击左侧的导航窗格中 “日志下载”，可以对指定的域名设置CDN原始日志下载相关参数。",
      "pos": [
        5395,
        5437
      ]
    },
    {
      "content": "日志下载视图",
      "pos": [
        5445,
        5451
      ]
    },
    {
      "content": "日志下载需要用户首先提供一个 Azure Storage Account 用以存放CDN日志，点击“下载设置”进行设置。",
      "pos": [
        5454,
        5514
      ]
    },
    {
      "content": "下载设置视图",
      "pos": [
        5531,
        5537
      ]
    },
    {
      "content": "在“下载设置”视图中，用户可以设置存储账号，以及需要下载日志的域名。设置完成后，系统会把搜集到的日志自动存放到指定的存储账号中。",
      "pos": [
        5541,
        5605
      ]
    },
    {
      "content": "用户可以删除存储账号以取消日志下载。",
      "pos": [
        5606,
        5624
      ]
    },
    {
      "content": "日志格式详解",
      "pos": [
        5641,
        5647
      ]
    },
    {
      "content": "日志以 blob 的形式存放在名为 \"cdn-access-logs\"的容器中。每个blob是一个GZip压缩后的CSV文件。其中每一栏的含义如下：",
      "pos": [
        5650,
        5724
      ]
    },
    {
      "content": "c-ip： 客户端IP地址",
      "pos": [
        5728,
        5741
      ]
    },
    {
      "content": "timestamp： 访问时间",
      "pos": [
        5744,
        5759
      ]
    },
    {
      "content": "cs-method： HTTP请求动作，如GET/HEAD等。",
      "pos": [
        5762,
        5793
      ]
    },
    {
      "content": "cs-uri-stem： 请求的URI",
      "pos": [
        5796,
        5815
      ]
    },
    {
      "content": "http-ver： HTTP协议版本",
      "pos": [
        5819,
        5837
      ]
    },
    {
      "content": "sc-status： HTTP状态码",
      "pos": [
        5840,
        5858
      ]
    },
    {
      "content": "sc-bytes： 服务器向客户端传送的字节数",
      "pos": [
        5862,
        5885
      ]
    },
    {
      "content": "c-referer：客户端Referer URI",
      "pos": [
        5888,
        5912
      ]
    },
    {
      "content": "c-user-agent：客户端User Agent标识",
      "pos": [
        5915,
        5943
      ]
    },
    {
      "content": "rs-duration(ms)：完成请求花费的时间（单位毫秒）。",
      "pos": [
        5946,
        5978
      ]
    },
    {
      "content": "hit-miss：CDN缓存命中、丢失标识。",
      "pos": [
        5981,
        6003
      ]
    },
    {
      "content": "s-ip：生成日志的CDN边缘节点IP地址。",
      "pos": [
        6006,
        6028
      ]
    },
    {
      "pos": [
        6031,
        6140
      ],
      "content": "**注意**\n如果CDN日志中未包括栏目内容，则相应记录标记为“-”，比如“c-referer”记录。此外，取决于边缘节点的日志配置，“rs-duration”、“hit-miss”、“s-ip”等记录也有可能为空。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "如果CDN日志中未包括栏目内容，则相应记录标记为“-”，比如“c-referer”记录。此外，取决于边缘节点的日志配置，“rs-duration”、“hit-miss”、“s-ip”等记录也有可能为空。",
          "pos": [
            7,
            108
          ]
        }
      ]
    },
    {
      "pos": [
        6143,
        6273
      ],
      "content": "**注意**\n网站通过CDN加速后，其访问记录多数来源于CDN边缘节点。CDN回源时，会在HTTP Header X-Forwarded-For 中填入原始IP，源站的Web服务器可以修改日志配置该信息。如果用户需要知道客户端原始IP地址，可以参考以下信息。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "网站通过CDN加速后，其访问记录多数来源于CDN边缘节点。CDN回源时，会在HTTP Header X-Forwarded-For 中填入原始IP，源站的Web服务器可以修改日志配置该信息。如果用户需要知道客户端原始IP地址，可以参考以下信息。",
          "pos": [
            7,
            129
          ]
        }
      ]
    },
    {
      "content": "以 Nginx 为例，其配置文件可以加入如下信息：",
      "pos": [
        6276,
        6301
      ]
    },
    {
      "content": "log_format logCDN '$remote_addr forwarded for $http_x_forwarded_for - $remote_user [$time_local]  '",
      "pos": [
        6304,
        6403
      ]
    },
    {
      "content": "'\"$request\" $status $body_bytes_sent '",
      "pos": [
        6422,
        6460
      ]
    },
    {
      "content": "'\"$http_referer\" \"$http_user_agent\"';",
      "pos": [
        6479,
        6516
      ]
    },
    {
      "content": "access_log /var/log/nginx/access.log logCDN;",
      "pos": [
        6519,
        6563
      ]
    },
    {
      "pos": [
        6568,
        6594
      ],
      "content": "<bpt id=\"p1\">**</bpt>服务检查<ept id=\"p1\">**</ept><ph id=\"ph1\">&lt;a id=\"step8\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "用户在创建CDN服务终节点后，可以在“服务检查”视图做一些基本的检查。我们强烈建议用户在CNAME操作之前，做一下服务检查。",
      "pos": [
        6596,
        6658
      ]
    },
    {
      "content": "如上视图，用户选择需要检查的域名后，提供一个源站可以访问的资源，然后点击“检查”。",
      "pos": [
        6669,
        6710
      ]
    },
    {
      "content": "源站正常 - 表明提供的资源可以访问；",
      "pos": [
        6715,
        6734
      ]
    },
    {
      "content": "CDN部署完成 - 表明该域名对应的CDN服务已经部署；",
      "pos": [
        6738,
        6766
      ]
    },
    {
      "content": "CDN缓存正常 - 表明通过源站访问的内容和通过CDN访问的内容一致（通过比较HTTP头：HTTP Status Code，Last Modified Time，Content Length）。",
      "pos": [
        6770,
        6867
      ]
    },
    {
      "pos": [
        6870,
        6910
      ],
      "content": "**注意**\n服务检查功能不能保证该域名所处的所有CDN边缘服务器都没有异常。",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "注意",
          "pos": [
            2,
            4
          ]
        },
        {
          "content": "服务检查功能不能保证该域名所处的所有CDN边缘服务器都没有异常。",
          "pos": [
            7,
            39
          ]
        }
      ]
    }
  ],
  "content": "<properties linkid=\"dev-net-common-tasks-cdn\" urlDisplayName=\"CDN\" pageTitle=\"How to useAzure CDN Management Portal advanced features - Azure feature guide\" metaKeywords=\"Azure CDN, Azure CDN, Azure blobs, Azure caching, Azure add-ons, 缓存刷新, 内容预取, 日志下载, 缓存规则, CDN 助文档, CDN技术文档, CDN\" description=\"Learn how to use advanced features of Azure CDN management portal to manage CDN endpoint\" metaCanonical=\"\" services=\"\" documentationCenter=\".NET\" title=\"\" authors=\"\" solutions=\"\" manager=\"\" editor=\"\" />\n<tags ms.service=\"cdn\"\n    ms.date=\"\"\n    wacn.date=\"2/23/2016\"\n    />\n\n# Azure CDN 管理门户使用指南\n\n> [AZURE.SELECTOR]\n- [中文版](/documentation/articles/cdn-management-portal-how-to-use)\n- [English Version](/documentation/articles/cdn-enus-management-portal-how-to-use)\n\nAzure 内容传送网络 (CDN) 通过遍布在中国大陆的众多物理节点上缓存Azure平台上的Storage Blob，Cloud Service和WebSites的静态内容，为开发人员提供一个传送高带宽内容的解决方案。目前本CDN服务也同时支持没有部署在Azure平台上的源站。\n\n有关 Azure CDN 的详细信息和价格，请参阅 [Azure CDN服务介绍](/home/features/cdn/)。\n\n+ [概览](#step1)\n+ [域名管理](#step2)\n+ [流量报表](#step3)\n+ [带宽报表](#step4)\n+ [缓存刷新](#step5)\n+ [内容预取](#step6)\n+ [日志下载](#step7)\n+ [服务检查](#step8)\n\n## **Azure CDN管理页面概览**<a id=\"step1\"></a>\n\n本页面显示了您的CDN订阅账号的基本信息。\n\n![][1]\n\n### **共有加速域名**\n\n当前Azure订阅下已经创建的加速域名的统计数字。\n\n### **已启用加速域名**\n\n当前Azure订阅下目前处于启用状态的加速域名的统计数字。\n\n### **当月总流量**\n\n当前Azure订阅下本月所有的加速域名使用的流量总和，单位是MB.\n\n### **当月流量**\n\n当前Azure订阅下当月每天的流量信息，单位是MB。 如果您需要了更详细的流量信息，可以在左侧的导航窗格中单击 “流量报表”，进入流量统计报表页面。\n\n\n### **当月带宽**\n当月每天的峰值带宽信息，单位是Kb/s。 如果您需要了解更详细的带宽信息，可以在左侧的导航窗格中单击 “带宽报表”，进入带宽统计报表页面。\n\n![][2]\n## **域名管理**<a id=\"step2\"></a>\n\n单击左侧导航窗格中 “域名管理”时，将显示当前Azure订阅下已经创建的所有CDN加速域名的列表视图。 你可以通过Azure订阅下拉列表选择不同的订阅查看不同订阅下的CDN加速域名信息。同时可以对加速域名进行**“修改配置”**，**“缓存规则配置”**和**“访问控制管理”**等操作。\n\n### **加速域名列表视图**\n\n![][3]\n\n#### **域名列表视图包括：**\n\n-   加速域名，用于访问CDN缓存内容的域名，该域名必须有相应的ICP备案信息。\n-   CDN 域名，由Azure CDN平台提供，都是以 **.mschcdn.com**结尾。\n-   源站地址，CDN所缓存内容的原始位置。\n-   加速类型 （目前支持“网站加速”，“下载加速”，“HTTP点播加速”和“流媒体直播加速”）\n-   状态，开启或者关闭（包括ICP审核，需要CNAME配置，禁用等非**开启**状态）\n\n>**注意**\n>您需要在CDN服务生效后（60分钟内），对你的加速域名配置CNAME映射信息，映射到微软提供的CDN域名。\n\n>**注意**\n>只有状态为**开启**的域名才可以正常使用CDN服务。\n\n#### **缓存规则配置视图**\n \n![][4]\n\n如上图，系统会根据缓存规则设置默认规则。用户可以根据需求加以调整。用户规则优先匹配，如果用户规则未命中，则逐条执行系统默认缓存规则。\n\n\n#### **缓存规则配置**\n\n用户点击“配置缓存规则”后，可以根据需求设置对域名的缓存规则，包括：\n\n- 根据目录进行配置\n\n    目录必须以 \"/\" 开头，比如： \"/pic\", \"/doc\", \"/htdoc/data\" 等等。后台会匹配指定目录下的所有文件，**包括子目录**。\n\n- 根据文件后缀配置\n\n    常用文件后缀名，比如：\"jpg\", \"png\", \"gif\", \"txt\", \"m4v\", \"mp3\" 等等。后台会匹配 **所有文件夹下** 指定的文件后缀。\n\n- 根据全路径配置\n\n    用来指定 **一个文件**，必须以 \"/\" 开头。比如：\"/sites/doc/example.doc\"。**注意**：如果用户填的全路径是\"/\"，则它匹配首页。\n\n>**注意**\n>用户填写配置规则时，字符串中不要包含 “{”, “}”, “(”, “)”, “[”, “]”, “.”, “?\", “*”, “\\”, “^”, “$” 等特殊字符。\n\n>**注意**\n>时间填为0表示禁止缓存。\n\n#### **缓存配置顺序**\n\n系统根据配置顺序**逐条匹配**，最先配置的规则具有最高优先级。规则被匹配后，其后的规则**不再**被匹配。\n\n#### **预定义模板**\n\n用户可以通过 “应用预定义模板” 快速创建缓存配置规则。上图列出了用户选中“应用预定义模板”后，选择“常见文件”后创建的一个规则。用户可以根据需求对自动创建的规则进行修改。\n\n#### **禁止缓存设置**\n\n勾选“设置为禁止缓存”，则该加速域名将不会被缓存。\n\n#### **访问控制管理**\n\n通过访问控制管理，用户可以设置配置Referer黑白名单，从而实现防盗链。\n\n![][5]\n\n当防盗链开启之后，便可以编辑外链规则。每条规则是一个路径和文件名的组合。比如/ *.png表示根目录下所有的png文件。\n\n每条规则是一个路径和文件名的组合。比如/ *.png表示根目录下所有的png文件。\n\n- 如果设置了黑名单，那么当Referer在黑名单里面的时候，不允许访问，其他情况可以访问。\n- 如果设置了白名单，那么只有当Referer是白名单中的域名时，才可以访问 。\n\n点击“提交”按钮之后，等待操作结束，会显示操作是否成功。如果点击“提交并关闭”按钮，那么对话框会立即关闭。当用户下次再打开对话框时，会显示上次操作的状态。\n\n## **流量统计报表**<a id=\"step3\"></a>\n\n你可以选择要查询的订阅（单选）、时间范围、加速域名（单个域名或全部），单击**刷新**按钮后界面将显示符合条件的流量统计报表，数据格式及含义请参见实际页面中的详细说明。\n\n![][6]\n\n**流量统计报表具有以下功能：**\n\n-   有多个Azure 订阅的用户，可以查看单个订阅的流量以及回源流量统计。\n-   有多个加速域名的Azure订阅，可以查询单个加速域名流量（以及回源流量）统计结果和所有加速域名流量（以及回源流量）汇总。\n-   最小查询粒度精确到小时。\n-   提供多种查询时间范围。 用户可以查询最近24小时，昨天，今天，最近七天，最近十五天，最近三十天和上个月的流量统计。也可以选择查询某个特定的时间段的流量以及回源流量 （统计时间范围不超过九十天）。\n\n## **带宽统计报表**<a id=\"step4\"></a>\n\n选择要查询的订阅（单选）、时间范围、加速域名（单选和全部），单击**刷新**按钮后界面将显示符合条件的带宽统计报表，数据格式及含义请参见实际页面中的详细说明。\n\n![][7]\n\n**带宽统计报表具有以下功能：**\n\n-   有多个Azure 订阅的用户，可以查询单个订阅的带宽统计和回源带宽统计。\n-   有多个加速域名的Azure订阅，可以查询单个加速域名带宽（以及回源带宽）统计结果和所有加速域名带宽（以及回源带宽）汇总。\n-   最小查询粒度精确到小时。\n-   显示带宽峰值出现时间。\n-   提供多种查询时间范围灵活选择。 你可以查询最近24小时，昨天，今天，最近七天，最近十五天，最近三十天和上个月的带宽统计。也可以选择查询某个特定的时间段的带宽（统计时间范围不超过九十天）。\n\n## **缓存刷新**<a id=\"step5\"></a>\n\n单击左侧导航窗格中“缓存刷新”，可以对指定的文件或者目录进行手动刷新。\n\n### **缓存刷新列表视图**\n\n选择要查询的订阅（单选）、状态、时间范围、加速域名（单选），单击**查询刷新结果**后界面将显示符合条件的缓存刷新记录，数据格式及含义请参见实际页面中的详细说明。\n\n![][8]\n\n#### **缓存刷新列表视图包括：**\n\n-   加速域名，用于访问CDN缓存内容的URL\n-   状态 (常见状态：成功，失败，刷新中）\n-   提交时间\n-   检测时间\n\n如果缓存刷新规则提交成功，状态栏会显示成功字样。如果失败的话，需要检查的缓存刷新规则是否正确。如果有问题，需要重新创建并提交缓存刷新规则。\n\n### **缓存刷新规则提交**\n\n既可以对单个文件，也可以对一个目录下的所有文件配置缓存刷新规则。\n\n#### **文件缓存刷新规则提交**\n\n![][9]\n\n此任务包括下列步骤：\n\n1. 单击 “提交文件刷新”按钮，进入文件刷新视图。\n2. 在“文件刷新”对话框中，从加速域名列表中选取你要配置的域名，输入相应文件路径。\n3. 你可以单击“+”增加新的规则，也可以单击“x”来删除对应的文件。\n4. 单击“提交”。\n\n这样，新建的文件缓存规则就会显示在缓存刷新列表视图中。\n\n>**注意**\n>当加速域名尚未ICP验证通过时，无法进行文件刷新操作，加速域名下拉列表为空。请等待后台验证通过。\n\n#### **目录缓存刷新规则提交**\n\n![][10]\n\n此任务包括下列步骤：\n\n1. 单击 “提交目录刷新”按钮，进入目录刷新视图。\n2. 在“目录刷新”对话框中，从加速域名列表中选取你要配置的域名，输入相应目录路径。\n3. 你可以单击“+”增加新的规则，也可以单击“x”来删除对应的目录。\n4. 单击“提交”。\n\n这样，新建的目录缓存规则就会显示在缓存刷新列表视图中\n\n## **内容预取**<a id=\"step6\"></a>\n单击左侧的导航窗格中 “内容预取”，可以对指定的文件进行内容预取和预取进度查询操作。\n\n内容预取是指预先将指定URL的内容从源站缓存到CDN节点，这样可以消除用户第一次访问该资源时的等待时间。内容预取一般被用在进行大文件分发时的场景，可以有效的提升用户访问体验。 \n\n### **内容预取列表视图**\n\n可以选择要查询的订阅（单选）、状态、时间范围、加速域名（单选），单击**查询预取结果**后界面将显示符合条件的预缓存记录，数据格式及含义请参见实际页面中的详细说明。\n\n![][11]\n\n#### **内容预取列表视图包括：**\n\n-   加速域名，用于访问CDN缓存内容的URL\n-   状态 （常见状态：成功，失败，进行中）\n-   提交时间\n\n\n如果预缓存规则提交成功，状态栏会显示成功字样。如果失败的话，需要检查的预缓存规则是否正确。如果有问题，需要重新创建并提交预缓存规则。\n\n### **预缓存规则提交**\n\n可以对单个文件或者多个文件配置预缓存。\n\n![][12]\n\n此任务包括下列步骤：\n\n1. 单击 “提交预缓存加载”按钮，进入预缓存加载视图。\n2. 在“预缓存加载”对话框中，从加速域名列表中选取你要配置的域名，输入相应文件路径。\n3. 你可以单击“+”增加新的规则，也可以单击“x”来删除对应的文件。\n4. 单击“提交”。\n\n这样，新建的预缓存加载规则就会显示在预缓存加载列表视图中。\n\n## **日志下载**<a id=\"step7\"></a>\n单击左侧的导航窗格中 “日志下载”，可以对指定的域名设置CDN原始日志下载相关参数。\n\n### **日志下载视图**\n日志下载需要用户首先提供一个 Azure Storage Account 用以存放CDN日志，点击“下载设置”进行设置。\n\n![][13]\n\n### **下载设置视图**\n\n在“下载设置”视图中，用户可以设置存储账号，以及需要下载日志的域名。设置完成后，系统会把搜集到的日志自动存放到指定的存储账号中。\n用户可以删除存储账号以取消日志下载。\n\n![][14]\n\n### **日志格式详解**\n日志以 blob 的形式存放在名为 \"cdn-access-logs\"的容器中。每个blob是一个GZip压缩后的CSV文件。其中每一栏的含义如下：\n\n- c-ip： 客户端IP地址\n- timestamp： 访问时间\n- cs-method： HTTP请求动作，如GET/HEAD等。\n- cs-uri-stem： 请求的URI \n- http-ver： HTTP协议版本\n- sc-status： HTTP状态码 \n- sc-bytes： 服务器向客户端传送的字节数\n- c-referer：客户端Referer URI\n- c-user-agent：客户端User Agent标识\n- rs-duration(ms)：完成请求花费的时间（单位毫秒）。\n- hit-miss：CDN缓存命中、丢失标识。\n- s-ip：生成日志的CDN边缘节点IP地址。\n\n>**注意**\n>如果CDN日志中未包括栏目内容，则相应记录标记为“-”，比如“c-referer”记录。此外，取决于边缘节点的日志配置，“rs-duration”、“hit-miss”、“s-ip”等记录也有可能为空。\n\n>**注意**\n>网站通过CDN加速后，其访问记录多数来源于CDN边缘节点。CDN回源时，会在HTTP Header X-Forwarded-For 中填入原始IP，源站的Web服务器可以修改日志配置该信息。如果用户需要知道客户端原始IP地址，可以参考以下信息。\n\n>以 Nginx 为例，其配置文件可以加入如下信息：\n\n>log_format logCDN '$remote_addr forwarded for $http_x_forwarded_for - $remote_user [$time_local]  '\n                  '\"$request\" $status $body_bytes_sent '\n                  '\"$http_referer\" \"$http_user_agent\"';\n\n>access_log /var/log/nginx/access.log logCDN;\n\n## **服务检查**<a id=\"step8\"></a>\n\n用户在创建CDN服务终节点后，可以在“服务检查”视图做一些基本的检查。我们强烈建议用户在CNAME操作之前，做一下服务检查。\n\n![][15]\n\n如上视图，用户选择需要检查的域名后，提供一个源站可以访问的资源，然后点击“检查”。\n\n1. 源站正常 - 表明提供的资源可以访问；\n2. CDN部署完成 - 表明该域名对应的CDN服务已经部署；\n3. CDN缓存正常 - 表明通过源站访问的内容和通过CDN访问的内容一致（通过比较HTTP头：HTTP Status Code，Last Modified Time，Content Length）。\n\n>**注意**\n>服务检查功能不能保证该域名所处的所有CDN边缘服务器都没有异常。\n\n \n\n[1]: ./media/cdn-unified-portal/001.png\n[2]: ./media/cdn-unified-portal/002.png\n[3]: ./media/cdn-unified-portal/003.png\n[4]: ./media/cdn-unified-portal/cache-policy-2.png\n[5]: ./media/cdn-unified-portal/access-control.png\n[6]: ./media/cdn-unified-portal/004.png\n[7]: ./media/cdn-unified-portal/005.png\n[8]: ./media/cdn-unified-portal/006.png\n[9]: ./media/cdn-unified-portal/007.png\n[10]: ./media/cdn-unified-portal/008.png\n[11]: ./media/cdn-unified-portal/prefetch-1.png\n[12]: ./media/cdn-unified-portal/prefetch-2.png\n[13]: ./media/cdn-unified-portal/log-download-1.png\n[14]: ./media/cdn-unified-portal/log-download-2.png\n[15]: ./media/cdn-unified-portal/service-check.png"
}