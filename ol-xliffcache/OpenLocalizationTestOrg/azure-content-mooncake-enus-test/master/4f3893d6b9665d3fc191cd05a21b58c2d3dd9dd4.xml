{
  "nodes": [
    {
      "content": "Azure SQL 数据库 Query Performance Insight",
      "pos": [
        27,
        66
      ]
    },
    {
      "content": "查询性能监视可以识别 Azure SQL 数据库中 CPU 消耗最大的查询。",
      "pos": [
        85,
        123
      ]
    },
    {
      "content": "Azure SQL 数据库 Query Performance Insight",
      "pos": [
        342,
        381
      ]
    },
    {
      "content": "管理和优化关系数据库性能是一项颇具挑战性的操作，需要投入大量的专业知识和时间。Query Performance Insight 提供以下功能，使你能够花费更少的时间来排查数据库性能问题：",
      "pos": [
        384,
        478
      ]
    },
    {
      "content": "深入洞察数据库资源 (DTU) 的消耗。",
      "pos": [
        482,
        502
      ]
    },
    {
      "content": "排名靠前的 CPU 消耗查询，经过优化后可能会改善性能。",
      "pos": [
        506,
        534
      ]
    },
    {
      "content": "可以向下钻取查询的详细信息。",
      "pos": [
        538,
        552
      ]
    },
    {
      "content": "先决条件",
      "pos": [
        558,
        562
      ]
    },
    {
      "content": "Query Performance Insight 仅适用于 Azure SQL 数据库 V12。",
      "pos": [
        566,
        615
      ]
    },
    {
      "pos": [
        618,
        740
      ],
      "content": "Query Performance Insight 要求在数据库中运行<bpt id=\"p1\">[</bpt>查询存储<ept id=\"p1\">](https://msdn.microsoft.com/zh-cn/library/dn817826.aspx)</ept>。如果尚未运行查询存储，门户将提示你打开查询存储。"
    },
    {
      "content": "权限",
      "pos": [
        747,
        749
      ]
    },
    {
      "pos": [
        751,
        860
      ],
      "content": "需有以下<bpt id=\"p1\">[</bpt>基于角色的访问控制<ept id=\"p1\">](/documentation/articles/role-based-access-control-configure)</ept>权限才能使用 Query Performance Insight："
    },
    {
      "content": "查看排名靠前的资源消耗查询和图表时，需有“读取者”、“所有者”、“参与者”、“SQL DB 参与者”或“SQL Server 参与者”权限。",
      "pos": [
        864,
        934
      ]
    },
    {
      "content": "查看查询文本时，需有“所有者”、“参与者”、“SQL DB 参与者”或“SQL Server 参与者”权限。",
      "pos": [
        938,
        992
      ]
    },
    {
      "content": "使用 Query Performance Insight",
      "pos": [
        999,
        1027
      ]
    },
    {
      "content": "Query Performance Insight 很容易使用：",
      "pos": [
        1029,
        1061
      ]
    },
    {
      "content": "查看排名靠前的资源消耗查询列表。",
      "pos": [
        1065,
        1081
      ]
    },
    {
      "content": "选择单个查询以查看其详细信息。",
      "pos": [
        1085,
        1100
      ]
    },
    {
      "content": "单击“设置”以自定义数据的显示方式，或显示不同的时间段。",
      "pos": [
        1103,
        1131
      ]
    },
    {
      "pos": [
        1137,
        1252
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> SQL 数据库的查询存储区需要捕获几个小时的数据，才能提供查询性能洞察数据。如果在某段时间内数据库没有任何活动，或查询存储不处于活动状态，则在显示该期间时图表是空的。如果查询存储未运行，你随时可以启用它。"
    },
    {
      "content": "查看 DTU 消耗量靠前的查询",
      "pos": [
        1259,
        1274
      ]
    },
    {
      "pos": [
        1276,
        1321
      ],
      "content": "在<bpt id=\"p1\">[</bpt>门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>中执行以下操作："
    },
    {
      "content": "浏览到 SQL 数据库并单击“Query Performance Insight”。",
      "pos": [
        1326,
        1368
      ]
    },
    {
      "content": "单击图表周围以获取详细信息。",
      "pos": [
        1412,
        1426
      ]
    },
    {
      "content": "最前面一行显示数据库的整体 DTU 百分比，条形显示所选查询消耗的 CPU 百分比。选择或清除图表要包含或排除的单个查询。",
      "pos": [
        1430,
        1491
      ]
    },
    {
      "content": "（可选）单击“编辑图表”以自定义 CPU 消耗数据的显示方式，或显示不同的时间段。",
      "pos": [
        1499,
        1540
      ]
    },
    {
      "content": "查看单个查询的详细信息",
      "pos": [
        1545,
        1556
      ]
    },
    {
      "content": "若要查看查询详细信息，请执行以下操作：",
      "pos": [
        1558,
        1577
      ]
    },
    {
      "content": "单击排名靠前的查询列表中的任何查询。",
      "pos": [
        1582,
        1600
      ]
    },
    {
      "content": "详细信息视图随即打开，查询 CPU 消耗已按时间细分。",
      "pos": [
        1604,
        1631
      ]
    },
    {
      "content": "单击图表以获取详细信息。",
      "pos": [
        1635,
        1647
      ]
    },
    {
      "content": "最前面一行显示整体 DTU 百分比，条形是所选查询消耗的 CPU 百分比。",
      "pos": [
        1651,
        1688
      ]
    },
    {
      "content": "检查数据以查看详细度量值，包括运行查询的每个间隔持续时间、运行次数、资源消耗百分比。",
      "pos": [
        1692,
        1734
      ]
    },
    {
      "content": "（可选）单击“设置”以自定义 CPU 消耗数据的显示方式，或显示不同的时间段。",
      "pos": [
        1741,
        1780
      ]
    },
    {
      "content": "摘要",
      "pos": [
        1788,
        1790
      ]
    },
    {
      "content": "Query Performance Insight 可帮助你了解查询工作负荷的影响，以及它与数据库资源消耗的关系。使用此功能可以了解排名靠前的消耗查询，并在发生问题之前轻松找出问题。单击数据库边栏选项卡上的“Query Performance Insight”磁贴可以查看排名靠前的资源 (CPU) 消耗查询。",
      "pos": [
        1792,
        1947
      ]
    },
    {
      "content": "后续步骤",
      "pos": [
        1955,
        1959
      ]
    },
    {
      "content": "数据库工作负荷是动态的，并且不断地更改。监视查询并继续微调以优化性能。",
      "pos": [
        1961,
        1996
      ]
    },
    {
      "pos": [
        1998,
        2080
      ],
      "content": "查看<bpt id=\"p1\">[</bpt>索引顾问<ept id=\"p1\">](/documentation/articles/sql-database-index-advisor)</ept>，以获取改善 SQL 数据库性能的其他建议。"
    }
  ],
  "content": "<properties \n   pageTitle=\"Azure SQL 数据库 Query Performance Insight\" \n   description=\"查询性能监视可以识别 Azure SQL 数据库中 CPU 消耗最大的查询。\" \n   services=\"sql-database\" \n   documentationCenter=\"\" \n   authors=\"stevestein\" \n   manager=\"jeffreyg\" \n   editor=\"monicar\"/>\n\n<tags\n   ms.service=\"sql-database\"\n   ms.date=\"12/02/2015\"\n   wacn.date=\"01/29/2016\"/>\n\n# Azure SQL 数据库 Query Performance Insight\n\n\n管理和优化关系数据库性能是一项颇具挑战性的操作，需要投入大量的专业知识和时间。Query Performance Insight 提供以下功能，使你能够花费更少的时间来排查数据库性能问题：\n\n- 深入洞察数据库资源 (DTU) 的消耗。 \n- 排名靠前的 CPU 消耗查询，经过优化后可能会改善性能。 \n- 可以向下钻取查询的详细信息。\n\n\n## 先决条件\n\n- Query Performance Insight 仅适用于 Azure SQL 数据库 V12。\n- Query Performance Insight 要求在数据库中运行[查询存储](https://msdn.microsoft.com/zh-cn/library/dn817826.aspx)。如果尚未运行查询存储，门户将提示你打开查询存储。\n\n \n## 权限\n\n需有以下[基于角色的访问控制](/documentation/articles/role-based-access-control-configure)权限才能使用 Query Performance Insight：\n\n- 查看排名靠前的资源消耗查询和图表时，需有“读取者”、“所有者”、“参与者”、“SQL DB 参与者”或“SQL Server 参与者”权限。 \n- 查看查询文本时，需有“所有者”、“参与者”、“SQL DB 参与者”或“SQL Server 参与者”权限。\n\n\n\n## 使用 Query Performance Insight\n\nQuery Performance Insight 很容易使用：\n\n- 查看排名靠前的资源消耗查询列表。 \n- 选择单个查询以查看其详细信息。\n- 单击“设置”以自定义数据的显示方式，或显示不同的时间段。\n\n\n\n> [AZURE.NOTE] SQL 数据库的查询存储区需要捕获几个小时的数据，才能提供查询性能洞察数据。如果在某段时间内数据库没有任何活动，或查询存储不处于活动状态，则在显示该期间时图表是空的。如果查询存储未运行，你随时可以启用它。\n\n\n\n## 查看 DTU 消耗量靠前的查询\n\n在[门户](https://manage.windowsazure.cn)中执行以下操作：\n\n1. 浏览到 SQL 数据库并单击“Query Performance Insight”。 \n \n\n    排名靠前的查询视图随即打开并列出 CPU 消耗量靠前的查询。\n\n1. 单击图表周围以获取详细信息。<br>最前面一行显示数据库的整体 DTU 百分比，条形显示所选查询消耗的 CPU 百分比。选择或清除图表要包含或排除的单个查询。\n\n \n\n1. （可选）单击“编辑图表”以自定义 CPU 消耗数据的显示方式，或显示不同的时间段。\n\n## 查看单个查询的详细信息\n\n若要查看查询详细信息，请执行以下操作：\n\n1. 单击排名靠前的查询列表中的任何查询。<br>详细信息视图随即打开，查询 CPU 消耗已按时间细分。\n3. 单击图表以获取详细信息。<br>最前面一行显示整体 DTU 百分比，条形是所选查询消耗的 CPU 百分比。\n4. 检查数据以查看详细度量值，包括运行查询的每个间隔持续时间、运行次数、资源消耗百分比。\n\n\n\n1. （可选）单击“设置”以自定义 CPU 消耗数据的显示方式，或显示不同的时间段。\n\n\n\n\n## 摘要\n\nQuery Performance Insight 可帮助你了解查询工作负荷的影响，以及它与数据库资源消耗的关系。使用此功能可以了解排名靠前的消耗查询，并在发生问题之前轻松找出问题。单击数据库边栏选项卡上的“Query Performance Insight”磁贴可以查看排名靠前的资源 (CPU) 消耗查询。\n\n\n\n\n## 后续步骤\n\n数据库工作负荷是动态的，并且不断地更改。监视查询并继续微调以优化性能。\n\n查看[索引顾问](/documentation/articles/sql-database-index-advisor)，以获取改善 SQL 数据库性能的其他建议。\n\n<!--Image references-->\n[1]: ./media/sql-database-query-performance/tile.png\n[2]: ./media/sql-database-query-performance/top-queries.png\n[3]: ./media/sql-database-query-performance/query-details.png\n\n<!---HONumber=Mooncake_0118_2016-->\n"
}