{
  "nodes": [
    {
      "content": "在 Azure 中配置 AlwaysOn 可用性组 (GUI)",
      "pos": [
        28,
        59
      ]
    },
    {
      "content": "在 Azure 虚拟机中创建 AlwaysOn 可用性组。本教程主要使用用户界面和工具而不是脚本。",
      "pos": [
        78,
        127
      ]
    },
    {
      "content": "在 Azure 中配置 AlwaysOn 可用性组 (GUI)",
      "pos": [
        357,
        388
      ]
    },
    {
      "content": "本端到端教程介绍如何使用 Azure 虚拟机上运行的 SQL Server AlwaysOn 实施可用性组。",
      "pos": [
        390,
        444
      ]
    },
    {
      "pos": [
        447,
        843
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>在 Azure 管理门户中，为包含 AlwaysOn 可用性组设置了一个包含侦听器的新库。该库可自动为你配置 AlwaysOn 可用性组的所有设置。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure 门户库中的 SQL Server AlwaysOn 产品<ept id=\"p1\">](http://blogs.technet.com/b/dataplatforminsider/archive/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery.aspx)</ept>。若要使用 PowerShell，请参阅同一方案的<bpt id=\"p2\">[</bpt>教程：Azure 中的 AlwaysOn 可用性组 (PowerShell)<ept id=\"p2\">](https://msdn.microsoft.com/zh-cn/library/azure/jj870963.aspx)</ept>。"
    },
    {
      "content": "完成本教程后，Azure 中的 SQL Server AlwaysOn 解决方案将包括以下要素：",
      "pos": [
        845,
        893
      ]
    },
    {
      "content": "一个包含多个子网（包括前端子网和后端子网）的虚拟网络",
      "pos": [
        897,
        923
      ]
    },
    {
      "content": "包含 Active Directory (AD) 域的域控制器",
      "pos": [
        927,
        958
      ]
    },
    {
      "content": "部署到后端子网并加入 AD 域的两个 SQL Server VM",
      "pos": [
        962,
        994
      ]
    },
    {
      "content": "具有节点多数仲裁模型的 3 节点 WSFC 群集",
      "pos": [
        998,
        1022
      ]
    },
    {
      "content": "具有可用性数据库的两个同步提交副本的可用性组",
      "pos": [
        1026,
        1048
      ]
    },
    {
      "content": "下图显示了该解决方案的示意图。",
      "pos": [
        1050,
        1065
      ]
    },
    {
      "content": "zure 中可用性组的测试实验体系结构",
      "pos": [
        1069,
        1088
      ]
    },
    {
      "content": "请注意，这是一个可能的配置。例如，你可最大程度减少 2 副本可用性组的虚拟机数目，以便通过将域控制器作为 2 节点 WSFC 群集中的仲裁文件共享见证服务器来节省 Azure 中的计算时间。通过此方法，上述配置中的 VM 数目可以减少一个。",
      "pos": [
        1174,
        1294
      ]
    },
    {
      "content": "本教程的假设条件如下：",
      "pos": [
        1296,
        1307
      ]
    },
    {
      "content": "你已有一个 Azure 帐户。",
      "pos": [
        1311,
        1326
      ]
    },
    {
      "pos": [
        1330,
        1467
      ],
      "content": "你已经知道如何使用 GUI 从虚拟机库预配 SQL Server VM。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>在 Azure 上预配 SQL Server 虚拟机<ept id=\"p1\">](/documentation/articles/virtual-machines-provision-sql-server)</ept>"
    },
    {
      "pos": [
        1471,
        1589
      ],
      "content": "你已经深入了解 AlwaysOn 可用性组。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>AlwaysOn 可用性组 (SQL Server)<ept id=\"p1\">](https://msdn.microsoft.com/zh-cn/library/hh510230.aspx)</ept>。"
    },
    {
      "pos": [
        1592,
        1757
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>如果你想将 AlwaysOn 可用性组与 SharePoint 结合使用，另请参阅<bpt id=\"p1\">[</bpt>为 SharePoint 2013 配置 SQL Server 2012 AlwaysOn 可用性组<ept id=\"p1\">](https://technet.microsoft.com/zh-cn/library/jj715261.aspx)</ept>。"
    },
    {
      "content": "创建虚拟网络和域控制器服务器",
      "pos": [
        1762,
        1776
      ]
    },
    {
      "content": "你将从一个新的 Azure 试用帐户开始。完成帐户设置后，你会进入 Azure 门户的主页屏幕。",
      "pos": [
        1778,
        1826
      ]
    },
    {
      "content": "单击该页左下角的“新建”按钮，如下所示。",
      "pos": [
        1831,
        1851
      ]
    },
    {
      "content": "在门户中单击“新建”",
      "pos": [
        1859,
        1869
      ]
    },
    {
      "content": "依次单击“网络服务”、“虚拟网络”、“自定义创建”，如下所示。",
      "pos": [
        1958,
        1989
      ]
    },
    {
      "content": "创建虚拟网络",
      "pos": [
        1997,
        2003
      ]
    },
    {
      "content": "在“创建虚拟网络”对话框中，通过逐页完成以下设置创建新的虚拟网络。",
      "pos": [
        2092,
        2125
      ]
    },
    {
      "content": "|Page|设置|",
      "pos": [
        2131,
        2140
      ]
    },
    {
      "content": "|---|---|",
      "pos": [
        2141,
        2150
      ]
    },
    {
      "content": "|虚拟网络详细信息|<bpt id=\"p1\">**</bpt>名称 = ContosoNET<ept id=\"p1\">**</ept>",
      "pos": [
        2151,
        2180
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>区域 = 中国北部<ept id=\"p1\">**</ept>|",
      "pos": [
        2185,
        2199
      ]
    },
    {
      "content": "|DNS 服务器和 VPN 连接|无|",
      "pos": [
        2200,
        2219
      ]
    },
    {
      "content": "|虚拟网络地址空间|设置显示在以下屏幕截图中：<ph id=\"ph1\">![</ph>创建虚拟网络<ph id=\"ph2\">](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784620.png)</ph>|",
      "pos": [
        2220,
        2336
      ]
    },
    {
      "content": "接下来，你将创建用作域控制器 (DC) 的 VM。再次单击“新建”，然后依次单击“计算”、“虚拟机”、“从库中”，如下所示。",
      "pos": [
        2341,
        2403
      ]
    },
    {
      "content": "创建 VM",
      "pos": [
        2411,
        2416
      ]
    },
    {
      "content": "在“创建虚拟机”对话框中，逐页完成以下设置来配置新 VM。",
      "pos": [
        2505,
        2534
      ]
    },
    {
      "content": "|Page|设置|",
      "pos": [
        2540,
        2549
      ]
    },
    {
      "content": "|---|---|",
      "pos": [
        2550,
        2559
      ]
    },
    {
      "content": "|选择虚拟机操作系统|Windows Server 2012 R2 Datacenter|",
      "pos": [
        2560,
        2605
      ]
    },
    {
      "content": "|虚拟机配置|<bpt id=\"p1\">**</bpt>版本发布日期<ept id=\"p1\">**</ept> =（最新）",
      "pos": [
        2606,
        2629
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟机名称<ept id=\"p1\">**</ept> = ContosoDC",
      "pos": [
        2634,
        2655
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>层<ept id=\"p1\">**</ept> = 基本",
      "pos": [
        2660,
        2670
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>大小<ept id=\"p1\">**</ept> = A2（双核）",
      "pos": [
        2675,
        2690
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新用户名<ept id=\"p1\">**</ept> = AzureAdmin",
      "pos": [
        2695,
        2716
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        2721,
        2742
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>确认密码<ept id=\"p1\">**</ept> = Contoso!000|",
      "pos": [
        2747,
        2770
      ]
    },
    {
      "content": "|虚拟机配置|<bpt id=\"p1\">**</bpt>云服务<ept id=\"p1\">**</ept> = 创建新的云服务",
      "pos": [
        2771,
        2795
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>云服务 DNS 名称<ept id=\"p1\">**</ept> = 唯一的云服务名称",
      "pos": [
        2800,
        2825
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>DNS 名称<ept id=\"p1\">**</ept> = 唯一名称（例如：ContosoDC123）",
      "pos": [
        2830,
        2864
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>区域/地缘组/虚拟网络<ept id=\"p1\">**</ept> = ContosoNET",
      "pos": [
        2869,
        2897
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟网络子网<ept id=\"p1\">**</ept> = Back(10.10.2.0/24)",
      "pos": [
        2902,
        2933
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>存储帐户<ept id=\"p1\">**</ept> = 使用自动生成的存储帐户",
      "pos": [
        2938,
        2960
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>可用性集<ept id=\"p1\">**</ept> =（无）|",
      "pos": [
        2965,
        2979
      ]
    },
    {
      "content": "|虚拟机选项|使用默认值|",
      "pos": [
        2980,
        2993
      ]
    },
    {
      "content": "配置完新虚拟机后，请等待对 VM 设置完成。此过程要用一些时间才能完成，并且，如果你单击 Azure 门户中的“虚拟机”选项卡，则可以看到 ContosoDC 逐一经历状态“正在启动(预配)”、“已停止”、“正在启动”、“正在运行(预配)”和最后的“正在运行”。",
      "pos": [
        2995,
        3126
      ]
    },
    {
      "content": "现在已成功预配 DC 服务器。接下来，请在 DC 服务器上配置 Active Directory 域。",
      "pos": [
        3128,
        3179
      ]
    },
    {
      "content": "配置域控制器",
      "pos": [
        3184,
        3190
      ]
    },
    {
      "content": "在以下步骤中，你可以将 ContosoDC 计算机配置为 corp.contoso.com 的域控制器。",
      "pos": [
        3192,
        3244
      ]
    },
    {
      "pos": [
        3249,
        3311
      ],
      "content": "在门户中，选择 <bpt id=\"p1\">**</bpt>ContosoDC<ept id=\"p1\">**</ept> 计算机。在“仪表板”选项卡上，单击“连接”以打开用于远程桌面访问 RDP 文件。"
    },
    {
      "content": "连接到虚拟机",
      "pos": [
        3319,
        3325
      ]
    },
    {
      "pos": [
        3414,
        3470
      ],
      "content": "使用已配置的管理员帐户 (<bpt id=\"p1\">**</bpt>\\\\AzureAdmin<ept id=\"p1\">**</ept>) 和密码 (<bpt id=\"p2\">**</bpt>Contoso!000<ept id=\"p2\">**</ept>) 登录。"
    },
    {
      "content": "默认情况下，应显示“服务器管理器”仪表板。",
      "pos": [
        3475,
        3496
      ]
    },
    {
      "content": "单击仪表板上的“添加角色和功能”链接。",
      "pos": [
        3501,
        3520
      ]
    },
    {
      "content": "服务器资源管理器中的“添加角色”",
      "pos": [
        3528,
        3544
      ]
    },
    {
      "content": "选择“下一步”，直到你到达“服务器角色”部分。",
      "pos": [
        3633,
        3656
      ]
    },
    {
      "content": "选择“Active Directory 域服务”和“DNS 服务器”角色。出现提示时，添加这些角色所需的任何其他功能。",
      "pos": [
        3661,
        3720
      ]
    },
    {
      "pos": [
        3727,
        3880
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>你将收到无静态 IP 地址的验证警告。如果你要测试配置，请单击“继续”。对于生产方案，请<bpt id=\"p1\">[</bpt>使用 PowerShell 设置域控制器计算机的静态 IP 地址<ept id=\"p1\">](/documentation/articles/virtual-networks-reserved-private-ip)</ept>。"
    },
    {
      "content": "添加角色对话框",
      "pos": [
        3888,
        3895
      ]
    },
    {
      "content": "单击“下一步”，直到你到达“确认”部分。选中“必要时自动重新启动目标服务器”复选框。",
      "pos": [
        3984,
        4026
      ]
    },
    {
      "content": "单击“安装”。",
      "pos": [
        4031,
        4038
      ]
    },
    {
      "content": "功能安装完毕后，返回到“服务器管理器”仪表板。",
      "pos": [
        4043,
        4066
      ]
    },
    {
      "content": "选择左侧窗格中的新“AD DS”选项。",
      "pos": [
        4071,
        4090
      ]
    },
    {
      "content": "单击黄色警告栏上的“更多”链接。",
      "pos": [
        4095,
        4111
      ]
    },
    {
      "content": "DNS 服务器 VM 上的 AD DS 对话框",
      "pos": [
        4119,
        4142
      ]
    },
    {
      "content": "在“所有服务器任务详细信息”对话框的“操作”栏中，单击“将此服务器提升为域控制器”。",
      "pos": [
        4231,
        4273
      ]
    },
    {
      "content": "在“Active Directory 域服务配置向导”中，使用以下值：",
      "pos": [
        4278,
        4313
      ]
    },
    {
      "content": "|Page|设置|",
      "pos": [
        4319,
        4328
      ]
    },
    {
      "content": "|---|---|",
      "pos": [
        4329,
        4338
      ]
    },
    {
      "content": "|部署配置|<bpt id=\"p1\">**</bpt>添加新林<ept id=\"p1\">**</ept> = 选定",
      "pos": [
        4339,
        4358
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>根域名<ept id=\"p1\">**</ept> = corp.contoso.com|",
      "pos": [
        4363,
        4390
      ]
    },
    {
      "content": "|域控制器选项|<bpt id=\"p1\">**</bpt>密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        4391,
        4419
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>确认密码<ept id=\"p1\">**</ept> = Contoso!000|",
      "pos": [
        4424,
        4447
      ]
    },
    {
      "content": "单击“下一步”以浏览向导中的其他页。在“必备项检查”页上，确认你看到以下消息：“所有先决条件检查都成功通过”。请注意，你应查看任何适用的警告消息，但可以继续安装。",
      "pos": [
        4452,
        4533
      ]
    },
    {
      "pos": [
        4538,
        4570
      ],
      "content": "单击“安装”。<bpt id=\"p1\">**</bpt>ContosoDC<ept id=\"p1\">**</ept> 虚拟机将自动重新启动。"
    },
    {
      "content": "配置域帐户",
      "pos": [
        4575,
        4580
      ]
    },
    {
      "content": "接下来的步骤用于配置 Active Directory (AD) 帐户以供稍后使用。",
      "pos": [
        4582,
        4624
      ]
    },
    {
      "pos": [
        4629,
        4653
      ],
      "content": "重新登录到 <bpt id=\"p1\">**</bpt>ContosoDC<ept id=\"p1\">**</ept> 计算机。"
    },
    {
      "content": "在“服务器管理器”中，选择“工具”，然后单击“Active Directory 管理中心”。",
      "pos": [
        4658,
        4704
      ]
    },
    {
      "content": "Active Directory 管理中心",
      "pos": [
        4712,
        4733
      ]
    },
    {
      "content": "在“Active Directory 管理中心”的左窗格中，选择“corp (本地)”。",
      "pos": [
        4822,
        4866
      ]
    },
    {
      "content": "在右侧的“任务”窗格中，选择“新建”，然后单击“用户”。使用以下设置：",
      "pos": [
        4871,
        4906
      ]
    },
    {
      "content": "|设置|值|",
      "pos": [
        4912,
        4918
      ]
    },
    {
      "content": "|---|---|",
      "pos": [
        4919,
        4928
      ]
    },
    {
      "content": "|<bpt id=\"p1\">**</bpt>名字<ept id=\"p1\">**</ept>|安装|",
      "pos": [
        4929,
        4940
      ]
    },
    {
      "content": "|<bpt id=\"p1\">**</bpt>用户 SamAccountName<ept id=\"p1\">**</ept>|安装|",
      "pos": [
        4941,
        4967
      ]
    },
    {
      "content": "|<bpt id=\"p1\">**</bpt>密码<ept id=\"p1\">**</ept>|Contoso!000|",
      "pos": [
        4968,
        4988
      ]
    },
    {
      "content": "|<bpt id=\"p1\">**</bpt>确认密码<ept id=\"p1\">**</ept>|Contoso!000|",
      "pos": [
        4989,
        5011
      ]
    },
    {
      "content": "|<bpt id=\"p1\">**</bpt>其他密码选项<ept id=\"p1\">**</ept>|选定|",
      "pos": [
        5012,
        5027
      ]
    },
    {
      "content": "|<bpt id=\"p1\">**</bpt>密码永不过期<ept id=\"p1\">**</ept>|已选中|",
      "pos": [
        5028,
        5044
      ]
    },
    {
      "pos": [
        5049,
        5094
      ],
      "content": "单击“确定”以创建 <bpt id=\"p1\">**</bpt>Install<ept id=\"p1\">**</ept> 用户。此帐户将用于配置故障转移群集和可用性组。"
    },
    {
      "pos": [
        5099,
        5241
      ],
      "content": "使用相同的步骤创建两个其他用户：<bpt id=\"p1\">**</bpt>CORP\\\\SQLSvc1<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>CORP\\\\SQLSvc2<ept id=\"p2\">**</ept>。这些帐户将用于 SQL Server 实例。接下来，你需要为 <bpt id=\"p3\">**</bpt>CORP\\\\Install<ept id=\"p3\">**</ept> 分配所需权限以配置 Windows Server 故障转移群集 (WSFC)。"
    },
    {
      "content": "在“Active Directory 管理中心”的左窗格中，选择“corp (本地)”。然后，在右侧的“任务”窗格中，单击“属性”。",
      "pos": [
        5246,
        5312
      ]
    },
    {
      "content": "CORP 用户属性",
      "pos": [
        5320,
        5329
      ]
    },
    {
      "content": "选择“扩展”，然后单击“安全性”选项卡上的“高级”按钮。",
      "pos": [
        5418,
        5446
      ]
    },
    {
      "pos": [
        5451,
        5482
      ],
      "content": "在“corp 的高级安全设置”对话框中，单击<bpt id=\"p1\">**</bpt>“添加”<ept id=\"p1\">**</ept>。"
    },
    {
      "pos": [
        5487,
        5531
      ],
      "content": "单击“选择主体”。然后，搜索 <bpt id=\"p1\">**</bpt>CORP\\\\Install<ept id=\"p1\">**</ept>。单击<bpt id=\"p2\">**</bpt>“确定”<ept id=\"p2\">**</ept>。"
    },
    {
      "content": "选择“读取全部属性”和“创建计算机对象”权限。",
      "pos": [
        5536,
        5559
      ]
    },
    {
      "content": "CORP 用户权限",
      "pos": [
        5567,
        5576
      ]
    },
    {
      "content": "单击“确定”，然后再次单击“确定”。关闭 corp 属性窗口。",
      "pos": [
        5665,
        5696
      ]
    },
    {
      "content": "现在你已完成 Active Directory 和用户对象的配置，接下来，你将创建三个 SQL Server VM 并将其加入到此域中。",
      "pos": [
        5698,
        5766
      ]
    },
    {
      "content": "创建 SQL Server VM",
      "pos": [
        5771,
        5787
      ]
    },
    {
      "content": "接下来，创建三个 VM，包括 WSFC 群集节点和两个 SQL Server VM。若要创建每个 VM，请返回到 Azure 门户，然后依次单击“新建”、“计算”、“虚拟机”和“从库中”。然后，使用下表中的模板来帮助创建 VM。",
      "pos": [
        5789,
        5903
      ]
    },
    {
      "content": "Page",
      "pos": [
        5906,
        5910
      ]
    },
    {
      "content": "VM1",
      "pos": [
        5911,
        5914
      ]
    },
    {
      "content": "VM2",
      "pos": [
        5915,
        5918
      ]
    },
    {
      "content": "VM3",
      "pos": [
        5919,
        5922
      ]
    },
    {
      "content": "选择虚拟机操作系统",
      "pos": [
        5943,
        5952
      ]
    },
    {
      "content": "Windows Server 2012 R2 Datacenter",
      "pos": [
        5955,
        5988
      ]
    },
    {
      "content": "SQL Server 2014 RTM Enterprise",
      "pos": [
        5993,
        6023
      ]
    },
    {
      "content": "SQL Server 2014 RTM Enterprise",
      "pos": [
        6028,
        6058
      ]
    },
    {
      "content": "虚拟机配置",
      "pos": [
        6063,
        6068
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>版本发布日期<ept id=\"p1\">**</ept> =（最新）",
      "pos": [
        6069,
        6085
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟机名称<ept id=\"p1\">**</ept> = ContosoWSFCNode",
      "pos": [
        6090,
        6117
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>层<ept id=\"p1\">**</ept> = 基本",
      "pos": [
        6122,
        6132
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>大小<ept id=\"p1\">**</ept> = A2（双核）",
      "pos": [
        6137,
        6152
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新用户名<ept id=\"p1\">**</ept> = AzureAdmin",
      "pos": [
        6157,
        6178
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        6183,
        6204
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>确认密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        6209,
        6231
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>版本发布日期<ept id=\"p1\">**</ept> =（最新）",
      "pos": [
        6232,
        6248
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟机名称<ept id=\"p1\">**</ept> = ContosoSQL1",
      "pos": [
        6253,
        6276
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>层<ept id=\"p1\">**</ept> = 基本",
      "pos": [
        6281,
        6291
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>大小<ept id=\"p1\">**</ept> = A3（4 核）",
      "pos": [
        6296,
        6312
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新用户名<ept id=\"p1\">**</ept> = AzureAdmin",
      "pos": [
        6317,
        6338
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        6343,
        6364
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>确认密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        6369,
        6391
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>版本发布日期<ept id=\"p1\">**</ept> =（最新）",
      "pos": [
        6392,
        6408
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟机名称<ept id=\"p1\">**</ept> = ContosoSQL2",
      "pos": [
        6413,
        6436
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>层<ept id=\"p1\">**</ept> = 基本",
      "pos": [
        6441,
        6451
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>大小<ept id=\"p1\">**</ept> = A3（4 核）",
      "pos": [
        6456,
        6472
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新用户名<ept id=\"p1\">**</ept> = AzureAdmin",
      "pos": [
        6477,
        6498
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>新密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        6503,
        6524
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>确认密码<ept id=\"p1\">**</ept> = Contoso!000",
      "pos": [
        6529,
        6551
      ]
    },
    {
      "content": "虚拟机配置",
      "pos": [
        6554,
        6559
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>云服务<ept id=\"p1\">**</ept> = 之前创建的唯一云服务 DNS 名称（例如：ContosoDC123）",
      "pos": [
        6560,
        6604
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>区域/地缘组/虚拟网络<ept id=\"p1\">**</ept> = ContosoNET",
      "pos": [
        6609,
        6637
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟网络子网<ept id=\"p1\">**</ept> = Back(10.10.2.0/24)",
      "pos": [
        6642,
        6673
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>存储帐户<ept id=\"p1\">**</ept> = 使用自动生成的存储帐户",
      "pos": [
        6678,
        6700
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>可用性集<ept id=\"p1\">**</ept> = 创建可用性集",
      "pos": [
        6705,
        6722
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>可用性集名称<ept id=\"p1\">**</ept> = SQLHADR",
      "pos": [
        6727,
        6747
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>云服务<ept id=\"p1\">**</ept> = 之前创建的唯一云服务 DNS 名称（例如：ContosoDC123）",
      "pos": [
        6748,
        6792
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>区域/地缘组/虚拟网络<ept id=\"p1\">**</ept> = ContosoNET",
      "pos": [
        6797,
        6825
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟网络子网<ept id=\"p1\">**</ept> = Back(10.10.2.0/24)",
      "pos": [
        6830,
        6861
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>存储帐户<ept id=\"p1\">**</ept> = 使用自动生成的存储帐户",
      "pos": [
        6866,
        6888
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>可用性集<ept id=\"p1\">**</ept> = SQLHADR（也可以在创建计算机后配置可用性集。所有三个计算机都应分配到 SQLHADR 可用性集。）",
      "pos": [
        6893,
        6956
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>云服务<ept id=\"p1\">**</ept> = 之前创建的唯一云服务 DNS 名称（例如：ContosoDC123）",
      "pos": [
        6957,
        7001
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>区域/地缘组/虚拟网络<ept id=\"p1\">**</ept> = ContosoNET",
      "pos": [
        7006,
        7034
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>虚拟网络子网<ept id=\"p1\">**</ept> = Back(10.10.2.0/24)",
      "pos": [
        7039,
        7070
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>存储帐户<ept id=\"p1\">**</ept> = 使用自动生成的存储帐户",
      "pos": [
        7075,
        7097
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>可用性集<ept id=\"p1\">**</ept> = SQLHADR（也可以在创建计算机后配置可用性集。所有三个计算机都应分配到 SQLHADR 可用性集。）",
      "pos": [
        7102,
        7165
      ]
    },
    {
      "content": "虚拟机选项",
      "pos": [
        7168,
        7173
      ]
    },
    {
      "content": "使用默认值",
      "pos": [
        7174,
        7179
      ]
    },
    {
      "content": "使用默认值",
      "pos": [
        7180,
        7185
      ]
    },
    {
      "content": "使用默认值",
      "pos": [
        7186,
        7191
      ]
    },
    {
      "pos": [
        7194,
        7294
      ],
      "content": "在三个虚拟机预配完毕之后，你需要将它们加入到 <bpt id=\"p1\">**</bpt>corp.contoso.com<ept id=\"p1\">**</ept> 域中，并向这些虚拟机授予 CORP\\\\Install 管理权限。为此，请针对三个虚拟机中的每一个按以下步骤操作。"
    },
    {
      "content": "首先，更改首选 DNS 服务器地址。通过在列表中选择 VM 并单击“连接”按钮，先将每个 VM 的远程桌面 (RDP) 文件下载到本地目录。若要选择 VM，请在该行中除第一个单元外的任意位置单击，如下所示。",
      "pos": [
        7299,
        7402
      ]
    },
    {
      "content": "下载 RDP 文件",
      "pos": [
        7410,
        7419
      ]
    },
    {
      "pos": [
        7508,
        7600
      ],
      "content": "下载 RDP 文件启动下载的 RDP 文件，并使用已配置的管理员帐户 (<bpt id=\"p1\">**</bpt>BUILTIN\\\\AzureAdmin<ept id=\"p1\">**</ept>) 和密码 (<bpt id=\"p2\">**</bpt>Contoso!000<ept id=\"p2\">**</ept>) 登录到 VM 中。"
    },
    {
      "content": "一旦登录，你应看到“服务器管理器”仪表板。单击左窗格中的“本地服务器”。",
      "pos": [
        7605,
        7641
      ]
    },
    {
      "content": "选择“由 DHCP 分配的启用 IPv6 的 IPv4 地址”链接。",
      "pos": [
        7646,
        7680
      ]
    },
    {
      "content": "在“网络连接”窗口中，选择网络图标。",
      "pos": [
        7685,
        7703
      ]
    },
    {
      "content": "更改 VM 的首选 DNS 服务器",
      "pos": [
        7711,
        7728
      ]
    },
    {
      "content": "在命令栏中，单击“更改此连接的设置”（根据你的窗口大小，你可能需要单击双右箭头才能看到此命令）。",
      "pos": [
        7817,
        7865
      ]
    },
    {
      "content": "选择“Internet 协议版本 4 (TCP/IPv4)”，然后单击“属性”。",
      "pos": [
        7870,
        7910
      ]
    },
    {
      "content": "选择“使用以下 DNS 服务器地址”，并在“首选 DNS 服务器”中指定 10.10.2.4。",
      "pos": [
        7915,
        7962
      ]
    },
    {
      "pos": [
        7967,
        8114
      ],
      "content": "地址 <bpt id=\"p1\">**</bpt>10.10.2.4<ept id=\"p1\">**</ept> 是分配到 Azure 虚拟网络中 10.10.2.0/24 子网中的 VM 的地址，而该 VM 是 <bpt id=\"p2\">**</bpt>ContosoDC<ept id=\"p2\">**</ept>。若要验证 <bpt id=\"p3\">**</bpt>ContosoDC<ept id=\"p3\">**</ept> 的 IP 地址，请在命令提示符中使用 <bpt id=\"p4\">**</bpt>nslookup contosodc<ept id=\"p4\">**</ept>，如下所示。"
    },
    {
      "content": "使用 NSLOOKUP 查找 DC 的 IP 地址",
      "pos": [
        8122,
        8147
      ]
    },
    {
      "pos": [
        8236,
        8293
      ],
      "content": "单击“确定”，然后“关闭”以提交更改。你现在能够将该 VM 加入到 <bpt id=\"p1\">**</bpt>corp.contoso.com<ept id=\"p1\">**</ept> 中。"
    },
    {
      "content": "再次在“本地服务器”窗口中，单击“工作组”链接。",
      "pos": [
        8298,
        8322
      ]
    },
    {
      "content": "在“计算机名”选项上，单击“更改”。",
      "pos": [
        8327,
        8345
      ]
    },
    {
      "pos": [
        8350,
        8395
      ],
      "content": "选中“域”复选框并在文本框中键入 <bpt id=\"p1\">**</bpt>corp.contoso.com<ept id=\"p1\">**</ept>。单击“确定”。"
    },
    {
      "pos": [
        8400,
        8481
      ],
      "content": "在“Windows 安全性”弹出对话框中，指定默认域管理员帐户 (<bpt id=\"p1\">**</bpt>CORP\\\\AzureAdmin<ept id=\"p1\">**</ept>) 和密码 (<bpt id=\"p2\">**</bpt>Contoso!000<ept id=\"p2\">**</ept>) 的凭据。"
    },
    {
      "content": "在看到“欢迎使用 corp.contoso.com 域”消息时，请单击“确定”。",
      "pos": [
        8486,
        8526
      ]
    },
    {
      "content": "单击“关闭”，然后单击弹出对话框中的“立即重新启动”。",
      "pos": [
        8531,
        8558
      ]
    },
    {
      "content": "接下来，添加 Corp\\\\Install 用户作为每个 VM 上的管理员：",
      "pos": [
        8564,
        8601
      ]
    },
    {
      "pos": [
        8606,
        8671
      ],
      "content": "一直等到 VM 重新启动，然后再次启动 RDP 文件以使用 <bpt id=\"p1\">**</bpt>BUILTIN\\\\AzureAdmin<ept id=\"p1\">**</ept> 帐户登录到 VM 中。"
    },
    {
      "content": "在“服务器管理器”中，选择“工具”，然后单击“计算机管理”。",
      "pos": [
        8676,
        8706
      ]
    },
    {
      "content": "计算机管理",
      "pos": [
        8714,
        8719
      ]
    },
    {
      "content": "在“计算机管理”窗口中，展开“本地用户和组”，然后选择“组”。",
      "pos": [
        8808,
        8839
      ]
    },
    {
      "content": "双击“管理员”组。",
      "pos": [
        8844,
        8853
      ]
    },
    {
      "content": "在“管理员属性”对话框中，单击“添加”按钮。",
      "pos": [
        8858,
        8880
      ]
    },
    {
      "pos": [
        8885,
        8970
      ],
      "content": "输入用户 <bpt id=\"p1\">**</bpt>CORP\\\\Install<ept id=\"p1\">**</ept>，然后单击“确定”。当系统提示你输入凭据时，使用 <bpt id=\"p2\">**</bpt>AzureAdmin<ept id=\"p2\">**</ept> 帐户与 <bpt id=\"p3\">**</bpt>Contoso!000<ept id=\"p3\">**</ept> 密码。"
    },
    {
      "content": "单击“确定”以关闭“管理员属性”对话框。",
      "pos": [
        8975,
        8995
      ]
    },
    {
      "pos": [
        9001,
        9029
      ],
      "content": "接下来，将<bpt id=\"p1\">**</bpt>故障转移群集<ept id=\"p1\">**</ept>功能功能添加到每个 VM。"
    },
    {
      "content": "在“服务器管理器”仪表板中，单击“添加角色和功能”。",
      "pos": [
        9034,
        9060
      ]
    },
    {
      "content": "在“添加角色和功能向导”中，单击“下一步”，直到出现“功能”页。",
      "pos": [
        9065,
        9097
      ]
    },
    {
      "content": "选择“故障转移群集”。出现提示时，请添加任何其他相关功能。",
      "pos": [
        9102,
        9131
      ]
    },
    {
      "content": "向 VM 添加故障转移群集功能",
      "pos": [
        9139,
        9154
      ]
    },
    {
      "content": "单击“下一步”，然后单击“确认”页上的“安装”。",
      "pos": [
        9243,
        9267
      ]
    },
    {
      "content": "“故障转移群集”功能安装完成后，单击“关闭”。",
      "pos": [
        9272,
        9295
      ]
    },
    {
      "content": "从 VM 注销。",
      "pos": [
        9300,
        9308
      ]
    },
    {
      "pos": [
        9313,
        9387
      ],
      "content": "针对所有三个服务器（<bpt id=\"p1\">**</bpt>ContosoWSFCNode<ept id=\"p1\">**</ept>、<bpt id=\"p2\">**</bpt>ContosoSQL1<ept id=\"p2\">**</ept> 和 <bpt id=\"p3\">**</bpt>ContosoSQL2<ept id=\"p3\">**</ept>）重复本部分中的步骤。"
    },
    {
      "content": "这些 SQL Server VM 现在已预配并正在运行，但它们是使用默认选项与 SQL Server 一同安装的。",
      "pos": [
        9389,
        9446
      ]
    },
    {
      "content": "创建 WSFC 群集",
      "pos": [
        9451,
        9461
      ]
    },
    {
      "content": "在本部分中，你将创建托管要在以后创建的可用性组的 WSFC 群集。至此，你应该已针对将在 WSFC 群集中使用的三个 VM 中的每个 VM 完成了以下操作：",
      "pos": [
        9463,
        9541
      ]
    },
    {
      "content": "在 Azure 中进行了完全预配",
      "pos": [
        9545,
        9561
      ]
    },
    {
      "content": "已将 VM 加入到域中",
      "pos": [
        9565,
        9576
      ]
    },
    {
      "pos": [
        9580,
        9610
      ],
      "content": "已将 <bpt id=\"p1\">**</bpt>CORP\\\\Install<ept id=\"p1\">**</ept> 添加到本地管理员组"
    },
    {
      "content": "添加了故障转移群集功能",
      "pos": [
        9614,
        9625
      ]
    },
    {
      "content": "必须在每个 VM 上执行所有这些操作，才能将该 VM 加入到 WSFC 群集中。",
      "pos": [
        9627,
        9667
      ]
    },
    {
      "content": "另请注意，Azure 虚拟网络的行为与本地网络不同。你需要按以下顺序来创建群集：",
      "pos": [
        9669,
        9709
      ]
    },
    {
      "pos": [
        9714,
        9749
      ],
      "content": "在其中一个节点 (<bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept>) 上创建单节点群集。"
    },
    {
      "pos": [
        9754,
        9795
      ],
      "content": "将群集 IP 地址修改为未使用的 IP 地址 (<bpt id=\"p1\">**</bpt>10.10.2.101<ept id=\"p1\">**</ept>)。"
    },
    {
      "content": "将群集名称联机。",
      "pos": [
        9800,
        9808
      ]
    },
    {
      "pos": [
        9813,
        9859
      ],
      "content": "添加其他节点（<bpt id=\"p1\">**</bpt>ContosoSQL2<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>ContosoWSFCNode<ept id=\"p2\">**</ept>）。"
    },
    {
      "content": "按照以下步骤完成完全配置群集的这些任务。",
      "pos": [
        9861,
        9881
      ]
    },
    {
      "pos": [
        9886,
        9943
      ],
      "content": "启动 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 的 RDP 文件，然后使用域帐户 <bpt id=\"p2\">**</bpt>CORP\\\\Install<ept id=\"p2\">**</ept> 登录。"
    },
    {
      "content": "在“服务器管理器”仪表板中，选择“工具”，然后单击“故障转移群集管理器”。",
      "pos": [
        9948,
        9985
      ]
    },
    {
      "content": "在左窗格中，右键单击“故障转移群集管理器”，然后单击“创建群集”，如下所示。",
      "pos": [
        9990,
        10028
      ]
    },
    {
      "content": "创建群集",
      "pos": [
        10036,
        10040
      ]
    },
    {
      "content": "在“创建群集向导”中，逐页完成以下设置来创建一个单节点群集：",
      "pos": [
        10129,
        10159
      ]
    },
    {
      "content": "|Page|设置|",
      "pos": [
        10165,
        10174
      ]
    },
    {
      "content": "|---|---|",
      "pos": [
        10175,
        10184
      ]
    },
    {
      "content": "|开始之前|使用默认值|",
      "pos": [
        10185,
        10197
      ]
    },
    {
      "content": "|选择服务器|在“输入服务器名称”中键入 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept>，然后单击“添加”|",
      "pos": [
        10198,
        10244
      ]
    },
    {
      "content": "|验证警告|选择<bpt id=\"p1\">**</bpt>“否。不需要 Microsoft 对该群集的支持，因此不希望运行验证测试。单击‘下一步’时，继续创建群集。<ept id=\"p1\">**</ept>”|",
      "pos": [
        10245,
        10312
      ]
    },
    {
      "content": "|用于管理群集的访问点|在“群集名称”中键入 <bpt id=\"p1\">**</bpt>Cluster1<ept id=\"p1\">**</ept>|",
      "pos": [
        10313,
        10349
      ]
    },
    {
      "content": "|确认|除非你使用的是存储空间，否则请使用默认值。请参阅此表后面的备注。|",
      "pos": [
        10350,
        10387
      ]
    },
    {
      "pos": [
        10394,
        10614
      ],
      "content": "<ph id=\"ph1\">[AZURE.WARNING]</ph>如果你使用<bpt id=\"p1\">[</bpt>存储空间<ept id=\"p1\">](https://technet.microsoft.com/zh-cn/library/hh831739)</ept>来将多个磁盘组合到存储池中，则必须取消选中“确认”页上的“将所有符合条件的存储添加到群集中”复选框。如果不取消选中该选项，则在群集过程中将分离虚拟磁盘。因此，这些虚拟磁盘也不会出现在磁盘管理器或资源管理器之中，除非从群集中删除存储空间，并使用 PowerShell 将其重新附加。"
    },
    {
      "content": "在左窗格中，展开“故障转移群集管理器”，然后单击“Cluster1.corp.contoso.com”。",
      "pos": [
        10619,
        10671
      ]
    },
    {
      "content": "在中心窗格中，向下滚动到“群集核心资源”部分并展开“名称: Clutser1”详细信息。你应看到“名称”和“IP 地址”资源都处于“已失败”状态。不能将 IP 地址资源联机，因为向该群集分配的 IP 地址与计算机本身的地址相同，地址重复。",
      "pos": [
        10676,
        10795
      ]
    },
    {
      "pos": [
        10800,
        10834
      ],
      "content": "右键单击失败的<bpt id=\"p1\">**</bpt>“IP 地址”<ept id=\"p1\">**</ept>资源，然后单击<bpt id=\"p2\">**</bpt>“属性”<ept id=\"p2\">**</ept>。"
    },
    {
      "content": "群集属性",
      "pos": [
        10842,
        10846
      ]
    },
    {
      "pos": [
        10935,
        10988
      ],
      "content": "选择“静态 IP 地址”，然后在“地址”文本框中指定 <bpt id=\"p1\">**</bpt>10.10.2.101<ept id=\"p1\">**</ept>。然后，单击“确定”。"
    },
    {
      "content": "在“群集核心资源”部分中，右键单击“名称: Cluster1”，然后单击“联机”。然后等待两个资源都已联机。当该群集名称资源联机时，它会用新的 AD 计算机帐户更新 DC 服务器。此 AD 帐户将在以后用于运行可用性组群集服务。",
      "pos": [
        10993,
        11107
      ]
    },
    {
      "content": "最后，你需要向该群集添加剩余节点。在浏览器树中，右键单击“Cluster1.corp.contoso.com”，然后单击“添加节点”，如下所示。",
      "pos": [
        11112,
        11184
      ]
    },
    {
      "content": "向群集添加节点",
      "pos": [
        11192,
        11199
      ]
    },
    {
      "content": "在“添加节点向导”中，单击“下一步”。然后，在“选择服务器”页上，向列表中添加“ContosoSQL2”和“ContosoWSFCNode”，方法是在“输入服务器名称”中键入服务器名称，然后单击“添加”。完成后，单击“下一步”。",
      "pos": [
        11288,
        11402
      ]
    },
    {
      "content": "在“验证警告”页上，单击“否”（在生产方案中，你应执行验证测试）。然后，单击“下一步”。",
      "pos": [
        11407,
        11451
      ]
    },
    {
      "content": "在“确认”页中，单击“下一步”以添加节点。",
      "pos": [
        11456,
        11477
      ]
    },
    {
      "pos": [
        11484,
        11697
      ],
      "content": "<ph id=\"ph1\">[AZURE.WARNING]</ph>如果你使用<bpt id=\"p1\">[</bpt>存储空间<ept id=\"p1\">](https://technet.microsoft.com/zh-cn/library/hh831739)</ept>来将多个磁盘组合到存储池中，则必须取消选中“将所有符合条件的存储添加到群集中”复选框。如果不取消选中该选项，则在群集过程中将分离虚拟磁盘。因此，这些虚拟磁盘也不会出现在磁盘管理器或资源管理器之中，除非从群集中删除存储空间，并使用 PowerShell 将其重新附加。"
    },
    {
      "content": "向群集添加节点后，单击“完成”。“故障转移群集管理器”现在应显示你的群集具有三个节点，并将这些节点在“节点”容器中列出。",
      "pos": [
        11702,
        11762
      ]
    },
    {
      "content": "从远程桌面会话注销。",
      "pos": [
        11767,
        11777
      ]
    },
    {
      "content": "为可用性组准备 SQL Server 实例",
      "pos": [
        11782,
        11803
      ]
    },
    {
      "pos": [
        11805,
        11857
      ],
      "content": "在本部分中，你将针对 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>contosoSQL2<ept id=\"p2\">**</ept> 完成以下操作："
    },
    {
      "pos": [
        11861,
        11925
      ],
      "content": "添加 <bpt id=\"p1\">**</bpt>NT AUTHORITY\\\\System<ept id=\"p1\">**</ept> 的一个登录名，该登录名具有对默认 SQL Server 实例的必要权限集"
    },
    {
      "pos": [
        11929,
        11982
      ],
      "content": "将 <bpt id=\"p1\">**</bpt>CORP\\\\Install<ept id=\"p1\">**</ept> 作为 sysadmin 角色添加到默认 SQL Server 实例"
    },
    {
      "content": "打开防火墙以便远程访问 SQL Server。",
      "pos": [
        11986,
        12009
      ]
    },
    {
      "content": "启用 AlwaysOn 可用性组功能",
      "pos": [
        12013,
        12031
      ]
    },
    {
      "pos": [
        12035,
        12096
      ],
      "content": "将 SQL Server 服务帐户分别更改为 <bpt id=\"p1\">**</bpt>CORP\\\\SQLSvc1<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>CORP\\\\SQLSvc2<ept id=\"p2\">**</ept>。"
    },
    {
      "pos": [
        12098,
        12169
      ],
      "content": "上述操作可按任意顺序执行。不过，以下步骤应按顺序进行。对 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>ContosoSQL2<ept id=\"p2\">**</ept> 按步骤执行操作："
    },
    {
      "content": "如果你具有尚未登录了远程桌面会话的最大为 VM，请现在注销。",
      "pos": [
        12174,
        12204
      ]
    },
    {
      "pos": [
        12209,
        12288
      ],
      "content": "启动 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>ContosoSQL2<ept id=\"p2\">**</ept> 的 RDP 文件，然后以 <bpt id=\"p3\">**</bpt>BUILTIN\\\\AzureAdmin<ept id=\"p3\">**</ept> 身份登录。"
    },
    {
      "pos": [
        12293,
        12385
      ],
      "content": "首先，向 SQL Server 登录帐户添加 <bpt id=\"p1\">**</bpt>NT AUTHORITY\\\\System<ept id=\"p1\">**</ept> 以及必要的权限。启动 <bpt id=\"p2\">**</bpt>SQL Server Management Studio<ept id=\"p2\">**</ept>。"
    },
    {
      "content": "单击“连接”连接到默认 SQL Server 实例。",
      "pos": [
        12390,
        12416
      ]
    },
    {
      "content": "在“对象资源管理器”，展开“安全性”，然后展开“登录名”。",
      "pos": [
        12421,
        12450
      ]
    },
    {
      "content": "右键单击“NT AUTHORITY\\\\System”登录名，然后单击“属性”。",
      "pos": [
        12455,
        12494
      ]
    },
    {
      "content": "在“安全对象”页上，针对本地服务器，选择“授予”以授予以下权限，然后单击“确定”。",
      "pos": [
        12499,
        12540
      ]
    },
    {
      "content": "更改任何可用性组",
      "pos": [
        12552,
        12560
      ]
    },
    {
      "content": "连接 SQL",
      "pos": [
        12572,
        12578
      ]
    },
    {
      "content": "查看服务器状态",
      "pos": [
        12590,
        12597
      ]
    },
    {
      "pos": [
        12602,
        12698
      ],
      "content": "接下来，将 <bpt id=\"p1\">**</bpt>CORP\\\\Install<ept id=\"p1\">**</ept> 作为 <bpt id=\"p2\">**</bpt>sysadmin<ept id=\"p2\">**</ept> 角色添加到默认 SQL Server 实例。在“对象资源管理器”中，右键单击“登录名”，然后单击“新建登录名”。"
    },
    {
      "pos": [
        12703,
        12732
      ],
      "content": "在“登录名”中，键入 <bpt id=\"p1\">**</bpt>CORP\\\\Install<ept id=\"p1\">**</ept>。"
    },
    {
      "content": "在“服务器角色”页上，选择“sysadmin”。然后，单击“确定”。创建登录名后，可通过在“对象资源管理器”中展开“登录名”来查看该登录名。",
      "pos": [
        12737,
        12807
      ]
    },
    {
      "content": "接下来，为 SQL Server 创建防火墙规则。从“开始”屏幕启动“高级安全 Windows 防火墙”。",
      "pos": [
        12812,
        12865
      ]
    },
    {
      "content": "在左窗格中，选择“入站规则”。在右窗格上，单击“新建规则”。",
      "pos": [
        12870,
        12900
      ]
    },
    {
      "content": "在“规则类型”页上，选择“程序”，然后单击“下一步”。",
      "pos": [
        12905,
        12932
      ]
    },
    {
      "pos": [
        12937,
        13137
      ],
      "content": "在“程序”页上，选择“此程序路径”，然后在文本框中键入 <bpt id=\"p1\">**</bpt>%ProgramFiles%\\\\Microsoft SQL Server\\\\MSSQL12.MSSQLSERVER\\\\MSSQL\\\\Binn\\\\sqlservr.exe<ept id=\"p1\">**</ept>（如果你遵循这些指示但使用的是 SQL Server 2012，SQL Server 目录则为 <bpt id=\"p2\">**</bpt>MSSQL11.MSSQLSERVER<ept id=\"p2\">**</ept>）。然后，单击“下一步”。"
    },
    {
      "content": "在“操作”页面中，保持选中“允许连接”，然后单击“下一步”。",
      "pos": [
        13142,
        13172
      ]
    },
    {
      "content": "在“配置文件”页面中，接受默认设置并单击“下一步”。",
      "pos": [
        13177,
        13203
      ]
    },
    {
      "pos": [
        13208,
        13275
      ],
      "content": "在“名称”页上，在“名称”文本框中指定一个规则名称，如 <bpt id=\"p1\">**</bpt>SQL Server (Program Rule)<ept id=\"p1\">**</ept>，然后单击“完成”。"
    },
    {
      "pos": [
        13280,
        13339
      ],
      "content": "接下来，启用 <bpt id=\"p1\">**</bpt>AlwaysOn 可用性组<ept id=\"p1\">**</ept>功能。从“开始”菜单，启动 <bpt id=\"p2\">**</bpt>SQL Server 配置管理器<ept id=\"p2\">**</ept>。"
    },
    {
      "content": "在浏览器树中，单击“SQL Server 服务”，右键单击“SQL Server (MSSQLSERVER)”服务，然后单击“属性”。",
      "pos": [
        13344,
        13411
      ]
    },
    {
      "content": "单击“AlwaysOn 高可用性组”选项卡，选择“启用 AlwaysOn 可用性组”（如下所示），然后单击“应用”。在弹出对话框中，单击“确定”，但不要关闭属性窗口。在更改服务帐户后，将重新启动 SQL Server 服务。",
      "pos": [
        13416,
        13528
      ]
    },
    {
      "content": "启用 AlwaysOn 可用性组",
      "pos": [
        13536,
        13552
      ]
    },
    {
      "pos": [
        13641,
        13778
      ],
      "content": "接下来，更改 SQL Server 服务帐户。单击“登录”选项卡，在“帐户名”中键入 <bpt id=\"p1\">**</bpt>CORP\\\\SQLSvc1<ept id=\"p1\">**</ept>（对于 <bpt id=\"p2\">**</bpt>ContosoSQL1<ept id=\"p2\">**</ept>）或 <bpt id=\"p3\">**</bpt>CORP\\\\SQLSvc2<ept id=\"p3\">**</ept>（对于 <bpt id=\"p4\">**</bpt>ContosoSQL2<ept id=\"p4\">**</ept>），填入并确认密码，然后单击“确定”。"
    },
    {
      "content": "在弹出窗口中，单击“是”重新启动该 SQL Server 服务。重新启动 SQL Server 服务后，在属性窗口中所做的更改即生效。",
      "pos": [
        13783,
        13850
      ]
    },
    {
      "content": "从 VM 注销。",
      "pos": [
        13855,
        13863
      ]
    },
    {
      "content": "创建可用性组",
      "pos": [
        13868,
        13874
      ]
    },
    {
      "content": "此时，你已做好配置可用性组的准备。下面概括了将要执行的操作：",
      "pos": [
        13876,
        13906
      ]
    },
    {
      "pos": [
        13910,
        13947
      ],
      "content": "在 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 上创建新数据库 (<bpt id=\"p2\">**</bpt>MyDB1<ept id=\"p2\">**</ept>)"
    },
    {
      "content": "获取数据库的完整备份和事务日志备份",
      "pos": [
        13951,
        13968
      ]
    },
    {
      "pos": [
        13972,
        14021
      ],
      "content": "使用 <bpt id=\"p1\">**</bpt>NORECOVERY<ept id=\"p1\">**</ept> 选项将完整备份和日志备份还原到 <bpt id=\"p2\">**</bpt>ContosoSQL2<ept id=\"p2\">**</ept>"
    },
    {
      "pos": [
        14025,
        14062
      ],
      "content": "通过同步提交、自动故障转移和可读辅助副本来创建可用性组 (<bpt id=\"p1\">**</bpt>AG1<ept id=\"p1\">**</ept>)"
    },
    {
      "content": "在 ContosoSQL1 上创建 MyDB1 数据库：",
      "pos": [
        14068,
        14096
      ]
    },
    {
      "pos": [
        14101,
        14158
      ],
      "content": "如果你尚未从 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 和 <bpt id=\"p2\">**</bpt>ContosoSQL2<ept id=\"p2\">**</ept> 的远程桌面会话注销，请现在注销。"
    },
    {
      "pos": [
        14163,
        14218
      ],
      "content": "启动 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 的 RDP 文件，然后以 <bpt id=\"p2\">**</bpt>CORP\\\\Install<ept id=\"p2\">**</ept> 身份登录。"
    },
    {
      "pos": [
        14223,
        14281
      ],
      "content": "在“文件资源管理器”中的 C:\\\\ 之下，创建名为 <bpt id=\"p1\">**</bpt>backup<ept id=\"p1\">**</ept> 的目录。你将使用此目录来备份并还原数据库。"
    },
    {
      "content": "右键单击新目录，指向“共享”，然后单击“特定用户”，如下所示。",
      "pos": [
        14286,
        14317
      ]
    },
    {
      "content": "创建备份文件夹",
      "pos": [
        14325,
        14332
      ]
    },
    {
      "content": "创建备份文件夹添加“CORP\\\\SQLSvc1”并授予其“读/写”权限，添加“CORP\\\\SQLSvc2”并授予其“读取”权限（如下所示），然后单击“共享”。文件共享过程完成后，请单击“完成”。",
      "pos": [
        14421,
        14518
      ]
    },
    {
      "content": "授予对备份文件夹的权限",
      "pos": [
        14526,
        14537
      ]
    },
    {
      "pos": [
        14626,
        14710
      ],
      "content": "接下来，你需要创建数据库。从“开始”菜单启动 <bpt id=\"p1\">**</bpt>SQL Server Management Studio<ept id=\"p1\">**</ept>，然后单击“连接”连接到默认 SQL Server 实例。"
    },
    {
      "content": "在“对象资源管理器”中，右键单击“数据库”，然后单击“新建数据库”。",
      "pos": [
        14715,
        14749
      ]
    },
    {
      "pos": [
        14754,
        14786
      ],
      "content": "在“数据库名称”中，键入 <bpt id=\"p1\">**</bpt>MyDB1<ept id=\"p1\">**</ept>，然后单击“确定”。"
    },
    {
      "content": "创建 MyDB1 的完整备份并在 ContosoSQL2 上还原该数据库：",
      "pos": [
        14792,
        14829
      ]
    },
    {
      "content": "接下来，对数据库进行完整备份。在“对象资源管理器”中，展开“数据库”，右键单击“MyDB1”，指向“任务”，然后单击“备份”。",
      "pos": [
        14834,
        14897
      ]
    },
    {
      "content": "在“源”部分中，将“备份类型”设置为“完整”。在“目标”部分中，单击“删除”以删除备份文件的默认文件路径。",
      "pos": [
        14902,
        14955
      ]
    },
    {
      "content": "在“目标”部分中，单击“添加”。",
      "pos": [
        14960,
        14976
      ]
    },
    {
      "pos": [
        14981,
        15081
      ],
      "content": "在“文件名”文本框中，键入 <bpt id=\"p1\">**</bpt>\\\\ContosoSQL1\\\\backup\\\\MyDB1.bak<ept id=\"p1\">**</ept>。然后，单击“确定”，然后再次单击“确定”以备份数据库。备份操作完成后，再次单击“确定”关闭对话框。"
    },
    {
      "content": "接下来，对数据库进行事务日志备份。在“对象资源管理器”中，展开“数据库”，右键单击“MyDB1”，指向“任务”，然后单击“备份”。",
      "pos": [
        15086,
        15151
      ]
    },
    {
      "content": "在“备份类型”中，选择“事务日志”。保持“目标”文件路径设置为此前指定的文件路径，然后单击“确定”。备份操作完成后，再次单击“确定”。",
      "pos": [
        15156,
        15223
      ]
    },
    {
      "pos": [
        15228,
        15350
      ],
      "content": "接下来，在 <bpt id=\"p1\">**</bpt>ContosoSQL2<ept id=\"p1\">**</ept> 上还原完整备份和事务日志备份。启动 <bpt id=\"p2\">**</bpt>ContosoSQL2<ept id=\"p2\">**</ept> 的 RDP 文件，然后以 <bpt id=\"p3\">**</bpt>CORP\\\\Install<ept id=\"p3\">**</ept> 身份登录。将 <bpt id=\"p4\">**</bpt>ContosoSQL1<ept id=\"p4\">**</ept> 的远程桌面会话保持打开。"
    },
    {
      "pos": [
        15355,
        15426
      ],
      "content": "从“开始”菜单启动 <bpt id=\"p1\">**</bpt>SQL Server Management Studio<ept id=\"p1\">**</ept>，然后单击“连接”连接到默认 SQL Server 实例。"
    },
    {
      "content": "在“对象资源管理器”中，右键单击“数据库”，然后单击“还原数据库”。",
      "pos": [
        15431,
        15465
      ]
    },
    {
      "content": "在“源”部分中，选择“设备”，然后单击“...”按钮。",
      "pos": [
        15470,
        15497
      ]
    },
    {
      "content": "在“选择备份设备”中，单击“添加”。",
      "pos": [
        15502,
        15520
      ]
    },
    {
      "content": "在“备份文件位置”中，键入 \\\\ContosoSQL1\\\\backup，单击“刷新”，选择“MyDB1.bak”，单击“确定”，然后再次单击“确定”。现在，你应在“要还原的备份集”窗格中看到完整备份和日志备份。",
      "pos": [
        15525,
        15630
      ]
    },
    {
      "content": "转到“选项”页，在“恢复状态”中选择“RESTORE WITH NORECOVERY”，然后单击“确定”还原数据库。还原操作完成后，单击“确定”。",
      "pos": [
        15635,
        15708
      ]
    },
    {
      "content": "创建可用性组：",
      "pos": [
        15714,
        15721
      ]
    },
    {
      "pos": [
        15726,
        15814
      ],
      "content": "返回到 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 的远程桌面会话。在 SSMS 中的“对象资源管理器”中，右键单击“AlwaysOn 高可用性”，然后单击“新建可用性组向导”，如下所示。"
    },
    {
      "content": "启动新建可用性组向导",
      "pos": [
        15822,
        15832
      ]
    },
    {
      "pos": [
        15921,
        15984
      ],
      "content": "在“简介”页上，单击“下一步”。在“指定可用性组名称”页上，在“可用性组名称”中键入 <bpt id=\"p1\">**</bpt>AG1<ept id=\"p1\">**</ept>，然后再次单击“下一步”。"
    },
    {
      "content": "新建可用性组向导，指定可用性组名称",
      "pos": [
        15992,
        16009
      ]
    },
    {
      "content": "在“选择数据库”页上，选择“MyDB1”，然后单击“下一步”。这些数据库满足可用性组的先决条件，因为你针对预定主副本进行了至少一个完整备份。",
      "pos": [
        16098,
        16168
      ]
    },
    {
      "content": "新建可用性组向导，选择数据库",
      "pos": [
        16176,
        16190
      ]
    },
    {
      "content": "在“指定副本”页上，单击“添加副本”。",
      "pos": [
        16279,
        16298
      ]
    },
    {
      "content": "新建可用性组向导，指定副本",
      "pos": [
        16306,
        16319
      ]
    },
    {
      "pos": [
        16408,
        16462
      ],
      "content": "此时会弹出“连接到服务器”对话框。在“服务器名称”中键入 <bpt id=\"p1\">**</bpt>ContosoSQL2<ept id=\"p1\">**</ept>，然后单击“连接”。"
    },
    {
      "content": "新建可用性组向导，连接到服务器",
      "pos": [
        16470,
        16485
      ]
    },
    {
      "pos": [
        16574,
        16642
      ],
      "content": "返回到“指定副本”页，此时应看到“可用的副本”中列出了 <bpt id=\"p1\">**</bpt>ContosoSQL2<ept id=\"p1\">**</ept>。配置这些副本，如下所示。完成后，单击“下一步”。"
    },
    {
      "content": "新建可用性组向导，指定副本（完整）",
      "pos": [
        16650,
        16667
      ]
    },
    {
      "pos": [
        16756,
        16935
      ],
      "content": "在“选择初始数据同步”页上，选择“仅联接”，然后单击“下一步”。在对 <bpt id=\"p1\">**</bpt>ContosoSQL1<ept id=\"p1\">**</ept> 进行完整备份和事务备份并在 <bpt id=\"p2\">**</bpt>ContosoSQL2<ept id=\"p2\">**</ept> 上还原这些备份时，你已手动执行了数据同步。你也可以选择不对数据库执行备份和还原操作，并选择“完整”以便让“新建可用性组向导”为你执行数据同步。不过，对于某些企业中存在的超大型数据库，不建议这样做。"
    },
    {
      "content": "新建可用性组向导，选择初始数据同步",
      "pos": [
        16943,
        16960
      ]
    },
    {
      "pos": [
        17049,
        17284
      ],
      "content": "在“验证”页中，单击“下一步”。此页应与以下页类似。因为你尚未配置可用性组侦听器，会出现一个侦听器配置警告。你可以忽略此警告，因为本教程不会配置侦听器。若要在完成本教程后配置侦听器，请参阅<bpt id=\"p1\">[</bpt>在 Azure 中配置 AlwaysOn 可用性组的 ILB 侦听器<ept id=\"p1\">](/documentation/articles/virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener)</ept>。"
    },
    {
      "content": "新建可用性组向导，验证",
      "pos": [
        17292,
        17303
      ]
    },
    {
      "content": "在“摘要”页上，单击“完成”，然后等待向导配置完新的可用性组。在“进度”页上，可单击“更多详细信息”以查看详细进度。向导运行完成后，检查“结果”页以验证是否已成功创建可用性组（如下所示），然后单击“关闭”退出向导。",
      "pos": [
        17392,
        17499
      ]
    },
    {
      "content": "新建可用性组向导，结果",
      "pos": [
        17507,
        17518
      ]
    },
    {
      "content": "在“对象资源管理器”中，展开“AlwaysOn 高可用性”，然后展开“可用性组”。此时，你应在此容器中看到新的可用性组。右键单击“AG1 (主)”，然后单击“显示仪表板”。",
      "pos": [
        17607,
        17693
      ]
    },
    {
      "content": "显示可用性组仪表板",
      "pos": [
        17701,
        17710
      ]
    },
    {
      "pos": [
        17799,
        17847
      ],
      "content": "<bpt id=\"p1\">**</bpt>AlwaysOn 仪表板<ept id=\"p1\">**</ept>应如下所示。你可以查看副本、每个副本的故障转移模式以及同步状态。"
    },
    {
      "content": "可用性组仪表板",
      "pos": [
        17855,
        17862
      ]
    },
    {
      "content": "返回到“服务器管理器”，选择“工具”，然后启动“故障转移群集管理器”。",
      "pos": [
        17951,
        17986
      ]
    },
    {
      "pos": [
        17991,
        18141
      ],
      "content": "展开 <bpt id=\"p1\">**</bpt>Cluster1.corp.contoso.com<ept id=\"p1\">**</ept>，然后展开“服务和应用程序”。选择“角色”，并注意已创建“AG1”可用性组角色。请注意，AG1 没有数据库客户端可按其连接到可用性组的 IP 地址，因为你未配置侦听器。你可以直接连接到主节点进行读写操作，直接连接到辅助节点进行只读查询。"
    },
    {
      "content": "故障转移群集管理器中的可用性组",
      "pos": [
        18149,
        18164
      ]
    },
    {
      "pos": [
        18251,
        18426
      ],
      "content": "<ph id=\"ph1\">[AZURE.WARNING]</ph>请勿尝试从故障转移群集管理器对可用性组进行故障转移。所有故障转移操作都应在 SSMS 中的 <bpt id=\"p1\">**</bpt>AlwaysOn 仪表板<ept id=\"p1\">**</ept>内进行。有关详细信息，请参阅<bpt id=\"p2\">[</bpt>将 WSFC 故障转移群集管理器用于可用性组的限制<ept id=\"p2\">](https://msdn.microsoft.com/zh-cn/library/ff929171.aspx)</ept>。"
    },
    {
      "content": "后续步骤",
      "pos": [
        18431,
        18435
      ]
    },
    {
      "pos": [
        18436,
        18643
      ],
      "content": "现在，你已通过在 Azure 中创建可用性组，成功实施了 SQL Server AlwaysOn。若要为此可用性组配置侦听器，请参阅<bpt id=\"p1\">[</bpt>在 Azure 中配置 AlwaysOn 可用性组的 ILB 侦听器<ept id=\"p1\">](/documentation/articles/virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener)</ept>。"
    },
    {
      "pos": [
        18645,
        18782
      ],
      "content": "有关在 Azure 中使用 SQL Server 的其他信息，请参阅 <bpt id=\"p1\">[</bpt>Azure 虚拟机上的 SQL Server<ept id=\"p1\">](/documentation/articles/virtual-machines-sql-server-infrastructure-services)</ept>。"
    }
  ],
  "content": "<properties \n    pageTitle=\"在 Azure 中配置 AlwaysOn 可用性组 (GUI)\"\n    description=\"在 Azure 虚拟机中创建 AlwaysOn 可用性组。本教程主要使用用户界面和工具而不是脚本。\"\n    services=\"virtual-machines\"\n    documentationCenter=\"na\"\n    authors=\"rothja\"\n    manager=\"jeffreyg\"\n    editor=\"monicar\" />\n<tags \n    ms.service=\"virtual-machines\"\n    ms.date=\"12/04/2015\"\n    wacn.date=\"03/03/2016\" />\n\n# 在 Azure 中配置 AlwaysOn 可用性组 (GUI)\n\n本端到端教程介绍如何使用 Azure 虚拟机上运行的 SQL Server AlwaysOn 实施可用性组。\n\n>[AZURE.NOTE]在 Azure 管理门户中，为包含 AlwaysOn 可用性组设置了一个包含侦听器的新库。该库可自动为你配置 AlwaysOn 可用性组的所有设置。有关详细信息，请参阅 [Azure 门户库中的 SQL Server AlwaysOn 产品](http://blogs.technet.com/b/dataplatforminsider/archive/2014/08/25/sql-server-alwayson-offering-in-microsoft-azure-portal-gallery.aspx)。若要使用 PowerShell，请参阅同一方案的[教程：Azure 中的 AlwaysOn 可用性组 (PowerShell)](https://msdn.microsoft.com/zh-cn/library/azure/jj870963.aspx)。\n\n完成本教程后，Azure 中的 SQL Server AlwaysOn 解决方案将包括以下要素：\n\n- 一个包含多个子网（包括前端子网和后端子网）的虚拟网络\n\n- 包含 Active Directory (AD) 域的域控制器\n\n- 部署到后端子网并加入 AD 域的两个 SQL Server VM\n\n- 具有节点多数仲裁模型的 3 节点 WSFC 群集\n\n- 具有可用性数据库的两个同步提交副本的可用性组\n\n下图显示了该解决方案的示意图。\n\n![zure 中可用性组的测试实验体系结构](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC791912.png)\n\n请注意，这是一个可能的配置。例如，你可最大程度减少 2 副本可用性组的虚拟机数目，以便通过将域控制器作为 2 节点 WSFC 群集中的仲裁文件共享见证服务器来节省 Azure 中的计算时间。通过此方法，上述配置中的 VM 数目可以减少一个。\n\n本教程的假设条件如下：\n\n- 你已有一个 Azure 帐户。\n\n- 你已经知道如何使用 GUI 从虚拟机库预配 SQL Server VM。有关详细信息，请参阅[在 Azure 上预配 SQL Server 虚拟机](/documentation/articles/virtual-machines-provision-sql-server)\n\n- 你已经深入了解 AlwaysOn 可用性组。有关详细信息，请参阅 [AlwaysOn 可用性组 (SQL Server)](https://msdn.microsoft.com/zh-cn/library/hh510230.aspx)。\n\n>[AZURE.NOTE]如果你想将 AlwaysOn 可用性组与 SharePoint 结合使用，另请参阅[为 SharePoint 2013 配置 SQL Server 2012 AlwaysOn 可用性组](https://technet.microsoft.com/zh-cn/library/jj715261.aspx)。\n\n## 创建虚拟网络和域控制器服务器\n\n你将从一个新的 Azure 试用帐户开始。完成帐户设置后，你会进入 Azure 门户的主页屏幕。\n\n1. 单击该页左下角的“新建”按钮，如下所示。\n\n    ![在门户中单击“新建”](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665511.gif)\n\n1. 依次单击“网络服务”、“虚拟网络”、“自定义创建”，如下所示。\n\n    ![创建虚拟网络](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665512.gif)\n\n1. 在“创建虚拟网络”对话框中，通过逐页完成以下设置创建新的虚拟网络。\n\n    |Page|设置|\n|---|---|\n|虚拟网络详细信息|**名称 = ContosoNET**<br/>**区域 = 中国北部**|\n|DNS 服务器和 VPN 连接|无|\n|虚拟网络地址空间|设置显示在以下屏幕截图中：![创建虚拟网络](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784620.png)|\n\n1. 接下来，你将创建用作域控制器 (DC) 的 VM。再次单击“新建”，然后依次单击“计算”、“虚拟机”、“从库中”，如下所示。\n\n    ![创建 VM](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784621.png)\n\n1. 在“创建虚拟机”对话框中，逐页完成以下设置来配置新 VM。\n\n    |Page|设置|\n|---|---|\n|选择虚拟机操作系统|Windows Server 2012 R2 Datacenter|\n|虚拟机配置|**版本发布日期** =（最新）<br/>**虚拟机名称** = ContosoDC<br/>**层** = 基本<br/>**大小** = A2（双核）<br/>**新用户名** = AzureAdmin<br/>**新密码** = Contoso!000<br/>**确认密码** = Contoso!000|\n|虚拟机配置|**云服务** = 创建新的云服务<br/>**云服务 DNS 名称** = 唯一的云服务名称<br/>**DNS 名称** = 唯一名称（例如：ContosoDC123）<br/>**区域/地缘组/虚拟网络** = ContosoNET<br/>**虚拟网络子网** = Back(10.10.2.0/24)<br/>**存储帐户** = 使用自动生成的存储帐户<br/>**可用性集** =（无）|\n|虚拟机选项|使用默认值|\n\n配置完新虚拟机后，请等待对 VM 设置完成。此过程要用一些时间才能完成，并且，如果你单击 Azure 门户中的“虚拟机”选项卡，则可以看到 ContosoDC 逐一经历状态“正在启动(预配)”、“已停止”、“正在启动”、“正在运行(预配)”和最后的“正在运行”。\n\n现在已成功预配 DC 服务器。接下来，请在 DC 服务器上配置 Active Directory 域。\n\n## 配置域控制器\n\n在以下步骤中，你可以将 ContosoDC 计算机配置为 corp.contoso.com 的域控制器。\n\n1. 在门户中，选择 **ContosoDC** 计算机。在“仪表板”选项卡上，单击“连接”以打开用于远程桌面访问 RDP 文件。\n\n    ![连接到虚拟机](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784622.png)\n\n1. 使用已配置的管理员帐户 (**\\\\AzureAdmin**) 和密码 (**Contoso!000**) 登录。\n\n1. 默认情况下，应显示“服务器管理器”仪表板。\n\n1. 单击仪表板上的“添加角色和功能”链接。\n\n    ![服务器资源管理器中的“添加角色”](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784623.png)\n\n1. 选择“下一步”，直到你到达“服务器角色”部分。\n\n1. 选择“Active Directory 域服务”和“DNS 服务器”角色。出现提示时，添加这些角色所需的任何其他功能。\n\n    >[AZURE.NOTE]你将收到无静态 IP 地址的验证警告。如果你要测试配置，请单击“继续”。对于生产方案，请[使用 PowerShell 设置域控制器计算机的静态 IP 地址](/documentation/articles/virtual-networks-reserved-private-ip)。\n\n    ![添加角色对话框](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784624.png)\n\n1. 单击“下一步”，直到你到达“确认”部分。选中“必要时自动重新启动目标服务器”复选框。\n\n1. 单击“安装”。\n\n1. 功能安装完毕后，返回到“服务器管理器”仪表板。\n\n1. 选择左侧窗格中的新“AD DS”选项。\n\n1. 单击黄色警告栏上的“更多”链接。\n\n    ![DNS 服务器 VM 上的 AD DS 对话框](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784625.png)\n\n1. 在“所有服务器任务详细信息”对话框的“操作”栏中，单击“将此服务器提升为域控制器”。\n\n1. 在“Active Directory 域服务配置向导”中，使用以下值：\n\n    |Page|设置|\n|---|---|\n|部署配置|**添加新林** = 选定<br/>**根域名** = corp.contoso.com|\n|域控制器选项|**密码** = Contoso!000<br/>**确认密码** = Contoso!000|\n\n1. 单击“下一步”以浏览向导中的其他页。在“必备项检查”页上，确认你看到以下消息：“所有先决条件检查都成功通过”。请注意，你应查看任何适用的警告消息，但可以继续安装。\n\n1. 单击“安装”。**ContosoDC** 虚拟机将自动重新启动。\n\n## 配置域帐户\n\n接下来的步骤用于配置 Active Directory (AD) 帐户以供稍后使用。\n\n1. 重新登录到 **ContosoDC** 计算机。\n\n1. 在“服务器管理器”中，选择“工具”，然后单击“Active Directory 管理中心”。\n\n    ![Active Directory 管理中心](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784626.png)\n\n1. 在“Active Directory 管理中心”的左窗格中，选择“corp (本地)”。\n\n1. 在右侧的“任务”窗格中，选择“新建”，然后单击“用户”。使用以下设置：\n\n    |设置|值|\n|---|---|\n|**名字**|安装|\n|**用户 SamAccountName**|安装|\n|**密码**|Contoso!000|\n|**确认密码**|Contoso!000|\n|**其他密码选项**|选定|\n|**密码永不过期**|已选中|\n\n1. 单击“确定”以创建 **Install** 用户。此帐户将用于配置故障转移群集和可用性组。\n\n1. 使用相同的步骤创建两个其他用户：**CORP\\\\SQLSvc1** 和 **CORP\\\\SQLSvc2**。这些帐户将用于 SQL Server 实例。接下来，你需要为 **CORP\\\\Install** 分配所需权限以配置 Windows Server 故障转移群集 (WSFC)。\n\n1. 在“Active Directory 管理中心”的左窗格中，选择“corp (本地)”。然后，在右侧的“任务”窗格中，单击“属性”。\n\n    ![CORP 用户属性](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784627.png)\n\n1. 选择“扩展”，然后单击“安全性”选项卡上的“高级”按钮。\n\n1. 在“corp 的高级安全设置”对话框中，单击**“添加”**。\n\n1. 单击“选择主体”。然后，搜索 **CORP\\\\Install**。单击**“确定”**。\n\n1. 选择“读取全部属性”和“创建计算机对象”权限。\n\n    ![CORP 用户权限](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784628.png)\n\n1. 单击“确定”，然后再次单击“确定”。关闭 corp 属性窗口。\n\n现在你已完成 Active Directory 和用户对象的配置，接下来，你将创建三个 SQL Server VM 并将其加入到此域中。\n\n## 创建 SQL Server VM\n\n接下来，创建三个 VM，包括 WSFC 群集节点和两个 SQL Server VM。若要创建每个 VM，请返回到 Azure 门户，然后依次单击“新建”、“计算”、“虚拟机”和“从库中”。然后，使用下表中的模板来帮助创建 VM。\n\n|Page|VM1|VM2|VM3|\n|---|---|---|---|\n|选择虚拟机操作系统|**Windows Server 2012 R2 Datacenter**|**SQL Server 2014 RTM Enterprise**|**SQL Server 2014 RTM Enterprise**|\n|虚拟机配置|**版本发布日期** =（最新）<br/>**虚拟机名称** = ContosoWSFCNode<br/>**层** = 基本<br/>**大小** = A2（双核）<br/>**新用户名** = AzureAdmin<br/>**新密码** = Contoso!000<br/>**确认密码** = Contoso!000|**版本发布日期** =（最新）<br/>**虚拟机名称** = ContosoSQL1<br/>**层** = 基本<br/>**大小** = A3（4 核）<br/>**新用户名** = AzureAdmin<br/>**新密码** = Contoso!000<br/>**确认密码** = Contoso!000|**版本发布日期** =（最新）<br/>**虚拟机名称** = ContosoSQL2<br/>**层** = 基本<br/>**大小** = A3（4 核）<br/>**新用户名** = AzureAdmin<br/>**新密码** = Contoso!000<br/>**确认密码** = Contoso!000|\n|虚拟机配置|**云服务** = 之前创建的唯一云服务 DNS 名称（例如：ContosoDC123）<br/>**区域/地缘组/虚拟网络** = ContosoNET<br/>**虚拟网络子网** = Back(10.10.2.0/24)<br/>**存储帐户** = 使用自动生成的存储帐户<br/>**可用性集** = 创建可用性集<br/>**可用性集名称** = SQLHADR|**云服务** = 之前创建的唯一云服务 DNS 名称（例如：ContosoDC123）<br/>**区域/地缘组/虚拟网络** = ContosoNET<br/>**虚拟网络子网** = Back(10.10.2.0/24)<br/>**存储帐户** = 使用自动生成的存储帐户<br/>**可用性集** = SQLHADR（也可以在创建计算机后配置可用性集。所有三个计算机都应分配到 SQLHADR 可用性集。）|**云服务** = 之前创建的唯一云服务 DNS 名称（例如：ContosoDC123）<br/>**区域/地缘组/虚拟网络** = ContosoNET<br/>**虚拟网络子网** = Back(10.10.2.0/24)<br/>**存储帐户** = 使用自动生成的存储帐户<br/>**可用性集** = SQLHADR（也可以在创建计算机后配置可用性集。所有三个计算机都应分配到 SQLHADR 可用性集。）|\n|虚拟机选项|使用默认值|使用默认值|使用默认值|\n\n在三个虚拟机预配完毕之后，你需要将它们加入到 **corp.contoso.com** 域中，并向这些虚拟机授予 CORP\\\\Install 管理权限。为此，请针对三个虚拟机中的每一个按以下步骤操作。\n\n1. 首先，更改首选 DNS 服务器地址。通过在列表中选择 VM 并单击“连接”按钮，先将每个 VM 的远程桌面 (RDP) 文件下载到本地目录。若要选择 VM，请在该行中除第一个单元外的任意位置单击，如下所示。\n\n    ![下载 RDP 文件](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC664953.jpg)\n\n1. 下载 RDP 文件启动下载的 RDP 文件，并使用已配置的管理员帐户 (**BUILTIN\\\\AzureAdmin**) 和密码 (**Contoso!000**) 登录到 VM 中。\n\n1. 一旦登录，你应看到“服务器管理器”仪表板。单击左窗格中的“本地服务器”。\n\n1. 选择“由 DHCP 分配的启用 IPv6 的 IPv4 地址”链接。\n\n1. 在“网络连接”窗口中，选择网络图标。\n\n    ![更改 VM 的首选 DNS 服务器](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784629.png)\n\n1. 在命令栏中，单击“更改此连接的设置”（根据你的窗口大小，你可能需要单击双右箭头才能看到此命令）。\n\n1. 选择“Internet 协议版本 4 (TCP/IPv4)”，然后单击“属性”。\n\n1. 选择“使用以下 DNS 服务器地址”，并在“首选 DNS 服务器”中指定 10.10.2.4。\n\n1. 地址 **10.10.2.4** 是分配到 Azure 虚拟网络中 10.10.2.0/24 子网中的 VM 的地址，而该 VM 是 **ContosoDC**。若要验证 **ContosoDC** 的 IP 地址，请在命令提示符中使用 **nslookup contosodc**，如下所示。\n\n    ![使用 NSLOOKUP 查找 DC 的 IP 地址](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC664954.jpg)\n\n1. 单击“确定”，然后“关闭”以提交更改。你现在能够将该 VM 加入到 **corp.contoso.com** 中。\n\n1. 再次在“本地服务器”窗口中，单击“工作组”链接。\n\n1. 在“计算机名”选项上，单击“更改”。\n\n1. 选中“域”复选框并在文本框中键入 **corp.contoso.com**。单击“确定”。\n\n1. 在“Windows 安全性”弹出对话框中，指定默认域管理员帐户 (**CORP\\\\AzureAdmin**) 和密码 (**Contoso!000**) 的凭据。\n\n1. 在看到“欢迎使用 corp.contoso.com 域”消息时，请单击“确定”。\n\n1. 单击“关闭”，然后单击弹出对话框中的“立即重新启动”。\n\n### 接下来，添加 Corp\\\\Install 用户作为每个 VM 上的管理员：\n\n1. 一直等到 VM 重新启动，然后再次启动 RDP 文件以使用 **BUILTIN\\\\AzureAdmin** 帐户登录到 VM 中。\n\n1. 在“服务器管理器”中，选择“工具”，然后单击“计算机管理”。\n\n    ![计算机管理](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784630.png)\n\n1. 在“计算机管理”窗口中，展开“本地用户和组”，然后选择“组”。\n\n1. 双击“管理员”组。\n\n1. 在“管理员属性”对话框中，单击“添加”按钮。\n\n1. 输入用户 **CORP\\\\Install**，然后单击“确定”。当系统提示你输入凭据时，使用 **AzureAdmin** 帐户与 **Contoso!000** 密码。\n\n1. 单击“确定”以关闭“管理员属性”对话框。\n\n### 接下来，将**故障转移群集**功能功能添加到每个 VM。\n\n1. 在“服务器管理器”仪表板中，单击“添加角色和功能”。\n\n1. 在“添加角色和功能向导”中，单击“下一步”，直到出现“功能”页。\n\n1. 选择“故障转移群集”。出现提示时，请添加任何其他相关功能。\n\n    ![向 VM 添加故障转移群集功能](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784631.png)\n\n1. 单击“下一步”，然后单击“确认”页上的“安装”。\n\n1. “故障转移群集”功能安装完成后，单击“关闭”。\n\n1. 从 VM 注销。\n\n1. 针对所有三个服务器（**ContosoWSFCNode**、**ContosoSQL1** 和 **ContosoSQL2**）重复本部分中的步骤。\n\n这些 SQL Server VM 现在已预配并正在运行，但它们是使用默认选项与 SQL Server 一同安装的。\n\n## 创建 WSFC 群集\n\n在本部分中，你将创建托管要在以后创建的可用性组的 WSFC 群集。至此，你应该已针对将在 WSFC 群集中使用的三个 VM 中的每个 VM 完成了以下操作：\n\n- 在 Azure 中进行了完全预配\n\n- 已将 VM 加入到域中\n\n- 已将 **CORP\\\\Install** 添加到本地管理员组\n\n- 添加了故障转移群集功能\n\n必须在每个 VM 上执行所有这些操作，才能将该 VM 加入到 WSFC 群集中。\n\n另请注意，Azure 虚拟网络的行为与本地网络不同。你需要按以下顺序来创建群集：\n\n1. 在其中一个节点 (**ContosoSQL1**) 上创建单节点群集。\n\n1. 将群集 IP 地址修改为未使用的 IP 地址 (**10.10.2.101**)。\n\n1. 将群集名称联机。\n\n1. 添加其他节点（**ContosoSQL2** 和 **ContosoWSFCNode**）。\n\n按照以下步骤完成完全配置群集的这些任务。\n\n1. 启动 **ContosoSQL1** 的 RDP 文件，然后使用域帐户 **CORP\\\\Install** 登录。\n\n1. 在“服务器管理器”仪表板中，选择“工具”，然后单击“故障转移群集管理器”。\n\n1. 在左窗格中，右键单击“故障转移群集管理器”，然后单击“创建群集”，如下所示。\n\n    ![创建群集](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784632.png)\n\n1. 在“创建群集向导”中，逐页完成以下设置来创建一个单节点群集：\n\n    |Page|设置|\n|---|---|\n|开始之前|使用默认值|\n|选择服务器|在“输入服务器名称”中键入 **ContosoSQL1**，然后单击“添加”|\n|验证警告|选择**“否。不需要 Microsoft 对该群集的支持，因此不希望运行验证测试。单击‘下一步’时，继续创建群集。**”|\n|用于管理群集的访问点|在“群集名称”中键入 **Cluster1**|\n|确认|除非你使用的是存储空间，否则请使用默认值。请参阅此表后面的备注。|\n\n    >[AZURE.WARNING]如果你使用[存储空间](https://technet.microsoft.com/zh-cn/library/hh831739)来将多个磁盘组合到存储池中，则必须取消选中“确认”页上的“将所有符合条件的存储添加到群集中”复选框。如果不取消选中该选项，则在群集过程中将分离虚拟磁盘。因此，这些虚拟磁盘也不会出现在磁盘管理器或资源管理器之中，除非从群集中删除存储空间，并使用 PowerShell 将其重新附加。\n\n1. 在左窗格中，展开“故障转移群集管理器”，然后单击“Cluster1.corp.contoso.com”。\n\n1. 在中心窗格中，向下滚动到“群集核心资源”部分并展开“名称: Clutser1”详细信息。你应看到“名称”和“IP 地址”资源都处于“已失败”状态。不能将 IP 地址资源联机，因为向该群集分配的 IP 地址与计算机本身的地址相同，地址重复。\n\n1. 右键单击失败的**“IP 地址”**资源，然后单击**“属性”**。\n\n    ![群集属性](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784633.png)\n\n1. 选择“静态 IP 地址”，然后在“地址”文本框中指定 **10.10.2.101**。然后，单击“确定”。\n\n1. 在“群集核心资源”部分中，右键单击“名称: Cluster1”，然后单击“联机”。然后等待两个资源都已联机。当该群集名称资源联机时，它会用新的 AD 计算机帐户更新 DC 服务器。此 AD 帐户将在以后用于运行可用性组群集服务。\n\n1. 最后，你需要向该群集添加剩余节点。在浏览器树中，右键单击“Cluster1.corp.contoso.com”，然后单击“添加节点”，如下所示。\n\n    ![向群集添加节点](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC784634.png)\n\n1. 在“添加节点向导”中，单击“下一步”。然后，在“选择服务器”页上，向列表中添加“ContosoSQL2”和“ContosoWSFCNode”，方法是在“输入服务器名称”中键入服务器名称，然后单击“添加”。完成后，单击“下一步”。\n\n1. 在“验证警告”页上，单击“否”（在生产方案中，你应执行验证测试）。然后，单击“下一步”。\n\n1. 在“确认”页中，单击“下一步”以添加节点。\n\n    >[AZURE.WARNING]如果你使用[存储空间](https://technet.microsoft.com/zh-cn/library/hh831739)来将多个磁盘组合到存储池中，则必须取消选中“将所有符合条件的存储添加到群集中”复选框。如果不取消选中该选项，则在群集过程中将分离虚拟磁盘。因此，这些虚拟磁盘也不会出现在磁盘管理器或资源管理器之中，除非从群集中删除存储空间，并使用 PowerShell 将其重新附加。\n\n1. 向群集添加节点后，单击“完成”。“故障转移群集管理器”现在应显示你的群集具有三个节点，并将这些节点在“节点”容器中列出。\n\n1. 从远程桌面会话注销。\n\n## 为可用性组准备 SQL Server 实例\n\n在本部分中，你将针对 **ContosoSQL1** 和 **contosoSQL2** 完成以下操作：\n\n- 添加 **NT AUTHORITY\\\\System** 的一个登录名，该登录名具有对默认 SQL Server 实例的必要权限集\n\n- 将 **CORP\\\\Install** 作为 sysadmin 角色添加到默认 SQL Server 实例\n\n- 打开防火墙以便远程访问 SQL Server。\n\n- 启用 AlwaysOn 可用性组功能\n\n- 将 SQL Server 服务帐户分别更改为 **CORP\\\\SQLSvc1** 和 **CORP\\\\SQLSvc2**。\n\n上述操作可按任意顺序执行。不过，以下步骤应按顺序进行。对 **ContosoSQL1** 和 **ContosoSQL2** 按步骤执行操作：\n\n1. 如果你具有尚未登录了远程桌面会话的最大为 VM，请现在注销。\n\n1. 启动 **ContosoSQL1** 和 **ContosoSQL2** 的 RDP 文件，然后以 **BUILTIN\\\\AzureAdmin** 身份登录。\n\n1. 首先，向 SQL Server 登录帐户添加 **NT AUTHORITY\\\\System** 以及必要的权限。启动 **SQL Server Management Studio**。\n\n1. 单击“连接”连接到默认 SQL Server 实例。\n\n1. 在“对象资源管理器”，展开“安全性”，然后展开“登录名”。\n\n1. 右键单击“NT AUTHORITY\\\\System”登录名，然后单击“属性”。\n\n1. 在“安全对象”页上，针对本地服务器，选择“授予”以授予以下权限，然后单击“确定”。\n    \n    - 更改任何可用性组\n    \n    - 连接 SQL\n    \n    - 查看服务器状态\n\n1. 接下来，将 **CORP\\\\Install** 作为 **sysadmin** 角色添加到默认 SQL Server 实例。在“对象资源管理器”中，右键单击“登录名”，然后单击“新建登录名”。\n\n1. 在“登录名”中，键入 **CORP\\\\Install**。\n\n1. 在“服务器角色”页上，选择“sysadmin”。然后，单击“确定”。创建登录名后，可通过在“对象资源管理器”中展开“登录名”来查看该登录名。\n\n1. 接下来，为 SQL Server 创建防火墙规则。从“开始”屏幕启动“高级安全 Windows 防火墙”。\n\n1. 在左窗格中，选择“入站规则”。在右窗格上，单击“新建规则”。\n\n1. 在“规则类型”页上，选择“程序”，然后单击“下一步”。\n\n1. 在“程序”页上，选择“此程序路径”，然后在文本框中键入 **%ProgramFiles%\\\\Microsoft SQL Server\\\\MSSQL12.MSSQLSERVER\\\\MSSQL\\\\Binn\\\\sqlservr.exe**（如果你遵循这些指示但使用的是 SQL Server 2012，SQL Server 目录则为 **MSSQL11.MSSQLSERVER**）。然后，单击“下一步”。\n\n1. 在“操作”页面中，保持选中“允许连接”，然后单击“下一步”。\n\n1. 在“配置文件”页面中，接受默认设置并单击“下一步”。\n\n1. 在“名称”页上，在“名称”文本框中指定一个规则名称，如 **SQL Server (Program Rule)**，然后单击“完成”。\n\n1. 接下来，启用 **AlwaysOn 可用性组**功能。从“开始”菜单，启动 **SQL Server 配置管理器**。\n\n1. 在浏览器树中，单击“SQL Server 服务”，右键单击“SQL Server (MSSQLSERVER)”服务，然后单击“属性”。\n\n1. 单击“AlwaysOn 高可用性组”选项卡，选择“启用 AlwaysOn 可用性组”（如下所示），然后单击“应用”。在弹出对话框中，单击“确定”，但不要关闭属性窗口。在更改服务帐户后，将重新启动 SQL Server 服务。\n\n    ![启用 AlwaysOn 可用性组](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665520.gif)\n\n1. 接下来，更改 SQL Server 服务帐户。单击“登录”选项卡，在“帐户名”中键入 **CORP\\\\SQLSvc1**（对于 **ContosoSQL1**）或 **CORP\\\\SQLSvc2**（对于 **ContosoSQL2**），填入并确认密码，然后单击“确定”。\n\n1. 在弹出窗口中，单击“是”重新启动该 SQL Server 服务。重新启动 SQL Server 服务后，在属性窗口中所做的更改即生效。\n\n1. 从 VM 注销。\n\n## 创建可用性组\n\n此时，你已做好配置可用性组的准备。下面概括了将要执行的操作：\n\n- 在 **ContosoSQL1** 上创建新数据库 (**MyDB1**)\n\n- 获取数据库的完整备份和事务日志备份\n\n- 使用 **NORECOVERY** 选项将完整备份和日志备份还原到 **ContosoSQL2**\n\n- 通过同步提交、自动故障转移和可读辅助副本来创建可用性组 (**AG1**)\n\n### 在 ContosoSQL1 上创建 MyDB1 数据库：\n\n1. 如果你尚未从 **ContosoSQL1** 和 **ContosoSQL2** 的远程桌面会话注销，请现在注销。\n\n1. 启动 **ContosoSQL1** 的 RDP 文件，然后以 **CORP\\\\Install** 身份登录。\n\n1. 在“文件资源管理器”中的 C:\\\\ 之下，创建名为 **backup** 的目录。你将使用此目录来备份并还原数据库。\n\n1. 右键单击新目录，指向“共享”，然后单击“特定用户”，如下所示。\n\n    ![创建备份文件夹](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665521.gif)\n\n1. 创建备份文件夹添加“CORP\\\\SQLSvc1”并授予其“读/写”权限，添加“CORP\\\\SQLSvc2”并授予其“读取”权限（如下所示），然后单击“共享”。文件共享过程完成后，请单击“完成”。\n\n    ![授予对备份文件夹的权限](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665522.gif)\n\n1. 接下来，你需要创建数据库。从“开始”菜单启动 **SQL Server Management Studio**，然后单击“连接”连接到默认 SQL Server 实例。\n\n1. 在“对象资源管理器”中，右键单击“数据库”，然后单击“新建数据库”。\n\n1. 在“数据库名称”中，键入 **MyDB1**，然后单击“确定”。\n\n### 创建 MyDB1 的完整备份并在 ContosoSQL2 上还原该数据库：\n\n1. 接下来，对数据库进行完整备份。在“对象资源管理器”中，展开“数据库”，右键单击“MyDB1”，指向“任务”，然后单击“备份”。\n\n1. 在“源”部分中，将“备份类型”设置为“完整”。在“目标”部分中，单击“删除”以删除备份文件的默认文件路径。\n\n1. 在“目标”部分中，单击“添加”。\n\n1. 在“文件名”文本框中，键入 **\\\\ContosoSQL1\\\\backup\\\\MyDB1.bak**。然后，单击“确定”，然后再次单击“确定”以备份数据库。备份操作完成后，再次单击“确定”关闭对话框。\n\n1. 接下来，对数据库进行事务日志备份。在“对象资源管理器”中，展开“数据库”，右键单击“MyDB1”，指向“任务”，然后单击“备份”。\n\n1. 在“备份类型”中，选择“事务日志”。保持“目标”文件路径设置为此前指定的文件路径，然后单击“确定”。备份操作完成后，再次单击“确定”。\n\n1. 接下来，在 **ContosoSQL2** 上还原完整备份和事务日志备份。启动 **ContosoSQL2** 的 RDP 文件，然后以 **CORP\\\\Install** 身份登录。将 **ContosoSQL1** 的远程桌面会话保持打开。\n\n1. 从“开始”菜单启动 **SQL Server Management Studio**，然后单击“连接”连接到默认 SQL Server 实例。\n\n1. 在“对象资源管理器”中，右键单击“数据库”，然后单击“还原数据库”。\n\n1. 在“源”部分中，选择“设备”，然后单击“...”按钮。\n\n1. 在“选择备份设备”中，单击“添加”。\n\n1. 在“备份文件位置”中，键入 \\\\ContosoSQL1\\\\backup，单击“刷新”，选择“MyDB1.bak”，单击“确定”，然后再次单击“确定”。现在，你应在“要还原的备份集”窗格中看到完整备份和日志备份。\n\n1. 转到“选项”页，在“恢复状态”中选择“RESTORE WITH NORECOVERY”，然后单击“确定”还原数据库。还原操作完成后，单击“确定”。\n\n### 创建可用性组：\n\n1. 返回到 **ContosoSQL1** 的远程桌面会话。在 SSMS 中的“对象资源管理器”中，右键单击“AlwaysOn 高可用性”，然后单击“新建可用性组向导”，如下所示。\n\n    ![启动新建可用性组向导](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665523.gif)\n\n1. 在“简介”页上，单击“下一步”。在“指定可用性组名称”页上，在“可用性组名称”中键入 **AG1**，然后再次单击“下一步”。\n\n    ![新建可用性组向导，指定可用性组名称](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665524.gif)\n\n1. 在“选择数据库”页上，选择“MyDB1”，然后单击“下一步”。这些数据库满足可用性组的先决条件，因为你针对预定主副本进行了至少一个完整备份。\n\n    ![新建可用性组向导，选择数据库](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665525.gif)\n\n1. 在“指定副本”页上，单击“添加副本”。\n\n    ![新建可用性组向导，指定副本](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665526.gif)\n\n1. 此时会弹出“连接到服务器”对话框。在“服务器名称”中键入 **ContosoSQL2**，然后单击“连接”。\n\n    ![新建可用性组向导，连接到服务器](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665527.gif)\n\n1. 返回到“指定副本”页，此时应看到“可用的副本”中列出了 **ContosoSQL2**。配置这些副本，如下所示。完成后，单击“下一步”。\n\n    ![新建可用性组向导，指定副本（完整）](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665528.gif)\n\n1. 在“选择初始数据同步”页上，选择“仅联接”，然后单击“下一步”。在对 **ContosoSQL1** 进行完整备份和事务备份并在 **ContosoSQL2** 上还原这些备份时，你已手动执行了数据同步。你也可以选择不对数据库执行备份和还原操作，并选择“完整”以便让“新建可用性组向导”为你执行数据同步。不过，对于某些企业中存在的超大型数据库，不建议这样做。\n\n    ![新建可用性组向导，选择初始数据同步](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665529.gif)\n\n1. 在“验证”页中，单击“下一步”。此页应与以下页类似。因为你尚未配置可用性组侦听器，会出现一个侦听器配置警告。你可以忽略此警告，因为本教程不会配置侦听器。若要在完成本教程后配置侦听器，请参阅[在 Azure 中配置 AlwaysOn 可用性组的 ILB 侦听器](/documentation/articles/virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener)。\n\n    ![新建可用性组向导，验证](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665530.gif)\n\n1. 在“摘要”页上，单击“完成”，然后等待向导配置完新的可用性组。在“进度”页上，可单击“更多详细信息”以查看详细进度。向导运行完成后，检查“结果”页以验证是否已成功创建可用性组（如下所示），然后单击“关闭”退出向导。\n\n    ![新建可用性组向导，结果](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665531.gif)\n\n1. 在“对象资源管理器”中，展开“AlwaysOn 高可用性”，然后展开“可用性组”。此时，你应在此容器中看到新的可用性组。右键单击“AG1 (主)”，然后单击“显示仪表板”。\n\n    ![显示可用性组仪表板](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665532.gif)\n\n1. **AlwaysOn 仪表板**应如下所示。你可以查看副本、每个副本的故障转移模式以及同步状态。\n\n    ![可用性组仪表板](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665533.gif)\n\n1. 返回到“服务器管理器”，选择“工具”，然后启动“故障转移群集管理器”。\n\n1. 展开 **Cluster1.corp.contoso.com**，然后展开“服务和应用程序”。选择“角色”，并注意已创建“AG1”可用性组角色。请注意，AG1 没有数据库客户端可按其连接到可用性组的 IP 地址，因为你未配置侦听器。你可以直接连接到主节点进行读写操作，直接连接到辅助节点进行只读查询。\n\n    ![故障转移群集管理器中的可用性组](./media/virtual-machines-sql-server-alwayson-availability-groups-gui/IC665534.gif)\n\n>[AZURE.WARNING]请勿尝试从故障转移群集管理器对可用性组进行故障转移。所有故障转移操作都应在 SSMS 中的 **AlwaysOn 仪表板**内进行。有关详细信息，请参阅[将 WSFC 故障转移群集管理器用于可用性组的限制](https://msdn.microsoft.com/zh-cn/library/ff929171.aspx)。\n\n## 后续步骤\n现在，你已通过在 Azure 中创建可用性组，成功实施了 SQL Server AlwaysOn。若要为此可用性组配置侦听器，请参阅[在 Azure 中配置 AlwaysOn 可用性组的 ILB 侦听器](/documentation/articles/virtual-machines-sql-server-configure-ilb-alwayson-availability-group-listener)。\n\n有关在 Azure 中使用 SQL Server 的其他信息，请参阅 [Azure 虚拟机上的 SQL Server](/documentation/articles/virtual-machines-sql-server-infrastructure-services)。\n\n<!---HONumber=70-->"
}