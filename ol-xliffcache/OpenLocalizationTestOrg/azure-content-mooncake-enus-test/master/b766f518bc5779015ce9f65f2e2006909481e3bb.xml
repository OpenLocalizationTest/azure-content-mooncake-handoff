{
  "nodes": [
    {
      "content": "使用媒体服务 REST API 配置内容密钥授权策略",
      "pos": [
        28,
        54
      ]
    },
    {
      "content": "了解如何使用媒体服务 REST API 配置内容密钥的授权策略。",
      "pos": [
        74,
        106
      ]
    },
    {
      "content": "动态加密：配置内容密钥授权策略",
      "pos": [
        325,
        340
      ]
    },
    {
      "content": "概述",
      "pos": [
        477,
        479
      ]
    },
    {
      "content": "借助 Azure 媒体服务，你可以传送使用高级加密标准 (AES)（使用 128 位加密密钥）和 PlayReady DRM（动态）加密的内容。媒体服务还提供了用于向已授权客户端传送密钥和 PlayReady 许可证的服务。",
      "pos": [
        481,
        593
      ]
    },
    {
      "pos": [
        595,
        763
      ],
      "content": "如果你需要媒体服务来加密资产，则需要将加密密钥（<bpt id=\"p1\">**</bpt>CommonEncryption<ept id=\"p1\">**</ept> 或 <bpt id=\"p2\">**</bpt>EnvelopeEncryption<ept id=\"p2\">**</ept>）与资产相关联（如<bpt id=\"p3\">[</bpt>此处<ept id=\"p3\">](/documentation/articles/media-services-rest-create-contentkey)</ept>所述），并且配置密钥的授权策略（如本文所述）。"
    },
    {
      "content": "当前你可以加密以下流格式：HLS、MPEG DASH 和平滑流。无法加密 HDS 流格式或渐进式下载。",
      "pos": [
        765,
        816
      ]
    },
    {
      "content": "当播放器请求流时，媒体服务将使用指定的密钥通过 AES 或 PlayReady 加密来动态加密你的内容。为了解密流，播放器将从密钥传送服务请求密钥。为了确定用户是否被授权获取密钥，服务将评估你为密钥指定的授权策略。",
      "pos": [
        818,
        925
      ]
    },
    {
      "pos": [
        927,
        1159
      ],
      "content": "媒体服务支持通过多种方式对发出密钥请求的用户进行身份验证。内容密钥授权策略可能受到一种或多种授权限制：<bpt id=\"p1\">**</bpt>开放<ept id=\"p1\">**</ept>、<bpt id=\"p2\">**</bpt>令牌<ept id=\"p2\">**</ept>限制或 <bpt id=\"p3\">**</bpt>IP<ept id=\"p3\">**</ept> 限制。令牌限制策略必须附带由安全令牌服务 (STS) 颁发的令牌。媒体服务支持采用<bpt id=\"p4\">**</bpt>简单 Web 令牌<ept id=\"p4\">**</ept> (<bpt id=\"p5\">[</bpt>SWT<ept id=\"p5\">](https://msdn.microsoft.com/zh-cn/library/gg185950.aspx#BKMK_2)</ept>) 格式和 <bpt id=\"p6\">**</bpt>JSON Web 令牌<ept id=\"p6\">**</ept>(JWT) 格式的令牌。"
    },
    {
      "content": "媒体服务不提供安全令牌服务。你可以创建自定义 STS 或利用 Azure ACS 来颁发令牌。必须将 STS 配置为创建令牌，该令牌使用指定密钥以及你在令牌限制配置中指定的颁发声明进行签名（如本文所述）。如果令牌有效，而且令牌中的声明与为内容密钥配置的声明相匹配，则媒体服务密钥传送服务会将加密密钥返回到客户端。",
      "pos": [
        1161,
        1317
      ]
    },
    {
      "content": "有关详细信息，请参阅",
      "pos": [
        1319,
        1329
      ]
    },
    {
      "content": "JWT 令牌身份验证",
      "pos": [
        1332,
        1342
      ]
    },
    {
      "pos": [
        1455,
        1615
      ],
      "content": "<bpt id=\"p1\">[</bpt>将基于 Azure 媒体服务 OWIN MVC 的应用与 Azure Active Directory 相集成，并基于 JWT 声明限制内容密钥传送<ept id=\"p1\">](http://www.gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/)</ept>。"
    },
    {
      "pos": [
        1617,
        1680
      ],
      "content": "<bpt id=\"p1\">[</bpt>使用 Azure ACS 颁发令牌<ept id=\"p1\">](http://mingfeiy.com/acs-with-key-services)</ept>。"
    },
    {
      "content": "请注意以下事项：",
      "pos": [
        1685,
        1693
      ]
    },
    {
      "pos": [
        1697,
        1833
      ],
      "content": "为了能够使用动态打包和动态加密，必须确保至少有一个流式处理保留单位。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>如何缩放媒体服务<ept id=\"p1\">](/documentation/articles/media-services-manage-origins#scale_streaming_endpoints)</ept>。"
    },
    {
      "pos": [
        1837,
        1944
      ],
      "content": "你的资产必须包含一组自适应比特率 MP4 或自适应比特率平滑流文件。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>对资产进行编码<ept id=\"p1\">](/documentation/articles/media-services-encode-asset)</ept>。"
    },
    {
      "pos": [
        1949,
        2008
      ],
      "content": "使用 <bpt id=\"p1\">**</bpt>AssetCreationOptions.StorageEncrypted<ept id=\"p1\">**</ept> 选项上载资产并对其进行编码。"
    },
    {
      "content": "如果你打算创建需要相同策略配置的多个内容密钥，我们强烈建议你创建单个授权策略，并将其重复用于多个内容密钥。",
      "pos": [
        2011,
        2064
      ]
    },
    {
      "content": "密钥传送服务将 ContentKeyAuthorizationPolicy 及其相关对象（策略选项和限制）缓存 15 分钟。如果你创建 ContentKeyAuthorizationPolicy 并指定使用“令牌”限制，然后对其进行测试，再将策略更新为“开放”限制，则现有策略切换到“开放”版本的策略需要大约 15 分钟。",
      "pos": [
        2067,
        2228
      ]
    },
    {
      "content": "如果你添加或更新资产的传送策略，则必须删除现有定位符（如果有）并创建新定位符。",
      "pos": [
        2231,
        2270
      ]
    },
    {
      "content": "AES-128 动态加密",
      "pos": [
        2275,
        2287
      ]
    },
    {
      "pos": [
        2291,
        2329
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>使用媒体服务 REST API 时，需注意以下事项："
    },
    {
      "pos": [
        2333,
        2456
      ],
      "content": "访问媒体服务中的实体时，必须在 HTTP 请求中设置特定标头字段和值。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>媒体服务 REST API 开发的设置<ept id=\"p1\">](/documentation/articles/media-services-rest-how-to-use)</ept>。"
    },
    {
      "pos": [
        2459,
        2641
      ],
      "content": "在成功连接到 https://media.chinacloudapi.cn 之后，你将接收到指定另一个媒体服务 URI 的 301 重定向。必须按<bpt id=\"p1\">[</bpt>使用 REST API 连接到媒体服务<ept id=\"p1\">](/documentation/articles/media-services-rest-connect_programmatically)</ept>中所述对新的 URI 执行后续调用。"
    },
    {
      "content": "开放限制",
      "pos": [
        2647,
        2651
      ]
    },
    {
      "content": "开放限制意味着系统会将密钥传送到发出密钥请求的任何用户。此限制可能适用于测试用途。",
      "pos": [
        2653,
        2694
      ]
    },
    {
      "content": "以下示例创建开放授权策略，并将其添加到内容密钥。",
      "pos": [
        2696,
        2720
      ]
    },
    {
      "pos": [
        2726,
        2804
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"ContentKeyAuthorizationPolicies\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>创建 ContentKeyAuthorizationPolicies"
    },
    {
      "content": "请求：",
      "pos": [
        2806,
        2809
      ]
    },
    {
      "content": "响应：",
      "pos": [
        3842,
        3845
      ]
    },
    {
      "pos": [
        4805,
        4893
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"ContentKeyAuthorizationPolicyOptions\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>创建 ContentKeyAuthorizationPolicyOptions"
    },
    {
      "content": "请求：",
      "pos": [
        4899,
        4902
      ]
    },
    {
      "content": "响应：",
      "pos": [
        6057,
        6060
      ]
    },
    {
      "pos": [
        7164,
        7270
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"LinkContentKeyAuthorizationPoliciesWithOptions\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>将 ContentKeyAuthorizationPolicies 与 Options 相链接"
    },
    {
      "content": "请求：",
      "pos": [
        7272,
        7275
      ]
    },
    {
      "content": "响应：",
      "pos": [
        8494,
        8497
      ]
    },
    {
      "pos": [
        8532,
        8584
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"AddAuthorizationPolicyToKey\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>将授权策略添加到内容密钥"
    },
    {
      "content": "请求：",
      "pos": [
        8586,
        8589
      ]
    },
    {
      "content": "响应：",
      "pos": [
        9689,
        9692
      ]
    },
    {
      "content": "令牌限制",
      "pos": [
        9726,
        9730
      ]
    },
    {
      "content": "本部分介绍如何创建内容密钥授权策略，以及如何将其与内容密钥相关联。授权策略描述了必须达到什么授权要求才能确定用户是否有权接收密钥（例如，“验证密钥”列表是否包含令牌签名时使用的密钥）。",
      "pos": [
        9732,
        9824
      ]
    },
    {
      "content": "若要配置令牌限制选项，你需要使用 XML 来描述令牌的授权要求。令牌限制配置 XML 必须符合以下 XML 架构。",
      "pos": [
        9826,
        9883
      ]
    },
    {
      "pos": [
        9889,
        9914
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"schema\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>令牌限制架构"
    },
    {
      "pos": [
        12714,
        12873
      ],
      "content": "在配置<bpt id=\"p1\">**</bpt>令牌<ept id=\"p1\">**</ept>限制策略时，必须指定主<bpt id=\"p2\">**</bpt>验证密钥<ept id=\"p2\">**</ept>、<bpt id=\"p3\">**</bpt>颁发者<ept id=\"p3\">**</ept>和<bpt id=\"p4\">**</bpt>受众<ept id=\"p4\">**</ept>参数。<bpt id=\"p5\">**</bpt>主验证密钥<ept id=\"p5\">**</ept>包含用来为令牌签名的的密钥，<bpt id=\"p6\">**</bpt>颁发者<ept id=\"p6\">**</ept>是颁发令牌的安全令牌服务。<bpt id=\"p7\">**</bpt>受众<ept id=\"p7\">**</ept>（有时称为<bpt id=\"p8\">**</bpt>范围<ept id=\"p8\">**</ept>）描述该令牌的意图，或者令牌授权访问的资源。媒体服务密钥交付服务将验证令牌中的这些值是否与模板中的值匹配。"
    },
    {
      "content": "以下示例创建包含令牌限制的授权策略。在此示例中，客户端必须出示令牌，其中包含：签名密钥 (VerificationKey)、令牌颁发者和必需的声明。",
      "pos": [
        12875,
        12949
      ]
    },
    {
      "content": "创建 ContentKeyAuthorizationPolicies",
      "pos": [
        12958,
        12992
      ]
    },
    {
      "pos": [
        12994,
        13047
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#ContentKeyAuthorizationPolicies)</ept>所示创建“令牌限制策略”。"
    },
    {
      "content": "创建 ContentKeyAuthorizationPolicyOptions",
      "pos": [
        13053,
        13092
      ]
    },
    {
      "content": "请求：",
      "pos": [
        13094,
        13097
      ]
    },
    {
      "content": "响应：",
      "pos": [
        15160,
        15163
      ]
    },
    {
      "content": "将 ContentKeyAuthorizationPolicies 与 Options 相链接",
      "pos": [
        17173,
        17220
      ]
    },
    {
      "pos": [
        17222,
        17312
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#ContentKeyAuthorizationPolicies)</ept>所示将 ContentKeyAuthorizationPolicies 与 Options 相链接。"
    },
    {
      "content": "将授权策略添加到内容密钥",
      "pos": [
        17318,
        17330
      ]
    },
    {
      "pos": [
        17332,
        17407
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#AddAuthorizationPolicyToKey)</ept>所示将 AuthorizationPolicy 添加到 ContentKey。"
    },
    {
      "content": "PlayReady 动态加密",
      "pos": [
        17412,
        17426
      ]
    },
    {
      "content": "媒体服务允许你配置相应的权限和限制，以便在用户尝试播放受保护的内容时，PlayReady DRM 运行时会强制实施这些权限和限制。",
      "pos": [
        17429,
        17494
      ]
    },
    {
      "pos": [
        17496,
        17641
      ],
      "content": "使用 PlayReady 保护你的内容时，需要在授权策略中指定的项目之一是用于定义 <bpt id=\"p1\">[</bpt>PlayReady 许可证模板<ept id=\"p1\">](/documentation/articles/media-services-playready-license-template-overview)</ept>的 XML 字符串。"
    },
    {
      "content": "开放限制",
      "pos": [
        17646,
        17650
      ]
    },
    {
      "content": "开放限制意味着系统会将密钥传送到发出密钥请求的任何用户。此限制可能适用于测试用途。",
      "pos": [
        17656,
        17697
      ]
    },
    {
      "content": "以下示例创建开放授权策略，并将其添加到内容密钥。",
      "pos": [
        17699,
        17723
      ]
    },
    {
      "pos": [
        17733,
        17812
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"ContentKeyAuthorizationPolicies2\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>创建 ContentKeyAuthorizationPolicies"
    },
    {
      "content": "请求：",
      "pos": [
        17814,
        17817
      ]
    },
    {
      "content": "响应：",
      "pos": [
        18842,
        18845
      ]
    },
    {
      "content": "创建 ContentKeyAuthorizationPolicyOptions",
      "pos": [
        19812,
        19851
      ]
    },
    {
      "content": "请求：",
      "pos": [
        19853,
        19856
      ]
    },
    {
      "content": "响应：",
      "pos": [
        21442,
        21445
      ]
    },
    {
      "content": "将 ContentKeyAuthorizationPolicies 与 Options 相链接",
      "pos": [
        22968,
        23015
      ]
    },
    {
      "pos": [
        23017,
        23107
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#ContentKeyAuthorizationPolicies)</ept>所示将 ContentKeyAuthorizationPolicies 与 Options 相链接。"
    },
    {
      "content": "将授权策略添加到内容密钥",
      "pos": [
        23113,
        23125
      ]
    },
    {
      "pos": [
        23127,
        23202
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#AddAuthorizationPolicyToKey)</ept>所示将 AuthorizationPolicy 添加到 ContentKey。"
    },
    {
      "content": "令牌限制",
      "pos": [
        23208,
        23212
      ]
    },
    {
      "pos": [
        23214,
        23287
      ],
      "content": "若要配置令牌限制选项，你需要使用 XML 来描述令牌的授权要求。令牌限制配置 XML 必须符合<bpt id=\"p1\">[</bpt>此<ept id=\"p1\">](#schema)</ept>部分中所示的 XML 架构。"
    },
    {
      "content": "创建 ContentKeyAuthorizationPolicies",
      "pos": [
        23297,
        23331
      ]
    },
    {
      "pos": [
        23337,
        23415
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#ContentKeyAuthorizationPolicies2)</ept>所示创建 ContentKeyAuthorizationPolicies。"
    },
    {
      "content": "创建 ContentKeyAuthorizationPolicyOptions",
      "pos": [
        23421,
        23460
      ]
    },
    {
      "content": "请求：",
      "pos": [
        23466,
        23469
      ]
    },
    {
      "content": "响应：",
      "pos": [
        25972,
        25975
      ]
    },
    {
      "content": "将 ContentKeyAuthorizationPolicies 与 Options 相链接",
      "pos": [
        28421,
        28468
      ]
    },
    {
      "pos": [
        28470,
        28560
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#ContentKeyAuthorizationPolicies)</ept>所示将 ContentKeyAuthorizationPolicies 与 Options 相链接。"
    },
    {
      "content": "将授权策略添加到内容密钥",
      "pos": [
        28566,
        28578
      ]
    },
    {
      "pos": [
        28580,
        28655
      ],
      "content": "根据<bpt id=\"p1\">[</bpt>此处<ept id=\"p1\">](#AddAuthorizationPolicyToKey)</ept>所示将 AuthorizationPolicy 添加到 ContentKey。"
    },
    {
      "pos": [
        28660,
        28717
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"types\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>定义 ContentKeyAuthorizationPolicy 时使用的类型"
    },
    {
      "pos": [
        28722,
        28785
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"ContentKeyRestrictionType\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>ContentKeyRestrictionType"
    },
    {
      "pos": [
        28918,
        28975
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"ContentKeyDeliveryType\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>ContentKeyDeliveryType"
    },
    {
      "content": "后续步骤",
      "pos": [
        29108,
        29112
      ]
    },
    {
      "content": "在配置内容密钥的授权策略后，请转到<bpt id=\"p1\">[</bpt>如何配置资产传送策略<ept id=\"p1\">](/documentation/articles/media-services-rest-configure-asset-delivery-policy)</ept>主题。",
      "pos": [
        29113,
        29222
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"使用媒体服务 REST API 配置内容密钥授权策略\" \n    description=\"了解如何使用媒体服务 REST API 配置内容密钥的授权策略。\" \n    services=\"media-services\" \n    documentationCenter=\"\" \n    authors=\"Juliako\" \n    manager=\"dwrede\" \n    editor=\"\"/>\n\n<tags\n    ms.service=\"media-services\"\n    ms.date=\"10/18/2015\"\n    wacn.date=\"11/27/2015\"/>\n\n\n#动态加密：配置内容密钥授权策略 \n[AZURE.INCLUDE [media-services-selector-content-key-auth-policy](../includes/media-services-selector-content-key-auth-policy.md)]\n \n\n##概述\n\n借助 Azure 媒体服务，你可以传送使用高级加密标准 (AES)（使用 128 位加密密钥）和 PlayReady DRM（动态）加密的内容。媒体服务还提供了用于向已授权客户端传送密钥和 PlayReady 许可证的服务。\n\n如果你需要媒体服务来加密资产，则需要将加密密钥（**CommonEncryption** 或 **EnvelopeEncryption**）与资产相关联（如[此处](/documentation/articles/media-services-rest-create-contentkey)所述），并且配置密钥的授权策略（如本文所述）。\n\n当前你可以加密以下流格式：HLS、MPEG DASH 和平滑流。无法加密 HDS 流格式或渐进式下载。\n\n当播放器请求流时，媒体服务将使用指定的密钥通过 AES 或 PlayReady 加密来动态加密你的内容。为了解密流，播放器将从密钥传送服务请求密钥。为了确定用户是否被授权获取密钥，服务将评估你为密钥指定的授权策略。\n\n媒体服务支持通过多种方式对发出密钥请求的用户进行身份验证。内容密钥授权策略可能受到一种或多种授权限制：**开放**、**令牌**限制或 **IP** 限制。令牌限制策略必须附带由安全令牌服务 (STS) 颁发的令牌。媒体服务支持采用**简单 Web 令牌** ([SWT](https://msdn.microsoft.com/zh-cn/library/gg185950.aspx#BKMK_2)) 格式和 **JSON Web 令牌**(JWT) 格式的令牌。\n\n媒体服务不提供安全令牌服务。你可以创建自定义 STS 或利用 Azure ACS 来颁发令牌。必须将 STS 配置为创建令牌，该令牌使用指定密钥以及你在令牌限制配置中指定的颁发声明进行签名（如本文所述）。如果令牌有效，而且令牌中的声明与为内容密钥配置的声明相匹配，则媒体服务密钥传送服务会将加密密钥返回到客户端。\n\n有关详细信息，请参阅\n\n[JWT 令牌身份验证](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)\n\n[将基于 Azure 媒体服务 OWIN MVC 的应用与 Azure Active Directory 相集成，并基于 JWT 声明限制内容密钥传送](http://www.gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/)。\n\n[使用 Azure ACS 颁发令牌](http://mingfeiy.com/acs-with-key-services)。\n\n###请注意以下事项：\n\n- 为了能够使用动态打包和动态加密，必须确保至少有一个流式处理保留单位。有关详细信息，请参阅[如何缩放媒体服务](/documentation/articles/media-services-manage-origins#scale_streaming_endpoints)。 \n- 你的资产必须包含一组自适应比特率 MP4 或自适应比特率平滑流文件。有关详细信息，请参阅[对资产进行编码](/documentation/articles/media-services-encode-asset)。  \n- 使用 **AssetCreationOptions.StorageEncrypted** 选项上载资产并对其进行编码。\n- 如果你打算创建需要相同策略配置的多个内容密钥，我们强烈建议你创建单个授权策略，并将其重复用于多个内容密钥。\n- 密钥传送服务将 ContentKeyAuthorizationPolicy 及其相关对象（策略选项和限制）缓存 15 分钟。如果你创建 ContentKeyAuthorizationPolicy 并指定使用“令牌”限制，然后对其进行测试，再将策略更新为“开放”限制，则现有策略切换到“开放”版本的策略需要大约 15 分钟。\n- 如果你添加或更新资产的传送策略，则必须删除现有定位符（如果有）并创建新定位符。\n\n\n##AES-128 动态加密 \n\n>[AZURE.NOTE]使用媒体服务 REST API 时，需注意以下事项：\n>\n>访问媒体服务中的实体时，必须在 HTTP 请求中设置特定标头字段和值。有关详细信息，请参阅[媒体服务 REST API 开发的设置](/documentation/articles/media-services-rest-how-to-use)。\n\n>在成功连接到 https://media.chinacloudapi.cn 之后，你将接收到指定另一个媒体服务 URI 的 301 重定向。必须按[使用 REST API 连接到媒体服务](/documentation/articles/media-services-rest-connect_programmatically)中所述对新的 URI 执行后续调用。\n\n\n###开放限制\n\n开放限制意味着系统会将密钥传送到发出密钥请求的任何用户。此限制可能适用于测试用途。\n\n以下示例创建开放授权策略，并将其添加到内容密钥。\n\n####<a id=\"ContentKeyAuthorizationPolicies\"></a>创建 ContentKeyAuthorizationPolicies\n\n请求：\n        \n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicies HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 1.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=bbbef702-e769-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423578086&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=lZlyQ2%2bvH73qtJsb42%2fH3xF7r7EvQFR3UXyezuDENFU%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: d732dbfa-54fc-474c-99d6-9b46a006f389\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 36\n    \n    {\"Name\":\"Open Authorization Policy\"}\n    \n响应：\n    \n    HTTP/1.1 201 Created\n    Cache-Control: no-cache\n    Content-Length: 211\n    Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8\n    Location: https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicies('nb%3Ackpid%3AUUID%3Adb4593da-f4d1-4cc5-a92a-d20eacbabee4')\n    Server: Microsoft-IIS/8.5\n    x-ms-client-request-id: d732dbfa-54fc-474c-99d6-9b46a006f389\n    request-id: aabfa731-e884-4bf3-8314-492b04747ac4\n    x-ms-request-id: aabfa731-e884-4bf3-8314-492b04747ac4\n    X-Content-Type-Options: nosniff\n    DataServiceVersion: 3.0;\n    X-Powered-By: ASP.NET\n    Strict-Transport-Security: max-age=31536000; includeSubDomains\n    Date: Tue, 10 Feb 2015 08:25:56 GMT\n    \n    {\"odata.metadata\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/$metadata#ContentKeyAuthorizationPolicies/@Element\",\"Id\":\"nb:ckpid:UUID:db4593da-f4d1-4cc5-a92a-d20eacbabee4\",\"Name\":\"Open Authorization Policy\"}\n\n####<a id=\"ContentKeyAuthorizationPolicyOptions\"></a>创建 ContentKeyAuthorizationPolicyOptions\n    \n请求：\n\n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 3.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=bbbef702-e769-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423580006&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=Ref3EsonGF7fUKCwGwGgiMnZitzIzsDOvvMTeVrVVPg%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: d225e357-e60e-4f42-add8-9d93aba1409a\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 168\n    \n    {\"Name\":\"policy\",\"KeyDeliveryType\":2,\"KeyDeliveryConfiguration\":\"\",\"Restrictions\":[{\"Name\":\"HLS Open Authorization Policy\",\"KeyRestrictionType\":0,\"Requirements\":null}]}\n\n响应：\n    \n    HTTP/1.1 201 Created\n    Cache-Control: no-cache\n    Content-Length: 349\n    Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8\n    Location: https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions('nb%3Ackpoid%3AUUID%3A57829b17-1101-4797-919b-f816f4a007b7')\n    Server: Microsoft-IIS/8.5\n    x-ms-client-request-id: d225e357-e60e-4f42-add8-9d93aba1409a\n    request-id: 81bcad37-295b-431f-972f-b23f2e4172c9\n    x-ms-request-id: 81bcad37-295b-431f-972f-b23f2e4172c9\n    X-Content-Type-Options: nosniff\n    DataServiceVersion: 3.0;\n    X-Powered-By: ASP.NET\n    Strict-Transport-Security: max-age=31536000; includeSubDomains\n    Date: Tue, 10 Feb 2015 08:56:40 GMT\n    \n    {\"odata.metadata\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/$metadata#ContentKeyAuthorizationPolicyOptions/@Element\",\"Id\":\"nb:ckpoid:UUID:57829b17-1101-4797-919b-f816f4a007b7\",\"Name\":\"policy\",\"KeyDeliveryType\":2,\"KeyDeliveryConfiguration\":\"\",\"Restrictions\":[{\"Name\":\"HLS Open Authorization Policy\",\"KeyRestrictionType\":0,\"Requirements\":null}]}\n\n####<a id=\"LinkContentKeyAuthorizationPoliciesWithOptions\"></a>将 ContentKeyAuthorizationPolicies 与 Options 相链接\n\n请求：\n    \n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicies('nb%3Ackpid%3AUUID%3A0baa438b-8ac2-4c40-a53c-4d4722b78715')/$links/Options HTTP/1.1\n    DataServiceVersion: 1.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Content-Type: application/json\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=zbbef702-2233-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423580006&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=Ref3EsonGF7fUKCwGwGgiMnZitzIzsDOvvMTeVrVVPg%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: 9847f705-f2ca-4e95-a478-8f823dbbaa29\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 154\n    \n    {\"uri\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions('nb%3Ackpoid%3AUUID%3A57829b17-1101-4797-919b-f816f4a007b7')\"}\n\n响应：\n\n    HTTP/1.1 204 No Content\n\n####<a id=\"AddAuthorizationPolicyToKey\"></a>将授权策略添加到内容密钥\n\n请求：\n\n    PUT https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeys('nb%3Akid%3AUUID%3A2e6d36a7-a17c-4e9a-830d-eca23ad1a6f9') HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 1.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=zbbef702-2233-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423581565&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=JiNSG3w6r2C0nIyfKvTZj1uPJGjuitD%2b0sbfZ%2b2JDZI%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: e613efff-cb6a-41b4-984a-f4f8fb6e76a4\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 78\n    \n    {\"AuthorizationPolicyId\":\"nb:ckpid:UUID:c06cebb8-c4f0-4d1a-ba00-3273fb2bc3ad\"}\n\n响应：\n\n    HTTP/1.1 204 No Content\n\n###令牌限制\n\n本部分介绍如何创建内容密钥授权策略，以及如何将其与内容密钥相关联。授权策略描述了必须达到什么授权要求才能确定用户是否有权接收密钥（例如，“验证密钥”列表是否包含令牌签名时使用的密钥）。\n\n若要配置令牌限制选项，你需要使用 XML 来描述令牌的授权要求。令牌限制配置 XML 必须符合以下 XML 架构。\n\n####<a id=\"schema\"></a>令牌限制架构\n    \n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <xs:schema xmlns:tns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/TokenRestrictionTemplate/v1\" elementFormDefault=\"qualified\" targetNamespace=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/TokenRestrictionTemplate/v1\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\n      <xs:complexType name=\"TokenClaim\">\n        <xs:sequence>\n          <xs:element name=\"ClaimType\" nillable=\"true\" type=\"xs:string\" />\n          <xs:element minOccurs=\"0\" name=\"ClaimValue\" nillable=\"true\" type=\"xs:string\" />\n        </xs:sequence>\n      </xs:complexType>\n      <xs:element name=\"TokenClaim\" nillable=\"true\" type=\"tns:TokenClaim\" />\n      <xs:complexType name=\"TokenRestrictionTemplate\">\n        <xs:sequence>\n          <xs:element minOccurs=\"0\" name=\"AlternateVerificationKeys\" nillable=\"true\" type=\"tns:ArrayOfTokenVerificationKey\" />\n          <xs:element name=\"Audience\" nillable=\"true\" type=\"xs:anyURI\" />\n          <xs:element name=\"Issuer\" nillable=\"true\" type=\"xs:anyURI\" />\n          <xs:element name=\"PrimaryVerificationKey\" nillable=\"true\" type=\"tns:TokenVerificationKey\" />\n          <xs:element minOccurs=\"0\" name=\"RequiredClaims\" nillable=\"true\" type=\"tns:ArrayOfTokenClaim\" />\n        </xs:sequence>\n      </xs:complexType>\n      <xs:element name=\"TokenRestrictionTemplate\" nillable=\"true\" type=\"tns:TokenRestrictionTemplate\" />\n      <xs:complexType name=\"ArrayOfTokenVerificationKey\">\n        <xs:sequence>\n          <xs:element minOccurs=\"0\" maxOccurs=\"unbounded\" name=\"TokenVerificationKey\" nillable=\"true\" type=\"tns:TokenVerificationKey\" />\n        </xs:sequence>\n      </xs:complexType>\n      <xs:element name=\"ArrayOfTokenVerificationKey\" nillable=\"true\" type=\"tns:ArrayOfTokenVerificationKey\" />\n      <xs:complexType name=\"TokenVerificationKey\">\n        <xs:sequence />\n      </xs:complexType>\n      <xs:element name=\"TokenVerificationKey\" nillable=\"true\" type=\"tns:TokenVerificationKey\" />\n      <xs:complexType name=\"ArrayOfTokenClaim\">\n        <xs:sequence>\n          <xs:element minOccurs=\"0\" maxOccurs=\"unbounded\" name=\"TokenClaim\" nillable=\"true\" type=\"tns:TokenClaim\" />\n        </xs:sequence>\n      </xs:complexType>\n      <xs:element name=\"ArrayOfTokenClaim\" nillable=\"true\" type=\"tns:ArrayOfTokenClaim\" />\n      <xs:complexType name=\"SymmetricVerificationKey\">\n        <xs:complexContent mixed=\"false\">\n          <xs:extension base=\"tns:TokenVerificationKey\">\n            <xs:sequence>\n              <xs:element name=\"KeyValue\" nillable=\"true\" type=\"xs:base64Binary\" />\n            </xs:sequence>\n          </xs:extension>\n        </xs:complexContent>\n      </xs:complexType>\n      <xs:element name=\"SymmetricVerificationKey\" nillable=\"true\" type=\"tns:SymmetricVerificationKey\" />\n    </xs:schema>\n\n在配置**令牌**限制策略时，必须指定主**验证密钥**、**颁发者**和**受众**参数。**主验证密钥**包含用来为令牌签名的的密钥，**颁发者**是颁发令牌的安全令牌服务。**受众**（有时称为**范围**）描述该令牌的意图，或者令牌授权访问的资源。媒体服务密钥交付服务将验证令牌中的这些值是否与模板中的值匹配。\n\n以下示例创建包含令牌限制的授权策略。在此示例中，客户端必须出示令牌，其中包含：签名密钥 (VerificationKey)、令牌颁发者和必需的声明。\n    \n###创建 ContentKeyAuthorizationPolicies\n\n根据[此处](#ContentKeyAuthorizationPolicies)所示创建“令牌限制策略”。\n\n\n###创建 ContentKeyAuthorizationPolicyOptions\n\n请求：\n    \n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 3.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=bbbef702-e769-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423580720&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=5LsNu%2b0D4eD3UOP3BviTLDkUjaErdUx0ekJ8402xidQ%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: 2643d836-bfe7-438e-9ba2-bc6ff28e4a53\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 1079\n    \n    {\"Name\":\"Token option for HLS\",\"KeyDeliveryType\":2,\"KeyDeliveryConfiguration\":null,\"Restrictions\":[{\"Name\":\"Token Authorization Policy\",\"KeyRestrictionType\":1,\"Requirements\":\"<TokenRestrictionTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/TokenRestrictionTemplate/v1\"><AlternateVerificationKeys><TokenVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>BklyAFiPTQsuJNKriQJBZHYaKM2CkCTDQX2bw9sMYuvEC9sjW0W7GUIBygQL/+POEeUqCYPnmEU2g0o1GW2Oqg==</KeyValue></TokenVerificationKey></AlternateVerificationKeys><Audience>urn:test</Audience><Issuer>http://testacs.com/</Issuer><PrimaryVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>E5BUHiN4vBdzUzdP0IWaHFMMU3D1uRZgF16TOhSfwwHGSw+Kbf0XqsHzEIYk11M372viB9vbiacsdcQksA0ftw==</KeyValue></PrimaryVerificationKey><RequiredClaims><TokenClaim><ClaimType>urn:microsoft:azure:mediaservices:contentkeyidentifier</ClaimType><ClaimValue i:nil=\"true\" /></TokenClaim></RequiredClaims><TokenType>SWT</TokenType></TokenRestrictionTemplate>\"}]}\n\n响应：\n    \n    HTTP/1.1 201 Created\n    Cache-Control: no-cache\n    Content-Length: 1260\n    Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8\n    Location: https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions('nb%3Ackpoid%3AUUID%3Ae1ef6145-46e8-4ee6-9756-b1cf96328c23')\n    Server: Microsoft-IIS/8.5\n    x-ms-client-request-id: 2643d836-bfe7-438e-9ba2-bc6ff28e4a53\n    request-id: 2310b716-aeaa-421e-913e-3ce2f6f685ca\n    x-ms-request-id: 2310b716-aeaa-421e-913e-3ce2f6f685ca\n    X-Content-Type-Options: nosniff\n    DataServiceVersion: 3.0;\n    X-Powered-By: ASP.NET\n    Strict-Transport-Security: max-age=31536000; includeSubDomains\n    Date: Tue, 10 Feb 2015 09:10:37 GMT\n    \n    {\"odata.metadata\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/$metadata#ContentKeyAuthorizationPolicyOptions/@Element\",\"Id\":\"nb:ckpoid:UUID:e1ef6145-46e8-4ee6-9756-b1cf96328c23\",\"Name\":\"Token option for HLS\",\"KeyDeliveryType\":2,\"KeyDeliveryConfiguration\":null,\"Restrictions\":[{\"Name\":\"Token Authorization Policy\",\"KeyRestrictionType\":1,\"Requirements\":\"<TokenRestrictionTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/TokenRestrictionTemplate/v1\"><AlternateVerificationKeys><TokenVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>BklyAFiPTQsuJNKriQJBZHYaKM2CkCTDQX2bw9sMYuvEC9sjW0W7GUIBygQL/+POEeUqCYPnmEU2g0o1GW2Oqg==</KeyValue></TokenVerificationKey></AlternateVerificationKeys><Audience>urn:test</Audience><Issuer>http://testacs.com/</Issuer><PrimaryVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>E5BUHiN4vBdzUzdP0IWaHFMMU3D1uRZgF16TOhSfwwHGSw+Kbf0XqsHzEIYk11M372viB9vbiacsdcQksA0ftw==</KeyValue></PrimaryVerificationKey><RequiredClaims><TokenClaim><ClaimType>urn:microsoft:azure:mediaservices:contentkeyidentifier</ClaimType><ClaimValue i:nil=\"true\" /></TokenClaim></RequiredClaims><TokenType>SWT</TokenType></TokenRestrictionTemplate>\"}]}\n    \n####将 ContentKeyAuthorizationPolicies 与 Options 相链接\n\n根据[此处](#ContentKeyAuthorizationPolicies)所示将 ContentKeyAuthorizationPolicies 与 Options 相链接。\n\n####将授权策略添加到内容密钥\n\n根据[此处](#AddAuthorizationPolicyToKey)所示将 AuthorizationPolicy 添加到 ContentKey。\n\n\n##PlayReady 动态加密 \n\n媒体服务允许你配置相应的权限和限制，以便在用户尝试播放受保护的内容时，PlayReady DRM 运行时会强制实施这些权限和限制。\n\n使用 PlayReady 保护你的内容时，需要在授权策略中指定的项目之一是用于定义 [PlayReady 许可证模板](/documentation/articles/media-services-playready-license-template-overview)的 XML 字符串。\n\n###开放限制\n    \n开放限制意味着系统会将密钥传送到发出密钥请求的任何用户。此限制可能适用于测试用途。\n\n以下示例创建开放授权策略，并将其添加到内容密钥。\n    \n####<a id=\"ContentKeyAuthorizationPolicies2\"></a>创建 ContentKeyAuthorizationPolicies\n\n请求：\n\n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicies HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 1.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=bbef702-2233-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423581565&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=JiNSG3w6r2C0nIyfKvTZj1uPJGjuitD%2b0sbfZ%2b2JDZI%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: 9e7fa407-f84e-43aa-8f05-9790b46e279b\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 58\n    \n    {\"Name\":\"Deliver Common Content Key\"}\n    \n响应：\n    \n    HTTP/1.1 201 Created\n    Cache-Control: no-cache\n    Content-Length: 233\n    Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8\n    Location: https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicies('nb%3Ackpid%3AUUID%3Acc3c64a8-e2fc-4e09-bf60-ac954251a387')\n    Server: Microsoft-IIS/8.5\n    x-ms-client-request-id: 9e7fa407-f84e-43aa-8f05-9790b46e279b\n    request-id: b3d33c1b-a9cb-4120-ac0c-18f64846c147\n    x-ms-request-id: b3d33c1b-a9cb-4120-ac0c-18f64846c147\n    X-Content-Type-Options: nosniff\n    DataServiceVersion: 3.0;\n    X-Powered-By: ASP.NET\n    Strict-Transport-Security: max-age=31536000; includeSubDomains\n    Date: Tue, 10 Feb 2015 09:26:00 GMT\n    \n    {\"odata.metadata\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/$metadata#ContentKeyAuthorizationPolicies/@Element\",\"Id\":\"nb:ckpid:UUID:cc3c64a8-e2fc-4e09-bf60-ac954251a387\",\"Name\":\"Deliver Common Content Key\"}\n    \n\n#### 创建 ContentKeyAuthorizationPolicyOptions\n\n请求：\n    \n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 3.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=zbbef702-2233-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423581565&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=JiNSG3w6r2C0nIyfKvTZj1uPJGjuitD%2b0sbfZ%2b2JDZI%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: f160ad25-b457-4bc6-8197-315604c5e585\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 593\n    \n    {\"Name\":\"\",\"KeyDeliveryType\":1,\"KeyDeliveryConfiguration\":\"<PlayReadyLicenseResponseTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1\"><LicenseTemplates><PlayReadyLicenseTemplate><AllowTestDevices>false</AllowTestDevices><ContentKey i:type=\"ContentEncryptionKeyFromHeader\" /><LicenseType>Nonpersistent</LicenseType><PlayRight /></PlayReadyLicenseTemplate></LicenseTemplates></PlayReadyLicenseResponseTemplate>\",\"Restrictions\":[{\"Name\":\"Open\",\"KeyRestrictionType\":0,\"Requirements\":null}]}\n    \n响应：\n    \n    HTTP/1.1 201 Created\n    Cache-Control: no-cache\n    Content-Length: 774\n    Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8\n    Location: https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions('nb%3Ackpoid%3AUUID%3A1052308c-4df7-4fdb-8d21-4d2141fc2be0')\n    Server: Microsoft-IIS/8.5\n    x-ms-client-request-id: f160ad25-b457-4bc6-8197-315604c5e585\n    request-id: 563f5a42-50a4-4c4a-add8-a833f8364231\n    x-ms-request-id: 563f5a42-50a4-4c4a-add8-a833f8364231\n    X-Content-Type-Options: nosniff\n    DataServiceVersion: 3.0;\n    X-Powered-By: ASP.NET\n    Strict-Transport-Security: max-age=31536000; includeSubDomains\n    Date: Tue, 10 Feb 2015 09:23:24 GMT\n    \n    {\"odata.metadata\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/$metadata#ContentKeyAuthorizationPolicyOptions/@Element\",\"Id\":\"nb:ckpoid:UUID:1052308c-4df7-4fdb-8d21-4d2141fc2be0\",\"Name\":\"\",\"KeyDeliveryType\":1,\"KeyDeliveryConfiguration\":\"<PlayReadyLicenseResponseTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1\"><LicenseTemplates><PlayReadyLicenseTemplate><AllowTestDevices>false</AllowTestDevices><ContentKey i:type=\"ContentEncryptionKeyFromHeader\" /><LicenseType>Nonpersistent</LicenseType><PlayRight /></PlayReadyLicenseTemplate></LicenseTemplates></PlayReadyLicenseResponseTemplate>\",\"Restrictions\":[{\"Name\":\"Open\",\"KeyRestrictionType\":0,\"Requirements\":null}]}\n\n####将 ContentKeyAuthorizationPolicies 与 Options 相链接\n\n根据[此处](#ContentKeyAuthorizationPolicies)所示将 ContentKeyAuthorizationPolicies 与 Options 相链接。\n\n####将授权策略添加到内容密钥\n\n根据[此处](#AddAuthorizationPolicyToKey)所示将 AuthorizationPolicy 添加到 ContentKey。\n\n\n###令牌限制\n\n若要配置令牌限制选项，你需要使用 XML 来描述令牌的授权要求。令牌限制配置 XML 必须符合[此](#schema)部分中所示的 XML 架构。\n    \n####创建 ContentKeyAuthorizationPolicies\n    \n根据[此处](#ContentKeyAuthorizationPolicies2)所示创建 ContentKeyAuthorizationPolicies。\n\n####创建 ContentKeyAuthorizationPolicyOptions\n    \n请求：\n\n    POST https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions HTTP/1.1\n    Content-Type: application/json\n    DataServiceVersion: 3.0;NetFx\n    MaxDataServiceVersion: 3.0;NetFx\n    Accept: application/json\n    Accept-Charset: UTF-8\n    Authorization: Bearer http%3a%2f%2fschemas.xmlsoap.org%2fws%2f2005%2f05%2fidentity%2fclaims%2fnameidentifier=juliakoams1&urn%3aSubscriptionId=zbbef702-2233-477b-9f16-bc4d3aa97387&http%3a%2f%2fschemas.microsoft.com%2faccesscontrolservice%2f2010%2f07%2fclaims%2fidentityprovider=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&Audience=urn%3aWindowsAzureMediaServices&ExpiresOn=1423583561&Issuer=https%3a%2f%2fwamsprodglobal001acs.accesscontrol.chinacloudapi.cn%2f&HMACSHA256=5eZnkOsSv%2fLLEKmS%2bWObBlsNYyee8BQlp%2bUYbjugcJg%3d\n    x-ms-version: 2.11\n    x-ms-client-request-id: ab079b0e-2ba9-4cf1-b549-a97bfa6cd2d3\n    Host: wamsbayclus001rest-hs.chinacloudapp.cn\n    Content-Length: 1525\n    \n    {\"Name\":\"Token option\",\"KeyDeliveryType\":1,\"KeyDeliveryConfiguration\":\"<PlayReadyLicenseResponseTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1\"><LicenseTemplates><PlayReadyLicenseTemplate><AllowTestDevices>false</AllowTestDevices><ContentKey i:type=\"ContentEncryptionKeyFromHeader\" /><LicenseType>Nonpersistent</LicenseType><PlayRight /></PlayReadyLicenseTemplate></LicenseTemplates></PlayReadyLicenseResponseTemplate>\",\"Restrictions\":[{\"Name\":\"Token Authorization Policy\",\"KeyRestrictionType\":1,\"Requirements\":\"<TokenRestrictionTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/TokenRestrictionTemplate/v1\"><AlternateVerificationKeys><TokenVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>w52OyHVqXT8aaupGxuJ3NGt8M6opHDOtx132p4r6q4hLI6ffnLusgEGie1kedUewVoIe1tqDkVE6xsIV7O91KA==</KeyValue></TokenVerificationKey></AlternateVerificationKeys><Audience>urn:test</Audience><Issuer>http://testacs.com/</Issuer><PrimaryVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>dYwLKIEMBljLeY9VM7vWdlhps31Fbt0XXhqP5VyjQa33bJXleBtkzQ6dF5AtwI9gDcdM2dV2TvYNhCilBKjMCg==</KeyValue></PrimaryVerificationKey><RequiredClaims><TokenClaim><ClaimType>urn:microsoft:azure:mediaservices:contentkeyidentifier</ClaimType><ClaimValue i:nil=\"true\" /></TokenClaim></RequiredClaims><TokenType>SWT</TokenType></TokenRestrictionTemplate>\"}]}\n\n响应：\n    \n    HTTP/1.1 201 Created\n    Cache-Control: no-cache\n    Content-Length: 1706\n    Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8\n    Location: https://wamsbayclus001rest-hs.chinacloudapp.cn/api/ContentKeyAuthorizationPolicyOptions('nb%3Ackpoid%3AUUID%3Ae42bbeae-de42-4077-90e9-a844f297ef70')\n    Server: Microsoft-IIS/8.5\n    x-ms-client-request-id: ab079b0e-2ba9-4cf1-b549-a97bfa6cd2d3\n    request-id: ccf8a4ba-731e-4124-8192-079592c251cc\n    x-ms-request-id: ccf8a4ba-731e-4124-8192-079592c251cc\n    X-Content-Type-Options: nosniff\n    DataServiceVersion: 3.0;\n    X-Powered-By: ASP.NET\n    Strict-Transport-Security: max-age=31536000; includeSubDomains\n    Date: Tue, 10 Feb 2015 09:58:47 GMT\n    \n    {\"odata.metadata\":\"https://wamsbayclus001rest-hs.chinacloudapp.cn/api/$metadata#ContentKeyAuthorizationPolicyOptions/@Element\",\"Id\":\"nb:ckpoid:UUID:e42bbeae-de42-4077-90e9-a844f297ef70\",\"Name\":\"Token option\",\"KeyDeliveryType\":1,\"KeyDeliveryConfiguration\":\"<PlayReadyLicenseResponseTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1\"><LicenseTemplates><PlayReadyLicenseTemplate><AllowTestDevices>false</AllowTestDevices><ContentKey i:type=\"ContentEncryptionKeyFromHeader\" /><LicenseType>Nonpersistent</LicenseType><PlayRight /></PlayReadyLicenseTemplate></LicenseTemplates></PlayReadyLicenseResponseTemplate>\",\"Restrictions\":[{\"Name\":\"Token Authorization Policy\",\"KeyRestrictionType\":1,\"Requirements\":\"<TokenRestrictionTemplate xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/TokenRestrictionTemplate/v1\"><AlternateVerificationKeys><TokenVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>w52OyHVqXT8aaupGxuJ3NGt8M6opHDOtx132p4r6q4hLI6ffnLusgEGie1kedUewVoIe1tqDkVE6xsIV7O91KA==</KeyValue></TokenVerificationKey></AlternateVerificationKeys><Audience>urn:test</Audience><Issuer>http://testacs.com/</Issuer><PrimaryVerificationKey i:type=\"SymmetricVerificationKey\"><KeyValue>dYwLKIEMBljLeY9VM7vWdlhps31Fbt0XXhqP5VyjQa33bJXleBtkzQ6dF5AtwI9gDcdM2dV2TvYNhCilBKjMCg==</KeyValue></PrimaryVerificationKey><RequiredClaims><TokenClaim><ClaimType>urn:microsoft:azure:mediaservices:contentkeyidentifier</ClaimType><ClaimValue i:nil=\"true\" /></TokenClaim></RequiredClaims><TokenType>SWT</TokenType></TokenRestrictionTemplate>\"}]}\n\n####将 ContentKeyAuthorizationPolicies 与 Options 相链接\n\n根据[此处](#ContentKeyAuthorizationPolicies)所示将 ContentKeyAuthorizationPolicies 与 Options 相链接。\n\n####将授权策略添加到内容密钥\n\n根据[此处](#AddAuthorizationPolicyToKey)所示将 AuthorizationPolicy 添加到 ContentKey。\n\n\n##<a id=\"types\"></a>定义 ContentKeyAuthorizationPolicy 时使用的类型\n\n###<a id=\"ContentKeyRestrictionType\"></a>ContentKeyRestrictionType\n\n    public enum ContentKeyRestrictionType\n    {\n        Open = 0,\n        TokenRestricted = 1,\n        IPRestricted = 2,\n    }\n\n###<a id=\"ContentKeyDeliveryType\"></a>ContentKeyDeliveryType\n\n    public enum ContentKeyDeliveryType\n    {\n        None = 0,\n        PlayReadyLicense = 1,\n        BaselineHttp = 2,\n    }\n\n\n\n\n##后续步骤\n在配置内容密钥的授权策略后，请转到[如何配置资产传送策略](/documentation/articles/media-services-rest-configure-asset-delivery-policy)主题。\n\n \n\n<!---HONumber=82-->"
}