{
  "nodes": [
    {
      "content": "连接到 SQL 数据仓库 | Azure",
      "pos": [
        26,
        46
      ]
    },
    {
      "content": "有关在开发解决方案时连接到 Azure SQL 数据仓库的技巧。",
      "pos": [
        64,
        96
      ]
    },
    {
      "content": "连接到 SQL 数据仓库",
      "pos": [
        320,
        332
      ]
    },
    {
      "content": "若要连接到 SQL 数据仓库，需要传入安全凭据进行身份验证。建立连接时，你还会看到特定的连接设置已配置为建立查询会话的一部分。",
      "pos": [
        334,
        397
      ]
    },
    {
      "content": "本文详细说明有关连接到 SQL 数据仓库的以下方面：",
      "pos": [
        399,
        425
      ]
    },
    {
      "content": "身份验证",
      "pos": [
        429,
        433
      ]
    },
    {
      "content": "连接设置",
      "pos": [
        436,
        440
      ]
    },
    {
      "content": "会话和请求标识符",
      "pos": [
        443,
        451
      ]
    },
    {
      "content": "身份验证",
      "pos": [
        457,
        461
      ]
    },
    {
      "content": "若要连接到 SQL 数据仓库，需要提供以下信息：",
      "pos": [
        462,
        486
      ]
    },
    {
      "content": "完全限定的服务器名称",
      "pos": [
        490,
        500
      ]
    },
    {
      "content": "指定 SQL 身份验证",
      "pos": [
        504,
        515
      ]
    },
    {
      "content": "用户名",
      "pos": [
        518,
        521
      ]
    },
    {
      "content": "密码",
      "pos": [
        525,
        527
      ]
    },
    {
      "content": "默认数据库（可选）",
      "pos": [
        530,
        539
      ]
    },
    {
      "content": "请务必注意，用户必须使用 SQL 身份验证。目前不支持受信任身份验证。",
      "pos": [
        541,
        576
      ]
    },
    {
      "content": "默认情况下，你的连接将连接到 master 数据库而不是用户数据库。若要连接到用户数据库，可以选择执行以下两项操作之一：",
      "pos": [
        578,
        638
      ]
    },
    {
      "content": "在 SSDT 或应用程序连接字符串中将你的服务器注册到 SQL Server 对象资源管理器时指定默认数据库。例如，包含 ODBC 连接的 InitialCatalog 参数。",
      "pos": [
        643,
        731
      ]
    },
    {
      "content": "在 SSDT 中创建会话之前先突出显示用户数据库。",
      "pos": [
        735,
        760
      ]
    },
    {
      "pos": [
        764,
        820
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> 有关使用 SSDT 连接到 SQL 数据仓库的指导，请参阅<bpt id=\"p1\">[</bpt>连接和查询<ept id=\"p1\">][]</ept>入门文章。"
    },
    {
      "pos": [
        822,
        879
      ],
      "content": "再次强调，必须注意，不支持使用 Transact-SQL 语句 <bpt id=\"p1\">**</bpt>USE<ph id=\"ph1\">&lt;your DB&gt;</ph><ept id=\"p1\">**</ept> 更改连接的数据库"
    },
    {
      "content": "应用程序连接协议",
      "pos": [
        884,
        892
      ]
    },
    {
      "content": "可以使用以下任一协议连接到 SQL 数据仓库：",
      "pos": [
        893,
        916
      ]
    },
    {
      "content": "ADO.NET",
      "pos": [
        920,
        927
      ]
    },
    {
      "content": "ODBC",
      "pos": [
        930,
        934
      ]
    },
    {
      "content": "PHP",
      "pos": [
        937,
        940
      ]
    },
    {
      "content": "JDBC",
      "pos": [
        943,
        947
      ]
    },
    {
      "content": "示例 ADO.NET 连接字符串",
      "pos": [
        953,
        969
      ]
    },
    {
      "content": "示例 ODBC 连接字符串",
      "pos": [
        1185,
        1198
      ]
    },
    {
      "content": "示例 PHP 连接字符串",
      "pos": [
        1440,
        1452
      ]
    },
    {
      "content": "示例 JDBC 连接字符串",
      "pos": [
        2354,
        2367
      ]
    },
    {
      "content": "连接设置",
      "pos": [
        2623,
        2627
      ]
    },
    {
      "content": "SQL 数据仓库在连接和创建对象期间标准化一些设置。无法重写这些设置。",
      "pos": [
        2628,
        2663
      ]
    },
    {
      "content": "数据库设置",
      "pos": [
        2667,
        2672
      ]
    },
    {
      "content": "值",
      "pos": [
        2675,
        2676
      ]
    },
    {
      "content": "ANSI\\_NULLS",
      "pos": [
        2735,
        2746
      ]
    },
    {
      "content": "开",
      "pos": [
        2749,
        2750
      ]
    },
    {
      "content": "QUOTED\\_IDENTIFIERS",
      "pos": [
        2755,
        2774
      ]
    },
    {
      "content": "开",
      "pos": [
        2777,
        2778
      ]
    },
    {
      "content": "NO\\_COUNT",
      "pos": [
        2783,
        2792
      ]
    },
    {
      "content": "关",
      "pos": [
        2795,
        2796
      ]
    },
    {
      "content": "DATEFORMAT",
      "pos": [
        2801,
        2811
      ]
    },
    {
      "content": "mdy",
      "pos": [
        2814,
        2817
      ]
    },
    {
      "content": "DATEFIRST",
      "pos": [
        2822,
        2831
      ]
    },
    {
      "content": "7",
      "pos": [
        2834,
        2835
      ]
    },
    {
      "content": "数据库排序规则",
      "pos": [
        2840,
        2847
      ]
    },
    {
      "content": "SQL\\_Latin1\\_General\\_CP1\\_CI\\_AS",
      "pos": [
        2850,
        2883
      ]
    },
    {
      "content": "会话和请求",
      "pos": [
        2890,
        2895
      ]
    },
    {
      "content": "创建连接和会话之后，可以编写查询并将其提交到 SQL 数据仓库。",
      "pos": [
        2896,
        2928
      ]
    },
    {
      "content": "每个查询由一个或多个请求标识符表示。在该连接上提交的所有查询都是单个会话的一部分，因此将以单个会话标识符表示。",
      "pos": [
        2930,
        2985
      ]
    },
    {
      "content": "但是，SQL 数据仓库是分布式 MPP 系统，相比于 SQL Server，会话和请求标识符的公开方式有所不同。",
      "pos": [
        2987,
        3043
      ]
    },
    {
      "content": "会话和请求由各自的标识符以逻辑方式表示。",
      "pos": [
        3045,
        3065
      ]
    },
    {
      "content": "标识符",
      "pos": [
        3073,
        3076
      ]
    },
    {
      "content": "示例值",
      "pos": [
        3079,
        3082
      ]
    },
    {
      "content": "会话 ID",
      "pos": [
        3118,
        3123
      ]
    },
    {
      "content": "SID123456",
      "pos": [
        3126,
        3135
      ]
    },
    {
      "content": "请求 ID",
      "pos": [
        3140,
        3145
      ]
    },
    {
      "content": "QID123456",
      "pos": [
        3148,
        3157
      ]
    },
    {
      "content": "请注意，会话标识符的前缀为 SID - 会话标识符的简写 - 请求的前缀为 QID，它是查询标识符的简写。",
      "pos": [
        3161,
        3214
      ]
    },
    {
      "content": "你需要此信息帮助在监视查询性能时标识查询。可以使用 [Azure 门户] 和动态管理视图来监视查询性能。",
      "pos": [
        3216,
        3268
      ]
    },
    {
      "content": "使用以下函数识别当前正在使用哪个会话：",
      "pos": [
        3270,
        3289
      ]
    },
    {
      "content": "若要查看当前正在运行或近期曾针对数据仓库运行的所有查询，可以使用类似于下面的查询：",
      "pos": [
        3322,
        3363
      ]
    },
    {
      "content": "请注意，此查询已封装在视图中，因此可以将其合并到解决方案。但是，若要查看结果，你需要创建并执行视图。",
      "pos": [
        4891,
        4941
      ]
    },
    {
      "content": "后续步骤",
      "pos": [
        4946,
        4950
      ]
    },
    {
      "pos": [
        4951,
        4985
      ],
      "content": "连接后，可以开始设计你的表。有关更多详细信息，请参阅<bpt id=\"p1\">[</bpt><ept id=\"p1\">表设计]</ept>一文。"
    }
  ],
  "content": "<properties\n   pageTitle=\"连接到 SQL 数据仓库 | Azure\"\n   description=\"有关在开发解决方案时连接到 Azure SQL 数据仓库的技巧。\"\n   services=\"sql-data-warehouse\"\n   documentationCenter=\"NA\"\n   authors=\"jrowlandjones\"\n   manager=\"barbkess\"\n   editor=\"\"/>\n\n<tags\n   ms.service=\"sql-data-warehouse\"\n   ms.date=\"01/07/2016\"\n   wacn.date=\"02/26/2016\"/>\n\n# 连接到 SQL 数据仓库 \n若要连接到 SQL 数据仓库，需要传入安全凭据进行身份验证。建立连接时，你还会看到特定的连接设置已配置为建立查询会话的一部分。\n\n本文详细说明有关连接到 SQL 数据仓库的以下方面：\n\n- 身份验证\n- 连接设置\n- 会话和请求标识符\n\n\n## 身份验证\n若要连接到 SQL 数据仓库，需要提供以下信息：\n\n- 完全限定的服务器名称 \n- 指定 SQL 身份验证\n- 用户名 \n- 密码\n- 默认数据库（可选）\n\n请务必注意，用户必须使用 SQL 身份验证。目前不支持受信任身份验证。\n\n默认情况下，你的连接将连接到 master 数据库而不是用户数据库。若要连接到用户数据库，可以选择执行以下两项操作之一：\n\n1. 在 SSDT 或应用程序连接字符串中将你的服务器注册到 SQL Server 对象资源管理器时指定默认数据库。例如，包含 ODBC 连接的 InitialCatalog 参数。\n2. 在 SSDT 中创建会话之前先突出显示用户数据库。\n\n> [AZURE.NOTE] 有关使用 SSDT 连接到 SQL 数据仓库的指导，请参阅[连接和查询][]入门文章。\n\n再次强调，必须注意，不支持使用 Transact-SQL 语句 **USE<your DB>** 更改连接的数据库\n\n## 应用程序连接协议\n可以使用以下任一协议连接到 SQL 数据仓库：\n\n- ADO.NET\n- ODBC\n- PHP\n- JDBC\n\n### 示例 ADO.NET 连接字符串\n\n```\nServer=tcp:{your_server}.database.chinacloudapi.cn,1433;Database={your_database};User ID={your_user_name};Password={your_password_here};Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;\n```\n\n### 示例 ODBC 连接字符串\n\n```\nDriver={SQL Server Native Client 11.0};Server=tcp:{your_server}.database.chinacloudapi.cn,1433;Database={your_database};Uid={your_user_name};Pwd={your_password_here};Encrypt=yes;TrustServerCertificate=no;Connection Timeout=30;\n```\n\n### 示例 PHP 连接字符串\n\n```\nServer: {your_server}.database.chinacloudapi.cn,1433 \\r\\nSQL Database: {your_database}\\r\\nUser Name: {your_user_name}\\r\\n\\r\\nPHP Data Objects(PDO) Sample Code:\\r\\n\\r\\ntry {\\r\\n   $conn = new PDO ( \"sqlsrv:server = tcp:{your_server}.database.chinacloudapi.cn,1433; Database = {your_database}\", \"{your_user_name}\", \"{your_password_here}\");\\r\\n    $conn->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );\\r\\n}\\r\\ncatch ( PDOException $e ) {\\r\\n   print( \"Error connecting to SQL Server.\" );\\r\\n   die(print_r($e));\\r\\n}\\r\\n\\rSQL Server Extension Sample Code:\\r\\n\\r\\n$connectionInfo = array(\"UID\" => \"{your_user_name}\", \"pwd\" => \"{your_password_here}\", \"Database\" => \"{your_database}\", \"LoginTimeout\" => 30, \"Encrypt\" => 1, \"TrustServerCertificate\" => 0);\\r\\n$serverName = \"tcp:{your_server}.database.chinacloudapi.cn,1433\";\\r\\n$conn = sqlsrv_connect($serverName, $connectionInfo);\n```\n\n### 示例 JDBC 连接字符串\n\n```\njdbc:sqlserver://yourserver.database.chinacloudapi.cn:1433;database=yourdatabase;user={your_user_name};password={your_password_here};encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.chinacloudapi.cn;loginTimeout=30;\n```\n\n## 连接设置\nSQL 数据仓库在连接和创建对象期间标准化一些设置。无法重写这些设置。\n\n| 数据库设置 | 值 |\n| :----------------- | :--------------------------- |\n| ANSI\\_NULLS | 开 |\n| QUOTED\\_IDENTIFIERS | 开 |\n| NO\\_COUNT | 关 |\n| DATEFORMAT | mdy |\n| DATEFIRST | 7 |\n| 数据库排序规则 | SQL\\_Latin1\\_General\\_CP1\\_CI\\_AS |\n\n## 会话和请求\n创建连接和会话之后，可以编写查询并将其提交到 SQL 数据仓库。\n\n每个查询由一个或多个请求标识符表示。在该连接上提交的所有查询都是单个会话的一部分，因此将以单个会话标识符表示。\n\n但是，SQL 数据仓库是分布式 MPP 系统，相比于 SQL Server，会话和请求标识符的公开方式有所不同。\n\n会话和请求由各自的标识符以逻辑方式表示。\n    \n| 标识符 | 示例值 |\n| :--------- | :------------ |\n| 会话 ID | SID123456 |\n| 请求 ID | QID123456 |\n\n请注意，会话标识符的前缀为 SID - 会话标识符的简写 - 请求的前缀为 QID，它是查询标识符的简写。\n\n你需要此信息帮助在监视查询性能时标识查询。可以使用 [Azure 门户] 和动态管理视图来监视查询性能。\n\n使用以下函数识别当前正在使用哪个会话：\n\n```\nSELECT SESSION_ID()\n;\n```\n\n若要查看当前正在运行或近期曾针对数据仓库运行的所有查询，可以使用类似于下面的查询：\n\n```\nCREATE VIEW dbo.vSessionRequests\nAS\nSELECT   s.[session_id]                                 AS Session_ID\n        ,s.[status]                                     AS Session_Status\n        ,s.[login_name]                                 AS Session_LoginName\n        ,s.[login_time]                                 AS Session_LoginTime\n        ,r.[request_id]                                 AS Request_ID\n        ,r.[status]                                     AS Request_Status\n        ,r.[submit_time]                                AS Request_SubmitTime\n        ,r.[start_time]                                 AS Request_StartTime\n        ,r.[end_compile_time]                           AS Request_EndCompileTime\n        ,r.[end_time]                                   AS Request_EndTime\n        ,r.[total_elapsed_time]                         AS Request_TotalElapsedDuration_ms\n        ,DATEDIFF(ms,[submit_time],[start_time])        AS Request_InitiateDuration_ms\n        ,DATEDIFF(ms,[start_time],[end_compile_time])   AS Request_CompileDuration_ms\n        ,DATEDIFF(ms,[end_compile_time],[end_time])     AS Request_ExecDuration_ms\n        ,[label]                                        AS Request_QueryLabel\n        ,[command]                                      AS Request_Command\n        ,[database_id]                                  AS Request_Database_ID\nFROM    sys.dm_pdw_exec_requests r\nJOIN    sys.dm_pdw_exec_sessions s  ON  r.[session_id] = s.[session_id]\nWHERE   s.[session_id] <> SESSION_ID()\n;\n```\n\n请注意，此查询已封装在视图中，因此可以将其合并到解决方案。但是，若要查看结果，你需要创建并执行视图。\n\n## 后续步骤\n连接后，可以开始设计你的表。有关更多详细信息，请参阅[表设计]一文。\n\n<!--Image references-->\n\n<!--Azure.com references-->\n[连接和查询]: /documentation/articles/sql-data-warehouse-get-started-connect\n[表设计]: /documentation/articles/sql-data-warehouse-develop-table-design\n\n<!--MSDN references-->\n\n<!--Other references-->\n\n<!---HONumber=Mooncake_0215_2016-->"
}