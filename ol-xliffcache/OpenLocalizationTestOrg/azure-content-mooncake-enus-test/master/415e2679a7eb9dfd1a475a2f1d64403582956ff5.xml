{
  "nodes": [
    {
      "content": "在 Azure 自动化中启动 Runbook",
      "pos": [
        27,
        49
      ]
    },
    {
      "content": "汇总了可用于在 Azure 自动化中启动 Runbook 的不同方法，并提供有关如何使用 Azure 管理门户和 Windows PowerShell 的详细信息。",
      "pos": [
        67,
        149
      ]
    },
    {
      "content": "在 Azure 自动化中启动 Runbook",
      "pos": [
        356,
        378
      ]
    },
    {
      "content": "下表将帮助你确定如何在 Azure 自动化中以最适合你方案的方法启动 Runbook。本文包含有关使用 Azure 管理门户和 Windows PowerShell 启动 Runbook 的详细信息。有关其他方法的详细信息将在其他文档中提供，你可以通过以下链接来访问。",
      "pos": [
        380,
        514
      ]
    },
    {
      "content": "方法",
      "pos": [
        536,
        538
      ]
    },
    {
      "content": "特征",
      "pos": [
        550,
        552
      ]
    },
    {
      "content": "Azure 管理门户",
      "pos": [
        640,
        650
      ]
    },
    {
      "content": "使用交互式用户界面的最简单方法。",
      "pos": [
        683,
        699
      ]
    },
    {
      "content": "用于提供简单参数值的窗体。",
      "pos": [
        713,
        726
      ]
    },
    {
      "content": "轻松跟踪作业状态。",
      "pos": [
        740,
        749
      ]
    },
    {
      "content": "使用 Azure 登录对访问进行身份验证。",
      "pos": [
        763,
        784
      ]
    },
    {
      "content": "Windows PowerShell",
      "pos": [
        891,
        909
      ]
    },
    {
      "content": "使用 Windows PowerShell cmdlet 从命令行调用。",
      "pos": [
        943,
        979
      ]
    },
    {
      "content": "可以使用多个步骤包含在自动化解决方案中。",
      "pos": [
        994,
        1014
      ]
    },
    {
      "content": "使用证书或 OAuth 用户主体/服务主体对请求进行身份验证。",
      "pos": [
        1029,
        1060
      ]
    },
    {
      "content": "提供简单和复杂的参数值。",
      "pos": [
        1075,
        1087
      ]
    },
    {
      "content": "跟踪作业状态。",
      "pos": [
        1102,
        1109
      ]
    },
    {
      "content": "支持 PowerShell cmdlet 所需的客户端。",
      "pos": [
        1124,
        1152
      ]
    },
    {
      "content": "Azure 自动化 API",
      "pos": [
        1264,
        1277
      ]
    },
    {
      "content": "最有弹性的方法，但也最复杂。",
      "pos": [
        1310,
        1324
      ]
    },
    {
      "content": "从任何可发出 HTTP 请求的自定义代码调用。",
      "pos": [
        1338,
        1361
      ]
    },
    {
      "content": "使用证书或 OAuth 用户主体/服务主体对请求进行身份验证。",
      "pos": [
        1375,
        1406
      ]
    },
    {
      "content": "提供简单和复杂的参数值。",
      "pos": [
        1420,
        1432
      ]
    },
    {
      "content": "跟踪作业状态。",
      "pos": [
        1446,
        1453
      ]
    },
    {
      "content": "计划",
      "pos": [
        1561,
        1563
      ]
    },
    {
      "content": "按每小时、每天或每周计划自动启动 Runbook。",
      "pos": [
        1596,
        1621
      ]
    },
    {
      "content": "通过 Azure 管理门户、PowerShell cmdlet 或 Azure API 来操作计划。",
      "pos": [
        1635,
        1685
      ]
    },
    {
      "content": "提供与计划配置使用的参数值。",
      "pos": [
        1699,
        1713
      ]
    },
    {
      "content": "从另一个 Runbook",
      "pos": [
        1816,
        1828
      ]
    },
    {
      "content": "使用一个 Runbook 作为另一个 Runbook 中的活动",
      "pos": [
        1861,
        1892
      ]
    },
    {
      "content": "对多个 Runbook 使用的功能很有用。",
      "pos": [
        1906,
        1927
      ]
    },
    {
      "content": "为子 Runbook 提供参数值，并使用父 Runbook 中的输出。",
      "pos": [
        1941,
        1976
      ]
    },
    {
      "content": "使用 Azure 管理门户启动 Runbook",
      "pos": [
        2026,
        2049
      ]
    },
    {
      "content": "在 Azure 管理门户中，选择“自动化”，然后单击自动化帐户的名称。",
      "pos": [
        2110,
        2145
      ]
    },
    {
      "content": "选择“Runbook”选项卡。",
      "pos": [
        2149,
        2164
      ]
    },
    {
      "content": "选择一个 Runbook，然后单击“启动”。",
      "pos": [
        2168,
        2190
      ]
    },
    {
      "pos": [
        2194,
        2287
      ],
      "content": "如果 Runbook 包含参数，则系统会提示你在文本框中提供每个参数的值。请参阅下面的 <bpt id=\"p1\">[</bpt>Runbook 参数<ept id=\"p1\">](#Runbook-parameters)</ept>，以获取有关参数的更多详细信息。"
    },
    {
      "content": "选择“启动 Runbook”消息旁边的“查看作业”，或选择 Runbook 的“作业”选项卡以查看 Runbook 作业的状态。",
      "pos": [
        2291,
        2355
      ]
    },
    {
      "content": "使用 Windows PowerShell 启动 Runbook",
      "pos": [
        2361,
        2393
      ]
    },
    {
      "pos": [
        2453,
        2618
      ],
      "content": "可以在 Windows PowerShell 中使用 <bpt id=\"p1\">[</bpt>Start-AzureAutomationRunbook<ept id=\"p1\">](http://msdn.microsoft.com/zh-cn/library/azure/dn690259.aspx)</ept> 启动 Runbook。以下示例代码将启动名为 Test-Runbook 的 Runbook。"
    },
    {
      "pos": [
        2720,
        3066
      ],
      "content": "Start-AzureAutomationRunbook 将返回一个作业对象，启动 Runbook 后，你可以使用该对象来跟踪 Runbook 的状态。然后可以将此作业对象与 <bpt id=\"p1\">[</bpt>Get-AzureAutomationJob<ept id=\"p1\">](http://msdn.microsoft.com/zh-cn/library/azure/dn690263.aspx)</ept> 结合使用来确定作业的状态，并将它与 <bpt id=\"p2\">[</bpt>Get-AzureAutomationJobOutput<ept id=\"p2\">](http://msdn.microsoft.com/zh-cn/library/azure/dn690268.aspx)</ept> 结合使用以获取作业的输出。以下示例代码将启动名为 Test-Runbook 的 Runbook，等待它完成，然后显示其输出。"
    },
    {
      "pos": [
        3594,
        3854
      ],
      "content": "如果 Runbook 需要参数，则你必须以<bpt id=\"p1\">[</bpt>哈希表<ept id=\"p1\">](http://technet.microsoft.com/zh-cn/library/hh847780.aspx)</ept>的形式提供参数，其中，哈希表的密钥与参数名称匹配，值为参数值。以下示例演示如何启动包含两个名称分别为 FirstName 和 LastName 的字符串参数、一个名为 RepeatCount 的整数和一个名为 Show 的布尔参数的 Runbook。有关参数的其他信息，请参阅下面的 <bpt id=\"p2\">[</bpt>Runbook 参数<ept id=\"p2\">](#Runbook-parameters)</ept>。"
    },
    {
      "content": "Runbook 参数",
      "pos": [
        4062,
        4072
      ]
    },
    {
      "pos": [
        4106,
        4320
      ],
      "content": "当你使用 Azure 管理门户或 Windows PowerShell 启动 Runbook 时，系统将通过 Azure 自动化 Web 服务发送指令。此服务不支持复杂数据类型的参数。如果需要提供复杂参数的值，则必须根据 <bpt id=\"p1\">[</bpt>Azure 自动化中的子 Runbook<ept id=\"p1\">](/documentation/articles/automation-child-runbooks)</ept> 中所述，以内联方式从另一个 Runbook 调用该参数值。"
    },
    {
      "content": "Azure 自动化 Web 服务将为使用特定数据类型的参数提供特殊功能，如以下部分中所述。",
      "pos": [
        4322,
        4367
      ]
    },
    {
      "content": "命名值",
      "pos": [
        4373,
        4376
      ]
    },
    {
      "pos": [
        4378,
        4641
      ],
      "content": "如果参数的数据类型为 object，则你可以使用以下 JSON 格式向它发送命名值列表：<bpt id=\"p1\">*</bpt>{\"Name1\":Value1, \"Name2\":Value2, \"Name3\":Value3}<ept id=\"p1\">*</ept>。这些值必须使用简单类型。Runbook 将以 <bpt id=\"p2\">[</bpt>PSCustomObject<ept id=\"p2\">](http://msdn.microsoft.com/zh-cn/library/azure/system.management.automation.pscustomobject(v=vs.85).aspx)</ept> 的形式接收参数，该对象的属性对应于每个命名值。"
    },
    {
      "content": "请考虑以下接受名为 user 的参数的测试 Runbook。",
      "pos": [
        4643,
        4673
      ]
    },
    {
      "content": "可为 user 参数使用以下文本。",
      "pos": [
        4959,
        4976
      ]
    },
    {
      "content": "这会导致生成以下输出。",
      "pos": [
        5050,
        5061
      ]
    },
    {
      "content": "数组",
      "pos": [
        5104,
        5106
      ]
    },
    {
      "pos": [
        5108,
        5195
      ],
      "content": "如果参数是数组（如 array 或 string），则你可以使用以下 JSON 格式向它发送值列表：<bpt id=\"p1\">*</bpt>[Value1,Value2,Value3]<ept id=\"p1\">*</ept>。这些值必须使用简单类型。"
    },
    {
      "pos": [
        5197,
        5229
      ],
      "content": "请考虑以下接受名为 <bpt id=\"p1\">*</bpt>user<ept id=\"p1\">*</ept> 的参数的测试 Runbook。"
    },
    {
      "content": "可为 user 参数使用以下文本。",
      "pos": [
        5492,
        5509
      ]
    },
    {
      "content": "这会导致生成以下输出。",
      "pos": [
        5539,
        5550
      ]
    },
    {
      "content": "凭据",
      "pos": [
        5593,
        5595
      ]
    },
    {
      "pos": [
        5597,
        5720
      ],
      "content": "如果参数的数据类型为 <bpt id=\"p1\">**</bpt>PSCredential<ept id=\"p1\">**</ept>，则你可以提供 Azure 自动化<bpt id=\"p2\">[</bpt>凭据资产<ept id=\"p2\">](/documentation/articles/automation-credentials)</ept>的名称。Runbook 将检索具有指定名称的凭据。"
    },
    {
      "content": "请考虑以下接受名为 credential 的参数的测试 Runbook。",
      "pos": [
        5722,
        5758
      ]
    },
    {
      "pos": [
        5919,
        5966
      ],
      "content": "假设存在名为 <bpt id=\"p1\">*</bpt>My Credential<ept id=\"p1\">*</ept> 的凭据资产，则可为 user 参数使用以下文本。"
    },
    {
      "pos": [
        5987,
        6018
      ],
      "content": "假设凭据中的用户名为 <bpt id=\"p1\">*</bpt>jsmith<ept id=\"p1\">*</ept>，则会导致生成以下输出。"
    },
    {
      "content": "相关文章",
      "pos": [
        6044,
        6048
      ]
    },
    {
      "content": "Azure 自动化中的子 Runbook",
      "pos": [
        6053,
        6073
      ]
    }
  ],
  "content": "<properties \n   pageTitle=\"在 Azure 自动化中启动 Runbook\"\n   description=\"汇总了可用于在 Azure 自动化中启动 Runbook 的不同方法，并提供有关如何使用 Azure 管理门户和 Windows PowerShell 的详细信息。\"\n   services=\"automation\"\n   documentationCenter=\"\"\n   authors=\"bwren\"\n   manager=\"stevenka\"\n   editor=\"tysonn\" />\n<tags\n    ms.service=\"automation\"\n    ms.date=\"11/13/2015\"\n    wacn.date=\"12/17/2015\"/>\n\n# 在 Azure 自动化中启动 Runbook\n\n下表将帮助你确定如何在 Azure 自动化中以最适合你方案的方法启动 Runbook。本文包含有关使用 Azure 管理门户和 Windows PowerShell 启动 Runbook 的详细信息。有关其他方法的详细信息将在其他文档中提供，你可以通过以下链接来访问。\n\n<table>\n <tr>\n  <td>方法</td>\n  <td>特征</td>\n </tr>\n <tr>           \n  <td><a href=\"#starting-a-runbook-with-the-azure-portal\">Azure 管理门户</a></td>\n  <td>\n   <ul>\n    <li>使用交互式用户界面的最简单方法。</li>\n    <li>用于提供简单参数值的窗体。</li>\n    <li>轻松跟踪作业状态。</li>\n    <li>使用 Azure 登录对访问进行身份验证。</li>\n   </ul>\n  </td>\n </tr>\n <tr>\n  <td><a href=\"https://msdn.microsoft.com/zh-cn/library/dn690259.aspx\">Windows PowerShell</a></td>\n  <td>\n   <ul>\n     <li>使用 Windows PowerShell cmdlet 从命令行调用。</li>\n     <li>可以使用多个步骤包含在自动化解决方案中。</li>\n     <li>使用证书或 OAuth 用户主体/服务主体对请求进行身份验证。</li>\n     <li>提供简单和复杂的参数值。</li>\n     <li>跟踪作业状态。</li>\n     <li>支持 PowerShell cmdlet 所需的客户端。</li>\n   </ul>\n  </td>\n </tr>\n <tr>\n  <td><a href=\"http://msdn.microsoft.com/zh-cn/library/azure/mt163849.aspx\">Azure 自动化 API</a></td>\n  <td>\n   <ul>\n    <li>最有弹性的方法，但也最复杂。</li>\n    <li>从任何可发出 HTTP 请求的自定义代码调用。</li>\n    <li>使用证书或 OAuth 用户主体/服务主体对请求进行身份验证。</li>\n    <li>提供简单和复杂的参数值。</li>\n    <li>跟踪作业状态。</li>\n   </ul>\n  </td>\n </tr>\n <tr>\n  <td><a href=\"/documentation/articles/automation-scheduling-a-runbook\">计划</a></td>\n  <td>\n   <ul>\n    <li>按每小时、每天或每周计划自动启动 Runbook。</li>\n    <li>通过 Azure 管理门户、PowerShell cmdlet 或 Azure API 来操作计划。</li>\n    <li>提供与计划配置使用的参数值。</li>\n   </ul>\n  </td>\n </tr>\n <tr>\n  <td><a href=\"/documentation/articles/automation-child-runbooks/\">从另一个 Runbook</a></td>\n  <td>\n   <ul>\n    <li>使用一个 Runbook 作为另一个 Runbook 中的活动</li>\n    <li>对多个 Runbook 使用的功能很有用。</li>\n    <li>为子 Runbook 提供参数值，并使用父 Runbook 中的输出。</li>\n   </ul>\n  </td>\n </tr>\n</table>\n<br>\n\n\n\n## 使用 Azure 管理门户启动 Runbook\n<a name=\"starting-a-runbook-with-the-azure-portal\"></a>\n\n1. 在 Azure 管理门户中，选择“自动化”，然后单击自动化帐户的名称。\n1. 选择“Runbook”选项卡。\n1. 选择一个 Runbook，然后单击“启动”。\n1. 如果 Runbook 包含参数，则系统会提示你在文本框中提供每个参数的值。请参阅下面的 [Runbook 参数](#Runbook-parameters)，以获取有关参数的更多详细信息。\n1. 选择“启动 Runbook”消息旁边的“查看作业”，或选择 Runbook 的“作业”选项卡以查看 Runbook 作业的状态。\n\n\n## 使用 Windows PowerShell 启动 Runbook\n<a name=\"starting-a-runbook-with-windows-powershell\"></a>\n\n可以在 Windows PowerShell 中使用 [Start-AzureAutomationRunbook](http://msdn.microsoft.com/zh-cn/library/azure/dn690259.aspx) 启动 Runbook。以下示例代码将启动名为 Test-Runbook 的 Runbook。\n\n    Start-AzureAutomationRunbook –AutomationAccountName \"MyAutomationAccount\" –Name \"Test-Runbook\"\n\nStart-AzureAutomationRunbook 将返回一个作业对象，启动 Runbook 后，你可以使用该对象来跟踪 Runbook 的状态。然后可以将此作业对象与 [Get-AzureAutomationJob](http://msdn.microsoft.com/zh-cn/library/azure/dn690263.aspx) 结合使用来确定作业的状态，并将它与 [Get-AzureAutomationJobOutput](http://msdn.microsoft.com/zh-cn/library/azure/dn690268.aspx) 结合使用以获取作业的输出。以下示例代码将启动名为 Test-Runbook 的 Runbook，等待它完成，然后显示其输出。\n\n    $job = Start-AzureAutomationRunbook –AutomationAccountName \"MyAutomationAccount\" –Name \"Test-Runbook\"\n    \n    $doLoop = $true\n    While ($doLoop) {\n       $job = Get-AzureAutomationJob –AutomationAccountName \"MyAutomationAccount\" -Id $job.Id\n       $status = $job.Status\n       $doLoop = (($status -ne \"Completed\") -and ($status -ne \"Failed\") -and ($status -ne \"Suspended\") -and ($status -ne \"Stopped\") \n    }\n    \n    Get-AzureAutomationJobOutput –AutomationAccountName \"MyAutomationAccount\" -Id $job.Id –Stream Output\n\n如果 Runbook 需要参数，则你必须以[哈希表](http://technet.microsoft.com/zh-cn/library/hh847780.aspx)的形式提供参数，其中，哈希表的密钥与参数名称匹配，值为参数值。以下示例演示如何启动包含两个名称分别为 FirstName 和 LastName 的字符串参数、一个名为 RepeatCount 的整数和一个名为 Show 的布尔参数的 Runbook。有关参数的其他信息，请参阅下面的 [Runbook 参数](#Runbook-parameters)。\n\n    $params = @{\"FirstName\"=\"Joe\";\"LastName\"=\"Smith\";\"RepeatCount\"=2;\"Show\"=$true}\n    Start-AzureAutomationRunbook –AutomationAccountName \"MyAutomationAccount\" –Name \"Test-Runbook\" –Parameters $params\n\n## Runbook 参数\n<a id=\"runbook-parameters\"></a>\n\n当你使用 Azure 管理门户或 Windows PowerShell 启动 Runbook 时，系统将通过 Azure 自动化 Web 服务发送指令。此服务不支持复杂数据类型的参数。如果需要提供复杂参数的值，则必须根据 [Azure 自动化中的子 Runbook](/documentation/articles/automation-child-runbooks) 中所述，以内联方式从另一个 Runbook 调用该参数值。\n\nAzure 自动化 Web 服务将为使用特定数据类型的参数提供特殊功能，如以下部分中所述。\n\n### 命名值\n\n如果参数的数据类型为 object，则你可以使用以下 JSON 格式向它发送命名值列表：*{\"Name1\":Value1, \"Name2\":Value2, \"Name3\":Value3}*。这些值必须使用简单类型。Runbook 将以 [PSCustomObject](http://msdn.microsoft.com/zh-cn/library/azure/system.management.automation.pscustomobject(v=vs.85).aspx) 的形式接收参数，该对象的属性对应于每个命名值。\n\n请考虑以下接受名为 user 的参数的测试 Runbook。\n\n    Workflow Test-Parameters\n    {\n       param ( \n          [Parameter(Mandatory=$true)][object]$user\n       )\n        if ($user.Show) {\n            foreach ($i in 1..$user.RepeatCount) {\n                $user.FirstName\n                $user.LastName\n            }\n        } \n    }\n\n可为 user 参数使用以下文本。\n\n    {\"FirstName\":\"Joe\",\"LastName\":\"Smith\",\"RepeatCount\":2,\"Show\":true}\n\n这会导致生成以下输出。\n\n    Joe\n    Smith\n    Joe\n    Smith\n\n### 数组\n\n如果参数是数组（如 array 或 string），则你可以使用以下 JSON 格式向它发送值列表：*[Value1,Value2,Value3]*。这些值必须使用简单类型。\n\n请考虑以下接受名为 *user* 的参数的测试 Runbook。\n\n    Workflow Test-Parameters\n    {\n       param ( \n          [Parameter(Mandatory=$true)][array]$user\n       )\n        if ($user[3]) {\n            foreach ($i in 1..$user[2]) {\n                $ user[0]\n                $ user[1]\n            }\n        } \n    }\n\n可为 user 参数使用以下文本。\n\n    [\"Joe\",\"Smith\",2,true]\n\n这会导致生成以下输出。\n\n    Joe\n    Smith\n    Joe\n    Smith\n\n### 凭据\n\n如果参数的数据类型为 **PSCredential**，则你可以提供 Azure 自动化[凭据资产](/documentation/articles/automation-credentials)的名称。Runbook 将检索具有指定名称的凭据。\n\n请考虑以下接受名为 credential 的参数的测试 Runbook。\n\n    Workflow Test-Parameters\n    {\n       param ( \n          [Parameter(Mandatory=$true)][PSCredential]$credential\n       )\n       $credential.UserName\n    }\n\n假设存在名为 *My Credential* 的凭据资产，则可为 user 参数使用以下文本。\n\n    My Credential\n\n假设凭据中的用户名为 *jsmith*，则会导致生成以下输出。\n\n<code>jsmith</code>\n\n## 相关文章\n\n- [Azure 自动化中的子 Runbook](/documentation/articles/automation-child-runbooks) \n\n<!---HONumber=Mooncake_1207_2015-->"
}