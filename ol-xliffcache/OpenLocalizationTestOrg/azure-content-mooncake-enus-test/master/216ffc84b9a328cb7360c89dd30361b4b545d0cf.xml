{
  "nodes": [
    {
      "content": "入门：Azure AD 密码管理 | Azure",
      "pos": [
        28,
        52
      ]
    },
    {
      "content": "使用户能够重置其自己的密码和了解密码重置先决条件，并启用密码写回来管理 Active Directory 中的本地密码。",
      "pos": [
        72,
        132
      ]
    },
    {
      "content": "密码管理入门",
      "pos": [
        366,
        372
      ]
    },
    {
      "content": "只要完成几个简单的步骤，就能让你的用户管理他们自己的云 Azure Active Directory 密码或本地 Active Directory 密码。在确保符合几个简单的先决条件之后，你将在不知不觉中为整个组织启用密码更改和重置。本文将引导你完成以下操作思路：",
      "pos": [
        373,
        505
      ]
    },
    {
      "content": "如何让用户重置其云 Azure Active Directory 密码",
      "pos": [
        512,
        547
      ]
    },
    {
      "content": "自助密码重置先决条件",
      "pos": [
        604,
        614
      ]
    },
    {
      "content": "步骤 1：配置密码重置策略",
      "pos": [
        636,
        649
      ]
    },
    {
      "content": "步骤 2：为测试用户添加联系人数据",
      "pos": [
        696,
        713
      ]
    },
    {
      "content": "步骤 3：以用户身份重置密码",
      "pos": [
        764,
        778
      ]
    },
    {
      "content": "如何让用户重置或更改其本地 Active Directory 密码",
      "pos": [
        833,
        866
      ]
    },
    {
      "content": "密码写回先决条件",
      "pos": [
        927,
        935
      ]
    },
    {
      "content": "步骤 1：下载最新版本的 Azure AD Connect",
      "pos": [
        967,
        996
      ]
    },
    {
      "content": "步骤 2：通过 UI 或 powershell 在 Azure AD Connect 中启用密码写回并验证",
      "pos": [
        1059,
        1112
      ]
    },
    {
      "content": "步骤 3：配置防火墙",
      "pos": [
        1173,
        1183
      ]
    },
    {
      "content": "步骤 4：设置适当的权限",
      "pos": [
        1222,
        1234
      ]
    },
    {
      "content": "步骤 5：以用户身份重置 AD 密码并验证",
      "pos": [
        1301,
        1322
      ]
    },
    {
      "pos": [
        1370,
        1449
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"enable-users-to-reset-their-azure-ad-passwords\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>让用户重置其 Azure AD 密码"
    },
    {
      "content": "本部分详细介绍如何为 AAD 云目录启用自助密码重置、注册用户进行自助密码重置，以及最终以用户身份执行测试性的自助密码重置。",
      "pos": [
        1450,
        1512
      ]
    },
    {
      "content": "自助密码重置先决条件",
      "pos": [
        1517,
        1527
      ]
    },
    {
      "content": "步骤 1：配置密码重置策略",
      "pos": [
        1548,
        1561
      ]
    },
    {
      "content": "步骤 2：为测试用户添加联系人数据",
      "pos": [
        1607,
        1624
      ]
    },
    {
      "content": "步骤 3：以用户身份重置密码",
      "pos": [
        1674,
        1688
      ]
    },
    {
      "pos": [
        1744,
        1776
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"prerequisites\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>先决条件"
    },
    {
      "content": "你必须先完成以下先决条件才能启用和使用自助密码重置：",
      "pos": [
        1777,
        1803
      ]
    },
    {
      "content": "创建 AAD 租户。",
      "pos": [
        1807,
        1817
      ]
    },
    {
      "pos": [
        1821,
        1941
      ],
      "content": "获取 Azure 订阅。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>什么是 Azure AD 租户？<ept id=\"p1\">](/documentation/articles/active-directory-administer#what-is-an-azure-ad-tenant)</ept>"
    },
    {
      "pos": [
        1944,
        2068
      ],
      "content": "将你的 AAD 租户与 Azure 订阅相关联。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure 订阅与 Azure AD 的关联方式<ept id=\"p1\">](https://msdn.microsoft.com/zh-cn/library/azure/dn629581.aspx)</ept>。"
    },
    {
      "pos": [
        2071,
        2171
      ],
      "content": "升级到 Azure AD Premium 或 Basic。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure Active Directory 版本<ept id=\"p1\">](/home/features/identity/#price)</ept>。"
    },
    {
      "pos": [
        2176,
        2371
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>若要启用自助密码重置，必须升级到 Azure AD Premium 或 Azure AD Basic。有关详细信息，请参阅“Azure Active Directory 版本”。这些信息包括以下任务的详细说明：如何注册 Azure AD Premium 或 Basic、如何激活你的许可计划并激活 Azure AD 访问权限，以及如何为管理员和用户帐户分配访问权限。"
    },
    {
      "content": "在 AAD 目录中创建至少一个管理员帐户和一个用户帐户。",
      "pos": [
        2377,
        2405
      ]
    },
    {
      "content": "为所创建的管理员和用户帐户分配 AAD Premium 或 Basic 许可证。",
      "pos": [
        2408,
        2448
      ]
    },
    {
      "pos": [
        2454,
        2520
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-1-configure-password-reset-policy\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 1：配置密码重置策略"
    },
    {
      "content": "若要配置用户密码重置策略，请完成以下步骤：",
      "pos": [
        2521,
        2542
      ]
    },
    {
      "pos": [
        2549,
        2607
      ],
      "content": "打开你选择的浏览器并转到 <bpt id=\"p1\">[</bpt>Azure 管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>。"
    },
    {
      "pos": [
        2612,
        2693
      ],
      "content": "在 <bpt id=\"p1\">[</bpt>Azure 管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>的左侧导航栏上，找到 <bpt id=\"p2\">**</bpt>Active Directory 扩展<ept id=\"p2\">**</ept>。"
    },
    {
      "content": "在“目录”选项卡上，单击你想在其中配置用户密码重置策略的目录，例如 Wingtip Toys。",
      "pos": [
        2712,
        2759
      ]
    },
    {
      "content": "单击“配置”选项卡。",
      "pos": [
        2779,
        2789
      ]
    },
    {
      "content": "在“配置”选项卡上，向下滚动到“用户密码重置策略”部分。你将在此为给定目录配置用户密码重置策略的各个方面。",
      "pos": [
        2809,
        2862
      ]
    },
    {
      "pos": [
        2869,
        3021
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>此<bpt id=\"p1\">**</bpt>策略仅适用于你组织中的最终用户，而不是管理员<ept id=\"p1\">**</ept>。出于安全原因，Microsoft 控制管理员的密码重置策略。如果你不查看本部分，请确保你已注册 Azure Active Directory Premium 和 Basic，并为要配置此功能的管理员帐户<bpt id=\"p2\">**</bpt>分配了许可证<ept id=\"p2\">**</ept>。"
    },
    {
      "pos": [
        3041,
        3233
      ],
      "content": "若要配置用户密码重置策略，请将“可进行密码重置的用户”开关滑动到“是”设置。这将显示更多控件，通过这些控件你可以配置此功能在目录中的工作方式。根据需要随意自定义密码重置。如果你想详细了解每个密码重置策略控件的作用，请参阅<bpt id=\"p1\">[</bpt>自定义：Azure AD 密码管理<ept id=\"p1\">](/documentation/articles/active-directory-passwords-customize)</ept>。"
    },
    {
      "content": "根据租户需求配置用户密码重置策略后，请单击屏幕底部的“保存”按钮。",
      "pos": [
        3253,
        3286
      ]
    },
    {
      "pos": [
        3291,
        3343
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>建议使用两个质询用户密码重置策略，以便你能够了解该功能如何在最复杂的情况下工作。"
    },
    {
      "pos": [
        3361,
        3435
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-2-add-contact-data-for-your-test-user\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 2：为测试用户添加联系人数据"
    },
    {
      "content": "关于如何为你所在组织中的用户指定用于密码重置的数据，你有几种选择。",
      "pos": [
        3436,
        3469
      ]
    },
    {
      "pos": [
        3475,
        3588
      ],
      "content": "在 <bpt id=\"p1\">[</bpt>Azure 管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>或 <bpt id=\"p2\">[</bpt>Office 365 管理门户<ept id=\"p2\">](https://portal.partner.microsoftonline.cn)</ept>中编辑用户"
    },
    {
      "content": "使用 AAD Connect 将用户属性从本地 Active Directory 域同步到 Azure AD",
      "pos": [
        3593,
        3647
      ]
    },
    {
      "content": "使用 Windows PowerShell 编辑用户属性",
      "pos": [
        3652,
        3680
      ]
    },
    {
      "pos": [
        3685,
        3766
      ],
      "content": "通过将用户引导至位于 <bpt id=\"p1\">[</bpt>http://aka.ms/ssprsetup<ept id=\"p1\">](http://aka.ms/ssprsetup)</ept> 的注册门户，使用户能够注册其自己的数据"
    },
    {
      "pos": [
        3771,
        3893
      ],
      "content": "要求用户在登录到位于 <bpt id=\"p1\">[</bpt>http://myapps.microsoft.com<ept id=\"p1\">](http://myapps.microsoft.com)</ept> 的访问面板时注册以进行密码重置，方法是将“登录到访问面板时要求用户注册”SSPR 配置选项设置为“是”。"
    },
    {
      "pos": [
        3895,
        4043
      ],
      "content": "如果你想要详细了解密码重置使用哪些数据，以及此数据的任何格式要求，请参阅<bpt id=\"p1\">[</bpt>密码重置使用哪些数据？<ept id=\"p1\">](/documentation/articles/active-directory-passwords-learn-more#what-data-is-used-by-password-reset)</ept>"
    },
    {
      "content": "通过用户注册门户添加用户联系人数据",
      "pos": [
        4050,
        4067
      ]
    },
    {
      "pos": [
        4072,
        4218
      ],
      "content": "为使用密码重置注册门户，你必须为你所在组织的用户提供指向此页面的链接 (<bpt id=\"p1\">[</bpt>http://aka.ms/ssprsetup<ept id=\"p1\">](http://aka.ms/ssprsetup)</ept>)，或者启用要求用户自动注册的选项。一旦他们单击此链接，系统将要求他们使用组织帐户登录。这样做之后，他们将看到以下页面："
    },
    {
      "content": "在此，用户可提供并验证其移动电话、备用电子邮件地址或安全提问。这是验证移动电话的界面。",
      "pos": [
        4238,
        4281
      ]
    },
    {
      "content": "用户指定此信息后，页面将更新以指示此信息是否有效（下面已将信息模糊处理）。单击“完成”或“取消”按钮后，用户将回到访问面板。",
      "pos": [
        4301,
        4363
      ]
    },
    {
      "pos": [
        4383,
        4451
      ],
      "content": "一旦用户验证这两条信息后，将用其提供的数据更新其个人资料。本例中，已手动指定<bpt id=\"p1\">**</bpt>办公电话<ept id=\"p1\">**</ept>号码，因此用户可将其用作重置密码的联系方式。"
    },
    {
      "pos": [
        4471,
        4555
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-3-reset-your-azure-ad-password-as-a-user\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 3：以用户身份重置 Azure AD 密码"
    },
    {
      "content": "由于你已配置用户重置策略并为用户指定了联系人详细信息，此用户将可以进行自助密码重置。",
      "pos": [
        4556,
        4598
      ]
    },
    {
      "content": "执行自助密码重置",
      "pos": [
        4605,
        4613
      ]
    },
    {
      "pos": [
        4618,
        4750
      ],
      "content": "如果你转到诸如 <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>portal.partner.microsoftonline.cn<ept id=\"p2\">**</ept><ept id=\"p1\">](https://portal.partner.microsoftonline.cn)</ept> 的站点，你将看到如下登录屏幕。单击“无法访问你的帐户?”链接以测试密码重置 UI。"
    },
    {
      "pos": [
        4770,
        4860
      ],
      "content": "单击“无法访问你的帐户?”后，你将转到一个新的页面，此页面将会要求你提供希望为其重置密码的<bpt id=\"p1\">**</bpt>用户 ID<ept id=\"p1\">**</ept>。在此处输入你的测试<bpt id=\"p2\">**</bpt>用户 ID<ept id=\"p2\">**</ept>，输入验证码，然后单击“下一步”。"
    },
    {
      "pos": [
        4880,
        4949
      ],
      "content": "由于在此用例中用户已指定<bpt id=\"p1\">**</bpt>办公电话<ept id=\"p1\">**</ept>、<bpt id=\"p2\">**</bpt>移动电话<ept id=\"p2\">**</ept>和<bpt id=\"p3\">**</bpt>备用电子邮件<ept id=\"p3\">**</ept>，你将看到他（她）可以将所有这三个选项用于通过第一次质询。"
    },
    {
      "pos": [
        4969,
        5067
      ],
      "content": "在这种情况下，请选择首先<bpt id=\"p1\">**</bpt>拨打****办公电话<ept id=\"p1\">**</ept>。请注意，选择基于电话的方式时，将要求用户先<bpt id=\"p2\">**</bpt>验证其电话号码<ept id=\"p2\">**</ept>，然后才能重置密码。这是为了防止恶意个人向你组织中用户的电话号码发送垃圾邮件。"
    },
    {
      "pos": [
        5087,
        5198
      ],
      "content": "一旦用户确认此类电话号码，单击呼叫会导致出现旋转图标并且其电话响起铃声。用户拿起电话后，将播放一条消息，指示<bpt id=\"p1\">**</bpt>用户应按“#”<ept id=\"p1\">**</ept>确认其帐户。按下此键将自动验证此用户是否通过第一次质询，并将使 UI 前进到第二个验证步骤。"
    },
    {
      "pos": [
        5218,
        5373
      ],
      "content": "通过第一次质询后，UI 自动更新，将此质询从用户的选择列表中删除。在这种情况下，由于你首先使用的<bpt id=\"p1\">**</bpt>是办公电话<ept id=\"p1\">**</ept>，因此只有<bpt id=\"p2\">**</bpt>移动电话<ept id=\"p2\">**</ept>和<bpt id=\"p3\">**</bpt>备用电子邮件<ept id=\"p3\">**</ept>是可用作第二个验证步骤的质询的有效选项。单击“向我的备用电子邮件发送电子邮件”选项。完成该操作后，按“电子邮件”将向存档的备用电子邮件发送电子邮件。"
    },
    {
      "content": "下面是用户将看到的电子邮件的示例 - 请注意租户品牌：",
      "pos": [
        5393,
        5420
      ]
    },
    {
      "content": "电子邮件送达后，页面将更新，你将能够在如下所示的输入框中输入电子邮件中找到的验证码。输入适当的代码后，“下一步”按钮亮起，你将能够通过第二个验证步骤。",
      "pos": [
        5440,
        5515
      ]
    },
    {
      "pos": [
        5535,
        5686
      ],
      "content": "满足组织策略的要求后，你可以选择一个新密码。验证密码是否符合 AAD“强”密码要求（参阅 <bpt id=\"p1\">[</bpt>Azure AD 中的密码策略<ept id=\"p1\">](https://msdn.microsoft.com/zh-cn/library/azure/jj943764.aspx)</ept>），显示强度验证器以指示用户输入的密码是否符合该策略。"
    },
    {
      "content": "提供符合组织策略的匹配密码后，你的密码将会重置，你可以立即用新密码登录。",
      "pos": [
        5706,
        5742
      ]
    },
    {
      "pos": [
        5762,
        5842
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"enable-users-to-reset-or-change-their-ad-passwords\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>让用户重置或更改其 AD 密码"
    },
    {
      "content": "本部分将指导你配置密码重置，以便将密码写回到本地 Active Directory。",
      "pos": [
        5844,
        5886
      ]
    },
    {
      "content": "密码写回先决条件",
      "pos": [
        5891,
        5899
      ]
    },
    {
      "content": "步骤 1：下载最新版本的 Azure AD Connect",
      "pos": [
        5930,
        5959
      ]
    },
    {
      "content": "步骤 2：通过 UI 或 powershell 在 Azure AD Connect 中启用密码写回并验证",
      "pos": [
        6021,
        6074
      ]
    },
    {
      "content": "步骤 3：配置防火墙",
      "pos": [
        6134,
        6144
      ]
    },
    {
      "content": "步骤 4：设置适当的权限",
      "pos": [
        6182,
        6194
      ]
    },
    {
      "content": "步骤 5：以用户身份重置 AD 密码并验证",
      "pos": [
        6260,
        6281
      ]
    },
    {
      "pos": [
        6331,
        6375
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"writeback-prerequisites\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>写回先决条件"
    },
    {
      "content": "在能够启用和使用密码写回之前，你必须确保满足以下先决条件：",
      "pos": [
        6376,
        6405
      ]
    },
    {
      "pos": [
        6409,
        6538
      ],
      "content": "必须拥有已启用 Azure AD Premium 的 Azure AD 租户。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure Active Directory 版本<ept id=\"p1\">](/documentation/articles/active-directory-editions)</ept>。"
    },
    {
      "pos": [
        6541,
        6638
      ],
      "content": "已在你的租户中配置和启用了密码重置。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>让用户重置其 Azure AD 密码<ept id=\"p1\">](#enable-users-to-reset-their-azure-ad-passwords)</ept>"
    },
    {
      "pos": [
        6641,
        6788
      ],
      "content": "你拥有至少一个管理员帐户和一个测试用户帐户，还有一个可用于测试此功能的 Azure AD Premium 许可证。有关详细信息，请参阅 <bpt id=\"p1\">[</bpt>Azure Active Directory 版本<ept id=\"p1\">](/documentation/articles/active-directory-editions)</ept>。"
    },
    {
      "pos": [
        6793,
        6880
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>确保用于启用密码写回的管理员帐户是云管理员帐户（在 Azure AD 中创建），而不是联合帐户（在本地 AD 中创建并同步到 Azure AD 中）。"
    },
    {
      "content": "拥有运行 Windows Server 2008、Windows Server 2008 R2、Windows Server 2012 或 Windows Server 2012 R2 并装有最新服务包的单林或多林 AD 本地部署。",
      "pos": [
        6886,
        7002
      ]
    },
    {
      "pos": [
        7007,
        7154
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>如果你运行的是旧版 Windows Server 2008 或 2008 R2，则你仍然可以使用此功能，但在云中实施本地 AD 密码策略之前，需要先<bpt id=\"p1\">[</bpt>下载并安装 KB 2386717<ept id=\"p1\">](https://support.microsoft.com/kb/2386717)</ept>。"
    },
    {
      "pos": [
        7160,
        7278
      ],
      "content": "已安装了 Azure AD 同步工具，并已准备好 AD 环境，可随时同步到云。有关详细信息，请参阅<bpt id=\"p1\">[</bpt>在云中使用本地标识基础结构<ept id=\"p1\">](/documentation/articles/active-directory-aadconnect)</ept>。"
    },
    {
      "pos": [
        7283,
        7360
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>测试密码写回之前，请确保完成完整导入，并在 Azure AD Connect 中从本地 AD 与 Azure AD 执行完全同步。"
    },
    {
      "pos": [
        7364,
        7583
      ],
      "content": "如果使用 Azure AD Sync 或 Azure AD Connect，则需要打开 <bpt id=\"p1\">**</bpt>TCP 443<ept id=\"p1\">**</ept> 出站端口（在某些情况下需要打开 <bpt id=\"p2\">**</bpt>TCP 9350-9354<ept id=\"p2\">**</ept>）。有关详细信息，请参阅<bpt id=\"p3\">[</bpt>步骤 3：配置防火墙<ept id=\"p3\">](#step-3-configure-your-firewall)</ept>。不再支持对此方案使用 DirSync。如果你仍在使用 DirSync，请升级到最新版本的 Azure AD Connect，然后再部署密码写回。"
    },
    {
      "pos": [
        7588,
        7685
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>我们强烈建议使用 Azure AD Sync 或 DirSync 工具的任何用户升级到最新版本的 Azure AD Connect，以确保拥有最佳使用体验和发行的新功能。"
    },
    {
      "pos": [
        7694,
        7792
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-1-download-the-latest-version-of-azure-ad-connect\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 1：下载最新版本的 Azure AD Connect"
    },
    {
      "pos": [
        7793,
        8093
      ],
      "content": "Azure AD Connect 发行版或版本号为 <bpt id=\"p1\">**</bpt>1.0.0419.0911<ept id=\"p1\">**</ept> 或更高的 Azure AD Sync 工具中提供了密码写回功能。Azure AD Connect 发行版或版本号为 <bpt id=\"p2\">**</bpt>1.0.0485.0222<ept id=\"p2\">**</ept> 或更高的 Azure AD Sync 工具中提供了支持自动帐户解锁的密码写回功能。如果你运行的是较旧版本，请在继续操作之前至少升级到此版本。<bpt id=\"p3\">[</bpt>单击此处下载最新版本的 Azure AD Connect<ept id=\"p3\">](/documentation/articles/active-directory-aadconnect#download-azure-ad-connect)</ept>。"
    },
    {
      "content": "查看 Azure AD Sync 的版本",
      "pos": [
        8100,
        8120
      ]
    },
    {
      "pos": [
        8125,
        8177
      ],
      "content": "导航到 <bpt id=\"p1\">**</bpt>%ProgramFiles%\\\\Azure Active Directory Sync<ept id=\"p1\">**</ept>。"
    },
    {
      "pos": [
        8182,
        8212
      ],
      "content": "找到 <bpt id=\"p1\">**</bpt>ConfigWizard.exe<ept id=\"p1\">**</ept> 可执行文件。"
    },
    {
      "content": "右键单击该可执行文件，然后从上下文菜单中选择“属性”选项。",
      "pos": [
        8217,
        8246
      ]
    },
    {
      "content": "单击“详细信息”选项卡。",
      "pos": [
        8251,
        8263
      ]
    },
    {
      "content": "找到“文件版本”字段。",
      "pos": [
        8268,
        8279
      ]
    },
    {
      "pos": [
        8295,
        8466
      ],
      "content": "如果此版本号大于或等于 <bpt id=\"p1\">**</bpt>1.0.0419.0911<ept id=\"p1\">**</ept>，或者你要安装 Azure AD Connect，则你可以跳至<bpt id=\"p2\">[</bpt>步骤 2：通过 UI 或 powershell 在 Azure AD Connect 中启用密码写回并验证<ept id=\"p2\">](#step-2-enable-password-writeback-in-azure-ad-connect)</ept>。"
    },
    {
      "pos": [
        8470,
        8772
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>如果是首次安装 Azure AD Connect 工具，建议遵循一些最佳实践，为目录同步准备好环境。在安装 Azure AD Connect 工具之前，必须在 <bpt id=\"p1\">[</bpt>Office 365 管理门户<ept id=\"p1\">](https://portal.partner.microsoftonline.cn)</ept>或 <bpt id=\"p2\">[</bpt>Azure 管理门户<ept id=\"p2\">](https://manage.windowsazure.cn)</ept>中激活目录同步。有关详细信息，请参阅<bpt id=\"p3\">[</bpt>管理 Azure AD Connect<ept id=\"p3\">](/documentation/articles/active-directory-aadconnect-whats-next)</ept>。"
    },
    {
      "pos": [
        8779,
        8877
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-2-enable-password-writeback-in-azure-ad-connect\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 2：在 Azure AD Connect 中启用密码写回"
    },
    {
      "content": "现在你已下载 Azure AD Connect 工具，为启用密码写回做好了准备。可通过两种方式之一启用密码写回。可以在 Azure AD Connect 设置向导的可选功能屏幕中启用密码写回，也可以通过 Windows PowerShell 启用。",
      "pos": [
        8878,
        9002
      ]
    },
    {
      "content": "在配置向导中启用密码写回",
      "pos": [
        9009,
        9021
      ]
    },
    {
      "pos": [
        9026,
        9071
      ],
      "content": "在你的<bpt id=\"p1\">**</bpt>目录同步计算机<ept id=\"p1\">**</ept>上，打开 <bpt id=\"p2\">**</bpt>Azure AD Connect<ept id=\"p2\">**</ept> 配置向导。"
    },
    {
      "pos": [
        9076,
        9100
      ],
      "content": "单击各个步骤，直到出现<bpt id=\"p1\">**</bpt>可选功能<ept id=\"p1\">**</ept>配置屏幕。"
    },
    {
      "content": "选中“密码写回”选项。",
      "pos": [
        9105,
        9116
      ]
    },
    {
      "content": "完成向导，最后一页将汇总更改并包括密码写回配置更改。",
      "pos": [
        9136,
        9162
      ]
    },
    {
      "pos": [
        9166,
        9406
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>你随时可以禁用密码写回，方法是重新运行此向导并取消选择该功能，或者在 <bpt id=\"p1\">[</bpt>Azure 管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>上你目录的“配置”选项卡的“用户密码重置策略”部分中，将“密码写回到本地目录”设置设为“否”。有关自定义密码重置体验的详细信息，请查看<bpt id=\"p2\">[</bpt>自定义：Azure AD 密码管理<ept id=\"p2\">](/documentation/articles/active-directory-passwords-customize)</ept>。"
    },
    {
      "content": "使用 Windows PowerShell 启用密码写回",
      "pos": [
        9413,
        9441
      ]
    },
    {
      "pos": [
        9446,
        9500
      ],
      "content": "在你的<bpt id=\"p1\">**</bpt>目录同步计算机<ept id=\"p1\">**</ept>上，打开一个新的<bpt id=\"p2\">**</bpt>权限提升的 Windows PowerShell 窗口<ept id=\"p2\">**</ept>。"
    },
    {
      "pos": [
        9505,
        9578
      ],
      "content": "如果尚未加载该模块，请键入 <ph id=\"ph1\">`Import-Module ADSync`</ph> 命令以将 Azure AD Connect cmdlet 载入当前会话。"
    },
    {
      "pos": [
        9583,
        9661
      ],
      "content": "运行 <ph id=\"ph1\">`Get-ADSyncConnector`</ph> cmdlet 并将结果存储在 <ph id=\"ph2\">`$aadConnectorName`</ph> 中，获取系统中 AAD 连接器的列表"
    },
    {
      "pos": [
        9666,
        9763
      ],
      "content": "运行以下 cmdlet 获得当前连接器的当前写回状态：<ph id=\"ph1\">`Get-ADSyncAADPasswordResetConfiguration –Connector $aadConnectorName`</ph>"
    },
    {
      "pos": [
        9768,
        9871
      ],
      "content": "运行以下 cmdlet 启用密码写回：<ph id=\"ph1\">`Set-ADSyncAADPasswordResetConfiguration –Connector $aadConnectorName –Enable $true`</ph>"
    },
    {
      "pos": [
        9875,
        10166
      ],
      "content": "[AZURE.NOTE]如果系统提示你输入凭据，请确保你为 AzureADCredential 指定的管理员帐户是**云管理员帐户（在 Azure AD 中创建）**，而不是联合帐户（在本地 AD 中创建并同步到 Azure AD 中）。\n[AZURE.NOTE]你可以通过 PowerShell 禁用密码写回，方法是根据上述相同说明重复操作（不过要在步骤中传递 `$false`），或者或者在 [Azure 管理门户](https://manage.windowsazure.cn)上你目录的“配置”选项卡的“用户密码重置策略”部分中，将“密码写回到本地目录”设置设为“否”。",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>如果系统提示你输入凭据，请确保你为 AzureADCredential 指定的管理员帐户是<bpt id=\"p1\">**</bpt>云管理员帐户（在 Azure AD 中创建）<ept id=\"p1\">**</ept>，而不是联合帐户（在本地 AD 中创建并同步到 Azure AD 中）。",
          "pos": [
            0,
            119
          ]
        },
        {
          "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>你可以通过 PowerShell 禁用密码写回，方法是根据上述相同说明重复操作（不过要在步骤中传递 <ph id=\"ph2\">`$false`</ph>），或者或者在 <bpt id=\"p1\">[</bpt>Azure 管理门户<ept id=\"p1\">](https://manage.windowsazure.cn)</ept>上你目录的“配置”选项卡的“用户密码重置策略”部分中，将“密码写回到本地目录”设置设为“否”。",
          "pos": [
            120,
            289
          ]
        }
      ]
    },
    {
      "content": "验证配置是否成功",
      "pos": [
        10173,
        10181
      ]
    },
    {
      "content": "配置成功之后，你将在 Windows PowerShell 窗口中看到消息“密码重置写回已启用”，或者在配置 UI 中看到成功消息。",
      "pos": [
        10182,
        10248
      ]
    },
    {
      "pos": [
        10250,
        10357
      ],
      "content": "你可以打开“事件查看器”，导航到应用程序事件日志，然后从源 <bpt id=\"p1\">**</bpt>PasswordResetService<ept id=\"p1\">**</ept> 查找事件 <bpt id=\"p2\">**</bpt>31005 - OnboardingEventSuccess<ept id=\"p2\">**</ept>，以验证服务是否正确安装。"
    },
    {
      "pos": [
        10375,
        10430
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-3-configure-your-firewall\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 3：配置防火墙"
    },
    {
      "content": "在 Azure AD Connect 工具中启用密码写回之后，需确保服务可连接到云。",
      "pos": [
        10431,
        10473
      ]
    },
    {
      "content": "安装完成后，如果要阻止环境中的未知出站连接，还需要向防火墙添加以下规则。确保进行这些更改后重新启动你的 AAD Connect 计算机：",
      "pos": [
        10479,
        10547
      ]
    },
    {
      "content": "允许通过端口 443 的出站连接 TCP",
      "pos": [
        10553,
        10573
      ]
    },
    {
      "content": "允许到 https://ssprsbprodncu-sb.accesscontrol.chinacloudapi.cn/ 的出站连接",
      "pos": [
        10579,
        10645
      ]
    },
    {
      "content": "当使用代理或遇到一般连接问题时，允许通过端口 9350-9534 TCP 的出站连接",
      "pos": [
        10652,
        10694
      ]
    },
    {
      "pos": [
        10700,
        10784
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"overview-of-password-management-reports\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 4：设置适当的 Active Directory 权限"
    },
    {
      "pos": [
        10785,
        10942
      ],
      "content": "对于包含其密码将要重置的用户的每个林，如果 X 是（初始配置期间）在配置向导中为该林指定的帐户，则必须为 X 授予对 <ph id=\"ph1\">`lockoutTime`</ph> 的“重置密码”、“更改密码”和“写入权限”，对 <ph id=\"ph2\">`pwdLastSet`</ph> 的“写入权限”，以及对该林中每个域的根对象的扩展权限。应当将权限标记为“由所有用户对象继承”。"
    },
    {
      "content": "如果你不确定上面指的是哪个帐户，请打开 Azure Active Directory Connect 配置 UI，然后单击“查看解决方案”选项。在下面的屏幕截图中，需要将权限添加到的帐户标有红色下划线。",
      "pos": [
        10944,
        11045
      ]
    },
    {
      "content": "请确保为系统中每个林内的每个域设置此权限，否则密码写回功能将无法正常工作。",
      "pos": [
        11067,
        11104
      ]
    },
    {
      "pos": [
        11127,
        11259
      ],
      "content": "设置这些权限将允许每个林的 MA 服务帐户代表该林中的用户帐户管理密码。如果你忘记分配这些权限，即使写回看上去配置正确，用户在尝试从云中管理本地密码时也会遇到错误。下面是如何使用 <bpt id=\"p1\">**</bpt>Active Directory 用户和计算机<ept id=\"p1\">**</ept>管理单元实现此目的的详细步骤："
    },
    {
      "pos": [
        11262,
        11298
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>将这些权限复制到目录中的所有对象可能需要一小时。"
    },
    {
      "pos": [
        11305,
        11390
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-4-set-up-the-appropriate-active-directory-permissions\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>设置正确的权限以执行写回"
    },
    {
      "content": "使用具有适当域管理权限的帐户打开“Active Directory 用户和计算机”。",
      "pos": [
        11396,
        11438
      ]
    },
    {
      "content": "在“视图菜单”选项中，确保打开“高级功能”。",
      "pos": [
        11443,
        11465
      ]
    },
    {
      "content": "在左面板中，右键单击表示根级域的对象。",
      "pos": [
        11470,
        11489
      ]
    },
    {
      "content": "单击“安全性”选项卡。",
      "pos": [
        11494,
        11505
      ]
    },
    {
      "content": "然后单击“高级”。",
      "pos": [
        11510,
        11519
      ]
    },
    {
      "content": "在“权限”选项卡上，单击“添加”。",
      "pos": [
        11539,
        11556
      ]
    },
    {
      "content": "选择要对其授予权限的帐户（该帐户与为此林设置同步时指定的帐户相同）。",
      "pos": [
        11576,
        11610
      ]
    },
    {
      "content": "在顶部的下拉列表中，选择“下级用户对象”。",
      "pos": [
        11615,
        11636
      ]
    },
    {
      "pos": [
        11641,
        11722
      ],
      "content": "在出现的“权限条目”中，选中针对 <ph id=\"ph1\">`lockoutTime`</ph> 的“重置密码”、“更改密码”和“写入权限”框，以及针对 <ph id=\"ph2\">`pwdLastSet`</ph> 的“写入权限”框。"
    },
    {
      "pos": [
        11728,
        11762
      ],
      "content": "![][026]\n![][027]\n![][028]",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": []
    },
    {
      "content": "然后，单击所有打开对话框中的“应用/确定”。",
      "pos": [
        11768,
        11790
      ]
    },
    {
      "pos": [
        11796,
        11868
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"step-5-reset-your-ad-password-as-a-user\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>步骤 5：以用户身份重置 AD 密码"
    },
    {
      "content": "现在密码写回功能已启用，你可以通过重置其帐户已同步到云租户的用户的密码，测试该功能是否能够正常工作。",
      "pos": [
        11869,
        11919
      ]
    },
    {
      "content": "验证密码写回是否正常工作",
      "pos": [
        11927,
        11939
      ]
    },
    {
      "pos": [
        11944,
        12067
      ],
      "content": "导航到 <bpt id=\"p1\">[</bpt>https://passwordreset.microsoftonline.com<ept id=\"p1\">](https://passwordreset.microsoftonline.com)</ept> 或转到任何组织 ID 登录屏幕并单击“无法访问你的帐户?”链接。"
    },
    {
      "content": "你现在应该看到一个新页面，它请求提供你要为其重置密码的用户 ID。输入测试用户 ID，并继续执行密码重置流程。",
      "pos": [
        12087,
        12142
      ]
    },
    {
      "content": "重置密码后，你将看到与此类似的屏幕。这意味着你已成功重置了本地和/或云目录中的密码。",
      "pos": [
        12147,
        12189
      ]
    },
    {
      "pos": [
        12209,
        12341
      ],
      "content": "若要验证操作是否成功或要诊断任何错误，请转到<bpt id=\"p1\">**</bpt>目录同步计算机<ept id=\"p1\">**</ept>，打开“事件查看器”，导航到<bpt id=\"p2\">**</bpt>应用程序事件日志<ept id=\"p2\">**</ept>，并从测试用户的源 <bpt id=\"p3\">**</bpt>PasswordResetService<ept id=\"p3\">**</ept> 查找事件 <bpt id=\"p4\">**</bpt>31002 - PasswordResetSuccess<ept id=\"p4\">**</ept>。"
    },
    {
      "content": "密码重置文档的链接",
      "pos": [
        12380,
        12389
      ]
    },
    {
      "content": "以下是所有 Azure AD 密码重置文档页面的链接：",
      "pos": [
        12390,
        12417
      ]
    },
    {
      "pos": [
        12421,
        12536
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>重置自己的密码<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-update-your-own-password)</ept> - 了解如何以系统用户的身份重置或更改自己的密码"
    },
    {
      "pos": [
        12539,
        12632
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>工作原理<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-how-it-works)</ept> - 了解六个不同的服务组件及其功能"
    },
    {
      "pos": [
        12635,
        12731
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>自定义<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-customize)</ept> - 了解如何根据组织的需求自定义服务的外观和行为"
    },
    {
      "pos": [
        12734,
        12832
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>最佳实践<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-best-practices)</ept> - 了解如何快速部署且有效管理组织的密码"
    },
    {
      "pos": [
        12835,
        12922
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>深入分析<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-get-insights)</ept> - 了解集成式报告功能"
    },
    {
      "pos": [
        12925,
        13003
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>常见问题<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-faq)</ept> - 获取常见问题的解答"
    },
    {
      "pos": [
        13006,
        13097
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>故障排除<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-troubleshoot)</ept> - 了解如何快速排查服务的问题"
    },
    {
      "pos": [
        13100,
        13191
      ],
      "content": "<bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>了解更多<ept id=\"p2\">**</ept><ept id=\"p1\">](/documentation/articles/active-directory-passwords-learn-more)</ept> - 深入探索服务工作原理的技术细节"
    }
  ],
  "content": "<properties \n    pageTitle=\"入门：Azure AD 密码管理 | Azure\" \n    description=\"使用户能够重置其自己的密码和了解密码重置先决条件，并启用密码写回来管理 Active Directory 中的本地密码。\" \n    services=\"active-directory\" \n    documentationCenter=\"\" \n    authors=\"asteen\" \n    manager=\"kbrint\" \n    editor=\"billmath\"/>\n\n<tags \n    ms.service=\"active-directory\"  \n    ms.date=\"11/16/2015\" \n    wacn.date=\"01/29/2016\"/>\n\n# 密码管理入门\n只要完成几个简单的步骤，就能让你的用户管理他们自己的云 Azure Active Directory 密码或本地 Active Directory 密码。在确保符合几个简单的先决条件之后，你将在不知不觉中为整个组织启用密码更改和重置。本文将引导你完成以下操作思路：\n\n* [**如何让用户重置其云 Azure Active Directory 密码**](#enable-users-to-reset-their-azure-ad-passwords)\n - [自助密码重置先决条件](#prerequisites)\n - [步骤 1：配置密码重置策略](#step-1-configure-password-reset-policy)\n - [步骤 2：为测试用户添加联系人数据](#step-2-add-contact-data-for-your-test-user)\n - [步骤 3：以用户身份重置密码](#step-3-reset-your-azure-ad-password-as-a-user)\n* [**如何让用户重置或更改其本地 Active Directory 密码**](#enable-users-to-reset-or-change-their-ad-passwords)\n - [密码写回先决条件](#writeback-prerequisites)\n - [步骤 1：下载最新版本的 Azure AD Connect](#step-1-download-the-latest-version-of-azure-ad-connect)\n - [步骤 2：通过 UI 或 powershell 在 Azure AD Connect 中启用密码写回并验证](#step-2-enable-password-writeback-in-azure-ad-connect)\n - [步骤 3：配置防火墙](#step-3-configure-your-firewall)\n - [步骤 4：设置适当的权限](#step-4-set-up-the-appropriate-active-directory-permissions)\n - [步骤 5：以用户身份重置 AD 密码并验证](#step-5-reset-your-ad-password-as-a-user)\n\n## <a name=\"enable-users-to-reset-their-azure-ad-passwords\"></a>让用户重置其 Azure AD 密码\n本部分详细介绍如何为 AAD 云目录启用自助密码重置、注册用户进行自助密码重置，以及最终以用户身份执行测试性的自助密码重置。\n\n- [自助密码重置先决条件](#prerequisites)\n- [步骤 1：配置密码重置策略](#step-1-configure-password-reset-policy)\n- [步骤 2：为测试用户添加联系人数据](#step-2-add-contact-data-for-your-test-user)\n- [步骤 3：以用户身份重置密码](#step-3-reset-your-azure-ad-password-as-a-user)\n\n\n### <a name=\"prerequisites\"></a>先决条件\n你必须先完成以下先决条件才能启用和使用自助密码重置：\n\n- 创建 AAD 租户。 \n- 获取 Azure 订阅。有关详细信息，请参阅[什么是 Azure AD 租户？](/documentation/articles/active-directory-administer#what-is-an-azure-ad-tenant)\n- 将你的 AAD 租户与 Azure 订阅相关联。有关详细信息，请参阅 [Azure 订阅与 Azure AD 的关联方式](https://msdn.microsoft.com/zh-cn/library/azure/dn629581.aspx)。\n- 升级到 Azure AD Premium 或 Basic。有关详细信息，请参阅 [Azure Active Directory 版本](/home/features/identity/#price)。\n\n  >[AZURE.NOTE]若要启用自助密码重置，必须升级到 Azure AD Premium 或 Azure AD Basic。有关详细信息，请参阅“Azure Active Directory 版本”。这些信息包括以下任务的详细说明：如何注册 Azure AD Premium 或 Basic、如何激活你的许可计划并激活 Azure AD 访问权限，以及如何为管理员和用户帐户分配访问权限。\n  \n- 在 AAD 目录中创建至少一个管理员帐户和一个用户帐户。\n- 为所创建的管理员和用户帐户分配 AAD Premium 或 Basic 许可证。\n\n### <a name=\"step-1-configure-password-reset-policy\"></a>步骤 1：配置密码重置策略\n若要配置用户密码重置策略，请完成以下步骤：\n \n1.  打开你选择的浏览器并转到 [Azure 管理门户](https://manage.windowsazure.cn)。\n2.  在 [Azure 管理门户](https://manage.windowsazure.cn)的左侧导航栏上，找到 **Active Directory 扩展**。\n\n    ![][001]\n\n3. 在“目录”选项卡上，单击你想在其中配置用户密码重置策略的目录，例如 Wingtip Toys。\n\n    ![][002]\n\n4.  单击“配置”选项卡。\n\n    ![][003]\n\n5.  在“配置”选项卡上，向下滚动到“用户密码重置策略”部分。你将在此为给定目录配置用户密码重置策略的各个方面。\n\n    >[AZURE.NOTE]此**策略仅适用于你组织中的最终用户，而不是管理员**。出于安全原因，Microsoft 控制管理员的密码重置策略。如果你不查看本部分，请确保你已注册 Azure Active Directory Premium 和 Basic，并为要配置此功能的管理员帐户**分配了许可证**。\n\n    ![][004]\n\n6.  若要配置用户密码重置策略，请将“可进行密码重置的用户”开关滑动到“是”设置。这将显示更多控件，通过这些控件你可以配置此功能在目录中的工作方式。根据需要随意自定义密码重置。如果你想详细了解每个密码重置策略控件的作用，请参阅[自定义：Azure AD 密码管理](/documentation/articles/active-directory-passwords-customize)。\n\n    ![][005]\n\n7.  根据租户需求配置用户密码重置策略后，请单击屏幕底部的“保存”按钮。\n\n  >[AZURE.NOTE]建议使用两个质询用户密码重置策略，以便你能够了解该功能如何在最复杂的情况下工作。\n\n  ![][006]\n\n### <a name=\"step-2-add-contact-data-for-your-test-user\"></a>步骤 2：为测试用户添加联系人数据\n关于如何为你所在组织中的用户指定用于密码重置的数据，你有几种选择。\n\n-   在 [Azure 管理门户](https://manage.windowsazure.cn)或 [Office 365 管理门户](https://portal.partner.microsoftonline.cn)中编辑用户\n-   使用 AAD Connect 将用户属性从本地 Active Directory 域同步到 Azure AD\n-   使用 Windows PowerShell 编辑用户属性\n-   通过将用户引导至位于 [http://aka.ms/ssprsetup](http://aka.ms/ssprsetup) 的注册门户，使用户能够注册其自己的数据\n-   要求用户在登录到位于 [http://myapps.microsoft.com](http://myapps.microsoft.com) 的访问面板时注册以进行密码重置，方法是将“登录到访问面板时要求用户注册”SSPR 配置选项设置为“是”。\n\n如果你想要详细了解密码重置使用哪些数据，以及此数据的任何格式要求，请参阅[密码重置使用哪些数据？](/documentation/articles/active-directory-passwords-learn-more#what-data-is-used-by-password-reset)\n\n#### 通过用户注册门户添加用户联系人数据\n1.  为使用密码重置注册门户，你必须为你所在组织的用户提供指向此页面的链接 ([http://aka.ms/ssprsetup](http://aka.ms/ssprsetup))，或者启用要求用户自动注册的选项。一旦他们单击此链接，系统将要求他们使用组织帐户登录。这样做之后，他们将看到以下页面：\n\n    ![][007]\n\n2.  在此，用户可提供并验证其移动电话、备用电子邮件地址或安全提问。这是验证移动电话的界面。\n\n    ![][008]\n\n3.  用户指定此信息后，页面将更新以指示此信息是否有效（下面已将信息模糊处理）。单击“完成”或“取消”按钮后，用户将回到访问面板。\n\n    ![][009]\n\n4.  一旦用户验证这两条信息后，将用其提供的数据更新其个人资料。本例中，已手动指定**办公电话**号码，因此用户可将其用作重置密码的联系方式。\n\n    ![][010]\n\n### <a name=\"step-3-reset-your-azure-ad-password-as-a-user\"></a>步骤 3：以用户身份重置 Azure AD 密码\n由于你已配置用户重置策略并为用户指定了联系人详细信息，此用户将可以进行自助密码重置。\n\n#### 执行自助密码重置\n1.  如果你转到诸如 [**portal.partner.microsoftonline.cn**](https://portal.partner.microsoftonline.cn) 的站点，你将看到如下登录屏幕。单击“无法访问你的帐户?”链接以测试密码重置 UI。\n\n    ![][011]\n\n2.  单击“无法访问你的帐户?”后，你将转到一个新的页面，此页面将会要求你提供希望为其重置密码的**用户 ID**。在此处输入你的测试**用户 ID**，输入验证码，然后单击“下一步”。\n\n    ![][012]\n\n3.  由于在此用例中用户已指定**办公电话**、**移动电话**和**备用电子邮件**，你将看到他（她）可以将所有这三个选项用于通过第一次质询。\n\n    ![][013]\n\n4.  在这种情况下，请选择首先**拨打****办公电话**。请注意，选择基于电话的方式时，将要求用户先**验证其电话号码**，然后才能重置密码。这是为了防止恶意个人向你组织中用户的电话号码发送垃圾邮件。\n\n    ![][014]\n\n5.  一旦用户确认此类电话号码，单击呼叫会导致出现旋转图标并且其电话响起铃声。用户拿起电话后，将播放一条消息，指示**用户应按“#”**确认其帐户。按下此键将自动验证此用户是否通过第一次质询，并将使 UI 前进到第二个验证步骤。\n\n    ![][015]\n\n6.  通过第一次质询后，UI 自动更新，将此质询从用户的选择列表中删除。在这种情况下，由于你首先使用的**是办公电话**，因此只有**移动电话**和**备用电子邮件**是可用作第二个验证步骤的质询的有效选项。单击“向我的备用电子邮件发送电子邮件”选项。完成该操作后，按“电子邮件”将向存档的备用电子邮件发送电子邮件。\n\n    ![][016]\n\n7.  下面是用户将看到的电子邮件的示例 - 请注意租户品牌：\n\n    ![][017]\n\n8.  电子邮件送达后，页面将更新，你将能够在如下所示的输入框中输入电子邮件中找到的验证码。输入适当的代码后，“下一步”按钮亮起，你将能够通过第二个验证步骤。\n\n    ![][018]\n\n9.  满足组织策略的要求后，你可以选择一个新密码。验证密码是否符合 AAD“强”密码要求（参阅 [Azure AD 中的密码策略](https://msdn.microsoft.com/zh-cn/library/azure/jj943764.aspx)），显示强度验证器以指示用户输入的密码是否符合该策略。\n\n    ![][019]\n\n10. 提供符合组织策略的匹配密码后，你的密码将会重置，你可以立即用新密码登录。\n\n    ![][020]\n\n\n## <a name=\"enable-users-to-reset-or-change-their-ad-passwords\"></a>让用户重置或更改其 AD 密码\n\n本部分将指导你配置密码重置，以便将密码写回到本地 Active Directory。\n\n- [密码写回先决条件](#writeback-prerequisites)\n- [步骤 1：下载最新版本的 Azure AD Connect](#step-1-download-the-latest-version-of-azure-ad-connect)\n- [步骤 2：通过 UI 或 powershell 在 Azure AD Connect 中启用密码写回并验证](#step-2-enable-password-writeback-in-azure-ad-connect)\n- [步骤 3：配置防火墙](#step-3-configure-your-firewall)\n- [步骤 4：设置适当的权限](#step-4-set-up-the-appropriate-active-directory-permissions)\n- [步骤 5：以用户身份重置 AD 密码并验证](#step-5-reset-your-ad-password-as-a-user)\n\n\n### <a name=\"writeback-prerequisites\"></a>写回先决条件\n在能够启用和使用密码写回之前，你必须确保满足以下先决条件：\n\n- 必须拥有已启用 Azure AD Premium 的 Azure AD 租户。有关详细信息，请参阅 [Azure Active Directory 版本](/documentation/articles/active-directory-editions)。\n- 已在你的租户中配置和启用了密码重置。有关详细信息，请参阅[让用户重置其 Azure AD 密码](#enable-users-to-reset-their-azure-ad-passwords)\n- 你拥有至少一个管理员帐户和一个测试用户帐户，还有一个可用于测试此功能的 Azure AD Premium 许可证。有关详细信息，请参阅 [Azure Active Directory 版本](/documentation/articles/active-directory-editions)。\n\n  >[AZURE.NOTE]确保用于启用密码写回的管理员帐户是云管理员帐户（在 Azure AD 中创建），而不是联合帐户（在本地 AD 中创建并同步到 Azure AD 中）。\n  \n- 拥有运行 Windows Server 2008、Windows Server 2008 R2、Windows Server 2012 或 Windows Server 2012 R2 并装有最新服务包的单林或多林 AD 本地部署。\n\n  >[AZURE.NOTE]如果你运行的是旧版 Windows Server 2008 或 2008 R2，则你仍然可以使用此功能，但在云中实施本地 AD 密码策略之前，需要先[下载并安装 KB 2386717](https://support.microsoft.com/kb/2386717)。\n  \n- 已安装了 Azure AD 同步工具，并已准备好 AD 环境，可随时同步到云。有关详细信息，请参阅[在云中使用本地标识基础结构](/documentation/articles/active-directory-aadconnect)。\n\n  >[AZURE.NOTE]测试密码写回之前，请确保完成完整导入，并在 Azure AD Connect 中从本地 AD 与 Azure AD 执行完全同步。\n\n- 如果使用 Azure AD Sync 或 Azure AD Connect，则需要打开 **TCP 443** 出站端口（在某些情况下需要打开 **TCP 9350-9354**）。有关详细信息，请参阅[步骤 3：配置防火墙](#step-3-configure-your-firewall)。不再支持对此方案使用 DirSync。如果你仍在使用 DirSync，请升级到最新版本的 Azure AD Connect，然后再部署密码写回。\n\n  >[AZURE.NOTE]我们强烈建议使用 Azure AD Sync 或 DirSync 工具的任何用户升级到最新版本的 Azure AD Connect，以确保拥有最佳使用体验和发行的新功能。\n  \n\n### <a name=\"step-1-download-the-latest-version-of-azure-ad-connect\"></a>步骤 1：下载最新版本的 Azure AD Connect\nAzure AD Connect 发行版或版本号为 **1.0.0419.0911** 或更高的 Azure AD Sync 工具中提供了密码写回功能。Azure AD Connect 发行版或版本号为 **1.0.0485.0222** 或更高的 Azure AD Sync 工具中提供了支持自动帐户解锁的密码写回功能。如果你运行的是较旧版本，请在继续操作之前至少升级到此版本。[单击此处下载最新版本的 Azure AD Connect](/documentation/articles/active-directory-aadconnect#download-azure-ad-connect)。\n\n#### 查看 Azure AD Sync 的版本\n1.  导航到 **%ProgramFiles%\\\\Azure Active Directory Sync**。\n2.  找到 **ConfigWizard.exe** 可执行文件。\n3.  右键单击该可执行文件，然后从上下文菜单中选择“属性”选项。\n4.  单击“详细信息”选项卡。\n5.  找到“文件版本”字段。\n\n    ![][021]\n\n如果此版本号大于或等于 **1.0.0419.0911**，或者你要安装 Azure AD Connect，则你可以跳至[步骤 2：通过 UI 或 powershell 在 Azure AD Connect 中启用密码写回并验证](#step-2-enable-password-writeback-in-azure-ad-connect)。\n\n >[AZURE.NOTE]如果是首次安装 Azure AD Connect 工具，建议遵循一些最佳实践，为目录同步准备好环境。在安装 Azure AD Connect 工具之前，必须在 [Office 365 管理门户](https://portal.partner.microsoftonline.cn)或 [Azure 管理门户](https://manage.windowsazure.cn)中激活目录同步。有关详细信息，请参阅[管理 Azure AD Connect](/documentation/articles/active-directory-aadconnect-whats-next)。\n\n\n### <a name=\"step-2-enable-password-writeback-in-azure-ad-connect\"></a>步骤 2：在 Azure AD Connect 中启用密码写回\n现在你已下载 Azure AD Connect 工具，为启用密码写回做好了准备。可通过两种方式之一启用密码写回。可以在 Azure AD Connect 设置向导的可选功能屏幕中启用密码写回，也可以通过 Windows PowerShell 启用。\n\n#### 在配置向导中启用密码写回\n1.  在你的**目录同步计算机**上，打开 **Azure AD Connect** 配置向导。\n2.  单击各个步骤，直到出现**可选功能**配置屏幕。\n3.  选中“密码写回”选项。\n\n    ![][022]\n\n4.  完成向导，最后一页将汇总更改并包括密码写回配置更改。\n\n> [AZURE.NOTE]你随时可以禁用密码写回，方法是重新运行此向导并取消选择该功能，或者在 [Azure 管理门户](https://manage.windowsazure.cn)上你目录的“配置”选项卡的“用户密码重置策略”部分中，将“密码写回到本地目录”设置设为“否”。有关自定义密码重置体验的详细信息，请查看[自定义：Azure AD 密码管理](/documentation/articles/active-directory-passwords-customize)。\n\n#### 使用 Windows PowerShell 启用密码写回\n1.  在你的**目录同步计算机**上，打开一个新的**权限提升的 Windows PowerShell 窗口**。\n2.  如果尚未加载该模块，请键入 `Import-Module ADSync` 命令以将 Azure AD Connect cmdlet 载入当前会话。\n3.  运行 `Get-ADSyncConnector` cmdlet 并将结果存储在 `$aadConnectorName` 中，获取系统中 AAD 连接器的列表\n4.  运行以下 cmdlet 获得当前连接器的当前写回状态：`Get-ADSyncAADPasswordResetConfiguration –Connector $aadConnectorName`\n5.  运行以下 cmdlet 启用密码写回：`Set-ADSyncAADPasswordResetConfiguration –Connector $aadConnectorName –Enable $true`\n\n> [AZURE.NOTE]如果系统提示你输入凭据，请确保你为 AzureADCredential 指定的管理员帐户是**云管理员帐户（在 Azure AD 中创建）**，而不是联合帐户（在本地 AD 中创建并同步到 Azure AD 中）。\n> [AZURE.NOTE]你可以通过 PowerShell 禁用密码写回，方法是根据上述相同说明重复操作（不过要在步骤中传递 `$false`），或者或者在 [Azure 管理门户](https://manage.windowsazure.cn)上你目录的“配置”选项卡的“用户密码重置策略”部分中，将“密码写回到本地目录”设置设为“否”。\n\n#### 验证配置是否成功\n配置成功之后，你将在 Windows PowerShell 窗口中看到消息“密码重置写回已启用”，或者在配置 UI 中看到成功消息。\n\n你可以打开“事件查看器”，导航到应用程序事件日志，然后从源 **PasswordResetService** 查找事件 **31005 - OnboardingEventSuccess**，以验证服务是否正确安装。\n\n  ![][023]\n\n### <a name=\"step-3-configure-your-firewall\"></a>步骤 3：配置防火墙\n在 Azure AD Connect 工具中启用密码写回之后，需确保服务可连接到云。\n\n1.  安装完成后，如果要阻止环境中的未知出站连接，还需要向防火墙添加以下规则。确保进行这些更改后重新启动你的 AAD Connect 计算机：\n   - 允许通过端口 443 的出站连接 TCP\n   - 允许到 https://ssprsbprodncu-sb.accesscontrol.chinacloudapi.cn/ 的出站连接 \n   - 当使用代理或遇到一般连接问题时，允许通过端口 9350-9534 TCP 的出站连接\n\n### <a name=\"overview-of-password-management-reports\"></a>步骤 4：设置适当的 Active Directory 权限\n对于包含其密码将要重置的用户的每个林，如果 X 是（初始配置期间）在配置向导中为该林指定的帐户，则必须为 X 授予对 `lockoutTime` 的“重置密码”、“更改密码”和“写入权限”，对 `pwdLastSet` 的“写入权限”，以及对该林中每个域的根对象的扩展权限。应当将权限标记为“由所有用户对象继承”。\n\n如果你不确定上面指的是哪个帐户，请打开 Azure Active Directory Connect 配置 UI，然后单击“查看解决方案”选项。在下面的屏幕截图中，需要将权限添加到的帐户标有红色下划线。\n\n**<font color=\"red\">请确保为系统中每个林内的每个域设置此权限，否则密码写回功能将无法正常工作。</font>**\n\n  ![][032]\n\n设置这些权限将允许每个林的 MA 服务帐户代表该林中的用户帐户管理密码。如果你忘记分配这些权限，即使写回看上去配置正确，用户在尝试从云中管理本地密码时也会遇到错误。下面是如何使用 **Active Directory 用户和计算机**管理单元实现此目的的详细步骤：\n\n>[AZURE.NOTE]将这些权限复制到目录中的所有对象可能需要一小时。\n\n#### <a name=\"step-4-set-up-the-appropriate-active-directory-permissions\"></a>设置正确的权限以执行写回\n\n1.  使用具有适当域管理权限的帐户打开“Active Directory 用户和计算机”。\n2.  在“视图菜单”选项中，确保打开“高级功能”。\n3.  在左面板中，右键单击表示根级域的对象。\n4.  单击“安全性”选项卡。\n5.  然后单击“高级”。\n\n    ![][024]\n\n6.  在“权限”选项卡上，单击“添加”。\n\n    ![][025]\n\n7.  选择要对其授予权限的帐户（该帐户与为此林设置同步时指定的帐户相同）。\n8.  在顶部的下拉列表中，选择“下级用户对象”。\n9.  在出现的“权限条目”中，选中针对 `lockoutTime` 的“重置密码”、“更改密码”和“写入权限”框，以及针对 `pwdLastSet` 的“写入权限”框。\n\n    ![][026]\n    ![][027]\n    ![][028]\n\n10. 然后，单击所有打开对话框中的“应用/确定”。\n\n### <a name=\"step-5-reset-your-ad-password-as-a-user\"></a>步骤 5：以用户身份重置 AD 密码\n现在密码写回功能已启用，你可以通过重置其帐户已同步到云租户的用户的密码，测试该功能是否能够正常工作。\n \n#### 验证密码写回是否正常工作\n1.  导航到 [https://passwordreset.microsoftonline.com](https://passwordreset.microsoftonline.com) 或转到任何组织 ID 登录屏幕并单击“无法访问你的帐户?”链接。\n\n    ![][029]\n\n2.  你现在应该看到一个新页面，它请求提供你要为其重置密码的用户 ID。输入测试用户 ID，并继续执行密码重置流程。\n3.  重置密码后，你将看到与此类似的屏幕。这意味着你已成功重置了本地和/或云目录中的密码。\n\n    ![][030]\n\n4.  若要验证操作是否成功或要诊断任何错误，请转到**目录同步计算机**，打开“事件查看器”，导航到**应用程序事件日志**，并从测试用户的源 **PasswordResetService** 查找事件 **31002 - PasswordResetSuccess**。\n\n    ![][031]\n\n\n<br/> <br/> <br/>\n\n## 密码重置文档的链接\n以下是所有 Azure AD 密码重置文档页面的链接：\n\n* [**重置自己的密码**](/documentation/articles/active-directory-passwords-update-your-own-password) - 了解如何以系统用户的身份重置或更改自己的密码\n* [**工作原理**](/documentation/articles/active-directory-passwords-how-it-works) - 了解六个不同的服务组件及其功能\n* [**自定义**](/documentation/articles/active-directory-passwords-customize) - 了解如何根据组织的需求自定义服务的外观和行为\n* [**最佳实践**](/documentation/articles/active-directory-passwords-best-practices) - 了解如何快速部署且有效管理组织的密码\n* [**深入分析**](/documentation/articles/active-directory-passwords-get-insights) - 了解集成式报告功能\n* [**常见问题**](/documentation/articles/active-directory-passwords-faq) - 获取常见问题的解答\n* [**故障排除**](/documentation/articles/active-directory-passwords-troubleshoot) - 了解如何快速排查服务的问题\n* [**了解更多**](/documentation/articles/active-directory-passwords-learn-more) - 深入探索服务工作原理的技术细节\n\n\n\n[001]: ./media/active-directory-passwords-getting-started/001.jpg \"Image_001.jpg\"\n[002]: ./media/active-directory-passwords-getting-started/002.jpg \"Image_002.jpg\"\n[003]: ./media/active-directory-passwords-getting-started/003.jpg \"Image_003.jpg\"\n[004]: ./media/active-directory-passwords-getting-started/004.jpg \"Image_004.jpg\"\n[005]: ./media/active-directory-passwords-getting-started/005.jpg \"Image_005.jpg\"\n[006]: ./media/active-directory-passwords-getting-started/006.jpg \"Image_006.jpg\"\n[007]: ./media/active-directory-passwords-getting-started/007.jpg \"Image_007.jpg\"\n[008]: ./media/active-directory-passwords-getting-started/008.jpg \"Image_008.jpg\"\n[009]: ./media/active-directory-passwords-getting-started/009.jpg \"Image_009.jpg\"\n[010]: ./media/active-directory-passwords-getting-started/010.jpg \"Image_010.jpg\"\n[011]: ./media/active-directory-passwords-getting-started/011.jpg \"Image_011.jpg\"\n[012]: ./media/active-directory-passwords-getting-started/012.jpg \"Image_012.jpg\"\n[013]: ./media/active-directory-passwords-getting-started/013.jpg \"Image_013.jpg\"\n[014]: ./media/active-directory-passwords-getting-started/014.jpg \"Image_014.jpg\"\n[015]: ./media/active-directory-passwords-getting-started/015.jpg \"Image_015.jpg\"\n[016]: ./media/active-directory-passwords-getting-started/016.jpg \"Image_016.jpg\"\n[017]: ./media/active-directory-passwords-getting-started/017.jpg \"Image_017.jpg\"\n[018]: ./media/active-directory-passwords-getting-started/018.jpg \"Image_018.jpg\"\n[019]: ./media/active-directory-passwords-getting-started/019.jpg \"Image_019.jpg\"\n[020]: ./media/active-directory-passwords-getting-started/020.jpg \"Image_020.jpg\"\n[021]: ./media/active-directory-passwords-getting-started/021.jpg \"Image_021.jpg\"\n[022]: ./media/active-directory-passwords-getting-started/022.jpg \"Image_022.jpg\"\n[023]: ./media/active-directory-passwords-getting-started/023.jpg \"Image_023.jpg\"\n[024]: ./media/active-directory-passwords-getting-started/024.jpg \"Image_024.jpg\"\n[025]: ./media/active-directory-passwords-getting-started/025.jpg \"Image_025.jpg\"\n[026]: ./media/active-directory-passwords-getting-started/026.jpg \"Image_026.jpg\"\n[027]: ./media/active-directory-passwords-getting-started/027.jpg \"Image_027.jpg\"\n[028]: ./media/active-directory-passwords-getting-started/028.jpg \"Image_028.jpg\"\n[029]: ./media/active-directory-passwords-getting-started/029.jpg \"Image_029.jpg\"\n[030]: ./media/active-directory-passwords-getting-started/030.jpg \"Image_030.jpg\"\n[031]: ./media/active-directory-passwords-getting-started/031.jpg \"Image_031.jpg\"\n[032]: ./media/active-directory-passwords-getting-started/032.jpg \"Image_032.jpg\"\n\n<!---HONumber=Mooncake_0118_2016-->"
}